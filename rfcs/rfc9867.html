<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9867: Mixing Preshared Keys in the IKE_INTERMEDIATE and CREATE_CHILD_SA Exchanges of the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-Quantum Security</title>
<meta content="Valery Smyslov" name="author">
<meta content="
        An Internet Key Exchange Protocol Version 2 (IKEv2) extension defined in RFC 8784 allows IPsec 
            traffic to be protected against someone storing VPN communications 
            and decrypting them later, when (and if) a Cryptographically Relevant Quantum Computer (CRQC) is available. 
            The protection is achieved by means of a Post-quantum Preshared Key (PPK) that is mixed into the session keys calculation.
            However, this protection does not cover an initial IKEv2 Security Association (SA), which might be unacceptable in some scenarios. 
            This specification defines an alternative way to provide protection against quantum computers, which 
            is similar to the solution defined in RFC 8784, but it also protects the initial IKEv2 SA.
       
        RFC 8784 assumes that PPKs are static and thus they are only used when 
            an initial IKEv2 SA is created. If a fresh PPK is available before the IKE SA expires, 
            then the only way to use it is to delete the current IKE SA and create a new one from scratch, which is inefficient.
            This specification defines a way to use PPKs in active IKEv2 SAs for creating additional IPsec SAs and rekey operations.
       
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="internet key exchange" name="keyword">
<meta content="quantum computer" name="keyword">
<meta content="post quantum" name="keyword">
<meta content="post-quantum" name="keyword">
<meta content="quantum safe" name="keyword">
<meta content="PPK" name="keyword">
<meta content="9867" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    wcwidth 0.2.5
    weasyprint 65.0
-->
<link href="rfc9867.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://static.ietf.org/fonts/noto-sans/import.css'); /* Sans-serif */
@import url('https://static.ietf.org/fonts/noto-serif/import.css'); /* Serif (print) */
@import url('https://static.ietf.org/fonts/roboto-mono/import.css'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
@media print {
  svg {
    max-height: 850px;
    max-width: 660px;
  }
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > blockquote:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-ikev2-qr-alt-10" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9867" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9867</td>
<td class="center">Enhanced Mixing PSKs in IKEv2 for PQ Sec</td>
<td class="right">November 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Smyslov</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9867" class="eref">9867</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-11" class="published">November 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9867</h1>
<h1 id="title">Mixing Preshared Keys in the IKE_INTERMEDIATE and CREATE_CHILD_SA Exchanges of the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-Quantum Security</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1"> An Internet Key Exchange Protocol Version 2 (IKEv2) extension defined in RFC 8784 allows IPsec 
            traffic to be protected against someone storing VPN communications 
            and decrypting them later, when (and if) a Cryptographically Relevant Quantum Computer (CRQC) is available. 
            The protection is achieved by means of a Post-quantum Preshared Key (PPK) that is mixed into the session keys calculation.
            However, this protection does not cover an initial IKEv2 Security Association (SA), which might be unacceptable in some scenarios. 
            This specification defines an alternative way to provide protection against quantum computers, which 
            is similar to the solution defined in RFC 8784, but it also protects the initial IKEv2 SA.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2"> RFC 8784 assumes that PPKs are static and thus they are only used when 
            an initial IKEv2 SA is created. If a fresh PPK is available before the IKE SA expires, 
            then the only way to use it is to delete the current IKE SA and create a new one from scratch, which is inefficient.
            This specification defines a way to use PPKs in active IKEv2 SAs for creating additional IPsec SAs and rekey operations.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9867">https://www.rfc-editor.org/info/rfc9867</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology-and-notation" class="internal xref">Terminology and Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-protocol-description" class="internal xref">Protocol Description</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-creating-initial-ike-sa" class="internal xref">Creating Initial IKE SA</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1" class="keepWithNext"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-computing-ike-sa-keys" class="internal xref">Computing IKE SA Keys</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-using-ppks-in-the-create_ch" class="internal xref">Using PPKs in the CREATE_CHILD_SA Exchange</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-computing-keys" class="internal xref">Computing Keys</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-comparison-of-this-specific" class="internal xref">Comparison of this Specification with RFC 8784</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1"> The Internet Key Exchange Protocol Version 2 (IKEv2), defined in <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>,
            is used in the IPsec architecture for performing authenticated key exchange.
            An extension to IKEv2 for mixing preshared keys for post-quantum security is defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.
            This extension allows today's IPsec traffic to be protected against future quantum computers. 
            The protection is achieved by means of using a Post-quantum Preshared Key (PPK) that is mixed into the session keys calculation.
            At the time this extension was being developed, the consensus in the IPsecME
            WG was that it was more important to protect the IPsec traffic than the IKE traffic.
It was believed that information transferred over IKE SA (including peers' identities) is less important
            and that extending the protection to also cover the initial IKE SA would require serious modifications to the core IKEv2 protocol.
            One of the goals was to minimize such changes. It was also decided that immediate rekey of initial IKE SA
            would add this protection to the new IKE SA (albeit it would not provide protection of the identity of the peers).<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"> However, in some situations, it is desirable to have this protection for the IKE SA from the very beginning,
            when an initial IKE SA is created. An example of such a situation is the Group Key Management protocol using IKEv2, 
            defined in <span>[<a href="#RFC9838" class="cite xref">RFC9838</a>]</span>. In this protocol, the group policy and session keys are transferred 
            from a Group Controller/Key Server (GCKS) to the Group Members (GMs) immediately once an initial IKE SA is created. 
            While session keys are additionally protected with a key derived from SK_d (and thus are immune to quantum computers if PPKs 
            <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> are employed), the other sensitive data, including group policy, is not.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"> Another issue with using PPKs as defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> is that this approach assumes that PPKs are static entities, 
            which are changed very infrequently. For this reason, PPKs are only used once when an initial IKE SA is established. 
            This restriction makes it difficult to use PPKs as defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> when 
            they are changed relatively frequently, for example, via the use of Quantum Key Distribution (QKD).
            If a fresh PPK becomes available before the IKE SA is expired, there is no way to use it except
            for deleting the IKE SA and recreating a new one from scratch using the fresh PPK.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4"> Some time after the protocol extension for mixing preshared keys in IKEv2 for post-quantum security was defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>, 
            a new IKE_INTERMEDIATE exchange for IKEv2 <span>[<a href="#RFC9242" class="cite xref">RFC9242</a>]</span> was developed. While the primary motivation for developing 
            this exchange was to allow multiple key exchanges to be used in IKEv2 (which is defined in <span>[<a href="#RFC9370" class="cite xref">RFC9370</a>]</span>),
            the IKE_INTERMEDIATE exchange itself can be used for other purposes too.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5"> This specification defines the use of PPKs in the IKE_INTERMEDIATE exchange of IKEv2 for post-quantum security, 
            which allows getting full protection against quantum computers for initial IKE SA.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6"> This specification also defines the use of PPKs in the CREATE_CHILD_SA exchange
            for creating additional IPsec SAs and for rekeying IKE and IPsec SAs.
            This allows implementations to leverage fresh PPKs without the need to delete the IKE SA and create it from scratch.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7"> This specification does not replace the approach defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.
            Both approaches for using PPKs in IKEv2 can be used depending on the circumstances
            (see <a href="#comparison" class="auto internal xref">Appendix A</a>).<a href="#section-1-7" class="pilcrow">¶</a></p>
</section>
<div id="mustshouldmay">
<section id="section-2">
      <h2 id="name-terminology-and-notation">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology-and-notation" class="section-name selfRef">Terminology and Notation</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2"> This document uses the terms defined in <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>. In particular, 
            readers should be familiar with the terms "initiator" and "responder" as used in that document.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3"> The approach defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> is referred to as "using PPKs in the IKE_AUTH exchange" or simply 
            "using PPKs in IKE_AUTH" throughout this document.<a href="#section-2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol">
<section id="section-3">
      <h2 id="name-protocol-description">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-description" class="section-name selfRef">Protocol Description</a>
      </h2>
<div id="init">
<section id="section-3.1">
        <h3 id="name-creating-initial-ike-sa">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-creating-initial-ike-sa" class="section-name selfRef">Creating Initial IKE SA</a>
        </h3>
<p id="section-3.1-1"> The IKE initiator, which supports the IKE_INTERMEDIATE exchange and wants to use a PPK to protect the initial IKE SA, 
            includes the INTERMEDIATE_EXCHANGE_SUPPORTED notification and a notification of type USE_PPK_INT in the IKE_SA_INIT request.
            If the responder supports the IKE_INTERMEDIATE exchange and is willing to use PPK for initial IKE SA protection,
            it includes both these notifications in the IKE_SA_INIT response.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-2">
<pre>
Initiator                       Responder
------------------------------------------------------------------
HDR, SAi1, KEi, Ni,
N(INTERMEDIATE_EXCHANGE_SUPPORTED),
N(USE_PPK_INT)              ---&gt;
                        &lt;---    HDR, SAr1, KEr, Nr, [CERTREQ,]
                                N(INTERMEDIATE_EXCHANGE_SUPPORTED),
                                N(USE_PPK_INT)</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3"> The USE_PPK_INT is a Status Type IKEv2 notification. Its Notify
        Message Type is 16445; the Protocol ID is set to 0; the Security
        Parameter Index (SPI) is absent, so the SPI Size is set to 0 too. This
        specification does not define any data that this notification may
        contain, so the Notification Data is left empty. However, future
        extensions of this specification may make use of it.  Implementations
        <span class="bcp14">MUST</span> ignore any data in the notification that they do
        not understand.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4"> Note that this negotiation is independent from the negotiation of using PPKs as specified in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.
            An initiator that supports both the use of PPKs in IKE_AUTH <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> and IKE_INTERMEDIATE <span class="bcp14">MAY</span> include both 
            the USE_PPK_INT and USE_PPK notifications if 
            configured to do so. However, if the responder supports both specifications 
            and is configured to use PPKs, it has to choose one to use; thus, it <span class="bcp14">MUST</span> return 
            either a USE_PPK_INT or a USE_PPK notification in the response but not both.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5"> If the initiator did not propose using this extension in the IKE_SA_INIT request and the responder's policy
            mandates protecting initial IKE SA with a PPK, then the responder <span class="bcp14">MUST</span> return the NO_PROPOSAL_CHOSEN notification.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6"> If the negotiation was successful, the initiator includes one or more 
            PPK_IDENTITY_KEY notifications in the IKE_INTERMEDIATE request with PPK identities that the initiator believes 
            are appropriate for the IKE SA being created.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7"> The PPK_IDENTITY_KEY is a Status Type IKEv2 notification. Its Notify Message Type
            is 16446; the Protocol ID and the SPI Size fields are both set to 0.
            The format of the Notification Data is shown below in <a href="#ppk_identity_key_format" class="auto internal xref">Figure 1</a>.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<span id="name-ppk_identity_key-notificati"></span><div id="ppk_identity_key_format">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-3.1-8.1">
<pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                             PPK_ID                            ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                        PPK Confirmation                       +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-ppk_identity_key-notificati" class="selfRef">PPK_IDENTITY_KEY Notification Data Format</a>
          </figcaption></figure>
</div>
<p id="section-3.1-9">Where:<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-10">
          <dt id="section-3.1-10.1">PPK_ID (variable):</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-10.2"> PPK_ID as defined in <span><a href="https://rfc-editor.org/rfc/rfc8784#section-5.1" class="relref">Section 5.1</a> of [<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.  The receiver can determine the
          length of PPK_ID by subtracting 8 (the length of PPK Confirmation)
          from the Notification Data length.<a href="#section-3.1-10.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-10.3">PPK Confirmation (8 octets):</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-10.4">
            <p id="section-3.1-10.4.1">A value that allows the
          responder to check whether it has the same PPK as the initiator for
          a given PPK_ID.  This field contains the first 8 octets of a string
          computed as prf( PPK, Ni | Nr | SPIi | SPIr ), where:<a href="#section-3.1-10.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.1-10.4.2.1">"prf" is the negotiated PRF;<a href="#section-3.1-10.4.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-3.1-10.4.2.2">PPK is the key value for a specified PPK_ID;<a href="#section-3.1-10.4.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-3.1-10.4.2.3">Ni, Nr, SPIi, SPIr are nonces and IKE SPIs for the SA being established.<a href="#section-3.1-10.4.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.1-11">If a series of the IKE_INTERMEDIATE exchanges takes place, the
        PPK_IDENTITY_KEY notification(s) <span class="bcp14">MUST</span> be sent in the
        last one, i.e., in the IKE_INTERMEDIATE exchange immediately preceding
        the IKE_AUTH exchange. If this IKE_INTERMEDIATE exchange contains
        other payloads aimed for some other purpose, then the notification(s)
        <span class="bcp14">MAY</span> be piggybacked with these payloads. Note that
        future IKEv2 extensions utilizing the IKE_INTERMEDIATE exchange may
        allow one or more of these exchanges to happen after the one concerned
        with PPK for the case when such extensions are negotiated.<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-12">
<pre>
Initiator                         Responder
------------------------------------------------------------------
HDR, SK { ... N(PPK_IDENTITY_KEY, PPK_ID_1)
           [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
           [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;</pre><a href="#section-3.1-12" class="pilcrow">¶</a>
</div>
<p id="section-3.1-13">
            Depending on the responder's capabilities and policy, the following situations are possible:<a href="#section-3.1-13" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1-14">
          <li id="section-3.1-14.1">
<div id="case1">
            <p id="section-3.1-14.1.1">If the responder is configured with a PPK with an ID that is
            among the IDs sent by the initiator, and if this PPK matches the
            initiator's PPK (based on the information from the PPK
            Confirmation field), then the responder selects this PPK and
            returns its identity in the PPK_IDENTITY notification.  The
            PPK_IDENTITY notification is defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.<a href="#section-3.1-14.1.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-14.1.2">
<pre>
Initiator                       Responder
---------------------------------------------------------------
               &lt;---    HDR, SK { ... N(PPK_IDENTITY, PPK_ID_i)}</pre><a href="#section-3.1-14.1.2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-14.1.3">
              In this case, the IKE_AUTH exchange is performed as defined in IKEv2 <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>.
              However, the keys for the IKE SA are computed using PPK, as described in <a href="#init_keys" class="auto internal xref">Section 3.1.1</a>.
              If the responder returns a PPK identity that was not proposed by the initiator, then the initiator
              <span class="bcp14">MUST</span> treat this as fatal and abort the IKE SA establishment.<a href="#section-3.1-14.1.3" class="pilcrow">¶</a></p>
</div>
          </li>
<li id="section-3.1-14.2">
<div id="case2">
            <p id="section-3.1-14.2.1">If the responder does not have a PPK with an ID that matches any
            of IDs sent by the initiator, or if the responder has some of the
            proposed PPKs but their values are mismatched from the initiator's
            PPKs (based on the information from the PPK Confirmation field),
            and if using PPK is mandatory for the responder, then it
            <span class="bcp14">MUST</span> return an AUTHENTICATION_FAILED notification
            and abort creating the IKE SA.<a href="#section-3.1-14.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-14.2.2">
<pre>
Initiator                       Responder
---------------------------------------------------------------
                 &lt;---    HDR, SK {... N(AUTHENTICATION_FAILED)}</pre><a href="#section-3.1-14.2.2" class="pilcrow">¶</a>
</div>
</div>
          </li>
<li id="section-3.1-14.3">
<div id="case3">
            <p id="section-3.1-14.3.1">
              If the responder does not have any PPKs proposed by the initiator,
              or if it has only some of the proposed PPKs but their values mismatch the initiator's ones 
              (based on the information from the PPK Confirmation field), and if using PPK is optional for the responder,
              then it does not include any PPK_IDENTITY notification to the response.<a href="#section-3.1-14.3.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-14.3.2">
<pre>
Initiator                       Responder
---------------------------------------------------------------
                        &lt;---    HDR, SK {...}</pre><a href="#section-3.1-14.3.2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-14.3.3">
              In this case, the initiator cannot achieve quantum computer resistance using the proposed PPKs.
              If this is a requirement for the initiator, then it <span class="bcp14">MUST</span> abort creating the IKE SA. 
              Otherwise, the initiator continues with the IKE_AUTH exchange as described in IKEv2 <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>.<a href="#section-3.1-14.3.3" class="pilcrow">¶</a></p>
</div>
        </li>
</ol>
<p id="section-3.1-15"><a href="#responders_behavior" class="auto internal xref">Table 1</a> summarizes the above logic for the responder:<a href="#section-3.1-15" class="pilcrow">¶</a></p>
<span id="name-responders-behavior"></span><div id="responders_behavior">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-responders-behavior" class="selfRef">Responder's Behavior</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Received USE_PPK_INT</th>
              <th class="text-left" rowspan="1" colspan="1">Supports USE_PPK_INT</th>
              <th class="text-left" rowspan="1" colspan="1">Has one of the proposed PPKs</th>
              <th class="text-left" rowspan="1" colspan="1">PPK is mandatory for initial IKE SA</th>
              <th class="text-left" rowspan="1" colspan="1">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">*</td>
              <td class="text-left" rowspan="1" colspan="1">*</td>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span> (if proposed) or standard IKEv2 protocol</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">*</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">Send NO_PROPOSAL_CHOSEN</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">*</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#case1" class="auto internal xref">Section 3.1, Paragraph 14, Item 1</a> (use this extension)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#case2" class="auto internal xref">Section 3.1, Paragraph 14, Item 2</a> (abort negotiation)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">Yes</td>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">No</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#case3" class="auto internal xref">Section 3.1, Paragraph 14, Item 3</a> (standard IKEv2 protocol)</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.1-17"> Since the responder selects a PPK before it knows the identity of the initiator, a situation may occur
            where the responder agrees to use some PPK in the IKE_INTERMEDIATE exchange but then, during the IKE_AUTH exchange, 
            discovers that this particular PPK is not associated with the initiator's identity in its local policy.
            Note that the responder does have this PPK, but it is just not listed among the PPKs to be used with this initiator.
            In this case, the responder <span class="bcp14">SHOULD</span> abort negotiation and return back the AUTHENTICATION_FAILED notification
            to be consistent with its policy. However, the responder <span class="bcp14">MAY</span> continue creating IKE SA using the negotiated 
            "wrong" PPK if this is acceptable according to its local policy.<a href="#section-3.1-17" class="pilcrow">¶</a></p>
<div id="init_keys">
<section id="section-3.1.1">
          <h4 id="name-computing-ike-sa-keys">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-computing-ike-sa-keys" class="section-name selfRef">Computing IKE SA Keys</a>
          </h4>
<p id="section-3.1.1-1">Once the PPK is negotiated in the IKE_INTERMEDIATE exchange, the
   IKE SA keys are recalculated.  Note that if the IKE SA keys are also
   recalculated as a result of other actions performed in this
   IKE_INTERMEDIATE exchange (for example, as defined in <span>[<a href="#RFC9370" class="cite xref">RFC9370</a>]</span>), then applying the PPK <span class="bcp14">MUST</span> be
   done after all of them so that recalculating IKE SA keys with the
   PPK is the last action before they are used in the next
   exchange. Note that future IKEv2 extensions utilizing the
   IKE_INTERMEDIATE exchange may update this requirement for the case
   when such extensions are negotiated.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2"> The IKE SA keys are computed differently compared to how PPKs
          are used in IKE_AUTH.  A new SKEYSEED' value is computed using the
          negotiated PPK and the most recently computed SK_d key.  Note that
          the PPK is applied to SK_d exactly how it is specified in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>, and the result is used as SKEYSEED'.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.1-3">
<pre>
SKEYSEED' = prf+ (PPK, SK_d)</pre><a href="#section-3.1.1-3" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-4">
              Then the SKEYSEED' is used to recalculate all SK_* keys as defined in <span><a href="https://rfc-editor.org/rfc/rfc7296#section-2.14" class="relref">Section 2.14</a> of [<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>.<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.1-5">
<pre>
{SK_d | SK_ai | SK_ar | SK_ei | SK_er | SK_pi | SK_pr}
                           = prf+ (SKEYSEED', Ni | Nr | SPIi | SPIr )</pre><a href="#section-3.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-6">

              In the formula above, Ni and Nr are nonces from the IKE_SA_INIT exchange, and SPIi and SPIr are the SPIs of the IKE SA being created.
              Note that SK_d, SK_pi, and SK_pr are not individually recalculated using PPK, as defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.<a href="#section-3.1.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1.1-7"> The resulting keys are then used in the IKE_AUTH exchange and in the created IKE SA.<a href="#section-3.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="create_child_sa">
<section id="section-3.2">
        <h3 id="name-using-ppks-in-the-create_ch">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-using-ppks-in-the-create_ch" class="section-name selfRef">Using PPKs in the CREATE_CHILD_SA Exchange</a>
        </h3>
<p id="section-3.2-1"> If a fresh PPK is available to both peers at the time when an IKE SA is active, 
            peers <span class="bcp14">MAY</span> use this fresh PPK without creating a new IKE SA from scratch
            when they have a need to create additional IPsec SAs or to rekey existing SAs.
            In this case, the PPK can be used for creating additional IPsec SAs and for rekeying both IKE and IPsec SAs
            regardless of whether the current IKE SA was created with the use of a PPK 
            (no matter how: in IKE_AUTH, in IKE_INTERMEDIATE, or in CREATE_CHILD_SA) or not.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2"> If the initiator wants to use a PPK in the CREATE_CHILD_SA exchange, it includes one or more 
            PPK_IDENTITY_KEY notifications containing PPK identities that the initiator believes 
            are appropriate for the SA being created in the CREATE_CHILD_SA request.
            In this case, the PPK Confirmation field contains the first 8 octets of a string computed as prf( PPK, Ni | SPIi | SPIr ),
            where Ni is the initiator's nonce from the CREATE_CHILD_SA request and SPIi/SPIr are the SPIs of the current IKE SA.
            If the responder supports using PPKs in the CREATE_CHILD_SA exchange and is configured and ready to do it, 
            then it sends back the PPK_IDENTITY notification containing the ID of the selected PPK, as depicted in the figures below.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<span id="name-create_child_sa-exchange-fo"></span><figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.2-3.1">
<pre>
Initiator                         Responder
------------------------------------------------------------------
HDR, SK {[N(REKEY_SA),] SA, Ni, [KEi,] TSi, TSr,
        N(PPK_IDENTITY_KEY, PPK_ID_1)
        [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
        [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;

                         &lt;---    HDR, SK {SA, Nr [KEr,] TSi, TSr,
                                         N(PPK_IDENTITY, PPK_ID_i)}</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-create_child_sa-exchange-fo" class="selfRef">CREATE_CHILD_SA Exchange for Creating or Rekeying Child SAs</a>
          </figcaption></figure>
<span id="name-create_child_sa-exchange-for"></span><figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-3.2-4.1">
<pre>
Initiator                         Responder
------------------------------------------------------------------
HDR, SK {SA, Ni, KEi,
        N(PPK_IDENTITY_KEY, PPK_ID_1)
        [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
        [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;

                         &lt;---    HDR, SK {SA, Nr, KEr,
                                         N(PPK_IDENTITY, PPK_ID_i)}</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-create_child_sa-exchange-for" class="selfRef">CREATE_CHILD_SA Exchange for Rekeying IKE SA</a>
          </figcaption></figure>
<p id="section-3.2-5">
   If the responder does not support (or is not configured for) using
   PPKs in the CREATE_CHILD_SA exchange or does not have a PPK with an
   ID that matches any of IDs sent by the initiator, or if the
   responder has some of the proposed PPKs but their values are
   mismatched from the initiator's PPKs (based on the information from
   the PPK Confirmation field), then it will not include any
   PPK_IDENTITY notifications in the response, and new SA is created as
   defined in IKEv2 <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>. If this is inappropriate
   for the initiator, it can immediately delete this SA.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">
   If using PPKs in CREATE_CHILD_SA is mandatory for the responder, and
   the initiator does not include any PPK_IDENTITY_KEY notifications in
   the request, or if the responder does not have a PPK with an ID that
   matches any of IDs sent by the initiator, or if the responder has
   some of the proposed PPKs but with mismatched values from the
   initiator's PPKs (based on the information from the PPK Confirmation
   field), then the responder <span class="bcp14">MUST</span> return the
   NO_PROPOSAL_CHOSEN notification.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7"> Otherwise, the new SA is created using the selected PPK.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<div id="create_child_sa_keys">
<section id="section-3.2.1">
          <h4 id="name-computing-keys">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-computing-keys" class="section-name selfRef">Computing Keys</a>
          </h4>
<p id="section-3.2.1-1"> For the purpose of calculation session keys for the new SA, the current SK_d key is first
              mixed with the selected PPK:<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2.1-2">
<pre>
SK_d' = prf+ (PPK, SK_d)</pre><a href="#section-3.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2.1-3">

              The resulting key SK_d' is then used instead of SK_d in all formulas for computing keys for the new SA
              (Sections <a href="https://rfc-editor.org/rfc/rfc7296#section-2.17" class="relref">2.17</a> and <a href="https://rfc-editor.org/rfc/rfc7296#section-2.18" class="relref">2.18</a> of <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc9370#section-2.2.4" class="relref">Section 2.2.4</a> of [<a href="#RFC9370" class="cite xref">RFC9370</a>]</span>).<a href="#section-3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-3.2.1-4"> Note that if the PPK that was used for the IKE SA establishment is not changed, then there is no point
              to use it in the CREATE_CHILD_SA exchange.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-4-1"> Security considerations for using Post-quantum Preshared Keys
            in the IKEv2 protocol are discussed in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.
            Unlike using PPKs in IKE_AUTH, this specification makes even initial IKE SA quantum
            secure. In addition, a PPK is mixed into the SK_* keys calculation 
            before the IKE_AUTH exchange starts, and since the PPK is used in authentication too, 
            this exchange is quantum secure even against an active attacker.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2"> This specification relies on the IKE_INTERMEDIATE exchange.
            Refer to <span>[<a href="#RFC9242" class="cite xref">RFC9242</a>]</span> for discussion of related security issues.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3"> <span><a href="https://rfc-editor.org/rfc/rfc9370#section-4" class="relref">Section 4</a> of [<a href="#RFC9370" class="cite xref">RFC9370</a>]</span> discusses the potential impact
      of when a CRQC is accessible on various cryptographic primitives used in
      IKEv2.  It is worthwhile to repeat here that it is believed that the
      security of symmetric key cryptographic primitives will not be affected
      by CRQC.<a href="#section-4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-5">
      <h2 id="name-iana-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-5-1">Per this document, IANA has added the following Notify Message Types in the "IKEv2 Notify Message Status Types" registry:<a href="#section-5-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-5-2">
        <dt id="section-5-2.1">16445</dt>
        <dd style="margin-left: 1.5em" id="section-5-2.2">USE_PPK_INT<a href="#section-5-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-5-2.3">16446</dt>
        <dd style="margin-left: 1.5em" id="section-5-2.4">PPK_IDENTITY_KEY<a href="#section-5-2.4" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<section id="section-6">
      <h2 id="name-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-6.1">
        <h3 id="name-normative-references">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8784">[RFC8784]</dt>
        <dd>
<span class="refAuthor">Fluhrer, S.</span>, <span class="refAuthor">Kampanakis, P.</span>, <span class="refAuthor">McGrew, D.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security"</span>, <span class="seriesInfo">RFC 8784</span>, <span class="seriesInfo">DOI 10.17487/RFC8784</span>, <time datetime="2020-06" class="refDate">June 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8784">https://www.rfc-editor.org/info/rfc8784</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9242">[RFC9242]</dt>
      <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Intermediate Exchange in the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 9242</span>, <span class="seriesInfo">DOI 10.17487/RFC9242</span>, <time datetime="2022-05" class="refDate">May 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9242">https://www.rfc-editor.org/info/rfc9242</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-6.2">
        <h3 id="name-informative-references">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC9838">[RFC9838]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span> and <span class="refAuthor">B. Weis</span>, <span class="refTitle">"Group Key Management Using the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 9838</span>, <span class="seriesInfo">DOI 10.17487/RFC9838</span>, <time datetime="2025-11" class="refDate">November 2025</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9838">https://www.rfc-editor.org/info/rfc9838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9370">[RFC9370]</dt>
      <dd>
<span class="refAuthor">Tjhai, CJ.</span>, <span class="refAuthor">Tomlinson, M.</span>, <span class="refAuthor">Bartlett, G.</span>, <span class="refAuthor">Fluhrer, S.</span>, <span class="refAuthor">Van Geest, D.</span>, <span class="refAuthor">Garcia-Morchon, O.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Multiple Key Exchanges in the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 9370</span>, <span class="seriesInfo">DOI 10.17487/RFC9370</span>, <time datetime="2023-05" class="refDate">May 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9370">https://www.rfc-editor.org/info/rfc9370</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="comparison">
<section id="appendix-A">
      <h2 id="name-comparison-of-this-specific">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-comparison-of-this-specific" class="section-name selfRef">Comparison of this Specification with RFC 8784</a>
      </h2>
<p id="appendix-A-1"> This specification is not intended to be a replacement for using PPKs in IKE_AUTH as defined in <span>[<a href="#RFC8784" class="cite xref">RFC8784</a>]</span>.
            Instead, it is supposed to be used in situations where the approach defined there 
            does not meet the requirements, like the need to make the initial IKE SA quantum-secure or 
            the need to choose between several available PPKs.
            However, if the peers support both using PPKs in IKE_AUTH and this specification, 
            then the latter may also be used in situations where using PPKs in IKE_AUTH suffices
            (e.g., when the initial IKE SA is not required to be quantum-protected).<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2"> The approach defined in this document has the following advantages:<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-A-3">
 <li id="appendix-A-3.1">
          <p id="appendix-A-3.1.1"> The main advantage of using PPK in the IKE_INTERMEDIATE exchange instead of the IKE_AUTH exchange is that it allows IKE_AUTH to be fully protected. 
                This means that the ID payloads and any other sensitive content sent in the IKE_AUTH are protected against quantum computers.
                The same is true for the sensitive data sent in the GSA_AUTH exchange in the G-IKEv2 protocol <span>[<a href="#RFC9838" class="cite xref">RFC9838</a>]</span>.<a href="#appendix-A-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-A-3.2">
          <p id="appendix-A-3.2.1"> In addition to the IKE_AUTH exchange being fully protected, the initial IKE SA is also fully protected, which is important when
                sensitive information is transferred over initial IKE SA. Examples of such a
                situation are the CREATE_CHILD_SA exchange of IKEv2 and the GSA_REGISTRATION exchange of G-IKEv2 <span>[<a href="#RFC9838" class="cite xref">RFC9838</a>]</span>.<a href="#appendix-A-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-A-3.3">
          <p id="appendix-A-3.3.1"> As the PPK exchange happens as a separate exchange before IKE_AUTH, this means that initiator can propose several PPKs and
                the responder can pick one. This is not possible when the PPK exchange happens in the IKE_AUTH. This feature could simplify PPK
                rollover.<a href="#appendix-A-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="appendix-A-3.4">
          <p id="appendix-A-3.4.1"> With this specification there is no need for the initiator to calculate the content of the AUTH payload twice (with and
                without PPK) to support a situation when using PPK is optional for both sides.<a href="#appendix-A-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="appendix-A-4">
            The main disadvantage of the approach defined in this document is that it always requires an additional round trip (the IKE_INTERMEDIATE exchange)
            to set up the IKE SA and the initial IPsec SA. However, if the IKE_INTERMEDIATE exchange has to be used for some other purposes in any case,
            then the PPK-related payloads can be piggybacked with other payloads, thus eliminating this penalty.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-B">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-B-1"> Author would like to thank <span class="contact-name">Paul Wouters</span> for
      valuable comments and <span class="contact-name">Tero Kivinen</span> who made a
      thorough review of the document and proposed a lot of text improvements,
      and who also pointed out to the problem of mismatched preshared
      keys. Thanks to <span class="contact-name">Rebecca Guthrie</span> for providing
      comments and proposals for the document and to <span class="contact-name">Mikhail Borodin</span> for discovering the problem of calculating
      PPK Confirmation in CREATE_CHILD_SA.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Valery Smyslov</span></div>
<div dir="auto" class="left"><span class="org">ELVIS-PLUS</span></div>
<div dir="auto" class="left"><span class="street-address">PO Box 81</span></div>
<div dir="auto" class="left"><span class="locality">Moscow (Zelenograd)</span></div>
<div dir="auto" class="left"><span class="postal-code">124460</span></div>
<div dir="auto" class="left"><span class="country-name">Russian Federation</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+7%20495%20276%200211" class="tel">+7 495 276 0211</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:svan@elvis.ru" class="email">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
