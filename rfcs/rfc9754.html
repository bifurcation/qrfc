<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9754: Extensions for Opening and Delegating Files in NFSv4.2</title>
<meta content="Thomas Haynes" name="author">
<meta content="Trond Myklebust" name="author">
<meta content="
       
      The Network File System v4 (NFSv4) allows a client to both open a
      file and be granted a delegation of that file.  This delegation
      provides the client the right to authoritatively cache metadata
      on the file locally.  This document presents several extensions
      for both opening the file and delegating it to
      the client. This document extends NFSv4.2 (see RFC 7863).
       
    " name="description">
<meta content="xml2rfc 3.28.0" name="generator">
<meta content="NFSv4" name="keyword">
<meta content="9754" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.28.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 64.1
-->
<link href="rfc9754.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-nfsv4-delstid-08" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9754" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9754</td>
<td class="center">Delegation of Stateids</td>
<td class="right">March 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Haynes &amp; Myklebust</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9754" class="eref">9754</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-03" class="published">March 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Haynes</div>
<div class="org">Hammerspace</div>
</div>
<div class="author">
      <div class="author-name">T. Myklebust</div>
<div class="org">Hammerspace</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9754</h1>
<h1 id="title">Extensions for Opening and Delegating Files in NFSv4.2</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
      The Network File System v4 (NFSv4) allows a client to both open a
      file and be granted a delegation of that file.  This delegation
      provides the client the right to authoritatively cache metadata
      on the file locally.  This document presents several extensions
      for both opening the file and delegating it to
      the client. This document extends NFSv4.2 (see RFC 7863).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9754">https://www.rfc-editor.org/info/rfc9754</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-definitions" class="internal xref">Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-requirements-language" class="internal xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-offline-files" class="internal xref">Offline Files</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-xdr-for-the-offline-attribu" class="internal xref">XDR for the Offline Attribute</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-determining-open-feature-su" class="internal xref">Determining OPEN Feature Support</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-xdr-for-open-arguments" class="internal xref">XDR for Open Arguments</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-open-grants-either-an-open-" class="internal xref">OPEN Grants Either an Open or a Delegation Stateid</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-implementation-experience" class="internal xref">Implementation Experience</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-proxying-of-times" class="internal xref">Proxying of Times</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-use-case-for-nfsv3-client-p" class="internal xref">Use Case for NFSv3 Client Proxy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-xdr-for-proxying-of-times" class="internal xref">XDR for Proxying of Times</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-extraction-of-xdr" class="internal xref">Extraction of XDR</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sec_intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
    In the Network File System version 4 (NFSv4), a client may be granted a
    delegation for a file (see <span><a href="https://rfc-editor.org/rfc/rfc8881#section-1.8.4" class="relref">Section 1.8.4</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>). This allows the client to act as the authority for
    the file's data and metadata. This document presents a number of
    extensions that enhance the functionality of opens and delegations. These
    allow the client to:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-2.1">detect an offline file, which may require significant effort to obtain;<a href="#section-1-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.2">determine which extensions of OPEN flags are supported by the server;<a href="#section-1-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.3">retrieve either the open or delegation stateid, but not
    both simultaneously, during the OPEN procedure; and<a href="#section-1-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.4">cache both the access and modify timestamps, thereby reducing the
    frequency with which the client must query the server for this
    information.<a href="#section-1-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-3">
    Using the process detailed in <span>[<a href="#RFC8178" class="cite xref">RFC8178</a>]</span>, the revisions in this document become an extension
    of NFSv4.2 <span>[<a href="#RFC7862" class="cite xref">RFC7862</a>]</span>. They are built on top of the External Data
    Representation (XDR) <span>[<a href="#RFC4506" class="cite xref">RFC4506</a>]</span> generated from <span>[<a href="#RFC7863" class="cite xref">RFC7863</a>]</span>.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="sec_defs">
<section id="section-1.1">
        <h3 id="name-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-definitions" class="section-name selfRef">Definitions</a>
        </h3>
<p id="section-1.1-1">This document uses the following terminology:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-2">
          <dt id="section-1.1-2.1">offline file:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-2.2">
        A file that exists on a device that is not connected to the
        server. There is typically a cost associated with bringing the
        file to an online status. Historically, this would be a file on
        tape media, and the cost would have been finding and loading the
        tape. A more modern interpretation is that the file is in the
        cloud, and the cost is a monetary one in downloading the file.<a href="#section-1.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.3">proxy:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-2.4">
        The proxying of attributes occurs when a client has the authority, as
        granted by the appropriate delegation, to represent the attributes
        normally maintained by the server.  For read attributes, this
        occurs when the client has either a read or write delegation
        for the file. For write attributes, this occurs when the client
        has a write delegation for the file.  The client having this
        authority is the "proxy" for those attributes.<a href="#section-1.1-2.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.1-3">Further, the definitions of the following terms are referenced
      as follows:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">CB_GETATTR (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-20.1" class="relref">Section 20.1</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.2">change (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-5.8.1.4" class="relref">Section 5.8.1.4</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.3">CLOSE (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.2" class="relref">Section 18.2</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.4">compound (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-2.3" class="relref">Section 2.3</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.5">DELEGRETURN (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.6" class="relref">Section 18.6</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.6">GETATTR (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.7" class="relref">Section 18.7</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.7">LAYOUTGET (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.43" class="relref">Section 18.43</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.8">LOCK (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.10" class="relref">Section 18.10</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.9">NFS4ERR_DELAY (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-15.1.1.3" class="relref">Section 15.1.1.3</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.10">OPEN (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.16" class="relref">Section 18.16</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.11">open_delegation_type4 (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.16.1" class="relref">Section 18.16.1</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.11" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.12">READ (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.22" class="relref">Section 18.22</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.13">READDIR (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.23" class="relref">Section 18.23</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.14">SETATTR (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.30" class="relref">Section 18.30</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.14" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.15">stateid (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.15" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.16">time_access (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-5.8.2.37" class="relref">Section 5.8.2.37</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.16" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.17">time_metadata (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-5.8.2.42" class="relref">Section 5.8.2.42</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.17" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.18">time_modify (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-5.8.2.43" class="relref">Section 5.8.2.43</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.18" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.19">WRITE (<span><a href="https://rfc-editor.org/rfc/rfc8881#section-18.32" class="relref">Section 18.32</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>)<a href="#section-1.1-4.19" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<section id="section-1.2">
        <h3 id="name-requirements-language">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="sec_offline">
<section id="section-2">
      <h2 id="name-offline-files">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-offline-files" class="section-name selfRef">Offline Files</a>
      </h2>
<p id="section-2-1">
    If a file is offline, then the server has immediate high-performance
    access to the file's attributes, but not to the file's content.
    The action of retrieving the data content is expensive, to the extent
    that the content should only be retrieved if it is going to be used.
    For example, a graphical file manager (such as Finder in Mac OS X) may
    want to access the beginning of the file to preview it for a user
    who is hovering their pointer over the file name and not accessing
    it otherwise.  If the file is retrieved, it will most likely be either
    immediately thrown away or returned.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">
    A compound with a GETATTR  or READDIR  can report the file's attributes
    without bringing the file online.  However, either an OPEN or a LAYOUTGET
    might cause the file server to retrieve the archived data contents, bringing the
    file online.  For non-parallel NFS systems (see <span><a href="https://rfc-editor.org/rfc/rfc8881#section-12" class="relref">Section 12</a> of [<a href="#RFC8881" class="cite xref">RFC8881</a>]</span>), the OPEN operation
    requires a filehandle to retrieve the data content. For parallel NFS (pNFS) systems, the
    filehandle retrieved from an OPEN need not cause the data content to be
    retrieved. However, when the LAYOUTGET operation is processed, a layout-type-specific mapping
     will cause the data content to be retrieved from offline
    storage.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">
    If the client is not aware that the file is offline, it might
    inadvertently open the file to determine what type of file it
    is accessing.  By interrogating the new attribute fattr4_offline,
    a client can predetermine the availability of the file, avoiding the
    need to open it at all. Being offline might also involve situations
    in which the file is archived in the cloud, i.e., there can be an
    expense in both retrieving the file to bring it online and in sending
    the file back to offline status.<a href="#section-2-3" class="pilcrow">¶</a></p>
<div id="ssec_offline_attr">
<section id="section-2.1">
        <h3 id="name-xdr-for-the-offline-attribu">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-xdr-for-the-offline-attribu" class="section-name selfRef">XDR for the Offline Attribute</a>
        </h3>
<div class="lang-xdr sourcecode" id="section-2.1-1">
<pre>&lt;CODE BEGINS&gt;
///
/// typedef bool            fattr4_offline;
///
///
/// const FATTR4_OFFLINE            = 83;
///

&lt;CODE ENDS&gt;</pre><a href="#section-2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="ssec_open_xor_xdr">
<section id="section-3">
      <h2 id="name-determining-open-feature-su">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-determining-open-feature-su" class="section-name selfRef">Determining OPEN Feature Support</a>
      </h2>
<p id="section-3-1">
    <span><a href="https://rfc-editor.org/rfc/rfc8178#section-4.4.2" class="relref">Section 4.4.2</a> of [<a href="#RFC8178" class="cite xref">RFC8178</a>]</span> allows for
    extending a particular minor version of the NFSv4 protocol without
    requiring the definition of a new minor version.  The client can probe the
    capabilities of the server and, based on the result, determine if both it
    and the server support optional features not previously specified as part
    of the minor version.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
    The fattr4_open_arguments attribute is a new XDR extension that
    provides helpful support when the OPEN procedure is extended in
    such a fashion. It models all of the parameters via bitmap4 data
    structures, which allows for the addition of a new flag to any of
    the OPEN arguments. The scope of this attribute
    applies to all objects with a matching fsid.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
    Two new flags are provided:<a href="#section-3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-4.1">
      OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION
      (see <a href="#sec_open_xor" class="auto internal xref">Section 4</a>)<a href="#section-3-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-4.2">
      OPEN4_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS
      (see <a href="#sec_proxy" class="auto internal xref">Section 5</a>)<a href="#section-3-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-5">
    Subsequent extensions can use this framework when introducing new
    <span class="bcp14">OPTIONAL</span> functionality to OPEN by creating a new
    flag for each <span class="bcp14">OPTIONAL</span> parameter.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">
    Since fattr4_open_arguments is a <span class="bcp14">RECOMMENDED</span> attribute, if the
    server informs the client via NFS4ERR_ATTRNOTSUPP that it does not support this new
    attribute, the client <span class="bcp14">MUST</span> take this to mean that
    the additional new <span class="bcp14">OPTIONAL</span> functionality to OPEN
    is also not supported.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">
    Some other concerns are how to process both currently
    <span class="bcp14">REQUIRED</span> flags and <span class="bcp14">OPTIONAL</span> flags that
    become <span class="bcp14">REQUIRED</span> in the future.  The server
    <span class="bcp14">MUST</span> mark <span class="bcp14">REQUIRED</span> flags as being supported.
    Note that these flags <span class="bcp14">MUST</span> only change from
    <span class="bcp14">OPTIONAL</span> to <span class="bcp14">REQUIRED</span> when the NFSv4 minor
    version is incremented.<a href="#section-3-7" class="pilcrow">¶</a></p>
<div id="ssec_open_xdr">
<section id="section-3.1">
        <h3 id="name-xdr-for-open-arguments">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-xdr-for-open-arguments" class="section-name selfRef">XDR for Open Arguments</a>
        </h3>
<div class="breakable lang-xdr sourcecode" id="section-3.1-1">
<pre>&lt;CODE BEGINS&gt;
///
/// struct open_arguments4 {
///   bitmap4  oa_share_access;
///   bitmap4  oa_share_deny;
///   bitmap4  oa_share_access_want;
///   bitmap4  oa_open_claim;
///   bitmap4  oa_create_mode;
/// };
///
///
/// enum open_args_share_access4 {
///    OPEN_ARGS_SHARE_ACCESS_READ  = 1,
///    OPEN_ARGS_SHARE_ACCESS_WRITE = 2,
///    OPEN_ARGS_SHARE_ACCESS_BOTH  = 3
/// };
///
///
/// enum open_args_share_deny4 {
///    OPEN_ARGS_SHARE_DENY_NONE  = 0,
///    OPEN_ARGS_SHARE_DENY_READ  = 1,
///    OPEN_ARGS_SHARE_DENY_WRITE = 2,
///    OPEN_ARGS_SHARE_DENY_BOTH  = 3
/// };
///
///
/// enum open_args_share_access_want4 {
///    OPEN_ARGS_SHARE_ACCESS_WANT_ANY_DELEG           = 3,
///    OPEN_ARGS_SHARE_ACCESS_WANT_NO_DELEG            = 4,
///    OPEN_ARGS_SHARE_ACCESS_WANT_CANCEL              = 5,
///    OPEN_ARGS_SHARE_ACCESS_WANT_SIGNAL_DELEG_WHEN_RESRC_AVAIL
///                                                    = 17,
///    OPEN_ARGS_SHARE_ACCESS_WANT_PUSH_DELEG_WHEN_UNCONTENDED
///                                                    = 18,
///    OPEN_ARGS_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS    = 20,
///    OPEN_ARGS_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION = 21
/// };
///
///
/// enum open_args_open_claim4 {
///    OPEN_ARGS_OPEN_CLAIM_NULL          = 0,
///    OPEN_ARGS_OPEN_CLAIM_PREVIOUS      = 1,
///    OPEN_ARGS_OPEN_CLAIM_DELEGATE_CUR  = 2,
///    OPEN_ARGS_OPEN_CLAIM_DELEGATE_PREV = 3,
///    OPEN_ARGS_OPEN_CLAIM_FH            = 4,
///    OPEN_ARGS_OPEN_CLAIM_DELEG_CUR_FH  = 5,
///    OPEN_ARGS_OPEN_CLAIM_DELEG_PREV_FH = 6
/// };
///
///
/// enum open_args_createmode4 {
///    OPEN_ARGS_CREATEMODE_UNCHECKED4     = 0,
///    OPEN_ARGS_CREATE_MODE_GUARDED       = 1,
///    OPEN_ARGS_CREATEMODE_EXCLUSIVE4     = 2,
///    OPEN_ARGS_CREATE_MODE_EXCLUSIVE4_1  = 3
/// };
///
///
/// typedef open_arguments4 fattr4_open_arguments;
///
///
/// %/*
/// % * Determine what OPEN supports.
/// % */
/// const FATTR4_OPEN_ARGUMENTS     = 86;
///
///
/// const OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION = 0x200000;
///
///
/// const OPEN4_RESULT_NO_OPEN_STATEID = 0x00000010;
///

&lt;CODE ENDS&gt;</pre><a href="#section-3.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sec_open_xor">
<section id="section-4">
      <h2 id="name-open-grants-either-an-open-">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-open-grants-either-an-open-" class="section-name selfRef">OPEN Grants Either an Open or a Delegation Stateid</a>
      </h2>
<p id="section-4-1">
    The OPEN 
    procedure returns an open stateid to the client to reference the state of
    the file.  The client could also request a delegation stateid in the OPEN
    arguments.  The file can be considered open for the client as long as the
    count of open and delegated stateids is greater than 0.  Either type of
    stateid is sufficient to enable the server to treat the file as if it were
    open, which allows READ, WRITE, LOCK, and LAYOUTGET  operations to proceed. If the client
    gets both an open and a delegation stateid as part of the OPEN, then it
    has to return them both to the server.  A further consideration is that
    during each operation, the client can send a costly GETATTR.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">
    If the client knows that the server supports the
    OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION flag (as determined by an
    earlier GETATTR operation that queried for the fattr4_open_arguments
    attribute), then the client can supply that flag during the OPEN and
    get either an open or a delegation stateid.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">
    The client is already prepared to not get a delegation
    stateid, even if requested. In order to not send an open
    stateid, the server <span class="bcp14">MUST</span> indicate that fact with the result
    flag of OPEN4_RESULT_NO_OPEN_STATEID. The open stateid field,
    OPEN4resok.stateid, <span class="bcp14">MUST</span> be set to the
    special all-zero stateid in this case.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">
    Note that the OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION flag is a
    hint. The server might return both stateids. Consider the scenario in
    which the client opens a file for read-only (with
    OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION set) and only gets an open
    stateid. If the client then opens the file for read-write (with
    OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION set), the server can return
    one of the following three options:<a href="#section-4-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-5">
    <li id="section-4-5.1">Only an open stateid with the correct seqid.<a href="#section-4-5.1" class="pilcrow">¶</a>
</li>
        <li id="section-4-5.2">Only a delegation stateid with the open stateid now having an incorrect seqid as it needs to be upgraded.<a href="#section-4-5.2" class="pilcrow">¶</a>
</li>
        <li id="section-4-5.3">Both an open stateid (which will be upgraded) and a delegation stateid.<a href="#section-4-5.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-4-6">
    In this scenario, returning just a delegation stateid would hide
    information from the client. If the client already has an open stateid,
    then the server <span class="bcp14">SHOULD</span> ignore the
    OPEN4_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION flag and return both the open
    and delegation stateids.<a href="#section-4-6" class="pilcrow">¶</a></p>
<div id="delstid_analysis">
<section id="section-4.1">
        <h3 id="name-implementation-experience">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-implementation-experience" class="section-name selfRef">Implementation Experience</a>
        </h3>
<p id="section-4.1-1">
      The CLOSE operation neither explicitly nor implicitly releases any
      delegation stateids. This is not symmetrical with the OPEN operation,
      which can grant both an open and a delegation stateid.  This specification
      could have tried to extend the CLOSE operation to release both
      stateids, but implementation experience shows that is more costly
      than the approach that has been proposed.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
      Consider a small workload of creating a file with content. This involves
      three synchronous operations and one asynchronous operation with
      existing implementations:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-3.1">The first synchronous operation has to OPEN the file.<a href="#section-4.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-3.2">The second synchronous operation performs the WRITE to the file.<a href="#section-4.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-3.3">The third synchronous operation has to CLOSE the file.<a href="#section-4.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-3.4">The asynchronous operation uses DELEGRETURN to return the delegation stateid.<a href="#section-4.1-3.4" class="pilcrow">¶</a>
</li>
        </ul>
<div class="lang-pseudocode sourcecode" id="section-4.1-4">
<pre>&lt;CODE BEGINS&gt;
      SEQ PUTFH OPEN GETFH GETATTR
      SEQ PUTFH WRITE GETATTR
      SEQ PUTFH CLOSE
      ...
      SEQ PUTFH DELEGRETURN

&lt;CODE ENDS&gt;</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">
      With the proposed approach of setting the
      OPEN_ARGS_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION flag during
      the OPEN, the number of operations is always three.  The first two
      compounds are still synchronous, but the last is asynchronous. That is,
      since the client no longer has to send a CLOSE operation, it can
      delay the DELEGRETURN until either the server requests it back
      via delegation recall or garbage collection causes the client to
      return the stateid.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.1-6">
<pre>&lt;CODE BEGINS&gt;
      SEQ PUTFH OPEN(OPEN_ARGS_SHARE_ACCESS_WANT_OPEN_XOR_DELEGATION)
          GETFH GETATTR
      SEQ PUTFH WRITE GETATTR
      ...
      SEQ PUTFH DELEGRETURN

&lt;CODE ENDS&gt;</pre><a href="#section-4.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1-7">
      This approach reduces the cost of synchronous operations by 33%
      and the total number of operations by 25%. Contrast that with
      the alternative proposal of having CLOSE return both stateids,
      which would not reduce the number of synchronous operations.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec_proxy">
<section id="section-5">
      <h2 id="name-proxying-of-times">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-proxying-of-times" class="section-name selfRef">Proxying of Times</a>
      </h2>
<p id="section-5-1">
    When a client is granted a write delegation on a file, it becomes the
    authority for the file contents and associated attributes.  If the server
    queries the client as to the state of the file via a CB_GETATTR, then according to
    the unextended NFSv4 protocol, it can only determine the size of the file
    and the change attribute. In the case of the client holding the
    delegation, it has the current values of the access and modify times.
    There is no way that other clients can have access to these values.  To
    notify the server of the proxied values, the client could send a compound
    of the form SEQ, PUTFH, SETATTR (time_modify | time_access), DELEGRETURN;
    however, the SETATTR operation would cause either or both of the change attribute
    or time_metadata attribute to be modified to the current time on the server.

    There is no current provision to obtain these values before
    delegation return using CB_GETATTR. As a result, it cannot pass on these
    times to an application expecting POSIX compliance, as is often
    necessary for correct operation.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
    With the addition of the new 
    OPEN4_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS flag, the client and server can
    negotiate that the client will be the authority for these values, and upon
    return of the delegation stateid via a DELEGRETURN, the times will be
    passed back to the server. If the server is queried by another client for
    either the size or the times, it will need to use a CB_GETATTR to query
    the client that holds the delegation.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">
    If a server informs the client via the fattr4_open_arguments attribute
    that it supports OPEN_ARGS_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS and it
    returns a valid delegation stateid for an OPEN operation that sets the
    OPEN4_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS flag, then it <span class="bcp14">MUST</span>
    query the client via a CB_GETATTR for the fattr4_time_deleg_access
    attribute (see <a href="#ssec_proxy_xdr" class="auto internal xref">Section 5.2</a>) and the
    fattr4_time_deleg_modify attribute (see <a href="#ssec_proxy_xdr" class="auto internal xref">Section 5.2</a>). (Note that the change time can be derived from
    the modify time.) Further, when a server gets a SETATTR with those attributes
    set, then it <span class="bcp14">MUST</span> accept those changes in the
    fattr4_time_deleg_access and fattr4_time_deleg_modify
    attributes and derive the change time, or it <span class="bcp14">MUST</span> reject the changes with
    NFS4ERR_DELAY.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
    When the server grants a delegation stateid, it
    <span class="bcp14">MUST</span> inform the client by setting the appropriate
    flag in the open_delegation_type4 response.
    The server <span class="bcp14">MUST</span> set OPEN_DELEGATE_READ_ATTRS_DELEG when it
    grants a read attribute delegation and <span class="bcp14">MUST</span> set
    OPEN_DELEGATE_WRITE_ATTRS_DELEG when it grants a write attribute
    delegation.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">
    These new attributes are invalid to be used with GETATTR, VERIFY, and NVERIFY, and they
    can only be used with CB_GETATTR and SETATTR by a  client holding an
    appropriate delegation.  The SETATTR <span class="bcp14">SHOULD</span> be either 
    1) in a separate compound before the one containing the DELEGRETURN or
    2) in the same compound as an operation before the DELEGRETURN.
    Failure to properly sequence the operations may lead to race conditions.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">
    A key prerequisite of this approach is that the server and client are in
    time synchronization with each other.  Note that while the base NFSv4.2
    does not require such synchronization, the use of RPCSEC_GSS typically
    makes such a requirement. When the client presents either the
    fattr4_time_deleg_access or the fattr4_time_deleg_modify attribute to the
    server, the server <span class="bcp14">MUST</span> decide for both of them whether the time presented is:<a href="#section-5-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-7.1">before the corresponding time_access attribute or time_modify
      attribute on the file, or<a href="#section-5-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-7.2">past the current server time.<a href="#section-5-7.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-8">When the time
    presented is before the original time, then the update is ignored. When
    the time presented is in the future, the server can either clamp the new
    time to the current time or return NFS4ERR_DELAY to the client,
    allowing it to retry.  Note that if the clock skew is large, the delay
    approach would result in access to the file being denied until the clock
    skew is exceeded.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">
    A change in the access time <span class="bcp14">MUST NOT</span> advance the change
    time, also known as the time_metadata attribute. However, a
    change in the modify time might advance the change time (and in turn, the
    change attribute).  If the modify time is greater than the change time
    and before the current time, then the change time is adjusted to the
    modify time and not the current time (as is most likely done on most
    SETATTR calls that change the metadata). If the modify time is in the
    future, it will be clamped to the current time.<a href="#section-5-9" class="pilcrow">¶</a></p>
<p id="section-5-10">
    Note that each of the possible times (access, modify, and change) are
    compared to the current time. They should all be compared against
    the same time value for the current time (i.e., they do not retrieve
    a different value of the current time for each calculation).<a href="#section-5-10" class="pilcrow">¶</a></p>
<p id="section-5-11">
    If the client sets the OPEN4_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS
    flag in an OPEN operation, then it <span class="bcp14">MUST</span> support
    the fattr4_time_deleg_access
    and fattr4_time_deleg_modify attributes in both the CB_GETATTR
    and SETATTR operations.<a href="#section-5-11" class="pilcrow">¶</a></p>
<div id="ssec_proxy_use">
<section id="section-5.1">
        <h3 id="name-use-case-for-nfsv3-client-p">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-use-case-for-nfsv3-client-p" class="section-name selfRef">Use Case for NFSv3 Client Proxy</a>
        </h3>
<p id="section-5.1-1">
      Consider an NFSv3 client that wants to access data on a server
      that only supports NFSv4.2.  An implementation may introduce an
      NFSv3 server that functions as an NFSv4.2 client, serving as a
      gateway between the two otherwise incompatible systems.  As NFSv3
      is a stateless protocol, the state is not kept on the client, but rather
      on the NFSv3 server. As the NFSv3 server is already managing the
      state, it can proxy file delegations to avoid spurious GETATTRs. That is, as the client queries the NFSv3 server for the attributes,
      they can be served without the NFSv3 server sending a GETATTR to
      the NFSv4.2 server.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ssec_proxy_xdr">
<section id="section-5.2">
        <h3 id="name-xdr-for-proxying-of-times">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-xdr-for-proxying-of-times" class="section-name selfRef">XDR for Proxying of Times</a>
        </h3>
<div class="lang-xdr sourcecode" id="section-5.2-1">
<pre>&lt;CODE BEGINS&gt;
///
/// /*
///  * attributes for the delegation times being
///  * cached and served by the "client"
///  */
/// typedef nfstime4        fattr4_time_deleg_access;
/// typedef nfstime4        fattr4_time_deleg_modify;
///
///
/// %/*
/// % * New RECOMMENDED Attribute for
/// % * delegation caching of times
/// % */
/// const FATTR4_TIME_DELEG_ACCESS  = 84;
/// const FATTR4_TIME_DELEG_MODIFY  = 85;
///
///
/// const OPEN4_SHARE_ACCESS_WANT_DELEG_TIMESTAMPS = 0x100000;
///
/// enum open_delegation_type4 {
///        OPEN_DELEGATE_NONE                  = 0,
///        OPEN_DELEGATE_READ                  = 1,
///        OPEN_DELEGATE_WRITE                 = 2,
///        OPEN_DELEGATE_NONE_EXT              = 3, /* new to v4.1 */
///        OPEN_DELEGATE_READ_ATTRS_DELEG      = 4,
///        OPEN_DELEGATE_WRITE_ATTRS_DELEG     = 5
/// };

&lt;CODE ENDS&gt;</pre><a href="#section-5.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="xdr_desc">
<section id="section-6">
      <h2 id="name-extraction-of-xdr">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-extraction-of-xdr" class="section-name selfRef">Extraction of XDR</a>
      </h2>
<p id="section-6-1">
    This document contains the XDR <span>[<a href="#RFC4506" class="cite xref">RFC4506</a>]</span> description of the
    new open flags for delegating the file to the client.  The XDR description
    is embedded in this document in a way that makes it simple for the reader
    to extract into a ready-to-compile form.  The reader can feed this
    document into the following shell script to produce the machine-readable
    XDR description of the new flags:<a href="#section-6-1" class="pilcrow">¶</a></p>
<div class="lang-shell sourcecode" id="section-6-2">
<pre>&lt;CODE BEGINS&gt;
#!/bin/sh
grep '^ *///' $* | sed 's?^ */// ??' | sed 's?^ *///$??'

&lt;CODE ENDS&gt;</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
<p id="section-6-3">
    That is, if the above script is stored in a file called "extract.sh" and
    this document is in a file called "spec.txt", then the reader can do the
    following:<a href="#section-6-3" class="pilcrow">¶</a></p>
<div class="lang-shell sourcecode" id="section-6-4">
<pre>&lt;CODE BEGINS&gt;
sh extract.sh &lt; spec.txt &gt; delstid_prot.x

&lt;CODE ENDS&gt;</pre><a href="#section-6-4" class="pilcrow">¶</a>
</div>
<p id="section-6-5">
    The effect of the script is to remove leading blank space from each
    line, plus a sentinel sequence of "///".  XDR descriptions with the
    sentinel sequence are embedded throughout the document.<a href="#section-6-5" class="pilcrow">¶</a></p>
<p id="section-6-6">
    Note that the XDR code contained in this document depends on types
    from the NFSv4.2 nfs4_prot.x file (generated from <span>[<a href="#RFC7863" class="cite xref">RFC7863</a>]</span>).  This includes both nfs types that
    end with a 4 (such as offset4 and length4) as well as more generic
    types (such as uint32_t and uint64_t).<a href="#section-6-6" class="pilcrow">¶</a></p>
<p id="section-6-7">
    While the XDR can be appended to that from
    <span>[<a href="#RFC7863" class="cite xref">RFC7863</a>]</span>,
    the various code snippets belong in their respective areas of
    that XDR.<a href="#section-6-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec_security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">
    While this document extends some capabilities for client delegation, there are
    no new security concerns.  The client cannot be queried by other clients
    as to the cached attributes. The client could report false data for the
    cached attributes, but it already has this ability via a SETATTR operation.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec_iana">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-normative-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4506">[RFC4506]</dt>
      <dd>
<span class="refAuthor">Eisler, M., Ed.</span>, <span class="refTitle">"XDR: External Data Representation Standard"</span>, <span class="seriesInfo">STD 67</span>, <span class="seriesInfo">RFC 4506</span>, <span class="seriesInfo">DOI 10.17487/RFC4506</span>, <time datetime="2006-05" class="refDate">May 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4506">https://www.rfc-editor.org/info/rfc4506</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7862">[RFC7862]</dt>
      <dd>
<span class="refAuthor">Haynes, T.</span>, <span class="refTitle">"Network File System (NFS) Version 4 Minor Version 2 Protocol"</span>, <span class="seriesInfo">RFC 7862</span>, <span class="seriesInfo">DOI 10.17487/RFC7862</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7862">https://www.rfc-editor.org/info/rfc7862</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7863">[RFC7863]</dt>
      <dd>
<span class="refAuthor">Haynes, T.</span>, <span class="refTitle">"Network File System (NFS) Version 4 Minor Version 2 External Data Representation Standard (XDR) Description"</span>, <span class="seriesInfo">RFC 7863</span>, <span class="seriesInfo">DOI 10.17487/RFC7863</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7863">https://www.rfc-editor.org/info/rfc7863</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8178">[RFC8178]</dt>
      <dd>
<span class="refAuthor">Noveck, D.</span>, <span class="refTitle">"Rules for NFSv4 Extensions and Minor Versions"</span>, <span class="seriesInfo">RFC 8178</span>, <span class="seriesInfo">DOI 10.17487/RFC8178</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8178">https://www.rfc-editor.org/info/rfc8178</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8881">[RFC8881]</dt>
    <dd>
<span class="refAuthor">Noveck, D., Ed.</span> and <span class="refAuthor">C. Lever</span>, <span class="refTitle">"Network File System (NFS) Version 4 Minor Version 1 Protocol"</span>, <span class="seriesInfo">RFC 8881</span>, <span class="seriesInfo">DOI 10.17487/RFC8881</span>, <time datetime="2020-08" class="refDate">August 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8881">https://www.rfc-editor.org/info/rfc8881</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1"><span class="contact-name">Trond Myklebust</span>, <span class="contact-name">Tom       Haynes</span>, and <span class="contact-name">David Flynn</span> all worked on the
      prototype at Hammerspace.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2"><span class="contact-name">Dave Noveck</span>, <span class="contact-name">Chuck Lever</span>,
      <span class="contact-name">Rick Macklem</span>, and <span class="contact-name">Zaheduzzaman       Sarker</span> provided reviews of the document.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3"><span class="contact-name">Jeff Layton</span> provided experience from an
      implementation he authored.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Thomas Haynes</span></div>
<div dir="auto" class="left"><span class="org">Hammerspace</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:loghyr@hammerspace.com" class="email">loghyr@hammerspace.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Trond Myklebust</span></div>
<div dir="auto" class="left"><span class="org">Hammerspace</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:trondmy@hammerspace.com" class="email">trondmy@hammerspace.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
