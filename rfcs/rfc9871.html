<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9871: BGP Color-Aware Routing (CAR)</title>
<meta content="Dhananjaya Rao" name="author">
<meta content="Swadesh Agrawal" name="author">
<meta content="
       
    This document describes a BGP-based routing solution to establish
    end-to-end intent-aware paths across a multi-domain transport network. The transport
    network can span multiple service provider and customer network domains.
    The BGP intent-aware paths can be used to steer traffic flows for service routes 
    that need a specific intent. This solution is called BGP Color-Aware Routing (BGP CAR).
       
       
   This document describes the routing framework and BGP extensions to enable
   intent-aware routing using the BGP CAR solution. The solution defines two
   new BGP SAFIs (BGP CAR SAFI and BGP VPN CAR SAFI) for IPv4 and IPv6. It
   also defines an extensible Network Layer Reachability Information (NLRI)
   model for both SAFIs that allows multiple NLRI types to be defined for
   different use cases.  Each type of NLRI contains key and TLV-based non-key
   fields for efficient encoding of different per-prefix information. This
   specification defines two NLRI types: Color-Aware Route NLRI and IP Prefix
   NLRI. It defines non-key TLV types for the MPLS label stack, SR-MPLS label
   index, and Segment Routing over IPv6 (SRv6) Segment Identifiers (SIDs). This
   solution also defines a new Local Color Mapping (LCM) Extended Community.
       
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="intent-aware routing" name="keyword">
<meta content="intent-based routing" name="keyword">
<meta content="color-aware VPNs" name="keyword">
<meta content="color-aware BGP transport" name="keyword">
<meta content="BGP extensible NLRI" name="keyword">
<meta content="9871" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    wcwidth 0.2.5
    weasyprint 65.0
-->
<link href="rfc9871.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://static.ietf.org/fonts/noto-sans/import.css'); /* Sans-serif */
@import url('https://static.ietf.org/fonts/noto-serif/import.css'); /* Serif (print) */
@import url('https://static.ietf.org/fonts/roboto-mono/import.css'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
@media print {
  svg {
    max-height: 850px;
    max-width: 660px;
  }
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > blockquote:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-idr-bgp-car-16" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9871" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9871</td>
<td class="center">BGP Color-Aware Routing (CAR)</td>
<td class="right">November 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rao &amp; Agrawal</td>
<td class="center">Experimental</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9871" class="eref">9871</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Experimental</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-11" class="published">November 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Rao, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">S. Agrawal, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9871</h1>
<h1 id="title">BGP Color-Aware Routing (CAR)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
    This document describes a BGP-based routing solution to establish
    end-to-end intent-aware paths across a multi-domain transport network. The transport
    network can span multiple service provider and customer network domains.
    The BGP intent-aware paths can be used to steer traffic flows for service routes 
    that need a specific intent. This solution is called BGP Color-Aware Routing (BGP CAR).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">
   This document describes the routing framework and BGP extensions to enable
   intent-aware routing using the BGP CAR solution. The solution defines two
   new BGP SAFIs (BGP CAR SAFI and BGP VPN CAR SAFI) for IPv4 and IPv6. It
   also defines an extensible Network Layer Reachability Information (NLRI)
   model for both SAFIs that allows multiple NLRI types to be defined for
   different use cases.  Each type of NLRI contains key and TLV-based non-key
   fields for efficient encoding of different per-prefix information. This
   specification defines two NLRI types: Color-Aware Route NLRI and IP Prefix
   NLRI. It defines non-key TLV types for the MPLS label stack, SR-MPLS label
   index, and Segment Routing over IPv6 (SRv6) Segment Identifiers (SIDs). This
   solution also defines a new Local Color Mapping (LCM) Extended Community.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for examination, experimental implementation, and
            evaluation.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document defines an Experimental Protocol for the Internet
            community.  This document is a product of the Internet Engineering
            Task Force (IETF).  It represents the consensus of the IETF community.
            It has received public review and has been approved for publication
            by the Internet Engineering Steering Group (IESG).  Not all documents
            approved by the IESG are candidates for any level of Internet
            Standard; see Section 2 of RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9871">https://www.rfc-editor.org/info/rfc9871</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-illustration" class="internal xref">Illustration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-requirements-language" class="internal xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-bgp-car-safi" class="internal xref">BGP CAR SAFI</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-data-model" class="internal xref">Data Model</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-extensible-encoding" class="internal xref">Extensible Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-bgp-car-route-origination" class="internal xref">BGP CAR Route Origination</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-bgp-car-route-validation" class="internal xref">BGP CAR Route Validation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-bgp-car-route-resolution" class="internal xref">BGP CAR Route Resolution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-aigp-metric-computation" class="internal xref">AIGP Metric Computation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="auto internal xref">2.7</a>.  <a href="#name-inherent-multipath-capabili" class="internal xref">Inherent Multipath Capability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.8">
                <p id="section-toc.1-1.2.2.8.1"><a href="#section-2.8" class="auto internal xref">2.8</a>.  <a href="#name-bgp-car-signaling-through-d" class="internal xref">BGP CAR Signaling Through Different Color Domains</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9">
                <p id="section-toc.1-1.2.2.9.1"><a href="#section-2.9" class="auto internal xref">2.9</a>.  <a href="#name-format-and-encoding" class="internal xref">Format and Encoding</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9.2.1">
                    <p id="section-toc.1-1.2.2.9.2.1.1"><a href="#section-2.9.1" class="auto internal xref">2.9.1</a>.  <a href="#name-bgp-car-safi-nlri-format" class="internal xref">BGP CAR SAFI NLRI Format</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9.2.2">
                    <p id="section-toc.1-1.2.2.9.2.2.1"><a href="#section-2.9.2" class="auto internal xref">2.9.2</a>.  <a href="#name-type-specific-non-key-tlv-f" class="internal xref">Type-Specific Non-Key TLV Format</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9.2.3">
                    <p id="section-toc.1-1.2.2.9.2.3.1"><a href="#section-2.9.3" class="auto internal xref">2.9.3</a>.  <a href="#name-color-aware-route-e-c-nlri-" class="internal xref">Color-Aware Route (E, C) NLRI Type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9.2.4">
                    <p id="section-toc.1-1.2.2.9.2.4.1"><a href="#section-2.9.4" class="auto internal xref">2.9.4</a>.  <a href="#name-ip-prefix-e-nlri-type" class="internal xref">IP Prefix (E) NLRI Type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9.2.5">
                    <p id="section-toc.1-1.2.2.9.2.5.1"><a href="#section-2.9.5" class="auto internal xref">2.9.5</a>.  <a href="#name-local-color-mapping-lcm-ext" class="internal xref">Local Color Mapping (LCM) Extended Community</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.10">
                <p id="section-toc.1-1.2.2.10.1"><a href="#section-2.10" class="auto internal xref">2.10</a>. <a href="#name-lcm-ec-and-bgp-color-ec-usa" class="internal xref">LCM-EC and BGP Color-EC Usage</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.11">
                <p id="section-toc.1-1.2.2.11.1"><a href="#section-2.11" class="auto internal xref">2.11</a>. <a href="#name-error-handling" class="internal xref">Error Handling</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-service-route-automated-ste" class="internal xref">Service Route Automated Steering on Color-Aware Paths</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-filtering" class="internal xref">Filtering</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-scaling" class="internal xref">Scaling</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-ultra-scale-reference-topol" class="internal xref">Ultra-Scale Reference Topology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-deployment-model" class="internal xref">Deployment Model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-flat" class="internal xref">Flat</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-hierarchical-design-with-ne" class="internal xref">Hierarchical Design with Next-Hop-Self at Ingress Domain BR</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-hierarchical-design-with-nex" class="internal xref">Hierarchical Design with Next-Hop-Unchanged at Ingress Domain BR</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-scale-analysis" class="internal xref">Scale Analysis</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-anycast-sid" class="internal xref">Anycast SID</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-anycast-sid-for-transit-int" class="internal xref">Anycast SID for Transit Inter-Domain Nodes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="auto internal xref">5.4.2</a>.  <a href="#name-anycast-sid-for-transport-c" class="internal xref">Anycast SID for Transport Color Endpoints</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-routing-convergence" class="internal xref">Routing Convergence</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-car-srv6" class="internal xref">CAR SRv6</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-routed-service-sid" class="internal xref">Routed Service SID</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="auto internal xref">7.1.2</a>.  <a href="#name-non-routed-service-sid" class="internal xref">Non-Routed Service SID</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-deployment-options-for-car-" class="internal xref">Deployment Options for CAR SRv6 Locator Reachability Distribution and Forwarding</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="auto internal xref">7.2.1</a>.  <a href="#name-hop-by-hop-ipv6-forwarding-" class="internal xref">Hop-by-Hop IPv6 Forwarding for BGP SRv6 Prefixes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.2">
                    <p id="section-toc.1-1.7.2.2.2.2.1"><a href="#section-7.2.2" class="auto internal xref">7.2.2</a>.  <a href="#name-encapsulation-between-brs-f" class="internal xref">Encapsulation Between BRs for BGP SRv6 Prefixes</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-operational-benefits-of-usi" class="internal xref">Operational Benefits of Using CAR SAFI for SRv6 Locator Prefix Distribution</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-car-ip-prefix-route" class="internal xref">CAR IP Prefix Route</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-vpn-car" class="internal xref">VPN CAR</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-format-and-encoding-2" class="internal xref">Format and Encoding</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.  <a href="#name-vpn-car-e-c-nlri-type" class="internal xref">VPN CAR (E, C) NLRI Type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.2">
                    <p id="section-toc.1-1.9.2.1.2.2.1"><a href="#section-9.1.2" class="auto internal xref">9.1.2</a>.  <a href="#name-vpn-car-ip-prefix-nlri-type" class="internal xref">VPN CAR IP Prefix NLRI Type</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-bgp-car-safis" class="internal xref">BGP CAR SAFIs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-bgp-car-nlri-types-registry" class="internal xref">"BGP CAR NLRI Types" Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="auto internal xref">10.3</a>.  <a href="#name-bgp-car-nlri-tlv-registry" class="internal xref">"BGP CAR NLRI TLV" Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="auto internal xref">10.4</a>.  <a href="#name-guidance-for-designated-exp" class="internal xref">Guidance for Designated Experts</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4.2.1">
                    <p id="section-toc.1-1.10.2.4.2.1.1"><a href="#section-10.4.1" class="auto internal xref">10.4.1</a>.  <a href="#name-additional-evaluation-crite" class="internal xref">Additional Evaluation Criteria for the "BGP CAR NLRI Types" Registry</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4.2.2">
                    <p id="section-toc.1-1.10.2.4.2.2.1"><a href="#section-10.4.2" class="auto internal xref">10.4.2</a>.  <a href="#name-additional-evaluation-criter" class="internal xref">Additional Evaluation Criteria for the "BGP CAR NLRI TLV" Registry</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="auto internal xref">10.5</a>.  <a href="#name-border-gateway-protocol-bgp" class="internal xref">"Border Gateway Protocol (BGP) Extended Communities" Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-manageability-and-operation" class="internal xref">Manageability and Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-illustrations-of-service-st" class="internal xref">Illustrations of Service Steering</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-e2e-bgp-transport-car-inten" class="internal xref">E2E BGP Transport CAR Intent Realized Using IGP Flexible Algorithm</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-e2e-bgp-transport-car-intent" class="internal xref">E2E BGP Transport CAR Intent Realized Using SR Policy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-bgp-transport-car-intent-re" class="internal xref">BGP Transport CAR Intent Realized in a Section of the Network</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.1">
                    <p id="section-toc.1-1.14.2.3.2.1.1"><a href="#appendix-A.3.1" class="auto internal xref">A.3.1</a>.  <a href="#name-provide-intent-for-service-" class="internal xref">Provide Intent for Service Flows Only in Core Domain Running IS-IS Flexible Algorithm</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.2">
                    <p id="section-toc.1-1.14.2.3.2.2.1"><a href="#appendix-A.3.2" class="auto internal xref">A.3.2</a>.  <a href="#name-provide-intent-for-service-f" class="internal xref">Provide Intent for Service Flows Only in Core Domain over TE Tunnel Mesh</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.  <a href="#name-transit-network-domains-tha" class="internal xref">Transit Network Domains That Do Not Support CAR</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#appendix-A.5" class="auto internal xref">A.5</a>.  <a href="#name-resource-avoidance-using-bg" class="internal xref">Resource Avoidance Using BGP CAR and IGP Flexible Algorithm</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.6">
                <p id="section-toc.1-1.14.2.6.1"><a href="#appendix-A.6" class="auto internal xref">A.6</a>.  <a href="#name-per-flow-steering-over-car-" class="internal xref">Per-Flow Steering over CAR Routes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.7">
                <p id="section-toc.1-1.14.2.7.1"><a href="#appendix-A.7" class="auto internal xref">A.7</a>.  <a href="#name-advertising-bgp-car-routes-" class="internal xref">Advertising BGP CAR Routes for Shared IP Addresses</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-color-mapping-illustrations" class="internal xref">Color Mapping Illustrations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-single-color-domain-contain" class="internal xref">Single Color Domain Containing Network Domains with N:N Color
        Distribution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-single-color-domain-containi" class="internal xref">Single Color Domain Containing Network Domains with N:M Color Distribution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.3">
                <p id="section-toc.1-1.15.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-multiple-color-domains" class="internal xref">Multiple Color Domains</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-car-srv6-illustrations" class="internal xref">CAR SRv6 Illustrations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-bgp-car-srv6-locator-reacha" class="internal xref">BGP CAR SRv6 Locator Reachability Hop-by-Hop Distribution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-bgp-car-srv6-locator-reachab" class="internal xref">BGP CAR SRv6 Locator Reachability Distribution with Encapsulation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.3">
                <p id="section-toc.1-1.16.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-bgp-car-e-c-route-distribut" class="internal xref">BGP CAR (E, C) Route Distribution for Steering Non-Routed Service SID</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-car-safi-nlri-update-packin" class="internal xref">CAR SAFI NLRI Update Packing Efficiency Calculation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-G" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="INTRO">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
      BGP Color-Aware Routing (CAR) is a BGP-based routing solution to establish
      end-to-end intent-aware paths across a multi-domain service provider
      transport network. BGP CAR distributes distinct routes to a destination network 
      endpoint, such as a Provider Edge (PE) router, for different intents or colors. Color is a 
      non-zero 32-bit integer value associated with a network intent (such as low cost, low delay, 
      avoid some resources, 5G network slice, etc.) as defined in 
      <span><a href="https://rfc-editor.org/rfc/rfc9256#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
      BGP CAR fulfills the transport and VPN problem statement and the requirements described
      in <span>[<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
      For this purpose, this document specifies two new BGP SAFIs, called 
      BGP CAR SAFI (83) and VPN CAR SAFI (84), that carry infrastructure routes to
      set up the transport paths. Both CAR SAFI and VPN CAR SAFI apply to IPv4 Unicast and 
      IPv6 Unicast AFIs (AFI 1 and AFI 2). The use of these SAFIs with other AFIs are 
      outside the scope of this document.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
      BGP CAR SAFI can be enabled on transport devices in a provider network
      (underlay) to set up color-aware transport/infrastructure paths across
      provider networks.  The multi-domain transport network may comprise of
      multiple BGP Autonomous Systems (ASes) as well as multiple IGP domains within a single BGP
      AS. BGP CAR SAFI can also be enabled within a VPN Routing and Forwarding (VRF) on a PE router towards
      a peering Customer Edge (CE) router, and on devices within a customer
      network. VPN CAR SAFI is used for the distribution of intent-aware
      routes from different customers received on a PE router across the
      provider networks, maintaining the separation of the customer address
      spaces that may overlap. The BGP CAR solution thus enables intent-aware
      transport paths to be set up across a multi-domain network that can span
      customer and provider network domains.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">
      This document also defines two BGP CAR route types for this purpose.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">
      The BGP CAR Type-1 NLRI (E, C) enables the generation and distribution of multiple 
      color-aware routes to the same destination IP prefix for different colors. 
      This case arises from situations where a transport node such as a PE has a common 
      IP address (such as a loopback) to advertise for multiple intents. The operator intends
      to use the common IP address as both the BGP next hop for service routes and as the 
      transport endpoint for the data plane path. Multiple routes are needed for this same 
      address or prefix to set up a unique path for each intent. One example is setting up 
      multiple Label Switched Paths (LSPs) for MPLS or Segment Routing over MPLS (SR-MPLS) to an egress PE, one per intent.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">
      The BGP CAR Type-2 NLRI (IP Prefix or E) enables the distribution of multiple color-aware routes to a 
      transport node for the case where the operator specifies a unique network 
      IP address block for a given intent, and the transport node gets assigned a 
      unique IP prefix or address for each intent. An example use case is Segment Routing over IPv6 (SRv6)
      per-intent locators.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">
      These BGP CAR intent-aware paths are then used by an ingress node (such as a PE) to 
      steer traffic flows for service routes that need the specific intents. Steering may be 
      towards a destination for all or specific traffic flows.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">BGP CAR adheres to the flat routing model of BGP for IP routing (BGP-IP) <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span> or BGP Labeled Unicast (BGP-LU) (SAFI 4 in <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>), and extends it to support intent awareness, thereby
     providing a consistent operational experience with those widely deployed
     transport routing technologies.<a href="#section-1-9" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<span class="break"></span><dl class="dlNewline" id="section-1.1-1">
          <dt id="section-1.1-1.1">Intent (in routing):</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.2">
            <p id="section-1.1-1.2.1">Any behaviors to influence routing or path selection, including
     any combination of the following behaviors:<a href="#section-1.1-1.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="compact type-a" id="section-1.1-1.2.2">
       <li id="section-1.1-1.2.2.1">Topology path selection (e.g., minimize metric or avoid
       resource)<a href="#section-1.1-1.2.2.1" class="pilcrow">¶</a>
</li>
              <li id="section-1.1-1.2.2.2">Network Function Virtualization (NFV) service insertion (e.g., service chain steering)<a href="#section-1.1-1.2.2.2" class="pilcrow">¶</a>
</li>
              <li id="section-1.1-1.2.2.3">Per-hop behavior (e.g., a 5G slice)<a href="#section-1.1-1.2.2.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-1.1-1.2.3">This is a more specific concept with respect to routing
       beyond best-effort, compared to intent as a declarative
       abstraction in <span>[<a href="#RFC9315" class="cite xref">RFC9315</a>]</span>.<a href="#section-1.1-1.2.3" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.3">Color:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.4">A non-zero 32-bit integer value associated with an intent
          (e.g., low cost, low delay, or avoid some resources) as defined in
          <span><a href="https://rfc-editor.org/rfc/rfc9256#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>. Color assignment is managed by
          the operator.<a href="#section-1.1-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.5">Colored service route:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.6">An egress PE (e.g., E2) colors its BGP service (e.g., VPN) route
          (e.g., V/v) to indicate the intent that it requests for the traffic
          bound to V/v.  The color is encoded as a BGP Color
          Extended Community <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span>, used as per <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>,
          or represented by the locator part of SRv6 Service SID <span>[<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>.<a href="#section-1.1-1.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.7">Color-aware path to (E2, C):</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.8">A path to forward packets towards E2 that satisfies the intent
          associated with color C.  Several technologies may provide a
          color-aware path to (E2, C), such as SR Policy <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>, IGP
          Flexible Algorithm <span>[<a href="#RFC9350" class="cite xref">RFC9350</a>]</span>, and BGP CAR (as specified in this document).<a href="#section-1.1-1.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.9">Color-aware route (E2, C):</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.10">A distributed or signaled route that builds a color-aware path to E2 for 
          color C.<a href="#section-1.1-1.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.11">Service route automated steering on color-aware path:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.12">An ingress PE (or ASBR) E1 automatically steers traffic for a
          C-colored service route V/v from E2 onto an (E2, C) color-aware
          path. If several such paths exist, a preference scheme is used to
          select the best path (for example, IGP Flexible Algorithm is preferred over SR
          Policy, and SR Policy is preferred over BGP CAR).<a href="#section-1.1-1.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.13">Color domain:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.14">A set of nodes that share the same color-to-intent mapping, typically under
          single administration. This set can be organized into one or multiple network domains 
          (IGP areas/instances within a single BGP AS, or multiple BGP ASes). Color-to-intent 
          mapping on nodes is set by configuration. Color re-mapping and filtering may happen 
          at color domain boundaries. Refer to 
          <span>[<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>.<a href="#section-1.1-1.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.15">Resolution of a BGP CAR route (E, C):</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.16">An inter-domain BGP CAR route (E, C) via N is resolved on an
          intra-domain color-aware path (N, C) where N is the next hop of the
          BGP CAR route.<a href="#section-1.1-1.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.17">Resolution versus steering:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.18">
            <p id="section-1.1-1.18.1">Consistent with the terminology used in the SR Policy document
     (<span><a href="https://rfc-editor.org/rfc/rfc9256#section-8" class="relref">Section 8</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>), in
     this document (service route) steering is used to describe the
     mapping of the traffic for a service route onto a BGP CAR path.
     In contrast, the term resolution is preserved for the mapping of
     an inter-domain BGP CAR route on an intra-domain color-aware
     path.<a href="#section-1.1-1.18.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.1-1.18.2">
              <dt id="section-1.1-1.18.2.1">Service steering:</dt>
              <dd style="margin-left: 1.5em" id="section-1.1-1.18.2.2">Service route maps traffic to a BGP CAR path (or other
       color-aware path, e.g., SR Policy). If a color-aware path is not
       available, local policy may map to a color-unaware routing/TE path
       (e.g., BGP-LU, RSVP-TE, IGP/LDP).  The service steering concept is
       agnostic to the transport technology used.  <a href="#STEERING" class="auto internal xref">Section 3</a> describes the specific service steering
       mechanisms leveraged for MPLS, SR-MPLS, and SRv6.<a href="#section-1.1-1.18.2.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-1.1-1.18.2.3">Intra-domain resolution:</dt>
              <dd style="margin-left: 1.5em" id="section-1.1-1.18.2.4">BGP CAR route maps to an intra-domain color-aware path (e.g., SR
       Policy, IGP Flexible Algorithm, BGP CAR) or a color-unaware routing/TE path
       (e.g., RSVP-TE, IGP/LDP, BGP-LU).<a href="#section-1.1-1.18.2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.19">Transport network:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.20">A network that comprises of multiple cooperating domains managed
          by one or more operators, and uses routing technologies such as IP,
          MPLS, and SR to forward packets for connectivity and
          other services.  In an SR deployment, the transport network is
          within a trusted domain as per <span>[<a href="#RFC8402" class="cite xref">RFC8402</a>]</span>.<a href="#section-1.1-1.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.21">Transport layer:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.22">Refers to an underlay network layer (e.g., MPLS LSPs between
          PEs) that gets used by an overlay or service layer (e.g., MPLS
          VPNs).<a href="#section-1.1-1.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.23">Transport RR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.24">A BGP Route Reflector (RR) used to distribute transport/underlay routes within a domain or 
          across domains.<a href="#section-1.1-1.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-1.25">Service RR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-1.26">A BGP Route Reflector (RR) used to distribute service/overlay routes
          within a domain or across domains.<a href="#section-1.1-1.26" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.1-2">Abbreviations:<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-3">
          <dt id="section-1.1-3.1">ABR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.2">Area Border Router<a href="#section-1.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.3">AFI:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.4">Address Family Identifier<a href="#section-1.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.5">AIGP:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.6">Accumulated IGP Metric Attribute <span>[<a href="#RFC7311" class="cite xref">RFC7311</a>]</span><a href="#section-1.1-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.7">ASBR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.8">Autonomous System Border Router<a href="#section-1.1-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.9">BGP-LU:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.10">BGP Labeled Unicast SAFI (SAFI value 4 as per <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>)<a href="#section-1.1-3.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.11">BGP-IP:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.12">BGP IPv4/IPv6 Unicast SAFI (SAFI value 1 as per <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span> and <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span>)<a href="#section-1.1-3.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.13">BR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.14">Border Router (either for an IGP area (an ABR) or a BGP
          autonomous system (an ASBR))<a href="#section-1.1-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.15">Color-EC:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.16">BGP Color Extended Community <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span><a href="#section-1.1-3.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.17">E:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.18">Generic representation of a transport endpoint such
          as a PE, ABR, or ASBR<a href="#section-1.1-3.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.19">LCM-EC:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.20">BGP Local Color Mapping Extended Community<a href="#section-1.1-3.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.21">NLRI:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.22">Network Layer Reachability Information <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span><a href="#section-1.1-3.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.23">P node:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.24">An intra-domain transport router<a href="#section-1.1-3.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.25">RD:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.26">Route Distinguisher<a href="#section-1.1-3.26" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.27">RR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.28">Route Reflector<a href="#section-1.1-3.28" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.29">T-RR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.30">Transport Route Reflector<a href="#section-1.1-3.30" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.31">S-RR:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.32">Service Route Reflector<a href="#section-1.1-3.32" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.33">SAFI:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.34">Subsequent Address Family Identifier<a href="#section-1.1-3.34" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.35">TEA:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.36">Tunnel Encapsulation Attribute <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span><a href="#section-1.1-3.36" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-3.37">V/v, W/w:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-3.38">Generic representations of a service route (indicating
   prefix/mask length), regardless of AFI/SAFI or actual NLRI
   encoding<a href="#section-1.1-3.38" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<div id="SECCARIllus">
<section id="section-1.2">
        <h3 id="name-illustration">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-illustration" class="section-name selfRef">Illustration</a>
        </h3>
<p id="section-1.2-1">Here is a brief illustration of the salient properties of the BGP CAR 
        solution.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<span id="name-bgp-car-solution-illustrati"></span><div id="Illustration">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.2-2.1">
<pre>
+-------------+      +-------------+      +-------------+
|             |      |             |      |             | V/v with C1
|----+        |------|             |------|        +----|/
| E1 |        |      |             |      |        | E2 |\
|----+        |      |             |      |        +----| W/w with C2
|             |------|             |------|             |
|  Domain 1   |      |   Domain 2  |      |   Domain 3  |
+-------------+      +-------------+      +-------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-bgp-car-solution-illustrati" class="selfRef">BGP CAR Solution Illustration</a>
          </figcaption></figure>
</div>
<p id="section-1.2-3">All the nodes are part of an inter-domain network under a single authority
        and with a consistent color-to-intent mapping:<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-4.1">
            <p id="section-1.2-4.1.1">C1 is mapped to "low delay"<a href="#section-1.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-4.1.2.1">
                <p id="section-1.2-4.1.2.1.1">Flex-Algo 1 is mapped to "low delay", and hence to C1<a href="#section-1.2-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-4.2">
            <p id="section-1.2-4.2.1">C2 is mapped to "low delay and avoid resource R"<a href="#section-1.2-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-4.2.2.1">
                <p id="section-1.2-4.2.2.1.1">Flex-Algo 2 is mapped to "low delay and avoid resource R", and hence to C2<a href="#section-1.2-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-1.2-5">E1 receives two service routes from E2:<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-6.1">
            <p id="section-1.2-6.1.1">V/v with BGP Color-EC C1<a href="#section-1.2-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-6.2">
            <p id="section-1.2-6.2.1">W/w with BGP Color-EC C2<a href="#section-1.2-6.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.2-7">E1 has the following color-aware paths:<a href="#section-1.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-8.1">
            <p id="section-1.2-8.1.1">(E2, C1) provided by BGP CAR with the following per-domain support:<a href="#section-1.2-8.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-8.1.2.1">
                <p id="section-1.2-8.1.2.1.1">Domain 1: over IGP FA1<a href="#section-1.2-8.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.2-8.1.2.2">
                <p id="section-1.2-8.1.2.2.1">Domain 2: over SR Policy bound to color C1<a href="#section-1.2-8.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.2-8.1.2.3">
                <p id="section-1.2-8.1.2.3.1">Domain 3: over IGP FA1<a href="#section-1.2-8.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-8.2">
            <p id="section-1.2-8.2.1">(E2, C2) provided by SR Policy<a href="#section-1.2-8.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.2-9">E1 automatically steers traffic for the received service routes as follows:<a href="#section-1.2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-10.1">
            <p id="section-1.2-10.1.1">V/v via (E2, C1) provided by BGP CAR<a href="#section-1.2-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-10.2">
            <p id="section-1.2-10.2.1">W/w via (E2, C2) provided by SR Policy<a href="#section-1.2-10.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.2-11">Illustrated properties:<a href="#section-1.2-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-12.1">
            <p id="section-1.2-12.1.1">Leverage of the BGP Color-EC<a href="#section-1.2-12.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-12.1.2.1">
                <p id="section-1.2-12.1.2.1.1">The service routes are colored with widely used BGP Color
                Extended Community <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span> to request
                intent<a href="#section-1.2-12.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-12.2">
            <p id="section-1.2-12.2.1">(E, C) automated steering<a href="#section-1.2-12.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-12.2.2.1">
                <p id="section-1.2-12.2.2.1.1">V/v and W/w are automatically steered on the appropriate color-aware 
            path<a href="#section-1.2-12.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-12.3">
            <p id="section-1.2-12.3.1">Seamless coexistence of BGP CAR and SR Policy<a href="#section-1.2-12.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-12.3.2.1">
                <p id="section-1.2-12.3.2.1.1">V/v is steered on a color-aware path provided by BGP CAR<a href="#section-1.2-12.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.2-12.3.2.2">
                <p id="section-1.2-12.3.2.2.1">W/w is steered on a color-aware path provided by SR Policy<a href="#section-1.2-12.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-12.4">
            <p id="section-1.2-12.4.1">Seamless interworking of BGP CAR and SR Policy<a href="#section-1.2-12.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-12.4.2.1">
                <p id="section-1.2-12.4.2.1.1">V/v is steered on a BGP CAR path that is itself resolved 
            within domain 2 onto an SR Policy bound to the color of V/v<a href="#section-1.2-12.4.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-1.2-13">Other properties:<a href="#section-1.2-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-14.1">
            <p id="section-1.2-14.1.1">MPLS data plane: with 300k PEs and 5 colors, the BGP CAR solution ensures 
          that no single node needs to support a data plane scaling in the order of 
          Remote PE * C (<a href="#SCLNG" class="auto internal xref">Section 5</a>). This would otherwise exceed the MPLS 
          data plane.<a href="#section-1.2-14.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-14.2">
            <p id="section-1.2-14.2.1">Control plane: a node should not install a (E, C) path if it's not participating
          in that color-aware path.<a href="#section-1.2-14.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-14.3">
            <p id="section-1.2-14.3.1">Incongruent color-intent mapping: the solution supports the signaling of 
          a BGP CAR route across different color domains 
          (<a href="#SDIFFCOLORS" class="auto internal xref">Section 2.8</a>).<a href="#section-1.2-14.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.2-15">The key benefits of this model are:<a href="#section-1.2-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-16.1">
            <p id="section-1.2-16.1.1">Leverage of the BGP Color-EC <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span> to color 
          service routes<a href="#section-1.2-16.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-16.2">
            <p id="section-1.2-16.2.1">The definition of the automated service steering: a C-colored service route V/v 
          from E2 is steered onto a color-aware path (E2, C)<a href="#section-1.2-16.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-16.3">
            <p id="section-1.2-16.3.1">The definition of the data model of a BGP CAR path: (E, C)<a href="#section-1.2-16.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-16.3.2.1">
                <p id="section-1.2-16.3.2.1.1">Natural extension of BGP-IP/BGP-LU data model (E)<a href="#section-1.2-16.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.2-16.3.2.2">
                <p id="section-1.2-16.3.2.2.1">Consistent with SR Policy data model<a href="#section-1.2-16.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-1.2-16.4">
            <p id="section-1.2-16.4.1">The definition of the recursive resolution of a BGP CAR route: a BGP CAR 
          (E2, C) route via N is resolved onto the color-aware path (N, C), which may itself 
          be provided by BGP CAR or via another color-aware routing solution (e.g.,
          SR Policy, IGP Flexible Algorithm)<a href="#section-1.2-16.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-16.5">
            <p id="section-1.2-16.5.1">Explicit definitions for multiple transport encapsulations (e.g., MPLS, SR, 
          SRv6, IP)<a href="#section-1.2-16.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<section id="section-1.3">
        <h3 id="name-requirements-language">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.3-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="CARSAFI">
<section id="section-2">
      <h2 id="name-bgp-car-safi">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-bgp-car-safi" class="section-name selfRef">BGP CAR SAFI</a>
      </h2>
<div id="SECDATAMODEL">
<section id="section-2.1">
        <h3 id="name-data-model">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-data-model" class="section-name selfRef">Data Model</a>
        </h3>
<p id="section-2.1-1">The BGP CAR data model is:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-2">
          <dt id="section-2.1-2.1">NLRI key:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">Falls into two categories to accommodate the use cases described 
          in the introduction:<a href="#section-2.1-2.2.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-2.2.2">
              <dt id="section-2.1-2.2.2.1">Type-1:</dt>
              <dd style="margin-left: 1.5em" id="section-2.1-2.2.2.2">Key is IP Prefix and Color (E, C). Color in
              NLRI key distinguishes a color-aware route for a common IP
              prefix, one per intent. Color also indicates the intent
              associated with the route.<a href="#section-2.1-2.2.2.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.1-2.2.2.3">Type-2:</dt>
              <dd style="margin-left: 1.5em" id="section-2.1-2.2.2.4">Key is IP Prefix (E). The unique IP prefix
              assigned for an intent (i.e, IP Prefix == intent)
              distinguishes the color-aware route.  Color is not needed in
              NLRI key as a distinguisher.<a href="#section-2.1-2.2.2.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-2.3">NLRI non-key encapsulation data:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.4">Data such as MPLS label
          stack, SR-MPLS label index, and SRv6 SID list associated with NLRI. Contained
          in TLVs as described in <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>.<a href="#section-2.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-2.5">BGP next hop:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.6">Next hop address associated with a particular NLRI key <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span>.<a href="#section-2.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-2.7">AIGP metric <span>[<a href="#RFC7311" class="cite xref">RFC7311</a>]</span>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.8">Accumulates a metric value specific to color/intent
          for a CAR route across multiple BGP hops.<a href="#section-2.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-2.9">Local Color Mapping Extended Community (LCM-EC):</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.10">
            <p id="section-2.1-2.10.1">Optional non-zero 32-bit color 
          value used to represent the intent associated with a CAR route:<a href="#section-2.1-2.10.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.10.2.1">
                <p id="section-2.1-2.10.2.1.1">when the CAR route propagates between different color domains.<a href="#section-2.1-2.10.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.1-2.10.2.2">
                <p id="section-2.1-2.10.2.2.1">when the CAR route has a unique IP prefix for an intent.<a href="#section-2.1-2.10.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-2.11">BGP Color Extended Community (Color-EC) <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span>:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-2.12">Optional non-zero 32-bit color value
          used to represent the intent associated with the BGP CAR next
          hop. It is used as per <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span> for automated route
          resolution, when intent/color used for the next hop is different
          than the CAR route's intent/color.<a href="#section-2.1-2.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-3">
          The sections below describe the data model in detail. The sections that 
          describe the protocol processing for CAR SAFI generally apply consistently 
          to both route types (for instance, any operation based on color). The 
          examples use (E, C) for simplicity.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-2.2">
        <h3 id="name-extensible-encoding">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-extensible-encoding" class="section-name selfRef">Extensible Encoding</a>
        </h3>
<p id="section-2.2-1">Extensible encoding is provided by:<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.2-2">
          <dt id="section-2.2-2.1">NLRI Type field:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.2">
            <p id="section-2.2-2.2.1">This provides extensibility to add new NLRI formats for new route types.<a href="#section-2.2-2.2.1" class="pilcrow">¶</a></p>
<p id="section-2.2-2.2.2">NLRI (route) types other than Type-1 (E, C) and Type-2 (E) are
          outside the scope of this document.<a href="#section-2.2-2.2.2" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.3">Key Length field:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.4">This specifies the key length. It allows new NLRI types to be handled 
          opaquely, which permits transitivity of new route types through BGP speakers such as 
          Route Reflectors (RRs).<a href="#section-2.2-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.5">TLV-based encoding of non-key part of NLRI:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.6">This allows
          the inclusion of additional non-key fields for a prefix to support
          different types of transport simultaneously with efficient BGP
          update packing (<a href="#ColorFamily" class="auto internal xref">Section 2.9</a>).<a href="#section-2.2-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.7">AIGP attribute:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.8">This provides extensibility via TLVs, enabling definition of 
          additional metric semantics for a color as needed for an intent.<a href="#section-2.2-2.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-2.3">
        <h3 id="name-bgp-car-route-origination">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-bgp-car-route-origination" class="section-name selfRef">BGP CAR Route Origination</a>
        </h3>
<p id="section-2.3-1">A BGP CAR route may be originated locally (e.g., loopback) or through 
        redistribution of an (E, C) color-aware path provided by another routing 
        solution (e.g., SR Policy, IGP Flexible Algorithm, RSVP-TE, BGP-LU <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>).<a href="#section-2.3-1" class="pilcrow">¶</a></p>
</section>
<div id="ROUTEVALIDN">
<section id="section-2.4">
        <h3 id="name-bgp-car-route-validation">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-bgp-car-route-validation" class="section-name selfRef">BGP CAR Route Validation</a>
        </h3>
<p id="section-2.4-1">A BGP CAR path (E, C) via next hop N with encapsulation T is valid if color-aware 
        path (N, C) exists with encapsulation T available in data plane.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">A local policy may customize the validation process:<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-3.1">
            <p id="section-2.4-3.1.1">The color constraint in the first check may be relaxed. If N is 
          reachable via alternate color(s) or in the default routing table, the route
          may be considered valid.<a href="#section-2.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.4-3.2">
            <p id="section-2.4-3.2.1">The data plane availability constraint of T may be relaxed to use an 
        alternate encapsulation.<a href="#section-2.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.4-3.3">
            <p id="section-2.4-3.3.1">A performance-measurement verification may be added to ensure that the 
          intent associated with C is met (e.g., delay &lt; bound).<a href="#section-2.4-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.4-4">A path that is not valid <span class="bcp14">MUST NOT</span> be considered for BGP best path selection.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ROUTERES">
<section id="section-2.5">
        <h3 id="name-bgp-car-route-resolution">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-bgp-car-route-resolution" class="section-name selfRef">BGP CAR Route Resolution</a>
        </h3>
<p id="section-2.5-1">A BGP color-aware route (E2, C1) with next hop N is automatically
        resolved over a color-aware route (N, C1) by default. The color-aware
        route (N, C1) is provided by color-aware mechanisms such as IGP
        Flexible Algorithm <span>[<a href="#RFC9350" class="cite xref">RFC9350</a>]</span>, SR Policy (<span><a href="https://rfc-editor.org/rfc/rfc9256#section-2.2" class="relref">Section 2.2</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>), or recursively by BGP CAR.
        When multiple producers of (N, C1) are available, the default
        preference is: IGP Flexible Algorithm, SR Policy, BGP CAR.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">Local policy <span class="bcp14">SHOULD</span> provide additional control:<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.5-3.1">
            <p id="section-2.5-3.1.1">A BGP color-aware route (E2, C1) with next hop N may be
            resolved over a color-aware route (N, C2) (i.e., the local policy
            maps the resolution of C1 over a different color C2). Examples where such 
            a resolution can occur are:<a href="#section-2.5-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.5-3.1.2.1">
                <p id="section-2.5-3.1.2.1.1">In a domain where resource R is known to not be present, the 
                inter-domain intent C1="low delay and avoid R" may be resolved over 
                an intra-domain path of intent C2="low delay".<a href="#section-2.5-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.5-3.1.2.2">
                <p id="section-2.5-3.1.2.2.1">In a domain where if no (N, C1) path is available, resolution may fallback 
                to a C2 path if the user has permitted it.<a href="#section-2.5-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-2.5-3.2">
            <p id="section-2.5-3.2.1">
          Route resolution may be driven by an egress node. In an SRv6 domain, an egress node 
          selects and advertises an SRv6 SID from its locator for intent C1, with a BGP CAR 
          route. In such a case, the ingress node resolves the received SRv6 SID over an 
          IPv6 route for the intent-aware locator of the egress node for C1 or a 
          summary route that covers the locator. This summary route may be provided by SRv6 
          Flexible Algorithm or BGP CAR IP Prefix route itself (e.g., <a href="#SECSRv6LOCencap" class="auto internal xref">Appendix C.2</a>).<a href="#section-2.5-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.5-3.3">
            <p id="section-2.5-3.3.1">Local policy may map the CAR route to mechanisms that are unaware of
          color or that provide best-effort, such as RSVP-TE, IGP/LDP, BGP-LU/BGP-IP (e.g., 
          <a href="#COREDOMAINTE" class="auto internal xref">Appendix A.3.2</a>) for brownfield scenarios.<a href="#section-2.5-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.5-4">Route resolution via a different color C2 can be automated by
        attaching BGP Color-EC C2 to CAR route (E2, C1), leveraging automated
        steering as described in Section <a href="https://rfc-editor.org/rfc/rfc9256#section-8.4" class="relref">8.4</a> of "Segment Routing Policy
        Architecture" <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span> for BGP CAR routes. This
        mechanism is illustrated in <a href="#APPENDIXNM" class="auto internal xref">Appendix B.2</a>. This
        mechanism <span class="bcp14">SHOULD</span> be supported.<a href="#section-2.5-4" class="pilcrow">¶</a></p>
<p id="section-2.5-5">For CAR route resolution, if Color-EC color is present with the route, it takes 
        precedence over the route's intent color. The route's intent color is the LCM-EC color 
        if present (see <a href="#SECLCMEC" class="auto internal xref">Section 2.9.5</a>), or else it is the NLRI color.<a href="#section-2.5-5" class="pilcrow">¶</a></p>
<p id="section-2.5-6">Local policy takes precedence over the color-based automated resolution specified above.<a href="#section-2.5-6" class="pilcrow">¶</a></p>
<p id="section-2.5-7">The color-aware route (N, C1) may be provided by BGP CAR itself in a
        hierarchical transport routing design. In such cases, based on the 
        procedures described above, recursive resolution may occur over the same 
        or different CAR route type.
        <a href="#SECNRSSID" class="auto internal xref">Section 7.1.2</a> describes a scenario where CAR (E, C) route 
        resolves over CAR IP Prefix route.<a href="#section-2.5-7" class="pilcrow">¶</a></p>
<p id="section-2.5-8">CAR IP Prefix route is allowed to be without color for best-effort. In this 
        case, resolution is based on BGP next hop N, or when present, a best-effort 
        SRv6 SID advertised by node N.<a href="#section-2.5-8" class="pilcrow">¶</a></p>
<p id="section-2.5-9">A BGP CAR route may recursively resolve over a BGP route that
        carries a TEA and follows <span><a href="https://rfc-editor.org/rfc/rfc9012#section-6" class="relref">Section 6</a> of [<a href="#RFC9012" class="cite xref">RFC9012</a>]</span> for validation. In this case, the procedures of <span><a href="https://rfc-editor.org/rfc/rfc9012#section-8" class="relref">Section 8</a> of [<a href="#RFC9012" class="cite xref">RFC9012</a>]</span> apply to BGP CAR
        routes, using color precedence as specified above for resolution.<a href="#section-2.5-9" class="pilcrow">¶</a></p>
<p id="section-2.5-10">The procedures of <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>], <a href="https://rfc-editor.org/rfc/rfc9012#section-6" class="relref">Section 6</a></span>, also apply to BGP CAR routes (AFI/SAFI = 1/83 or
        2/83). For instance, a BGP CAR BR may advertise a BGP CAR route to an
        ingress BR or PE with a specific BGP next hop per color, with a TEA or
        Tunnel Encapsulation EC, as per <span><a href="https://rfc-editor.org/rfc/rfc9012#section-6" class="relref">Section 6</a> of [<a href="#RFC9012" class="cite xref">RFC9012</a>]</span>.<a href="#section-2.5-10" class="pilcrow">¶</a></p>
<p id="section-2.5-11"> BGP CAR resolution in one network domain is independent of resolution in 
        another domain.<a href="#section-2.5-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="AIGPMETRIC">
<section id="section-2.6">
        <h3 id="name-aigp-metric-computation">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-aigp-metric-computation" class="section-name selfRef">AIGP Metric Computation</a>
        </h3>
<p id="section-2.6-1">The Accumulated IGP (AIGP) Metric Attribute <span>[<a href="#RFC7311" class="cite xref">RFC7311</a>]</span> is updated as 
        the BGP CAR route propagates across the network.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.6-2">The value that is set (or appropriately incremented) in the AIGP TLV corresponds 
        to the metric associated with the underlying intent of the color. For example, 
        when the color is associated with a low latency path, the metric value is set 
        based on the delay metric.<a href="#section-2.6-2" class="pilcrow">¶</a></p>
<p id="section-2.6-3">Information regarding the metric type used by the underlying intra-domain 
        mechanism can also be used to set the metric value.<a href="#section-2.6-3" class="pilcrow">¶</a></p>
<p id="section-2.6-4">If BGP CAR routes traverse across a discontinuity in the transport path for 
        a given intent, a penalty is added in the AIGP metric (value set by user 
        policy). This could occur, for instance, when color C1 path is not available, and route resolves via 
        color C2 path (see <a href="#SHDFAUSECASE" class="auto internal xref">Appendix A.3</a> for an example).<a href="#section-2.6-4" class="pilcrow">¶</a></p>
<p id="section-2.6-5">AIGP metric computation is recursive.<a href="#section-2.6-5" class="pilcrow">¶</a></p>
<p id="section-2.6-6">To avoid continuous IGP metric changes causing end-to-end BGP CAR route churn, an 
        implementation should provide thresholds to trigger AIGP updates.<a href="#section-2.6-6" class="pilcrow">¶</a></p>
<p id="section-2.6-7">Additional AIGP extensions may be defined to signal state for specific 
        use cases such as Maximum SID Depth (MSD) along the BGP CAR route advertisement and minimum MTU along the BGP 
        CAR route advertisement. This is out of scope for this document.<a href="#section-2.6-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SECPA">
<section id="section-2.7">
        <h3 id="name-inherent-multipath-capabili">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-inherent-multipath-capabili" class="section-name selfRef">Inherent Multipath Capability</a>
        </h3>
<p id="section-2.7-1">The (E, C) route definition inherently provides availability of redundant paths at 
        every BGP hop identical to BGP-LU or BGP-IP. For instance, BGP CAR routes originated 
        by two or more egress ABRs in a domain are advertised as multiple paths to ingress 
        ABRs in the domain, where they become equal-cost or primary-backup paths. 
        A failure of an egress ABR is detected and handled by ingress ABRs locally within 
        the domain for faster convergence, without any necessity to propagate the event 
        to upstream nodes for traffic restoration.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">BGP ADD-PATH <span>[<a href="#RFC7911" class="cite xref">RFC7911</a>]</span> <span class="bcp14">SHOULD</span> be enabled for BGP CAR to signal multiple 
        next hops through a transport RR (T-RR).<a href="#section-2.7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SDIFFCOLORS">
<section id="section-2.8">
        <h3 id="name-bgp-car-signaling-through-d">
<a href="#section-2.8" class="section-number selfRef">2.8. </a><a href="#name-bgp-car-signaling-through-d" class="section-name selfRef">BGP CAR Signaling Through Different Color Domains</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-2.8-1">
<pre>
          [Color Domain 1   A]-----[B     Color Domain 2     E2]
          [C1=low delay      ]     [C2=low delay               ]
</pre><a href="#section-2.8-1" class="pilcrow">¶</a>
</div>
<p id="section-2.8-2">Let us assume a BGP CAR route (E2, C2) is signaled from B to A, two BRs of Domain 2 and Domain 1, respectively. Let us assume that these two 
        domains do not share the same color-to-intent mapping (i.e., they belong to different 
        color domains). Low delay in Domain 2 is color C2, while it is C1 in 
        Domain 1 (C1 &lt;&gt; C2).<a href="#section-2.8-2" class="pilcrow">¶</a></p>
<p id="section-2.8-3">It is not expected to be a typical scenario to have an underlay
        transport path (e.g., an MPLS LSP) extend across different color
        domains. However, the BGP CAR solution seamlessly supports this rare
        scenario while maintaining the separation and independence of the
        administrative authority in different color domains.<a href="#section-2.8-3" class="pilcrow">¶</a></p>
<p id="section-2.8-4">The solution works as described below:<a href="#section-2.8-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-5.1">
            <p id="section-2.8-5.1.1">Within Domain 2, the BGP CAR route is (E2, C2) via E2.<a href="#section-2.8-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-5.2">
            <p id="section-2.8-5.2.1">B signals to A the BGP CAR route as (E2, C2) via B with 
            Local Color Mapping Extended Community (LCM-EC) of color C2.<a href="#section-2.8-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-5.3">
            <p id="section-2.8-5.3.1">A is aware of the intent-to-color mapping 
            within Domain 2 ("low delay" in Domain 2 is C2), as per typical coordination that exists between operators of peering domains.<a href="#section-2.8-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-5.4">
            <p id="section-2.8-5.4.1">A maps C2 in LCM-EC to C1 and signals within Domain 1 the received 
            BGP CAR route as (E2, C2) via A with LCM-EC (C1).<a href="#section-2.8-5.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-5.5">
            <p id="section-2.8-5.5.1">The nodes within the receiving Domain 1 use the local color encoded 
            in the LCM-EC for next-hop resolution and service steering.<a href="#section-2.8-5.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.8-6">
        The following procedures apply at a color domain boundary for BGP CAR routes, 
        performed by route policy at the sending and receiving peer:<a href="#section-2.8-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-7.1">
            <p id="section-2.8-7.1.1">Use local policy to control which routes are advertised to or accepted from a 
        peer in a different color domain.<a href="#section-2.8-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-7.2">
            <p id="section-2.8-7.2.1">Attach LCM-EC if not present with the route. If LCM-EC is present, then update 
        the value to re-map the color as needed.<a href="#section-2.8-7.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-7.2.2.1">
                <p id="section-2.8-7.2.2.1.1">This function may be done by the advertising BGP speaker or the receiving BGP 
        speaker as determined by the operator peering agreement, and indicated by local policy
        on the BGP peers.<a href="#section-2.8-7.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-2.8-8">These procedures apply to both CAR route types, in addition to all procedures specified in earlier sections. LCM-EC is described in <a href="#SECLCMEC" class="auto internal xref">Section 2.9.5</a>.<a href="#section-2.8-8" class="pilcrow">¶</a></p>
<p id="section-2.8-9">Salient properties:<a href="#section-2.8-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-10.1">
            <p id="section-2.8-10.1.1">The NLRI never changes, even though the color-to-intent mapping changes.<a href="#section-2.8-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-10.2">
            <p id="section-2.8-10.2.1">E is globally unique, which makes E-C in that order unique.<a href="#section-2.8-10.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-10.3">
            <p id="section-2.8-10.3.1">In typical expected cases, the color of the NLRI is used for 
          resolution and steering.<a href="#section-2.8-10.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.8-10.4">
            <p id="section-2.8-10.4.1">In the rare case of color incongruence, the local color encoded in 
          LCM-EC takes precedence.<a href="#section-2.8-10.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.8-11">Operational considerations are in <a href="#MANAGEOPER" class="auto internal xref">Section 11</a>. Further illustrations are provided in <a href="#ColorMapping" class="auto internal xref">Appendix B</a>.<a href="#section-2.8-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ColorFamily">
<section id="section-2.9">
        <h3 id="name-format-and-encoding">
<a href="#section-2.9" class="section-number selfRef">2.9. </a><a href="#name-format-and-encoding" class="section-name selfRef">Format and Encoding</a>
        </h3>
<p id="section-2.9-1">BGP CAR leverages BGP multiprotocol extensions <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span> and uses the MP_REACH_NLRI and MP_UNREACH_NLRI
        attributes for route updates within SAFI value 83 along with
        AFI 1 for IPv4 prefixes and AFI 2 for IPv6 prefixes.<a href="#section-2.9-1" class="pilcrow">¶</a></p>
<p id="section-2.9-2">BGP speakers <span class="bcp14">MUST</span> use the BGP Capabilities Advertisement to ensure
        support for processing of BGP CAR updates. This is done as 
        specified in <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span>, by using capability code 1 
        (multiprotocol BGP), with AFI 1 and 2 (as required) and SAFI 83.<a href="#section-2.9-2" class="pilcrow">¶</a></p>
<p id="section-2.9-3">
        The Next Hop network address field in the MP_REACH_NLRI may either be 
        an IPv4 address or an IPv6 address, independent of AFI. If the 
        next hop length is 4, then the next hop is an IPv4 address. The next hop
        length may be 16 or 32 for an IPv6 next hop address, set as per 
        <span><a href="https://rfc-editor.org/rfc/rfc2545#section-3" class="relref">Section 3</a> of [<a href="#RFC2545" class="cite xref">RFC2545</a>]</span>. Processing of the Next Hop field is governed by 
        standard BGP procedures as described in <span><a href="https://rfc-editor.org/rfc/rfc4760#section-3" class="relref">Section 3</a> of [<a href="#RFC4760" class="cite xref">RFC4760</a>]</span>.<a href="#section-2.9-3" class="pilcrow">¶</a></p>
<p id="section-2.9-4">The sub-sections below specify the generic encoding of the BGP CAR NLRI and non-key TLV fields,
        followed by the encoding for specific NLRI types introduced in this 
        document.<a href="#section-2.9-4" class="pilcrow">¶</a></p>
<div id="NLRI">
<section id="section-2.9.1">
          <h4 id="name-bgp-car-safi-nlri-format">
<a href="#section-2.9.1" class="section-number selfRef">2.9.1. </a><a href="#name-bgp-car-safi-nlri-format" class="section-name selfRef">BGP CAR SAFI NLRI Format</a>
          </h4>
<p id="section-2.9.1-1">The generic format for the BGP CAR SAFI NLRI is shown
          below:<a href="#section-2.9.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.1-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NLRI Length  |  Key Length   |   NLRI Type   |              //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+              //
|                  Type-Specific Key Fields                    //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Type-Specific Non-Key TLV Fields (if applicable)   //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-2.9.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.1-3">where:<a href="#section-2.9.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.1-4">
            <dt id="section-2.9.1-4.1">NLRI Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.1-4.2">1-octet field that indicates the length in octets
            of the NLRI excluding the NLRI Length field itself.<a href="#section-2.9.1-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.1-4.3">Key Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.1-4.4">1-octet field that indicates the length in octets
            of the NLRI Type-Specific Key Fields. Key Length <span class="bcp14">MUST</span> be at least
            2 less than the NLRI Length.<a href="#section-2.9.1-4.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.1-4.5">NLRI Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.1-4.6">1-octet field that indicates the type of the BGP
            CAR NLRI.<a href="#section-2.9.1-4.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.1-4.7">Type-Specific Key Fields:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.1-4.8">The exact definition of these fields
            depends on the NLRI Type. They have length indicated by the Key Length.<a href="#section-2.9.1-4.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.1-4.9">Type-Specific Non-Key TLV Fields:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.1-4.10">The fields are
            optional and can carry one or more non-key TLVs (of different
            types) depending on the NLRI Type.  The NLRI definition allows for
            encoding of specific non-key information associated with the route
            as part of the NLRI for efficient packing of BGP updates.<a href="#section-2.9.1-4.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-2.9.1-5">The non-key TLVs portion of the NLRI <span class="bcp14">MUST</span> be omitted while carrying it
          within the MP_UNREACH_NLRI when withdrawing the route advertisement.<a href="#section-2.9.1-5" class="pilcrow">¶</a></p>
<p id="section-2.9.1-6">Error handling for CAR SAFI NLRI and non-key TLVs is described in 
          <a href="#Fault" class="auto internal xref">Section 2.11</a>.<a href="#section-2.9.1-6" class="pilcrow">¶</a></p>
<p id="section-2.9.1-7">The benefits of CAR NLRI design are:<a href="#section-2.9.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.1-8.1">The indication of the key length enables BGP speakers to
            determine the key portion of the NLRI and use it along with the
            NLRI Type field in an opaque manner for the handling of unknown or
            unsupported NLRI types.  This can help deployed Route Reflectors
            (RR) to propagate NLRI types introduced in the future in a
            transparent manner.<a href="#section-2.9.1-8.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.9.1-8.2">The key length also helps error handling be more resilient and
            minimally disruptive. The use of key length in error handling is
            described in <a href="#Fault" class="auto internal xref">Section 2.11</a>.<a href="#section-2.9.1-8.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.9.1-8.3">
              <p id="section-2.9.1-8.3.1">The ability of a route (NLRI) to carry more than one non-key
            TLV (of different types) provides significant benefits such as
            signaling multiple encapsulations simultaneously for the same
            route, each with a different value (label/SID, etc.).  This enables
            simpler and efficient migrations with low overhead:<a href="#section-2.9.1-8.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.1-8.3.2.1">
                  <p id="section-2.9.1-8.3.2.1.1">avoids the need for duplicate routes to signal different encapsulations<a href="#section-2.9.1-8.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.9.1-8.3.2.2">
                  <p id="section-2.9.1-8.3.2.2.1">avoids the need for separate control planes for distribution<a href="#section-2.9.1-8.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-2.9.1-8.3.2.3">
                  <p id="section-2.9.1-8.3.2.3.1">preserves update packing (e.g., <a href="#UPDATEPACKING" class="auto internal xref">Appendix D</a>)<a href="#section-2.9.1-8.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="NLRITLVs">
<section id="section-2.9.2">
          <h4 id="name-type-specific-non-key-tlv-f">
<a href="#section-2.9.2" class="section-number selfRef">2.9.2. </a><a href="#name-type-specific-non-key-tlv-f" class="section-name selfRef">Type-Specific Non-Key TLV Format</a>
          </h4>
<p id="section-2.9.2-1">The generic format for Non-Key TLVs is shown below:<a href="#section-2.9.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.2-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |    Length     |    Value (variable)          //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><a href="#section-2.9.2-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.2-3">where:<a href="#section-2.9.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.2-4">
            <dt id="section-2.9.2-4.1">Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.2-4.2">
              <p id="section-2.9.2-4.2.1">1 octet that contains the type code and
            flags. It is encoded as shown below:<a href="#section-2.9.2-4.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.2-4.2.2">
<pre>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|R|T| Type code |
+-+-+-+-+-+-+-+-+
</pre><a href="#section-2.9.2-4.2.2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.2-4.2.3">where:<a href="#section-2.9.2-4.2.3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.2-4.2.4">
                <dt id="section-2.9.2-4.2.4.1">R:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.2-4.2.4.2">Bit is reserved and <span class="bcp14">MUST</span> be set
                to 0 and ignored on receive.<a href="#section-2.9.2-4.2.4.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-2.9.2-4.2.4.3">T:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.2-4.2.4.4">
                  <p id="section-2.9.2-4.2.4.4.1">Transitive bit, applicable to speakers that
                change the BGP CAR next hop.<a href="#section-2.9.2-4.2.4.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.2-4.2.4.4.2.1">
                      <p id="section-2.9.2-4.2.4.4.2.1.1">The T bit is set to indicate TLV is transitive. An
                    unrecognized transitive TLV <span class="bcp14">MUST</span> be
                    propagated by a speaker that changes the next hop.<a href="#section-2.9.2-4.2.4.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-2.9.2-4.2.4.4.2.2">
                      <p id="section-2.9.2-4.2.4.4.2.2.1">The T bit is unset to indicate TLV is non-transitive.  An
                    unrecognized non-transitive TLV <span class="bcp14">MUST NOT</span> be
                    propagated by a speaker that changes the next hop.<a href="#section-2.9.2-4.2.4.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
<p id="section-2.9.2-4.2.4.4.3">A speaker that does not change the next hop
                  <span class="bcp14">SHOULD</span> propagate all received TLVs.<a href="#section-2.9.2-4.2.4.4.3" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.2-4.3">Type code:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.2-4.4">Remaining 6 bits contain the type of the TLV.<a href="#section-2.9.2-4.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.2-4.5">Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.2-4.6">1-octet field that contains the length of the
            value portion of the Non-Key TLV in terms of octets.<a href="#section-2.9.2-4.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.2-4.7">Value:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.2-4.8">Variable-length field as indicated by the
            Length field and to be interpreted as per the Type field.<a href="#section-2.9.2-4.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-2.9.2-5"> The following sub-sections specify non-key TLVs. Each NLRI Type <span class="bcp14">MUST</span>
          list the TLVs that can be associated with it.<a href="#section-2.9.2-5" class="pilcrow">¶</a></p>
<div id="CARMPLS">
<section id="section-2.9.2.1">
            <h5 id="name-label-tlv">
<a href="#section-2.9.2.1" class="section-number selfRef">2.9.2.1. </a><a href="#name-label-tlv" class="section-name selfRef">Label TLV</a>
            </h5>
<p id="section-2.9.2.1-1">The Label TLV is used for the advertisement of CAR routes
            along with their MPLS labels. It has the following format as per 
            <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>:<a href="#section-2.9.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.2.1-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|T|  Type     |    Length     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

It is followed by one (or more) labels encoded as below:

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Label                 |Rsrv |S|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><a href="#section-2.9.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.2.1-3">where:<a href="#section-2.9.2.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.2.1-4">
              <dt id="section-2.9.2.1-4.1">Type:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.1-4.2">Type code is 1. The T bit <span class="bcp14">MUST</span> be unset.<a href="#section-2.9.2.1-4.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.1-4.3">Length:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.1-4.4">Length is in octets, variable, and
              <span class="bcp14">MUST</span> be a multiple of 3.<a href="#section-2.9.2.1-4.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.1-4.5">Label Information:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.1-4.6">Multiples of 3-octet fields to
              convey the MPLS label(s) associated with the advertised CAR
              route.  It is used for encoding a single label or a stack of
              labels for usage as described in <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>. The number of labels is derived from the Length
              field. The 3-bit Rsrv field and the 1-bit S field <span class="bcp14">SHOULD</span> be set
              to zero on transmission and <span class="bcp14">MUST</span> be ignored on
              reception.<a href="#section-2.9.2.1-4.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-2.9.2.1-5">If a BGP transport CAR speaker sets itself as the next hop while
            propagating a CAR route, it allocates a local label for
            the type-specific key, and updates the value in this
            TLV. It also <span class="bcp14">MUST</span> program a label cross-connect that would result in
            the label swap operation for the incoming label that it advertises
            with the label received from its best-path router(s).<a href="#section-2.9.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="CARMPLSSID">
<section id="section-2.9.2.2">
            <h5 id="name-label-index-tlv">
<a href="#section-2.9.2.2" class="section-number selfRef">2.9.2.2. </a><a href="#name-label-index-tlv" class="section-name selfRef">Label-Index TLV</a>
            </h5>
<p id="section-2.9.2.2-1">The Label-Index TLV is used for the advertisement of Segment
            Routing over MPLS (SR-MPLS) Segment Identifier (SID) <span>[<a href="#RFC8402" class="cite xref">RFC8402</a>]</span> information associated with the labeled CAR
            routes. It has the following format as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>:<a href="#section-2.9.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.2.2-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|T|   Type    |    Length     |    Reserved   |     Flags     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~               |                 Label Index                   ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~               |
+-+-+-+-+-+-+-+-+</pre><a href="#section-2.9.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.2.2-3">where:<a href="#section-2.9.2.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.2.2-4">
              <dt id="section-2.9.2.2-4.1">Type:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.2-4.2">Type code is 2. The T bit <span class="bcp14">MUST</span> be set.<a href="#section-2.9.2.2-4.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.2-4.3">Length:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.2-4.4">Length is in octets and is 7.<a href="#section-2.9.2.2-4.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.2-4.5">Reserved:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.2-4.6">1-octet field that <span class="bcp14">MUST</span> be
              set to 0 and ignored on receipt.<a href="#section-2.9.2.2-4.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.2-4.7">Flags:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.2-4.8">2-octet field that's defined as per the Flags
              field of the Label-Index TLV of the BGP Prefix-SID attribute
              (<span><a href="https://rfc-editor.org/rfc/rfc8669#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8669" class="cite xref">RFC8669</a>]</span>).<a href="#section-2.9.2.2-4.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.2-4.9">Label Index:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.2-4.10">4-octet field that's defined as per the
              Label Index field of the Label-Index TLV of the BGP Prefix-SID
              attribute (<span><a href="https://rfc-editor.org/rfc/rfc8669#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8669" class="cite xref">RFC8669</a>]</span>).<a href="#section-2.9.2.2-4.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-2.9.2.2-5">This TLV provides the equivalent functionality as the Label-Index TLV
            of <span>[<a href="#RFC8669" class="cite xref">RFC8669</a>]</span> for Transport CAR route in SR-MPLS
            deployments.
            When a speaker allocates a local label for a received CAR route as per 
            <a href="#CARMPLS" class="auto internal xref">Section 2.9.2.1</a>, it <span class="bcp14">SHOULD</span> use the received Label Index as a hint
            using procedures as specified in <span>[<a href="#RFC8669" class="cite xref">RFC8669</a>], <a href="https://rfc-editor.org/rfc/rfc8669#section-4" class="relref">Section 4</a></span>.<a href="#section-2.9.2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.9.2.2-6">The Label-Index TLV provides much better packing efficiency by carrying the
            Label Index in NLRI instead of in the BGP Prefix-SID attribute
            (<a href="#UPDATEPACKING" class="auto internal xref">Appendix D</a>).<a href="#section-2.9.2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.9.2.2-7">The Label-Index TLV <span class="bcp14">MUST NOT</span> be carried in the Prefix-SID attribute for
            BGP CAR routes. If a speaker receives a CAR route with the Label-Index TLV in
            the Prefix-SID attribute, it <span class="bcp14">SHOULD</span> ignore it. The BGP Prefix-SID attribute
            <span class="bcp14">SHOULD NOT</span> be sent with the labeled CAR routes if the attribute is
            being used only to convey the Label-Index TLV.<a href="#section-2.9.2.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="CRSRv6">
<section id="section-2.9.2.3">
            <h5 id="name-srv6-sid-tlv">
<a href="#section-2.9.2.3" class="section-number selfRef">2.9.2.3. </a><a href="#name-srv6-sid-tlv" class="section-name selfRef">SRv6 SID TLV</a>
            </h5>
<p id="section-2.9.2.3-1">BGP Transport CAR can be also used to set up end-to-end
            color-aware connectivity using Segment Routing over IPv6 (SRv6)
            <span>[<a href="#RFC8402" class="cite xref">RFC8402</a>]</span>. <span>[<a href="#RFC8986" class="cite xref">RFC8986</a>]</span> specifies the
            SRv6 Endpoint behaviors (e.g., End Penultimate Segment Pop (PSP)), which can be leveraged for
            BGP CAR with SRv6. The SRv6 SID TLV is used for the advertisement of
            CAR routes along with their SRv6 SIDs. It has the following format
            as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>:<a href="#section-2.9.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.2.3-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|T|  Type     |    Length     |   SRv6 SID Info (variable)   //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-2.9.2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.2.3-3">where:<a href="#section-2.9.2.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.2.3-4">
              <dt id="section-2.9.2.3-4.1">Type:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.3-4.2">Type code is 3. The T bit <span class="bcp14">MUST</span> be unset.<a href="#section-2.9.2.3-4.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.3-4.3">Length:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.3-4.4">Length is in octets, variable, and
              <span class="bcp14">MUST</span> be either less than or equal to 16, or be a
              multiple of 16.<a href="#section-2.9.2.3-4.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-2.9.2.3-4.5">SRv6 SID Information:</dt>
              <dd style="margin-left: 1.5em" id="section-2.9.2.3-4.6">
                <p id="section-2.9.2.3-4.6.1">Field of size as indicated by the
              length that either carries the SRv6 SID(s) for the advertised
              CAR route as one of the following:<a href="#section-2.9.2.3-4.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.2.3-4.6.2.1">
                    <p id="section-2.9.2.3-4.6.2.1.1">A single 128-bit SRv6 SID or an ordered list of
                  128-bit SRv6 SIDs.<a href="#section-2.9.2.3-4.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-2.9.2.3-4.6.2.2">
                    <p id="section-2.9.2.3-4.6.2.2.1">A transposed portion (refer to <span>[<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>) of the SRv6 SID that <span class="bcp14">MUST</span>
                  be of size in multiples of one octet and less than 16.<a href="#section-2.9.2.3-4.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-2.9.2.3-5">
            BGP CAR SRv6 SID TLV definitions provide the following benefits:<a href="#section-2.9.2.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.2.3-6.1">The explicit encoding of SIDs avoids robustness issues caused by the
      overloading of MPLS label fields.<a href="#section-2.9.2.3-6.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-2.9.2.3-6.2">The encoding to include the entire 128 bits for unique SIDs (non-transposition)
      maintains BGP update prefix packing.<a href="#section-2.9.2.3-6.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-2.9.2.3-6.3">The highly efficient transposition scheme (12-14 bytes saved per
      NLRI) also maintains BGP update prefix packing.<a href="#section-2.9.2.3-6.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.9.2.3-7">The BGP CAR route update for SRv6 encapsulation <span class="bcp14">MUST</span>
            include the BGP Prefix-SID attribute along with the SRv6 L3 Service TLV
            carrying the SRv6 SID information as specified in <span>[<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>.
            When using the transposition scheme of encoding for packing efficiency
            of BGP updates <span>[<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>, the transposed part of the SID is carried
            in the SRv6 SID TLV and is not limited by MPLS label field size.<a href="#section-2.9.2.3-7" class="pilcrow">¶</a></p>
<p id="section-2.9.2.3-8">If a BGP transport CAR speaker sets itself as the next hop while
            propagating a CAR route and allocates an SRv6 SID that maps to the received 
            SRv6 SID, it updates the value in this TLV.<a href="#section-2.9.2.3-8" class="pilcrow">¶</a></p>
<p id="section-2.9.2.3-9">Received MPLS information can map to SRv6 and vice versa.<a href="#section-2.9.2.3-9" class="pilcrow">¶</a></p>
<aside id="section-2.9.2.3-10">
              <p id="section-2.9.2.3-10.1">
             <span>[<a href="#I-D.ietf-spring-srv6-mpls-interworking" class="cite xref">SRv6-INTERWORK</a>]</span> describes MPLS
            and SRv6 interworking procedures and their applicability to BGP CAR routes.<a href="#section-2.9.2.3-10.1" class="pilcrow">¶</a></p>
</aside>
</section>
</div>
</section>
</div>
<div id="NLRITYPE1">
<section id="section-2.9.3">
          <h4 id="name-color-aware-route-e-c-nlri-">
<a href="#section-2.9.3" class="section-number selfRef">2.9.3. </a><a href="#name-color-aware-route-e-c-nlri-" class="section-name selfRef">Color-Aware Route (E, C) NLRI Type</a>
          </h4>
<p id="section-2.9.3-1">The Color-Aware Route NLRI Type is used for the advertisement of
          BGP CAR color-aware routes (E, C). It has the following format:<a href="#section-2.9.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.3-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NLRI Length  |  Key Length   |   NLRI Type   |Prefix Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               IP Prefix (variable)                           //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Color (4 octets)                                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><a href="#section-2.9.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.3-3">It is followed by optional Non-Key TLVs encoded as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>.<a href="#section-2.9.3-3" class="pilcrow">¶</a></p>
<p id="section-2.9.3-4">Where:<a href="#section-2.9.3-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.3-5">
            <dt id="section-2.9.3-5.1">NLRI Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.3-5.2">Variable.<a href="#section-2.9.3-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.3-5.3">Key Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.3-5.4">Variable. It indicates the total length comprised of 
            the Prefix Length field, IP Prefix field, and the Color field, as
            described below.  For IPv4 (AFI=1), the minimum length is 5 and the
            maximum length is 9.  For IPv6 (AFI=2), the minimum length is 5
            and the maximum length is 21.<a href="#section-2.9.3-5.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.3-5.5">NLRI Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.3-5.6">1.<a href="#section-2.9.3-5.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.3-5.7">Type-Specific Key Fields:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.3-5.8">
              <p id="section-2.9.3-5.8.1">These are as seen below:<a href="#section-2.9.3-5.8.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.3-5.8.2">
                <dt id="section-2.9.3-5.8.2.1">Prefix Length:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.3-5.8.2.2">1-octet field that carries the
                length of prefix in bits. Length <span class="bcp14">MUST</span> be less
                than or equal to 32 for IPv4 (AFI=1) and less than or equal to
                128 for IPv6 (AFI=2).<a href="#section-2.9.3-5.8.2.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-2.9.3-5.8.2.3">IP Prefix:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.3-5.8.2.4">
                  <p id="section-2.9.3-5.8.2.4.1">IPv4 or IPv6 prefix (based on the
                AFI). A variable-size field that contains the most significant
                octets of the prefix. The format of this field for an IPv4
                prefix is:<a href="#section-2.9.3-5.8.2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.3-5.8.2.4.2.1">0 octet for prefix length 0<a href="#section-2.9.3-5.8.2.4.2.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.3-5.8.2.4.2.2">1 octet for prefix length 1 to 8<a href="#section-2.9.3-5.8.2.4.2.2" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.3-5.8.2.4.2.3">2 octets for prefix length 9 to 16<a href="#section-2.9.3-5.8.2.4.2.3" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.3-5.8.2.4.2.4">3 octets for prefix length 17 up to 24<a href="#section-2.9.3-5.8.2.4.2.4" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.3-5.8.2.4.2.5">4 octets for prefix length 25 up to 32<a href="#section-2.9.3-5.8.2.4.2.5" class="pilcrow">¶</a>
</li>
                  </ul>
<p id="section-2.9.3-5.8.2.4.3">The format for this field for an IPv6 address follows the
                same pattern for prefix lengths of 1-128 (octets 1-16).<a href="#section-2.9.3-5.8.2.4.3" class="pilcrow">¶</a></p>
<p id="section-2.9.3-5.8.2.4.4">The last octet has enough trailing bits to make the end of
                the field fall on an octet boundary. Note that the value of
                the trailing bits <span class="bcp14">MUST</span> be set to zero. The size
                of the field <span class="bcp14">MUST</span> be less than or equal to 4
                for IPv4 (AFI=1) and less than or equal to 16 for IPv6
                (AFI=2).<a href="#section-2.9.3-5.8.2.4.4" class="pilcrow">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt id="section-2.9.3-5.8.2.5">Color:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.3-5.8.2.6">4 octets that contain non-zero color value
              associated with the prefix.<a href="#section-2.9.3-5.8.2.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.3-5.9">Type-Specific Non-Key TLVs:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.3-5.10">The Label TLV, Label-Index TLV,
            and SRv6 SID TLV (<a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>) may be associated
            with the color-aware route NLRI type.<a href="#section-2.9.3-5.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-2.9.3-6">The prefix is unique across the administrative domains where BGP
          transport CAR is deployed. It is possible that the same prefix is
          originated by multiple BGP CAR speakers in the case of
          anycast addressing or multihoming.<a href="#section-2.9.3-6" class="pilcrow">¶</a></p>
<p id="section-2.9.3-7">The Color is introduced to enable multiple route advertisements
          for the same prefix. The color is associated with an intent
          (e.g., low latency) in originator color domain.<a href="#section-2.9.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="NLRITYPE2">
<section id="section-2.9.4">
          <h4 id="name-ip-prefix-e-nlri-type">
<a href="#section-2.9.4" class="section-number selfRef">2.9.4. </a><a href="#name-ip-prefix-e-nlri-type" class="section-name selfRef">IP Prefix (E) NLRI Type</a>
          </h4>
<p id="section-2.9.4-1">The IP Prefix Route NLRI Type is used for the advertisement of
          BGP CAR IP Prefix routes (E). It has the following format:<a href="#section-2.9.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.4-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NLRI Length  |  Key Length   |   NLRI Type   |Prefix Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               IP Prefix (variable)                           //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-2.9.4-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.4-3">It is followed by optional Non-Key TLVs encoded as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>.<a href="#section-2.9.4-3" class="pilcrow">¶</a></p>
<p id="section-2.9.4-4">Where:<a href="#section-2.9.4-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.4-5">
            <dt id="section-2.9.4-5.1">NLRI Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.4-5.2">Variable.<a href="#section-2.9.4-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.4-5.3">Key Length:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.4-5.4">Variable. It indicates the total length comprised of
            the Prefix Length field and IP Prefix field as described below.
            For IPv4 (AFI=1), the minimum length is 1 and the
            maximum length is 5.  For IPv6 (AFI=2), the minimum length is 1
            and the maximum length is 17.<a href="#section-2.9.4-5.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.4-5.5">NLRI Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.4-5.6">2.<a href="#section-2.9.4-5.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.4-5.7">Type-Specific Key Fields:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.4-5.8">
              <p id="section-2.9.4-5.8.1">These are as seen below:<a href="#section-2.9.4-5.8.1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.4-5.8.2">
                <dt id="section-2.9.4-5.8.2.1">Prefix Length:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.4-5.8.2.2">1-octet field that carries the
                length of prefix in bits. Length <span class="bcp14">MUST</span> be less
                than or equal to 32 for IPv4 (AFI=1) and less than or equal to
                128 for IPv6 (AFI=2).<a href="#section-2.9.4-5.8.2.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-2.9.4-5.8.2.3">IP Prefix:</dt>
                <dd style="margin-left: 1.5em" id="section-2.9.4-5.8.2.4">
                  <p id="section-2.9.4-5.8.2.4.1">IPv4 or IPv6 prefix (based on the
                AFI). A variable-size field that contains the most significant
                octets of the prefix. The format of this field for an IPv4
                prefix is:<a href="#section-2.9.4-5.8.2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.4-5.8.2.4.2.1">0 octet for prefix length 0<a href="#section-2.9.4-5.8.2.4.2.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.4-5.8.2.4.2.2">1 octet for prefix length 1 to 8<a href="#section-2.9.4-5.8.2.4.2.2" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.4-5.8.2.4.2.3">2 octets for prefix length 9 to 16<a href="#section-2.9.4-5.8.2.4.2.3" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.4-5.8.2.4.2.4">3 octets for prefix length 17 up to 24<a href="#section-2.9.4-5.8.2.4.2.4" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="section-2.9.4-5.8.2.4.2.5">4 octets for prefix length 25 up to 32<a href="#section-2.9.4-5.8.2.4.2.5" class="pilcrow">¶</a>
</li>
                  </ul>
<p id="section-2.9.4-5.8.2.4.3">The format for this field for an IPv6 address follows the
               same pattern for prefix lengths of 1-128 (octets 1-16).<a href="#section-2.9.4-5.8.2.4.3" class="pilcrow">¶</a></p>
<p id="section-2.9.4-5.8.2.4.4">The last octet has enough trailing bits to make the end of
               the field fall on an octet boundary. Note that the value of the
               trailing bits <span class="bcp14">MUST</span> be set to zero. The size of
               the field <span class="bcp14">MUST</span> be less than or equal to 4 for
               IPv4 (AFI=1) and less than or equal to 16 for IPv6 (AFI=2).<a href="#section-2.9.4-5.8.2.4.4" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.4-5.9">Type-Specific Non-Key TLVs:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.4-5.10">The Label TLV, Label-Index
             TLV, and SRv6 SID TLV (<a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>) may be
             associated with the IP Prefix NLRI Type.<a href="#section-2.9.4-5.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="SECLCMEC">
<section id="section-2.9.5">
          <h4 id="name-local-color-mapping-lcm-ext">
<a href="#section-2.9.5" class="section-number selfRef">2.9.5. </a><a href="#name-local-color-mapping-lcm-ext" class="section-name selfRef">Local Color Mapping (LCM) Extended Community</a>
          </h4>
<p id="section-2.9.5-1">This document defines a new BGP Extended Community called "LCM".
          The LCM is a Transitive Opaque Extended Community with the following encoding:<a href="#section-2.9.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.9.5-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type=0x3  | Sub-Type=0x1b |          Reserved             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Color                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-2.9.5-2" class="pilcrow">¶</a>
</div>
<p id="section-2.9.5-3">where:<a href="#section-2.9.5-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.9.5-4">
            <dt id="section-2.9.5-4.1">Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.5-4.2">0x3.<a href="#section-2.9.5-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.5-4.3">Sub-Type:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.5-4.4">0x1b.<a href="#section-2.9.5-4.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.5-4.5">Reserved:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.5-4.6">2-octet reserved field that
            <span class="bcp14">MUST</span> be set to zero on transmission and ignored on
            reception.<a href="#section-2.9.5-4.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.9.5-4.7">Color:</dt>
            <dd style="margin-left: 1.5em" id="section-2.9.5-4.8">4-octet field that carries the non-zero 32-bit color value.<a href="#section-2.9.5-4.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-2.9.5-5">
          When a CAR route crosses the originator's color domain boundary, LCM-EC 
          is added or updated, as specified in <a href="#SDIFFCOLORS" class="auto internal xref">Section 2.8</a>. LCM-EC 
          conveys the local color mapping for the intent
          (e.g., low latency) in other (transit or destination) color domains.<a href="#section-2.9.5-5" class="pilcrow">¶</a></p>
<p id="section-2.9.5-6">For CAR IP Prefix routes, LCM-EC may also be added in the originator color domain to
          indicate the color associated with the IP prefix.<a href="#section-2.9.5-6" class="pilcrow">¶</a></p>
<p id="section-2.9.5-7">An implementation <span class="bcp14">SHOULD NOT</span> send more than one instance of the LCM-EC. 
        However, if more than one instance is received, an implementation <span class="bcp14">MUST</span> 
        disregard all instances other than the one with the numerically highest 
        value.<a href="#section-2.9.5-7" class="pilcrow">¶</a></p>
<p id="section-2.9.5-8">If a node receives multiple BGP CAR routes (paths) for a given destination endpoint and color that have 
               different LCM values, it is a misconfiguration in color re-mapping for one of the routes.<a href="#section-2.9.5-8" class="pilcrow">¶</a></p>
<p id="section-2.9.5-9">In this case, the LCM from the selected BGP best path <span class="bcp14">SHOULD</span> be chosen to be installed into the routing 
              table.<a href="#section-2.9.5-9" class="pilcrow">¶</a></p>
<p id="section-2.9.5-10">A warning message <span class="bcp14">SHOULD</span> also be logged for further operator intervention.<a href="#section-2.9.5-10" class="pilcrow">¶</a></p>
<p id="section-2.9.5-11">If present, LCM-EC contains the intent of a BGP CAR route.
        LCM-EC Color is used instead of the Color in CAR route NLRI for procedures 
        described in earlier sections such as route validation (<a href="#ROUTEVALIDN" class="auto internal xref">Section 2.4</a>), 
              route resolution (<a href="#ROUTERES" class="auto internal xref">Section 2.5</a>), 
        AIGP calculation (<a href="#AIGPMETRIC" class="auto internal xref">Section 2.6</a>) and steering (<a href="#STEERING" class="auto internal xref">Section 3</a>).<a href="#section-2.9.5-11" class="pilcrow">¶</a></p>
<p id="section-2.9.5-12">The LCM-EC <span class="bcp14">MAY</span> be used for filtering of BGP CAR routes and/or for 
          applying routing policies on the intent, when present.<a href="#section-2.9.5-12" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="LCMBGPECUSAGE">
<section id="section-2.10">
        <h3 id="name-lcm-ec-and-bgp-color-ec-usa">
<a href="#section-2.10" class="section-number selfRef">2.10. </a><a href="#name-lcm-ec-and-bgp-color-ec-usa" class="section-name selfRef">LCM-EC and BGP Color-EC Usage</a>
        </h3>
<p id="section-2.10-1">There are 2 distinct requirements to be supported as stated in 
        <span>[<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>:<a href="#section-2.10-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.10-2">
<li id="section-2.10-2.1">
            <p id="section-2.10-2.1.1">Domains with different intent granularity (<span><a href="https://datatracker.ietf.org/doc/html/draft-hr-spring-intentaware-routing-using-color-04#section-6.3.1.9" class="relref">Section 6.3.1.9</a> of [<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>)<a href="#section-2.10-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.10-2.2">
            <p id="section-2.10-2.2.1">Network domains under different administration (i.e., color
            domains; see <span><a href="https://datatracker.ietf.org/doc/html/draft-hr-spring-intentaware-routing-using-color-04#section-6.3.1.10" class="relref">Section 6.3.1.10</a> of [<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>)<a href="#section-2.10-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.10-3">Requirement 1 is the case where within the same administrative or 
        color domain, BGP CAR routes for N end-to-end intents may need to traverse 
        across an intermediate transit domain where only M intents are available, N &gt;= M.
        For example, consider a multi-domain network is designed as Access-Core-Access. 
        The core may have the most granular N intents, whereas the access only has fewer M 
        intents. Therefore, the BGP next-hop resolution for a CAR route in the access domain must be 
        via a color-aware path for one of these M intents. As the procedures in <a href="#ROUTERES" class="auto internal xref">Section 2.5</a> describe, 
        and the example in <a href="#APPENDIXNM" class="auto internal xref">Appendix B.2</a> illustrates, 
        BGP Color-EC is used to automate the CAR route resolution in this case.<a href="#section-2.10-3" class="pilcrow">¶</a></p>
<p id="section-2.10-4">For requirement 2, where CAR routes traverse across different color domains, 
        LCM-EC is used to carry the local color mapping for the NLRI color in other color
        domains. The related procedures are described in <a href="#SDIFFCOLORS" class="auto internal xref">Section 2.8</a>, and 
        an example is given in <a href="#APPENDIXMCD" class="auto internal xref">Appendix B.3</a>.<a href="#section-2.10-4" class="pilcrow">¶</a></p>
<p id="section-2.10-5">Both LCM-EC and BGP Color-EC may be present at the same time with a BGP CAR route. 
        For example, a BGP CAR route (E, C1) from color domain D1, with LCM-EC C2 in color 
        domain D2, may also carry Color-EC C3 and next hop N in a transit network domain 
        within D2 where C2 is being resolved via an available intra-domain intent C3 (see
        the detailed example in the combination of Appendices <a href="#APPENDIXNM" class="auto internal xref">B.2</a> and 
        <a href="#APPENDIXMCD" class="auto internal xref">B.3</a>).<a href="#section-2.10-5" class="pilcrow">¶</a></p>
<p id="section-2.10-6">In this case, as described in <a href="#ROUTERES" class="auto internal xref">Section 2.5</a>, the default order of 
        processing for resolution in the presence of LCM-EC is local policy, then BGP Color-EC 
        color, and finally LCM-EC color.<a href="#section-2.10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Fault">
<section id="section-2.11">
        <h3 id="name-error-handling">
<a href="#section-2.11" class="section-number selfRef">2.11. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
        </h3>
<p id="section-2.11-1">The error handling actions as described in <span>[<a href="#RFC7606" class="cite xref">RFC7606</a>]</span> are applicable for the handling of BGP update messages
        for BGP CAR SAFI. In general, as indicated in <span>[<a href="#RFC7606" class="cite xref">RFC7606</a>]</span>, 
        the goal is to minimize the disruption of a session reset or 
        'AFI/SAFI disable' to the extent possible.<a href="#section-2.11-1" class="pilcrow">¶</a></p>
<p id="section-2.11-2">When the error determined allows for the router to skip the malformed
        NLRI(s) and continue processing of the rest of the update message, then
        it <span class="bcp14">MUST</span> handle such malformed NLRIs as 'treat-as-withdraw'.
        In other cases, where the error in the NLRI encoding results in the inability to
        process the BGP update message, then the router <span class="bcp14">SHOULD</span> handle such malformed 
        NLRIs as 'AFI/SAFI disable' when other AFI/SAFI besides BGP CAR are being 
        advertised over the same session. Alternately, the router <span class="bcp14">MUST</span> perform 
        'session reset' when the session is only being used for BGP CAR SAFI.<a href="#section-2.11-2" class="pilcrow">¶</a></p>
<p id="section-2.11-3">The CAR NLRI definition encodes NLRI length and key length explicitly.
        The NLRI length <span class="bcp14">MUST</span> be relied upon to enable the beginning of the next
        NLRI field to be located. Key length <span class="bcp14">MUST</span> be relied upon to extract the 
        key and perform 'treat-as-withdraw' for malformed information.<a href="#section-2.11-3" class="pilcrow">¶</a></p>
<p id="section-2.11-4">A sender <span class="bcp14">MUST</span> ensure that the NLRI and key lengths are the number of actual 
 bytes encoded in the NLRI and key fields, respectively, regardless of 
 content being encoded.<a href="#section-2.11-4" class="pilcrow">¶</a></p>
<p id="section-2.11-5">Given the NLRI length and Key length <span class="bcp14">MUST</span> be valid, failures in the following 
   checks result in 'AFI/SAFI disable' or 'session reset':<a href="#section-2.11-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.11-6.1">
            <p id="section-2.11-6.1.1">The minimum NLRI Length <span class="bcp14">MUST</span> be at least 2, as Key Length and NLRI Type are required fields.<a href="#section-2.11-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-6.2">
            <p id="section-2.11-6.2.1">The Key Length <span class="bcp14">MUST</span> be at least 2 less than NLRI Length.<a href="#section-2.11-6.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.11-7">NLRI type-specific error handling:<a href="#section-2.11-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.11-8.1">
            <p id="section-2.11-8.1.1">By default, a speaker <span class="bcp14">SHOULD</span> discard an
            unrecognized or unsupported NLRI type and move to the next
            NLRI.<a href="#section-2.11-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-8.2">
            <p id="section-2.11-8.2.1">Key length and key errors of a known NLRI type
            <span class="bcp14">SHOULD</span> result in the discard of NLRI similar to an
            unrecognized NLRI type. (This <span class="bcp14">MUST</span> be logged for
            trouble shooting.)<a href="#section-2.11-8.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.11-9">Transparent propagation of unrecognized NLRI type:<a href="#section-2.11-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.11-10.1">
            <p id="section-2.11-10.1.1">Key length allows unrecognized route types to transit through the RR 
 transparently without a software upgrade. The RR receiving unrecognized route
        types does not need to interpret the key portion of an NLRI and handles the NLRI
        as an opaque value of a specific length. An implementation <span class="bcp14">SHOULD</span> provide configuration 
        that controls the RR unrecognized route type propagation behavior, possibly at 
        the granularity of route type values allowed. This configuration option gives the
        operator the ability to allow specific route types to be transparently passed through 
        RRs based on client speaker support.<a href="#section-2.11-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-10.2">
            <p id="section-2.11-10.2.1">In such a case, the RRs may reflect NLRIs with NLRI type-specific key length and 
 field errors. Clients of such an RR that consume the route for installation 
 will perform the key error handling of known NLRI type or discard the
 unrecognized type. This prevents propagation of routes with NLRI errors any 
 further in network.<a href="#section-2.11-10.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.11-11">Type-specific Non-Key TLV handling:<a href="#section-2.11-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.11-12.1">
            <p id="section-2.11-12.1.1">Either the length of a TLV would cause the NLRI length to be exceeded when 
 parsing the TLV, or fewer than 2 bytes remain when beginning to parse the TLV.
 In either of these cases, an error condition exists, and the 'treat-as-withdraw' 
 approach <span class="bcp14">MUST</span> be used.<a href="#section-2.11-12.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-12.2">
            <p id="section-2.11-12.2.1">Type-specific length constraints should be verified. The TLV <span class="bcp14">MUST</span> be
 discarded if there is an error. When discarded, an error may be logged for further 
        analysis.<a href="#section-2.11-12.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-12.3">
            <p id="section-2.11-12.3.1">If multiple instances of same type are encountered, all but the first 
 instance <span class="bcp14">MUST</span> be discarded. When discarded, an error may be logged for further analysis.<a href="#section-2.11-12.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.11-12.4">
            <p id="section-2.11-12.4.1">If a speaker that performs encapsulation to the BGP next hop
            does not receive at least one recognized forwarding information
            TLV with the T bit unset (such as label or SRv6 SID), such NLRI is
            considered invalid and not eligible for best path
            selection. 'Treat-as-withdraw' may be used, though it is recommended
            to keep the NLRI for debugging purposes.<a href="#section-2.11-12.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="STEERING">
<section id="section-3">
      <h2 id="name-service-route-automated-ste">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-service-route-automated-ste" class="section-name selfRef">Service Route Automated Steering on Color-Aware Paths</a>
      </h2>
<p id="section-3-1">An ingress PE (or ASBR) E1 automatically steers a C-colored service route 
      V/v from E2 onto an (E2, C) color-aware path, as illustrated in 
      <a href="#SECCARIllus" class="auto internal xref">Section 1.2</a>. If several such paths exist, a preference scheme is used 
      to select the best path. The default preference scheme is IGP Flexible Algorithm first, then 
      SR Policy, followed by BGP CAR. A configuration option may be used to adjust the 
      default preference scheme.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">An egress PE may express its intent that traffic should be steered a certain way through the transport layer
      by including the BGP Color-EC <span>[<a href="#RFC9012" class="cite xref">RFC9012</a>]</span> with the relevant service routes. An ingress PE
      steers service traffic over a CAR (E, C) route using the service route's next
      hop and BGP Color-EC.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">This is consistent with the automated service route steering on SR
      Policy (a routing solution providing color-aware paths) defined in <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>. All the steering variations described in <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span> are applicable to BGP CAR paths:
      on-demand steering, per-destination steering, per-flow steering, and
      color-only steering. For brevity, please refer to <span><a href="https://rfc-editor.org/rfc/rfc9256#section-8" class="relref">Section 8</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4"><a href="#SSTEERINGAPNDX" class="auto internal xref">Appendix A</a> provides illustrations of service route 
      automated steering over BGP CAR (E, C) routes.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">An egress PE may express its intent that traffic should be steered a certain way through the transport layer
      by allocating the SRv6 Service SID from a routed intent-aware 
      locator prefix (<span><a href="https://rfc-editor.org/rfc/rfc8986#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8986" class="cite xref">RFC8986</a>]</span>). Steering at an ingress
      PE is via resolution of the Service SID over a CAR Type-2 IP Prefix route.
      Service steering over BGP CAR SRv6 transport is described in 
      <a href="#SECCARSRV6" class="auto internal xref">Section 7</a>.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">Service steering via BGP CAR routes is applicable to any BGP SAFI, including SAFIs for 
      IPv4/IPv6 (SAFI 1), L3VPN (SAFI 128), pseudowire (PW), EVPN (SAFI 70), FlowSpec, 
      and BGP-LU (SAFI 4).<a href="#section-3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="FILTERING">
<section id="section-4">
      <h2 id="name-filtering">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-filtering" class="section-name selfRef">Filtering</a>
      </h2>
<p id="section-4-1">PEs and BRs may support filtering of CAR routes. For instance, the filtering 
      may only accept routes of locally configured colors.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Techniques such as RT Constrain <span>[<a href="#RFC4684" class="cite xref">RFC4684</a>]</span> may also be applied to the CAR SAFI, where
      Route Target (RT) Extended Communities <span>[<a href="#RFC4360" class="cite xref">RFC4360</a>]</span> can be used to constrain distribution and 
      automate filtering of CAR routes. RT assignment may be via user policy; for example, an RT 
      value can be assigned to all routes of a specific color.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">A PE may support on-demand installation of a CAR route based on the presence of a service route whose next hop 
      resolves via the CAR route.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Similarly, a PE may dynamically subscribe to receive individual CAR
      routes from upstream routers or Route Reflectors (RRs) to limit the routes
      that it needs to learn. On-demand subscription and automated filtering
      procedures for individual CAR routes are outside the scope of this
      document.<a href="#section-4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SCLNG">
<section id="section-5">
      <h2 id="name-scaling">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-scaling" class="section-name selfRef">Scaling</a>
      </h2>
<p id="section-5-1">This section analyzes the key scale requirement of 
      <span>[<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>, specifically:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">
          <p id="section-5-2.1.1">No intermediate node data plane should need to scale to (Colors * PEs).<a href="#section-5-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-2.2">
          <p id="section-5-2.2.1">No node should learn and install a BGP CAR route to (E, C) if it does 
        not install a colored service route to E.<a href="#section-5-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-3">While the requirements and design principles generally apply to any transport, 
      the logical analysis based on the network design in this section focuses on 
      MPLS/SR-MPLS transport since the scaling constraints are specifically relevant to 
      these technologies. BGP CAR SAFI is used here, but the considerations can apply to 
      <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span> or <span>[<a href="#RFC8669" class="cite xref">RFC8669</a>]</span> used with MPLS/SR-MPLS.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Two key principles used to address the scaling requirements are a 
    hierarchical network and routing design, and on-demand route 
    subscription and filtering.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5"><a href="#SUSRT" class="auto internal xref">Figure 2</a> in <a href="#USTOP" class="auto internal xref">Section 5.1</a> provides an ultra-scale 
      reference topology. <a href="#USTOP" class="auto internal xref">Section 5.1</a> describes this topology.
      <a href="#SSDM" class="auto internal xref">Section 5.2</a> presents three design models to deploy BGP CAR in the 
      reference topology, including hierarchical options. <a href="#SSA" class="auto internal xref">Section 5.3</a> analyzes 
      the logical scaling properties of each model.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">Filtering techniques described in the previous section allow a PE to
      limit the CAR routes that it needs to learn or install. Scaling benefits
      of on-demand BGP subscription and filtering will be described in a
      separate document.<a href="#section-5-6" class="pilcrow">¶</a></p>
<div id="USTOP">
<section id="section-5.1">
        <h3 id="name-ultra-scale-reference-topol">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-ultra-scale-reference-topol" class="section-name selfRef">Ultra-Scale Reference Topology</a>
        </h3>
<span id="name-ultra-scale-reference-topolo"></span><div id="SUSRT">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-5.1-1.1">
<pre>
                                         RD:V/v via E2
          +-----+              +-----+ vpn label:30030 +-----+
  ....... |S-RR1| &lt;........... |S-RR2| &lt;...............|S-RR3| &lt;......
  :       +-----+              +-----+  Color C1       +-----+       :
  :                                                                  :
  :                                                                  :
  :                                                                  :
 +:------------+--------------+--------------+--------------+--------:-+
 |:            |              |              |              |        : |
 |:            |              |              |              |        : |
 |:          +---+          +---+          +---+          +---+      : |
 |:          |121|          |231|          |341|          |451|      : |
 |:          +---+          +---+          +---+          +---+      : |
 |---+         |              |              |              |      +---|
 | E1|         |              |              |              |      | E2|
 |---+         |              |              |              |      +---|
 |           +---+          +---+          +---+          +---+        |
 |           |122|          |232|          |342|          |452|        |
 |           +---+          +---+          +---+          +---+        |
 |   Access    |   Metro      |   Core       |   Metro      | Access   |
 |   domain 1  |   domain 2   |   domain 3   |   domain 4   | domain 5 |
 +-------------+--------------+--------------+--------------+----------+
  iPE         iBRM          iBRC           eBRC           eBRM       ePE
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-ultra-scale-reference-topolo" class="selfRef">Ultra-Scale Reference Topology</a>
          </figcaption></figure>
</div>
<p id="section-5.1-2">The following description applies to the reference topology above:<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.1">
            <p id="section-5.1-3.1.1">Independent IS-IS/OSPF SR instance in each domain.<a href="#section-5.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.2">
            <p id="section-5.1-3.2.1">Each domain has Flex-Algo 128. Prefix-SID for a node is Segment Routing Global Block (SRGB) 168000 plus 
          node number.<a href="#section-5.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.3">
            <p id="section-5.1-3.3.1">A BGP CAR route (E2, C1) is advertised by egress BRM node 451. The route is 
          sourced locally from redistribution from IGP Flex-Algo 128.<a href="#section-5.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.4">
            <p id="section-5.1-3.4.1">Not shown for simplicity, node 452 will also advertise (E2, C1).<a href="#section-5.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.5">
            <p id="section-5.1-3.5.1">When a transport RR (T-RR) is used within the domain or across domains, 
          ADD-PATH is enabled to advertise paths from both egress BRs to its
          clients.<a href="#section-5.1-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.6">
            <p id="section-5.1-3.6.1">Egress PE E2 advertises a VPN route RD:V/v with BGP Color-EC C1 that propagates via service RRs to ingress PE E1.<a href="#section-5.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.7">
            <p id="section-5.1-3.7.1">E1 steers V/v prefix via color-aware path (E2, C1) and VPN label 30030.<a href="#section-5.1-3.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="SSDM">
<section id="section-5.2">
        <h3 id="name-deployment-model">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-deployment-model" class="section-name selfRef">Deployment Model</a>
        </h3>
<section id="section-5.2.1">
          <h4 id="name-flat">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-flat" class="section-name selfRef">Flat</a>
          </h4>
<span id="name-flat-transport-network-desi"></span><div id="SFLAT">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-5.2.1-1.1">
<pre>
                                        RD:V/v via E2
         +-----+              +-----+ vpn label:30030 +-----+
 ....... |S-RR1| &lt;........... |S-RR2| &lt;...............|S-RR3| &lt;......
 :       +-----+              +-----+  Color C1       +-----+       :
 :                                                                  :
 :                                                                  :
 :                                                                  :
+:------------+--------------+--------------+--------------+--------:-+
|:            |              |              |              |        : |
|:            |   (E2,C1)    |   (E2,C1)    |   (E2,C1)    |        : |
|:          +---+ via 231  +---+ via 341  +---+ via 451  +---+      : |
|:(E2,C1)   |121|&lt;---------|231|&lt;---------|341|&lt;---------|451|      : |
|: via 121 /+---+ L=168002 +---+ L=168002 +---+ L=168002 +---+      : |
|---+     /   |              |              |              |      +---|
| E1| &lt;--/    |              |              |              |      | E2|
|---+ L=168002|              |              |              |      +---|
|           +---+          +---+          +---+          +---+        |
|           |122|          |232|          |342|          |452|        |
|           +---+          +---+          +---+          +---+        |
|   Access    |   Metro      |   Core       |   Metro      | Access   |
|   domain 1  |   domain 2   |   domain 3   |   domain 4   | domain 5 |
+-------------+--------------+--------------+--------------+----------+
 iPE         iBRM          iBRC           eBRC           eBRM      ePE


168121      168231        168341        168451
168002      168002        168002        168002         168002
 30030       30030         30030         30030          30030     30030
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-flat-transport-network-desi" class="selfRef">Flat Transport Network Design</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.1">
              <p id="section-5.2.1-2.1.1">Node 451 advertises BGP CAR route (E2, C1) to 341, from which
              it goes to 231, then to 121, and finally to E1.<a href="#section-5.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.1-2.2">
              <p id="section-5.2.1-2.2.1">Each BGP hop allocates local label and programs swap entry in forwarding 
            for (E2, C1).<a href="#section-5.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.1-2.3">
              <p id="section-5.2.1-2.3.1">E1 receives BGP CAR route (E2, C1) via 121 with label 168002.<a href="#section-5.2.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.3.2.1">
                  <p id="section-5.2.1-2.3.2.1.1">Let's assume E1 selects that path.<a href="#section-5.2.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.1-2.4">
              <p id="section-5.2.1-2.4.1">E1 resolves BGP CAR route (E2, C1) via 121 on color-aware path (121, C1).<a href="#section-5.2.1-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.4.2.1">
                  <p id="section-5.2.1-2.4.2.1.1">Color-aware path (121, C1) is Flex-Algo 128 path to 121 
                  (label 168121).<a href="#section-5.2.1-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.1-2.5">
              <p id="section-5.2.1-2.5.1">E1's imposition color-aware label stack for V/v is thus:<a href="#section-5.2.1-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-2.5.2.1">
                  <p id="section-5.2.1-2.5.2.1.1">30030 &lt;=&gt; V/v<a href="#section-5.2.1-2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.1-2.5.2.2">
                  <p id="section-5.2.1-2.5.2.2.1">168002 &lt;=&gt; (E2, C1)<a href="#section-5.2.1-2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.1-2.5.2.3">
                  <p id="section-5.2.1-2.5.2.3.1">168121 &lt;=&gt; (121, C1)<a href="#section-5.2.1-2.5.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.1-2.6">
              <p id="section-5.2.1-2.6.1">Each BGP hop performs swap operation on 168002 bound to color-aware path 
            (E2, C1).<a href="#section-5.2.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
<section id="section-5.2.2">
          <h4 id="name-hierarchical-design-with-ne">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-hierarchical-design-with-ne" class="section-name selfRef">Hierarchical Design with Next-Hop-Self at Ingress Domain BR</a>
          </h4>
<span id="name-hierarchical-bgp-transport-"></span><div id="BGPCARSCALEHEIRNH">
<figure id="figure-4">
            <div class="alignLeft art-text artwork" id="section-5.2.2-1.1">
<pre>
                               (E2,C1)
                      +-----+  via 451        +-----+
                      |T-RR1| &lt;-------------- |T-RR2|
                    / +-----+  L=168002       +-----+\
                   /                                   \
+-------------+---/----------+--------------+-----------\--+----------+
|             |  /           |              |            \ |          |
|  (E2,C1)    | / (451,C1)   |   (451,C1)   |             \|          |
|  via 121  +---+ via 231  +---+ via 341  +---+          +---+        |
|  L=168002 |121| &lt;======= |231| &lt;========|341| &lt;======= |451|        |
|         / +---+ L=168451 +---+ L=168451 +---+          +---+        |
|---+    /    |              |              |              |      +---|
| E1|&lt;--/     |              |              |              |      | E2|
|---+         |              |              |              |      +---|
|           +---+          +---+          +---+          +---+        |
|           |122|          |232|          |342|          |452|        |
|           +---+          +---+          +---+          +---+        |
|   Access    |   Metro      |   Core       |   Metro      | Access   |
|   domain 1  |   domain 2   |   domain 3   |   domain 4   | domain 5 |
+-------------+--------------+--------------+--------------+----------+
 iPE         iBRM          iBRC           eBRC           eBRM      ePE

            168231        168341
168121      168451        168451        168451
168002      168002        168002        168002         168002
 30030       30030         30030         30030          30030     30030
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-hierarchical-bgp-transport-" class="selfRef">Hierarchical BGP Transport CAR, Next-Hop-Self (NHS) at iBR</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.1">
              <p id="section-5.2.2-2.1.1">Node 451 advertises BGP CAR route (451, C1) to 341, from which it goes to 
            231, and finally to 121.<a href="#section-5.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.2">
              <p id="section-5.2.2-2.2.1">Each BGP hop allocates local label and programs swap entry in forwarding 
            for (451, C1).<a href="#section-5.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.3">
              <p id="section-5.2.2-2.3.1">121 resolves received BGP CAR route (451, C1) via 231 (label 168451) on 
            color-aware path (231, C1).<a href="#section-5.2.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.3.2.1">
                  <p id="section-5.2.2-2.3.2.1.1">Color-aware path (231, C1) is Flex-Algo 128 path to 231 (label 168231).<a href="#section-5.2.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.2-2.4">
              <p id="section-5.2.2-2.4.1">451 advertises BGP CAR route (E2, C1) via 451 to T-RR2, which
            reflects it to T-RR1, which reflects it to 121.<a href="#section-5.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.5">
              <p id="section-5.2.2-2.5.1">121 receives BGP CAR route (E2, C1) via 451 with label 168002.<a href="#section-5.2.2-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.5.2.1">
                  <p id="section-5.2.2-2.5.2.1.1">Let's assume 121 selects that path.<a href="#section-5.2.2-2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.2-2.6">
              <p id="section-5.2.2-2.6.1">121 resolves BGP CAR route (E2, C1) via 451 on color-aware path (451, C1).<a href="#section-5.2.2-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.6.2.1">
                  <p id="section-5.2.2-2.6.2.1.1">Color-aware path (451, C1) is BGP CAR path to 451 (label 168451).<a href="#section-5.2.2-2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.2-2.7">
              <p id="section-5.2.2-2.7.1">121 imposition of color-aware label stack for (E2, C1) is thus:<a href="#section-5.2.2-2.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.7.2.1">
                  <p id="section-5.2.2-2.7.2.1.1">168002 &lt;=&gt; (E2, C1)<a href="#section-5.2.2-2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.2-2.7.2.2">
                  <p id="section-5.2.2-2.7.2.2.1">168451 &lt;=&gt; (451, C1)<a href="#section-5.2.2-2.7.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.2-2.7.2.3">
                  <p id="section-5.2.2-2.7.2.3.1">168231 &lt;=&gt; (231, C1)<a href="#section-5.2.2-2.7.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.2-2.8">
              <p id="section-5.2.2-2.8.1">121 advertises (E2, C1) to E1 with next-hop-self (121) and label 168002.<a href="#section-5.2.2-2.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.9">
              <p id="section-5.2.2-2.9.1">E1 constructs same imposition color-aware label stack for V/v via (E2, C1) 
            as in the flat model:<a href="#section-5.2.2-2.9.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.9.2.1">
                  <p id="section-5.2.2-2.9.2.1.1">30030 &lt;=&gt; V/v<a href="#section-5.2.2-2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.2-2.9.2.2">
                  <p id="section-5.2.2-2.9.2.2.1">168002 &lt;=&gt; (E2, C1)<a href="#section-5.2.2-2.9.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.2-2.9.2.3">
                  <p id="section-5.2.2-2.9.2.3.1">168121 &lt;=&gt; (121, C1)<a href="#section-5.2.2-2.9.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.2-2.10">
              <p id="section-5.2.2-2.10.1">121 performs swap operation on 168002 with hierarchical color-aware label 
            stack for (E2, C1) via 451 from step 7.<a href="#section-5.2.2-2.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.11">
              <p id="section-5.2.2-2.11.1">Nodes 231 and 341 perform swap operation on 168451 bound to color-aware 
            path (451, C1).<a href="#section-5.2.2-2.11.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.2-2.12">
              <p id="section-5.2.2-2.12.1">451 performs swap operation on 168002 bound to color-aware path (E2, C1).<a href="#section-5.2.2-2.12.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.2.2-3">Note: E1 does not need the BGP CAR route (451, C1) in this design.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
</section>
<div id="SBGPCARSCALEHEIRNHU">
<section id="section-5.2.3">
          <h4 id="name-hierarchical-design-with-nex">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-hierarchical-design-with-nex" class="section-name selfRef">Hierarchical Design with Next-Hop-Unchanged at Ingress Domain BR</a>
          </h4>
<span id="name-hierarchical-bgp-transport-c"></span><div id="BGPCARSCALEHEIRNHU">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-5.2.3-1.1">
<pre>
                               (E2,C1)
                      +-----+  via 451        +-----+
                      |T-RR1| &lt;-------------- |T-RR2|
                    / +-----+  L=168002       +-----+\
                   /                                   \
+-------------+---/----------+--------------+-----------\--+----------+
|             |  /           |              |            \ |          |
|  (E2,C1)    | / (451,C1)   |   (451,C1)   |             \|          |
|  via 451  +---+ via 231  +---+ via 341  +---+          +---+        |
|  L=168002/|121| &lt;======= |231| &lt;========|341| &lt;======= |451|        |
|         / +---+ L=168451 +---+ L=168451 +---+          +---+        |
|---+ &lt;--/  //|              |              |              |      +---|
| E1|      // |              |              |              |      | E2|
|---+ &lt;===//  |              |              |              |      +---|
|  (451,C1) +---+          +---+          +---+          +---+        |
|  via 121  |122|          |232|          |342|          |452|        |
|  L=168451 +---+          +---+          +---+          +---+        |
|             |              |              |              |          |
|   Access    |   Metro      |   Core       |   Metro      | Access   |
|   domain 1  |   domain 2   |   domain 3   |   domain 4   | domain 5 |
+-------------+--------------+--------------+--------------+----------+
 iPE         iBRM           iBRC          eBRC           eBRM      ePE

168121      168231        168341
168451      168451        168451        168451
168002      168002        168002        168002         168002
 30030       30030         30030         30030          30030     30030
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-hierarchical-bgp-transport-c" class="selfRef">Hierarchical BGP Transport CAR, Next-Hop-Unchanged (NHU) at iBR</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.1">
              <p id="section-5.2.3-2.1.1">Nodes 341, 231, and 121 receive and resolve BGP CAR route (451, C1) the 
            same as in the previous model.<a href="#section-5.2.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.2">
              <p id="section-5.2.3-2.2.1">Node 121 allocates local label and programs swap entry in forwarding for 
            (451, C1).<a href="#section-5.2.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.3">
              <p id="section-5.2.3-2.3.1">451 advertises BGP CAR route (E2, C1) to T-RR2, which 
            reflects it to T-RR1, which reflects it to 121.<a href="#section-5.2.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.4">
              <p id="section-5.2.3-2.4.1">Node 121 advertises (E2, C1) to E1 with next hop as 451
              (i.e., next-hop-unchanged).<a href="#section-5.2.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.5">
              <p id="section-5.2.3-2.5.1">121 also advertises (451, C1) to E1 with next-hop-self (121) and label 
            168451.<a href="#section-5.2.3-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.6">
              <p id="section-5.2.3-2.6.1">E1 resolves BGP CAR route (451, C1) via 121 on color-aware path (121, C1).<a href="#section-5.2.3-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.6.2.1">
                  <p id="section-5.2.3-2.6.2.1.1">Color-aware path (121, C1) is Flex-Algo 128 path to 121 (label 168121).<a href="#section-5.2.3-2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.3-2.7">
              <p id="section-5.2.3-2.7.1">E1 receives BGP CAR route (E2, C1) via 451 with label 168002.<a href="#section-5.2.3-2.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.7.2.1">
                  <p id="section-5.2.3-2.7.2.1.1">Let's assume E1 selects that path.<a href="#section-5.2.3-2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.3-2.8">
              <p id="section-5.2.3-2.8.1">E1 resolves BGP CAR route (E2, C1) via 451 on color-aware path (451, C1).<a href="#section-5.2.3-2.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.8.2.1">
                  <p id="section-5.2.3-2.8.2.1.1">Color-aware path (451, C1) is BGP CAR path to 451 (label 168451).<a href="#section-5.2.3-2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.3-2.9">
              <p id="section-5.2.3-2.9.1">E1's imposition color-aware label stack for V/v is thus:<a href="#section-5.2.3-2.9.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.9.2.1">
                  <p id="section-5.2.3-2.9.2.1.1">30030 &lt;=&gt; V/v<a href="#section-5.2.3-2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.3-2.9.2.2">
                  <p id="section-5.2.3-2.9.2.2.1">168002 &lt;=&gt; (E2, C1)<a href="#section-5.2.3-2.9.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.3-2.9.2.3">
                  <p id="section-5.2.3-2.9.2.3.1">168451 &lt;=&gt; (451, C1)<a href="#section-5.2.3-2.9.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.2.3-2.9.2.4">
                  <p id="section-5.2.3-2.9.2.4.1">168121 &lt;=&gt; (121, C1)<a href="#section-5.2.3-2.9.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.2.3-2.10">
              <p id="section-5.2.3-2.10.1">Nodes 121, 231, and 341 perform swap operation on 168451 bound to (451, C1).<a href="#section-5.2.3-2.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.2.3-2.11">
              <p id="section-5.2.3-2.11.1">451 performs swap operation on 168002 bound to color-aware path (E2, C1).<a href="#section-5.2.3-2.11.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="SSA">
<section id="section-5.3">
        <h3 id="name-scale-analysis">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-scale-analysis" class="section-name selfRef">Scale Analysis</a>
        </h3>
<p id="section-5.3-1">The following two tables summarize the logically analyzed scaling of the 
        control plane and data plane for the previous three models:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1"></th>
              <th class="text-left" rowspan="1" colspan="1">E1</th>
              <th class="text-left" rowspan="1" colspan="1">121</th>
              <th class="text-left" rowspan="1" colspan="1">231</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">FLAT</th>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (121,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (231,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (341,C)</td>
            </tr>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">H.NHS</th>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (121,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (451,C)<br>(451,C) via (231,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(451,C) via (341,C)</td>
            </tr>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">H.NHU</th>
              <td class="text-left" rowspan="1" colspan="1">(E2,C) via (451,C)<br>(451,C) via (121,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(451,C) via (231,C)</td>
              <td class="text-left" rowspan="1" colspan="1">(451,C) via (341,C)</td>
            </tr>
          </tbody>
        </table>
<table class="center" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1"></th>
              <th class="text-left" rowspan="1" colspan="1">E1</th>
              <th class="text-left" rowspan="1" colspan="1">121</th>
              <th class="text-left" rowspan="1" colspan="1">231</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">FLAT</th>
              <td class="text-right" rowspan="1" colspan="1">V -&gt; 30030<br>168002<br>168121</td>
              <td class="text-right" rowspan="1" colspan="1">168002 -&gt; 168002<br>168231</td>
              <td class="text-right" rowspan="1" colspan="1">168002 -&gt; 168002<br>168341</td>
            </tr>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">H.NHS</th>
              <td class="text-right" rowspan="1" colspan="1">V -&gt;   30030<br>168002<br>168121</td>
              <td class="text-right" rowspan="1" colspan="1">168002 -&gt; 168002<br>168451<br>168231</td>
              <td class="text-right" rowspan="1" colspan="1">168451 -&gt; 168451<br>168341</td>
            </tr>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">H.NHU</th>
              <td class="text-right" rowspan="1" colspan="1">V -&gt;   30030<br>168002<br>168451<br>168121</td>
              <td class="text-right" rowspan="1" colspan="1">168451 -&gt; 168451<br>168231</td>
              <td class="text-right" rowspan="1" colspan="1">168451 -&gt; 168451<br>168341</td>
            </tr>
          </tbody>
        </table>
<ul class="normal">
<li class="normal" id="section-5.3-4.1">
            <p id="section-5.3-4.1.1">The flat model is the simplest design, with a single BGP
            transport level.  It results in the minimum label/SID stack at
            each BGP hop. However, it significantly increases the scale impact
            on the core BRs (e.g., 341), whose FIB capacity and even MPLS
            label space may be exceeded.<a href="#section-5.3-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-4.1.2.1">
                <p id="section-5.3-4.1.2.1.1">341's data plane scales with (E2, C) where there may be
                300k Es and 5 Cs, hence 1.5M entries &gt; 1M MPLS
                data plane.<a href="#section-5.3-4.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.3-4.2">
            <p id="section-5.3-4.2.1">The hierarchical models avoid the need for core BRs to learn routes and 
          install label forwarding entries for (E, C) routes.<a href="#section-5.3-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-4.2.2.1">
                <p id="section-5.3-4.2.2.1.1">Whether next hop is set to self or left unchanged at 121, 341's data plane 
            scales with (451, C) where there may be thousands of 451s and 5 Cs. Therefore,
            this scaling is well under the 1 million MPLS labels data plane limit.<a href="#section-5.3-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.3-4.2.2.2">
                <p id="section-5.3-4.2.2.2.1">They also aid faster convergence by allowing the PE routes
                to be distributed via out-of-band RRs that can be scaled
                independent of the transport BRs.<a href="#section-5.3-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.3-4.3">
            <p id="section-5.3-4.3.1">The next-hop-self option at ingress BRM (e.g., 121) hides the hierarchical 
          design from the ingress PE, keeping its outgoing label programming as simple as 
          the flat model. However, the ingress BRM requires an additional BGP transport 
          level recursion, which coupled with load-balancing adds data plane complexity.
          It needs to support a swap and push operation. It also needs to install label 
          forwarding entries for the egress PEs that are of interest to its local ingress 
          PEs.<a href="#section-5.3-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-4.4">
            <p id="section-5.3-4.4.1">With the next-hop-unchanged option at ingress BRM (e.g., 121), only an ingress 
          PE needs to learn and install output label entries for egress (E, C) routes. 
          The ingress BRM only installs label forwarding entries for the egress ABR 
          (e.g., 451). However, the ingress PE needs an additional BGP transport level 
          recursion and pushes a BGP VPN label and two BGP transport labels. It may also 
          need to handle load-balancing for the egress ABRs. This is the most complex 
          data plane option for the ingress PE.<a href="#section-5.3-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="SECANYCASTSID">
<section id="section-5.4">
        <h3 id="name-anycast-sid">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-anycast-sid" class="section-name selfRef">Anycast SID</a>
        </h3>
<p id="section-5.4-1">This section describes how Anycast SID complements and improves the 
        scaling designs above.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="ASIDTRANS">
<section id="section-5.4.1">
          <h4 id="name-anycast-sid-for-transit-int">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-anycast-sid-for-transit-int" class="section-name selfRef">Anycast SID for Transit Inter-Domain Nodes</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-5.4.1-1.1">
              <p id="section-5.4.1-1.1.1">Redundant BRs (e.g., two egress BRMs, 451 and 452) advertise BGP CAR 
            routes for a local PE (e.g., E2) with the same SID (based on label index). 
            Such egress BRMs may be assigned a common Anycast SID, so that the BGP 
            next hops for these routes will also resolve via a color-aware path to 
            the Anycast SID.<a href="#section-5.4.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-1.2">
              <p id="section-5.4.1-1.2.1">The use of Anycast SID naturally provides fast local convergence upon 
            failure of an egress BRM node. In addition, it decreases the recursive 
            resolution and load-balancing complexity at an ingress BRM or PE in the 
            hierarchical designs above.<a href="#section-5.4.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<section id="section-5.4.2">
          <h4 id="name-anycast-sid-for-transport-c">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-anycast-sid-for-transport-c" class="section-name selfRef">Anycast SID for Transport Color Endpoints</a>
          </h4>
<p id="section-5.4.2-1">The common Anycast SID technique may also be used for a redundant pair 
          of PEs that share an identical set of service (VPN) attachments.<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.1">
              <p id="section-5.4.2-2.1.1">
            For example, assume a node E2' is paired with E2 above 
            (e.g., <a href="#BGPCARSCALEHEIRNHU" class="auto internal xref">Figure 5</a>). Both 
            PEs should be configured with the same static label/SID for the services 
            (e.g., per-VRF VPN label/SID), and will advertise associated service 
            routes with the Anycast IP as BGP next hop.<a href="#section-5.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.2">
              <p id="section-5.4.2-2.2.1">This design provides a convergence and recursive resolution benefit on 
            an ingress PE or ABR similar to the egress ABR case in 
            <a href="#ASIDTRANS" class="auto internal xref">Section 5.4.1</a>.  However, its applicability is limited 
            to cases where the above constraints can be met.<a href="#section-5.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</section>
</div>
</section>
</div>
<section id="section-6">
      <h2 id="name-routing-convergence">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-routing-convergence" class="section-name selfRef">Routing Convergence</a>
      </h2>
<p id="section-6-1">BGP CAR leverages existing well-known design techniques to provide fast 
      convergence.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2"><a href="#SECPA" class="auto internal xref">Section 2.7</a> describes how BGP CAR provides localized 
      convergence within a domain for BR failures, including originating BRs, without 
      propagating failure churn into other domains.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Anycast SID techniques described in <a href="#SECANYCASTSID" class="auto internal xref">Section 5.4</a> 
      can provide further convergence optimizations for BR and PE failures deployed in 
      redundant designs.<a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
<div id="SECCARSRV6">
<section id="section-7">
      <h2 id="name-car-srv6">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-car-srv6" class="section-name selfRef">CAR SRv6</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-overview">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-7.1-1">Steering services over SRv6-based intent-aware multi-domain
        transport paths may be categorized into two distinct cases that are
        described in <span><a href="https://rfc-editor.org/rfc/rfc9252#section-5" class="relref">Section 5</a> of [<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>. Both cases are supported by BGP CAR, as described
        below.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<div id="SECRTDSSID">
<section id="section-7.1.1">
          <h4 id="name-routed-service-sid">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-routed-service-sid" class="section-name selfRef">Routed Service SID</a>
          </h4>
<p id="section-7.1.1-1">The SRv6 Service SID that is advertised with a service route is
          allocated by an egress PE from a routed intent-aware locator prefix 
          (<span><a href="https://rfc-editor.org/rfc/rfc8986#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8986" class="cite xref">RFC8986</a>]</span>). Service steering at an ingress PE is 
          via resolution of the Service SID signaled with the service route as described in
          <span>[<a href="#RFC9252" class="cite xref">RFC9252</a>]</span>.<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1.1-2">The intent-aware transport path to the SRv6 locator of the egress PE is provided 
          by underlay IP routing. Underlay IP routing can include IGP Flexible Algorithm <span>[<a href="#RFC9350" class="cite xref">RFC9350</a>]</span> 
          within a domain, and BGP CAR (as defined in this document) across multiple IGP domains or BGP ASes.<a href="#section-7.1.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1.1-3"> An SRv6 locator prefix is assigned for a given intent or color. The SRv6 locator 
          may be shared with an IGP Flexible Algorithm, or it may be assigned specific to BGP CAR for 
          a given intent.<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1.1-4">Distribution of SRv6 locators in BGP CAR SAFI:<a href="#section-7.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.1-5.1">
              <p id="section-7.1.1-5.1.1">In a multi-domain network, the SRv6 locator prefix is distributed using BGP CAR SAFI
          to ingress PEs and ASBRs in a remote domain. The SRv6 locator prefix may be advertised 
          in the BGP CAR SAFI from an egress PE, or redistributed into BGP CAR from an IGP Flex-Algo 
          at a BR. The locator prefix may also be summarized on a border node along the path and 
          a summary route distributed to ingress PEs.<a href="#section-7.1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.1-5.2">
              <p id="section-7.1.1-5.2.1"> An IP Prefix CAR route (Type-2) is defined to distribute SRv6 locator prefixes
          and described in Sections <a href="#NLRITYPE2" class="auto internal xref">2.9.4</a> and <a href="#CARIPPREFIX" class="auto internal xref">8</a>.<a href="#section-7.1.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.1-5.3">
              <p id="section-7.1.1-5.3.1">A BGP CAR advertised SRv6 locator prefix may also be used for resolution 
          of the SRv6 Service SID advertised for best-effort connectivity.<a href="#section-7.1.1-5.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.1.1-6">Appendices <a href="#SECLOCHBYH" class="auto internal xref">C.1</a> and <a href="#SECSRv6LOCencap" class="auto internal xref">C.2</a>
          illustrate the control, and forwarding behaviors for routed SRv6 
          Service SIDs.<a href="#section-7.1.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1.1-7"><a href="#SRv6DEPLT" class="auto internal xref">Section 7.2</a> describes the deployment options.<a href="#section-7.1.1-7" class="pilcrow">¶</a></p>
<p id="section-7.1.1-8"><a href="#SRv6CAROPER" class="auto internal xref">Section 7.3</a> describes operational considerations 
          of using BGP CAR SAFI versus BGP IPv6 SAFI for inter-domain route distribution
          of SRv6 locators.<a href="#section-7.1.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SECNRSSID">
<section id="section-7.1.2">
          <h4 id="name-non-routed-service-sid">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-non-routed-service-sid" class="section-name selfRef">Non-Routed Service SID</a>
          </h4>
<p id="section-7.1.2-1">The SRv6 Service SID allocated by an egress PE is not routed. The service
          route carrying the non-routed SRv6 Service SID is advertised by the egress PE
          with a Color-EC C (<span>[<a href="#RFC9252" class="cite xref">RFC9252</a>], <a href="https://rfc-editor.org/rfc/rfc9252#section-5" class="relref">Section 5</a></span>).
          An ingress PE in a remote domain steers traffic for the received service route with
          Color-EC C and this SRv6 Service SID as described below.<a href="#section-7.1.2-1" class="pilcrow">¶</a></p>
<p id="section-7.1.2-2">BGP CAR distribution of (E, C) underlay route:<a href="#section-7.1.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-3.1">
              <p id="section-7.1.2-3.1.1">The intent-aware path to the egress PE within the egress domain is 
          provided by an SR-TE or similar policy (E, C) <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>. 
          This (E, C) policy is distributed into the multi-domain network from egress BRs 
          using a BGP CAR (E, C) route towards ingress PEs in other domains. 
          This signaling is the same as for SR-MPLS as described in earlier sections.<a href="#section-7.1.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.2-3.2">
              <p id="section-7.1.2-3.2.1">The (E, C) BGP CAR Type-1 route is advertised from a BR with an 
          SRv6 transport SID allocated from an SRv6 locator assigned for the intent C.
          An SR-PCE or local configuration may ensure multiple BRs in the egress
          domain that originate the (E, C) route advertise the same SRv6 transport SID.<a href="#section-7.1.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.1.2-4">BGP CAR distribution of SRv6 locator underlay route:<a href="#section-7.1.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-5.1">
              <p id="section-7.1.2-5.1.1">
          BGP CAR <span class="bcp14">MAY</span> also provide the underlay intent-aware inter-domain route to resolve 
          the intent-aware SRv6 transport SID advertised with the (E, C) BGP CAR route as 
          follows:<a href="#section-7.1.2-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-5.1.2.1">
                  <p id="section-7.1.2-5.1.2.1.1">An egress domain BR has an SRv6 locator prefix that covers the SRv6 transport SID 
   allocated by the egress BR for the (E, C) BGP CAR route.<a href="#section-7.1.2-5.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.1.2-5.1.2.2">
                  <p id="section-7.1.2-5.1.2.2.1">The egress domain BR advertises an IP Prefix Type-2 CAR route for the SRv6 
          locator prefix, and the route is distributed across BGP hops in the underlay 
          towards ingress PEs. This distribution is the same as the previous case in
          <a href="#SECRTDSSID" class="auto internal xref">Section 7.1.1</a>. The route may also be summarized in another 
          CAR Type-2 route prefix.<a href="#section-7.1.2-5.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
<p id="section-7.1.2-6">Service traffic steering and SRv6 transport SID resolution at ingress PE:<a href="#section-7.1.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-7.1">
              <p id="section-7.1.2-7.1.1">An ingress PE in a remote domain resolves the received
              service route with color C via the (E, C) BGP CAR route above,
              as described in <a href="#STEERING" class="auto internal xref">Section 3</a>.<a href="#section-7.1.2-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.1.2-7.2">
              <p id="section-7.1.2-7.2.1">Additionally, the ingress PE resolves the SRv6 transport SID
              received in the BGP CAR (E, C) route via the BGP CAR IP Prefix
              route, similar to the SRv6 Routed Service SID resolution in
              <a href="#SECRTDSSID" class="auto internal xref">Section 7.1.1</a>.<a href="#section-7.1.2-7.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-7.2.2.1">
                  <p id="section-7.1.2-7.2.2.1.1">Multiple (E, C) routes may resolve via a single IP Prefix CAR route.<a href="#section-7.1.2-7.2.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2-7.2.2.1.2.1">
                      <p id="section-7.1.2-7.2.2.1.2.1.1">Resolution of (E, C) routes over IP Prefix CAR routes is the typical 
          resolution order as the IP Prefix route provides
          intent-aware reachability to the BRs that advertise the (E, C) specific
          routes for each egress PE. However, there can be use cases where an IP Prefix
          CAR route may resolve via a (E, C) route.<a href="#section-7.1.2-7.2.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.1.2-7.3">
              <p id="section-7.1.2-7.3.1">The ingress PE via the recursive resolution above builds the packet 
          encapsulation that contains the SRv6 Service SID and the received (E, C) 
          route's SRv6 transport SID in the SID list.<a href="#section-7.1.2-7.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.1.2-8"><a href="#SECSRv6EC" class="auto internal xref">Appendix C.3</a> contains an example that illustrates the control
          plane distribution, recursive resolution and forwarding behaviors described 
          above.<a href="#section-7.1.2-8" class="pilcrow">¶</a></p>
<p id="section-7.1.2-9">Note: An SR Policy may also be defined for multi-domain end to end 
          <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>, independent of BGP CAR. In that case, both 
          BGP CAR and SR-TE inter-domain paths may be available at an ingress PE for an (E, C) route 
          (<a href="#SECCARIllus" class="auto internal xref">Section 1.2</a>).<a href="#section-7.1.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="SRv6DEPLT">
<section id="section-7.2">
        <h3 id="name-deployment-options-for-car-">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-deployment-options-for-car-" class="section-name selfRef">Deployment Options for CAR SRv6 Locator Reachability Distribution and Forwarding</a>
        </h3>
<p id="section-7.2-1">Since an SRv6 locator (or summary) is an IPv6 prefix, it will be installed 
        into the IPv6 forwarding table on a BGP router (e.g., ABR or ASBR) for packet 
        forwarding. With the use of IPv6 locator prefixes, there is no need to allocate and 
        install per-PE SIDs on each BGP hop to forward packets.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2"> A few options to forward packets for BGP SRv6 prefixes described in
        <span>[<a href="#I-D.ietf-spring-srv6-mpls-interworking" class="cite xref">SRv6-INTERWORK</a>]</span>
        also apply to BGP CAR. These options are described in 
        Sections <a href="#SRv6HBH" class="auto internal xref">7.2.1</a> and <a href="#SRv6ENC" class="auto internal xref">7.2.2</a>.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<div id="SRv6HBH">
<section id="section-7.2.1">
          <h4 id="name-hop-by-hop-ipv6-forwarding-">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-hop-by-hop-ipv6-forwarding-" class="section-name selfRef">Hop-by-Hop IPv6 Forwarding for BGP SRv6 Prefixes</a>
          </h4>
<p id="section-7.2.1-1">This option employs hop-by-hop IPv6 lookup and forwarding on both BRs and P nodes 
            in a domain along the path of propagation of BGP CAR routes. This option's 
            procedures include the following:<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1-2.1">
              <p id="section-7.2.1-2.1.1">In addition to BRs, P nodes within a domain also learn BGP CAR IP Prefix routes (for SRv6)
            and install them into the forwarding table.<a href="#section-7.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-2.2">
              <p id="section-7.2.1-2.2.1">BGP routing is enabled on all internal nodes (iBGP) using full-mesh or an RR.<a href="#section-7.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-2.3">
              <p id="section-7.2.1-2.3.1">BRs distribute external BGP SRv6 routes to internal peers including P routers, 
            with the following conditions:<a href="#section-7.2.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1-2.3.2.1">
                  <p id="section-7.2.1-2.3.2.1.1">the external BGP next hop is advertised unchanged to the internal peers;<a href="#section-7.2.1-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.2.1-2.3.2.2">
                  <p id="section-7.2.1-2.3.2.2.1">internal nodes use recursive resolution via IGP at each
                  hop to forward IPv6 packets towards the external BGP
                  next hop; and<a href="#section-7.2.1-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.2.1-2.3.2.3">
                  <p id="section-7.2.1-2.3.2.3.1">resolution is per intent/color (e.g., via IGP IPv6 Flex-Algo).<a href="#section-7.2.1-2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
<p id="section-7.2.1-3">This design is illustrated with an example in <a href="#SECLOCHBYH" class="auto internal xref">Appendix C.1</a>.<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<p id="section-7.2.1-4">The benefits of this scheme are:<a href="#section-7.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1-5.1">
              <p id="section-7.2.1-5.1.1">A simpler design, as no tunnel encapsulation is required between BRs in a domain.<a href="#section-7.2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-5.2">
              <p id="section-7.2.1-5.2.1">No per-PE SID allocation and installation on any BGP hop.<a href="#section-7.2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-5.3">
              <p id="section-7.2.1-5.3.1">This design is similar to the well-known Internet / BGP
              hop-by-hop IP routing model and can support large-scale route
              distribution.<a href="#section-7.2.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.1-5.4">
              <p id="section-7.2.1-5.4.1">In addition, since SRv6 locator prefixes can be summarized,
              this minimizes the number of routes, and hence the scale
              requirements on P routers.<a href="#section-7.2.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="SRv6ENC">
<section id="section-7.2.2">
          <h4 id="name-encapsulation-between-brs-f">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-encapsulation-between-brs-f" class="section-name selfRef">Encapsulation Between BRs for BGP SRv6 Prefixes</a>
          </h4>
<p id="section-7.2.2-1">In this design, IPv6 lookup and forwarding for BGP SRv6 prefixes are only done on 
            BGP BRs. This option includes the following procedures:<a href="#section-7.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-2.1">
              <p id="section-7.2.2-2.1.1">These nodes use SRv6 (or other) encapsulations to reach the BGP SRv6 next hop.<a href="#section-7.2.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-2.1.2.1">
                  <p id="section-7.2.2-2.1.2.1.1">SRv6 outer encapsulation may be H.Encaps.Red.<a href="#section-7.2.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.2.2-2.1.2.2">
                  <p id="section-7.2.2-2.1.2.2.1">Encapsulation is not needed for directly connected next hops, such as with eBGP single-hop sessions.<a href="#section-7.2.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.2.2-2.2">
              <p id="section-7.2.2-2.2.1">BGP route distribution is enabled between BRs via RRs, or directly if single-hop BGP.<a href="#section-7.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-2.3">
              <p id="section-7.2.2-2.3.1">An egress BR sets itself as BGP next hop, and selects and advertises an appropriate 
            encapsulation towards itself.<a href="#section-7.2.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-2.3.2.1">
                  <p id="section-7.2.2-2.3.2.1.1">If SRv6 encapsulation, then the SRv6 SID advertised from egress BR is from an SRv6 
            locator for the specific intent within the domain.
            Multiple BGP SRv6 prefixes may share a common SID, avoiding 
            per-PE SID allocation and installation on any BGP hop.<a href="#section-7.2.2-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.2.2-2.3.2.2">
                  <p id="section-7.2.2-2.3.2.2.1">If MPLS/SR-MPLS transport, the route will carry the label/Prefix-SID allocated 
            by the next hop. The label/SID may be shared among multiple routes.<a href="#section-7.2.2-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.2.2-2.4">
              <p id="section-7.2.2-2.4.1">An ingress BR encapsulates SRv6 egress PE destined packets with 
            encapsulation to BGP next hop (i.e., the egress BR).<a href="#section-7.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.2-3">The benefits of this scheme are:<a href="#section-7.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-4.1">
              <p id="section-7.2.2-4.1.1">P nodes do not need to learn or install BGP SRv6 prefixes in this (BGP-free core) design.<a href="#section-7.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-4.2">
              <p id="section-7.2.2-4.2.1">No per-PE SID allocation and installation on any BGP hop.<a href="#section-7.2.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.2-5">This design is illustrated in <a href="#SECSRv6LOCencap" class="auto internal xref">Appendix C.2</a>.<a href="#section-7.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="SRv6CAROPER">
<section id="section-7.3">
        <h3 id="name-operational-benefits-of-usi">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-operational-benefits-of-usi" class="section-name selfRef">Operational Benefits of Using CAR SAFI for SRv6 Locator Prefix Distribution</a>
        </h3>
<p id="section-7.3-1">When reachability to an SRv6 SID is provided by distribution of a locator prefix 
      via underlay routing, BGP IPv6 SAFI (AFI/SAFI=2/1) may also be used for 
      inter-domain distribution of these IPv6 prefixes as described in
      <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-spring-srv6-mpls-interworking-01#section-7.1.2" class="relref">Section 7.1.2</a> of [<a href="#I-D.ietf-spring-srv6-mpls-interworking" class="cite xref">SRv6-INTERWORK</a>]</span> or
      <span>[<a href="#RFC9723" class="cite xref">RFC9723</a>]</span>.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">Using the BGP CAR SAFI provides the following operational benefits:<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-3.1">
            <p id="section-7.3-3.1.1">CAR SAFI is a separate BGP SAFI used for underlay transport intent-aware routing. 
        It avoids overloading of BGP IPv6 SAFI, which also carries Internet (service) 
        prefixes. Using CAR SAFI provides:<a href="#section-7.3-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-3.1.2.1">
                <p id="section-7.3-3.1.2.1.1">Automatic separation of SRv6 locator (transport) routes from Internet 
          (service) routes,<a href="#section-7.3-3.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-3.1.2.1.2.1">
                    <p id="section-7.3-3.1.2.1.2.1.1">preventing inadvertent leaking of routes, and<a href="#section-7.3-3.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-7.3-3.1.2.1.2.2">
                    <p id="section-7.3-3.1.2.1.2.2.1">avoiding the need to configure specific route filters for locator routes.<a href="#section-7.3-3.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-7.3-3.1.2.2">
                <p id="section-7.3-3.1.2.2.1">Priority handling of infrastructure routes over service (Internet) routes.<a href="#section-7.3-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-7.3-3.2">
            <p id="section-7.3-3.2.1">CAR SAFI also supports inter-domain distribution of (E, C) routes 
        sourced from SR Policy, in addition to SRv6 locator IPv6 prefixes.<a href="#section-7.3-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-3.3">
            <p id="section-7.3-3.3.1">CAR SAFI may also be used for best-effort routes in addition to
            intent-aware routes as described in the next section.<a href="#section-7.3-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.3-4">Note: If infrastructure routes such as SRv6 locator routes are
        carried in both BGP-IP <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span> / BGP-LU <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span> <span>[<a href="#RFC4798" class="cite xref">RFC4798</a>]</span>, and BGP CAR, <a href="#CARIPPREFIX" class="auto internal xref">Section 8</a> describes the path selection preference between
        them.<a href="#section-7.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="CARIPPREFIX">
<section id="section-8">
      <h2 id="name-car-ip-prefix-route">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-car-ip-prefix-route" class="section-name selfRef">CAR IP Prefix Route</a>
      </h2>
<p id="section-8-1">An IP Prefix CAR route is a route type (Type-2) that carries a
      routable IP prefix whose processing follows the semantics of <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span> and
      <span>[<a href="#RFC2545" class="cite xref">RFC2545</a>]</span>. IP Prefix CAR routes are installed
      in the default routing and forwarding table and provide
      longest-prefix-match forwarding. This is unlike Type-1 (E, C) routes,
      where it is the signaled forwarding data such as labels/SIDs that are
      installed in the forwarding table to create end-to-end paths.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">IP Prefix CAR routes may be originated into BGP CAR SAFI either from
      an egress PE or from a BR in a domain. Type-2 routes carry
      infrastructure routes for both IPv4 and IPv6.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">As described in <a href="#SECDATAMODEL" class="auto internal xref">Section 2.1</a>, it is used for cases
      where a unique routable IP prefix is assigned for a given intent or
      color. It may also be used for routes providing best-effort
      connectivity.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">A few applicable example use cases:<a href="#section-8-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-5.1">
          <p id="section-8-5.1.1">SRv6 locator prefix with color for specific intents.<a href="#section-8-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-5.2">
          <p id="section-8-5.2.1">SRv6 locator prefix without color for best-effort.<a href="#section-8-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-5.3">
          <p id="section-8-5.3.1">Best-effort transport reachability to a PE/BR without color.<a href="#section-8-5.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-6">
 For specific intents, color may be signaled with the IP Prefix CAR
 route for purposes such as intent-aware SRv6 SID or BGP next hop
 selection at each transit BR, color-based routing policies and
 filtering, and intent-aware next-hop resolution (<a href="#ROUTERES" class="auto internal xref">Section 2.5</a>). These purposes are the same as with (E, C)
 routes. For such purposes, color associated with the CAR IP Prefix
 route is signaled using LCM-EC.<a href="#section-8-6" class="pilcrow">¶</a></p>
<p id="section-8-7">
 Reminder: LCM-EC conveys end-to-end intent/color associated with
 route/NLRI. When traversing network domain(s) where a different
 intent/color is used for next-hop resolution, BGP Color-EC may
 additionally be used as in <a href="#LCMBGPECUSAGE" class="auto internal xref">Section 2.10</a>.<a href="#section-8-7" class="pilcrow">¶</a></p>
<p id="section-8-8">
 A special case of intent is best-effort, which may be represented by a
 color and follow the above procedures. However, to be compatible with
 existing operational usage, the CAR IP Prefix route is allowed to be
 without color for best-effort. In this case, the routes will not carry
 an LCM-EC. Resolution is described in <a href="#ROUTERES" class="auto internal xref">Section 2.5</a>.<a href="#section-8-8" class="pilcrow">¶</a></p>
<p id="section-8-9">
 As described in <a href="#SRv6CAROPER" class="auto internal xref">Section 7.3</a>, infrastructure prefixes
 are intended to be carried in CAR SAFI instead of SAFIs that also
 carry service routes such as BGP-IP (SAFI 1, <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span>)
 and BGP-LU (SAFI 4, <span>[<a href="#RFC4798" class="cite xref">RFC4798</a>]</span>). However, if such
 infrastructure routes are also distributed in these SAFIs, a router
 may receive both BGP CAR SAFI paths and IP/LU SAFI paths. By default, the
 CAR SAFI transport path is preferred over the BGP-IP or BGP-LU SAFI path.<a href="#section-8-9" class="pilcrow">¶</a></p>
<p id="section-8-10">A BGP transport CAR speaker that supports packet forwarding lookup based on the
      IPv6 prefix route (such as a BR) will set itself as next hop while advertising the 
      route to peers. It will also install the IPv6 route into forwarding with the 
      received next hop and/or encapsulation. If such a transit router does not support 
      this route type, it will not install this route and will not set itself as next hop;
      hence, it will not propagate the route any further.<a href="#section-8-10" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-vpn-car">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-vpn-car" class="section-name selfRef">VPN CAR</a>
      </h2>
<p id="section-9-1">This section illustrates the extension of BGP CAR to address the VPN
      intent-aware routing requirement stated in <span><a href="https://datatracker.ietf.org/doc/html/draft-hr-spring-intentaware-routing-using-color-04#section-6.1.2" class="relref">Section 6.1.2</a> of [<a href="#I-D.hr-spring-intentaware-routing-using-color" class="cite xref">INTENT-AWARE</a>]</span>. The examples use MPLS, but other
      transport types can also be used (e.g., SRv6).<a href="#section-9-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9-2">
<pre>
CE1 -------------- PE1 -------------------- PE2 -------------- CE2 - V
</pre><a href="#section-9-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-9-3.1">
          <p id="section-9-3.1.1">BGP CAR SAFI is enabled on CE1-PE1 and PE2-CE2 sessions.<a href="#section-9-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.2">
          <p id="section-9-3.2.1">BGP VPN CAR SAFI is enabled between PE1 and PE2.<a href="#section-9-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.3">
          <p id="section-9-3.3.1">Provider publishes to customer that intent "low delay" is mapped to color CP ("Provider Color") on its 
        inbound peering links.<a href="#section-9-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.4">
          <p id="section-9-3.4.1">Within its infrastructure, provider maps intent "low delay" to color CPT ("Provider Transport Color").<a href="#section-9-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.5">
          <p id="section-9-3.5.1">On CE1 and CE2, intent "low delay" is mapped to CC ("Customer Color").<a href="#section-9-3.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-9-4">(V, CC) is a color-aware route originated by CE2.<a href="#section-9-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9-5">
  <li id="section-9-5.1">
          <p id="section-9-5.1.1">CE2 sends to PE2:<a href="#section-9-5.1.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.1.2">[(V, CC), label L1] via CE2 with LCM-EC (CP) as per peering agreement.<a href="#section-9-5.1.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.2">
          <p id="section-9-5.2.1">PE2 installs in VRF A:<a href="#section-9-5.2.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.2.2">[(V, CC), L1] via CE2, which resolves on (CE2, CP) or connected Outgoing Interface (OIF).<a href="#section-9-5.2.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.3">PE2 allocates VPN label L2 and programs swap entry for (V, CC).<a href="#section-9-5.3" class="pilcrow">¶</a>
</li>
        <li id="section-9-5.4">
          <p id="section-9-5.4.1">PE2 sends to PE1:<a href="#section-9-5.4.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.4.2">[(RD, V, CC), L2] via PE2, LCM-EC (CP) with regular Color-EC (CPT).<a href="#section-9-5.4.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.5">
          <p id="section-9-5.5.1">PE1 installs in VRF A:<a href="#section-9-5.5.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.5.2">[(V, CC), L2] via (PE2, CPT) steered on (PE2, CPT).<a href="#section-9-5.5.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.6">PE1 allocates label L3 and programs swap entry for (V, CC).<a href="#section-9-5.6" class="pilcrow">¶</a>
</li>
        <li id="section-9-5.7">
          <p id="section-9-5.7.1">PE1 sends to CE1:<a href="#section-9-5.7.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.7.2">[(V, CC), L3] via PE1 after removing LCM-EC through route policy.<a href="#section-9-5.7.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.8">
          <p id="section-9-5.8.1">CE1 installs:<a href="#section-9-5.8.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="section-9-5.8.2">[(V, CC), L3] via PE1, which resolves on (PE1, CC) or connected OIF.<a href="#section-9-5.8.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-9-5.9">Label L3 is installed as the imposition label for (V, CC).<a href="#section-9-5.9" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-9-6">VPN CAR distribution for (RD, V, CC) requires a new SAFI that follows the
      same VPN semantics as defined in <span>[<a href="#RFC4364" class="cite xref">RFC4364</a>]</span> and also supports the 
      distribution of routes with the CAR NLRI and associated non-key TLVs defined in 
      <a href="#ColorFamily" class="auto internal xref">Section 2.9</a> of this document.<a href="#section-9-6" class="pilcrow">¶</a></p>
<p id="section-9-7">Procedures defined in <span>[<a href="#RFC4364" class="cite xref">RFC4364</a>]</span> and <span>[<a href="#RFC4659" class="cite xref">RFC4659</a>]</span> apply to 
      VPN CAR SAFI.
      Further, all CAR SAFI procedures described in <a href="#CARSAFI" class="auto internal xref">Section 2</a> above apply to 
      CAR SAFI enabled within a VRF. Since CE and PE are typically in different administrative 
      domains, LCM-EC is attached to CAR routes.<a href="#section-9-7" class="pilcrow">¶</a></p>
<p id="section-9-8">VPN CAR SAFI routes follow color-based steering techniques as described in 
      <a href="#STEERING" class="auto internal xref">Section 3</a> and illustrated in the example above.<a href="#section-9-8" class="pilcrow">¶</a></p>
<p id="section-9-9">VPN CAR SAFI routes may also be advertised with a specific BGP next hop per color, 
      with a TEA or Tunnel Encapsulation EC, and follow the procedures of <span><a href="https://rfc-editor.org/rfc/rfc9012#section-6" class="relref">Section 6</a> of [<a href="#RFC9012" class="cite xref">RFC9012</a>]</span>.<a href="#section-9-9" class="pilcrow">¶</a></p>
<p id="section-9-10">CAR routes distributed in VPN CAR SAFI are infrastructure routes advertised by 
      CEs in different customer VRFs on a PE. Example use cases are intent-aware 
      L3VPN Carriers' Carriers (<span><a href="https://rfc-editor.org/rfc/rfc4364#section-9" class="relref">Section 9</a> of [<a href="#RFC4364" class="cite xref">RFC4364</a>]</span>) and SRv6 over a provider 
      network.  The VPN RD distinguishes CAR routes of different customers being 
      advertised by the PE.<a href="#section-9-10" class="pilcrow">¶</a></p>
<div id="VPNColorFamily">
<section id="section-9.1">
        <h3 id="name-format-and-encoding-2">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-format-and-encoding-2" class="section-name selfRef">Format and Encoding</a>
        </h3>
<p id="section-9.1-1">BGP VPN CAR SAFI leverages BGP multiprotocol extensions <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span> and uses the MP_REACH_NLRI and MP_UNREACH_NLRI
        attributes for route updates within SAFI value 84 along with AFI 1 for
        IPv4 VPN CAR prefixes and AFI 2 for IPv6 VPN CAR prefixes.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">BGP speakers <span class="bcp14">MUST</span> use the BGP Capabilities Advertisement
        to ensure support for processing of BGP VPN CAR updates.  This is done
        as specified in <span>[<a href="#RFC4760" class="cite xref">RFC4760</a>]</span>, by using capability code 1
        (multiprotocol BGP), with AFI 1 and 2 (as required) and SAFI 84.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">The Next Hop network address field in the MP_REACH_NLRI may contain
        either a VPN-IPv4 or a VPN-IPv6 address with 8-octet RD set to zero,
        independent of AFI. If the next hop length is 12, then the next hop is
        a VPN-IPv4 address with an RD of 0 constructed as per <span>[<a href="#RFC4364" class="cite xref">RFC4364</a>]</span>. If the next hop length is 24 or 48, then the next
        hop is a VPN-IPv6 address constructed as per <span><a href="https://rfc-editor.org/rfc/rfc4659#section-3.2.1.1" class="relref">Section 3.2.1.1</a> of [<a href="#RFC4659" class="cite xref">RFC4659</a>]</span>.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<div id="VPNCARNLRITYPE1">
<section id="section-9.1.1">
          <h4 id="name-vpn-car-e-c-nlri-type">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-vpn-car-e-c-nlri-type" class="section-name selfRef">VPN CAR (E, C) NLRI Type</a>
          </h4>
<p id="section-9.1.1-1">VPN CAR Type-1 (E, C) NLRI with RD has the format shown below:<a href="#section-9.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.1.1-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NLRI Length  |  Key Length   |   NLRI Type   |Prefix Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Route Distinguisher                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Route Distinguisher                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               IP Prefix (variable)                           //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Color (4 octets)                                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-9.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-9.1.1-3">It is followed by optional Non-Key TLVs encoded as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>.<a href="#section-9.1.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1.1-4">where:<a href="#section-9.1.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1.1-5">all fields are encoded as per <a href="#NLRITYPE1" class="auto internal xref">Section 2.9.3</a> with the following changes:<a href="#section-9.1.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.1.1-6">
            <dt id="section-9.1.1-6.1">Key Length:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-6.2">This length indicates the total length comprised of the 
            RD, Prefix Length field, IP Prefix field, and the Color field.<a href="#section-9.1.1-6.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-6.3">Route Distinguisher:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-6.4">An 8-octet field encoded
            according to <span>[<a href="#RFC4364" class="cite xref">RFC4364</a>]</span>.<a href="#section-9.1.1-6.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.1-6.5">Type-Specific Non-Key TLVs:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.1-6.6">The Label TLV, Label-Index TLV,
            and SRv6 SID TLV (<a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>) may be associated
            with the VPN CAR (E, C) NLRI Type.<a href="#section-9.1.1-6.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="VPNCARNLRITYPE2">
<section id="section-9.1.2">
          <h4 id="name-vpn-car-ip-prefix-nlri-type">
<a href="#section-9.1.2" class="section-number selfRef">9.1.2. </a><a href="#name-vpn-car-ip-prefix-nlri-type" class="section-name selfRef">VPN CAR IP Prefix NLRI Type</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-9.1.2-1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NLRI Length  |  Key Length   |   NLRI Type   |Prefix Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Route Distinguisher                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Route Distinguisher                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               IP Prefix (variable)                           //
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-9.1.2-1" class="pilcrow">¶</a>
</div>
<p id="section-9.1.2-2">It is followed by optional Non-Key TLVs encoded as per <a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>.<a href="#section-9.1.2-2" class="pilcrow">¶</a></p>
<p id="section-9.1.2-3">where:<a href="#section-9.1.2-3" class="pilcrow">¶</a></p>
<p id="section-9.1.2-4">all fields are encoded as per <a href="#NLRITYPE2" class="auto internal xref">Section 2.9.4</a> with the following changes:<a href="#section-9.1.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.1.2-5">
            <dt id="section-9.1.2-5.1">Key Length:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-5.2">This length indicates the total length comprised of the 
            RD, Prefix Length field, and IP Prefix field.<a href="#section-9.1.2-5.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-5.3">Route Distinguisher:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-5.4">An 8-octet field encoded according
            to <span>[<a href="#RFC4364" class="cite xref">RFC4364</a>]</span>.<a href="#section-9.1.2-5.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-9.1.2-5.5">Type-Specific Non-Key TLVs:</dt>
            <dd style="margin-left: 1.5em" id="section-9.1.2-5.6">The Label TLV, Label-Index TLV,
            and SRv6 SID TLV (<a href="#NLRITLVs" class="auto internal xref">Section 2.9.2</a>) may be associated
            with the VPN CAR IP Prefix NLRI Type.<a href="#section-9.1.2-5.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-9.1.2-6">The error handling specified in <a href="#Fault" class="auto internal xref">Section 2.11</a> also applies to VPN CAR SAFI.<a href="#section-9.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
<div id="IANA">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-bgp-car-safis">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-bgp-car-safis" class="section-name selfRef">BGP CAR SAFIs</a>
        </h3>
<p id="section-10.1-1">IANA has assigned SAFI value 83 (BGP CAR) and SAFI value
      84 (BGP VPN CAR) from the "SAFI Values" registry in the "Subsequent 
      Address Family Identifiers (SAFI) Parameters" registry group with this document as a
      reference.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
</section>
<div id="NLRITYPESREG">
<section id="section-10.2">
        <h3 id="name-bgp-car-nlri-types-registry">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-bgp-car-nlri-types-registry" class="section-name selfRef">"BGP CAR NLRI Types" Registry</a>
        </h3>
<p id="section-10.2-1">IANA has created a "BGP CAR NLRI Types"
        registry in the "Border Gateway Protocol (BGP) Parameters"
        registry group with this document as a reference. The registry is for
        assignment of the 1-octet code points for BGP CAR NLRI types 
        and is populated with the values shown below:<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<table class="center" id="table-3">
          <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">NLRI Type</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Color-Aware Route</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">IP Prefix</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3-255</td>
              <td class="text-left" rowspan="1" colspan="2">Unassigned</td>
            </tr>
          </tbody>
        </table>
<p id="section-10.2-3">Allocations within the registry are to be made with the
        "Specification Required" policy as specified in <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> and in <a href="#DE-Guidance" class="auto internal xref">Section 10.4</a>.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="TLVTYPESREG">
<section id="section-10.3">
        <h3 id="name-bgp-car-nlri-tlv-registry">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-bgp-car-nlri-tlv-registry" class="section-name selfRef">"BGP CAR NLRI TLV" Registry</a>
        </h3>
<p id="section-10.3-1">IANA has created a "BGP CAR NLRI TLV Types"
        registry in the "Border Gateway Protocol (BGP) Parameters"
        registry group with this document as a reference. The registry is for
        assignment of the 6-bit code points for BGP CAR NLRI non-key
        TLV types and is populated with the values shown below:<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-4">
          <caption><a href="#table-4" class="selfRef">Table 4</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">NLRI TLV Type</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Label</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">Label-Index</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">SRv6 SID</td>
              <td class="text-left" rowspan="1" colspan="1">RFC 9871</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4-64</td>
              <td class="text-left" rowspan="1" colspan="2">Unassigned</td>
            </tr>
          </tbody>
        </table>
<p id="section-10.3-3">Allocations within the registry are to be made with the
        "Specification Required" policy as specified in <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> and in <a href="#DE-Guidance" class="auto internal xref">Section 10.4</a>.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<p id="section-10.3-4">For a new TLV to be used with existing NLRI types, documentation of the NLRI types 
        must be updated.<a href="#section-10.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="DE-Guidance">
<section id="section-10.4">
        <h3 id="name-guidance-for-designated-exp">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-guidance-for-designated-exp" class="section-name selfRef">Guidance for Designated Experts</a>
        </h3>
<p id="section-10.4-1">In all cases of review by the Designated Expert (DE) described
        here, the DE is expected to ascertain the existence of suitable
        documentation (a specification) as described in <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> for the "BGP CAR NLRI Types" registry and the "BGP CAR NLRI
        TLV" registry.<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<p id="section-10.4-2">The DE is also expected to check the clarity of purpose and use of
        the requested code points. Additionally, the DE must verify that any
        request for one of these code points has been made available for
        review and comment within the IETF: the DE will post the request to
        the IDR Working Group mailing list (or a successor mailing list
        designated by the IESG). The DE must ensure that any request for a
        code point does not conflict with work that is active or already
        published within the IETF.<a href="#section-10.4-2" class="pilcrow">¶</a></p>
<p id="section-10.4-3">The DE is expected to confirm that the specification satisfies the
        requirements for the "Specification Required" policy (<span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.6" class="relref">Section 4.6</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>). In particular,
        as a reminder, the specification is required to be "permanent and
        readily available". The DE may assume that any document in the
        Internet-Draft or RFC repository satisfies the requirement for
        permanence and availability. In other cases, and in particular for any
        document not hosted by another standards development organization, the
        burden of proof of permanence falls on the applicant.<a href="#section-10.4-3" class="pilcrow">¶</a></p>
<section id="section-10.4.1">
          <h4 id="name-additional-evaluation-crite">
<a href="#section-10.4.1" class="section-number selfRef">10.4.1. </a><a href="#name-additional-evaluation-crite" class="section-name selfRef">Additional Evaluation Criteria for the "BGP CAR NLRI Types" Registry</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-10.4.1-1.1">
              <p id="section-10.4.1-1.1.1">Check the interoperability between the new NLRI type and
              current NLRI types specified in this document for BGP CAR SAFIs
              (BGP CAR SAFI and VPN CAR SAFI), and any updates to this
              document.<a href="#section-10.4.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-10.4.1-1.2">
              <p id="section-10.4.1-1.2.1">Check if the specification indicates which non-key TLVs are
              applicable for the new NLRI type.<a href="#section-10.4.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
<section id="section-10.4.2">
          <h4 id="name-additional-evaluation-criter">
<a href="#section-10.4.2" class="section-number selfRef">10.4.2. </a><a href="#name-additional-evaluation-criter" class="section-name selfRef">Additional Evaluation Criteria for the "BGP CAR NLRI TLV" Registry</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-10.4.2-1.1">
              <p id="section-10.4.2-1.1.1">Check the applicability of the new TLV for the BGP CAR NLRI types defined.<a href="#section-10.4.2-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-10.4.2-1.2">
              <p id="section-10.4.2-1.2.1">Check the T bit setting for the new TLV.<a href="#section-10.4.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</section>
</div>
<div id="PROTOIDREG">
<section id="section-10.5">
        <h3 id="name-border-gateway-protocol-bgp">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-border-gateway-protocol-bgp" class="section-name selfRef">"Border Gateway Protocol (BGP) Extended Communities" Registry</a>
        </h3>
<p id="section-10.5-1">IANA has assigned the sub-type 0x1b for "Local Color Mapping (LCM)" 
        in the "Transitive Opaque Extended Community Sub-Types" registry in the 
        "Border Gateway Protocol (BGP) Extended Communities" registry group.<a href="#section-10.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="MANAGEOPER">
<section id="section-11">
      <h2 id="name-manageability-and-operation">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-manageability-and-operation" class="section-name selfRef">Manageability and Operational Considerations</a>
      </h2>
<p id="section-11-1">Color assignments in a multi-domain network operating under a common
      or cooperating administrative control (i.e., a color domain) should be
      managed similar to transport layer IP addresses, and ensure a unique and
      non-conflicting color allocation across the different network domains in
      that color domain. This is a logical best practice in a single color or
      administrative domain, which is the most typical deployment
      scenario.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">When color-aware routes propagate across a color domain boundary,
      there is typically no need for color assignments to be identical in both
      color domains, since the IP prefix is unique in the inter-domain
      transport network. This unique IP prefix provides a unique and
      non-conflicting scope for the color in an (E, C) route. Coordination
      between the operators of the color domains is needed only to enable the
      color to be re-mapped into a local color (carried in the LCM-EC)
      assigned for the same intent in the receiving color domain.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">However, if networks under different administrative control establish
      a shared transport service between them, where the same transport
      service IP address is coordinated and shared among two (or more) color
      domain networks, then the color assignments associated with that shared
      IP address should also be coordinated to avoid any conflicts in either
      network (<a href="#SHAREDIP" class="auto internal xref">Appendix A.7</a>).<a href="#section-11-3" class="pilcrow">¶</a></p>
<p id="section-11-4">It should be noted that the color assignments coordination is only
      necessary for routes specific to the shared service IP. Colors used for
      intra-domain or for inter-domain intents associated with unique IP
      addresses do not need any coordination.<a href="#section-11-4" class="pilcrow">¶</a></p>
<p id="section-11-5">Extended communities (LCM-EC/Color-EC) carried in BGP CAR and service
      routes <span class="bcp14">MUST NOT</span> be filtered, otherwise the desired intent
      will not be achieved.<a href="#section-11-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SecurityConsiderations">
<section id="section-12">
      <h2 id="name-security-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-12-1">This document does not change the underlying security considerations
      and issues inherent in the existing BGP protocol, such as those
      described in <span>[<a href="#RFC4271" class="cite xref">RFC4271</a>]</span> and <span>[<a href="#RFC4272" class="cite xref">RFC4272</a>]</span>.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">This document defines a new BGP SAFI and related extensions to carry
      color-aware routes and their associated attributes. The separate SAFI is
      expected to be explicitly configured by an operator. It is also expected
      that the necessary BGP route policy filtering is configured on this new
      SAFI to filter routing information distributed by the routers
      participating in this network, at appropriate points within and at the
      boundaries of this network.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">Also, given that this SAFI and these mechanisms can only be enabled
      through configuration of routers within an operator's network, standard
      security measures should be taken to restrict access to the management
      interface(s) of routers that implement these mechanisms.<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4">Additionally, BGP sessions <span class="bcp14">SHOULD</span> be protected using the
      TCP Authentication Option <span>[<a href="#RFC5925" class="cite xref">RFC5925</a>]</span> and the Generalized
      TTL Security Mechanism <span>[<a href="#RFC5082" class="cite xref">RFC5082</a>]</span>. BGP origin validation
      <span>[<a href="#RFC6811" class="cite xref">RFC6811</a>]</span> and BGPsec <span>[<a href="#RFC8205" class="cite xref">RFC8205</a>]</span> could also
      be used with this SAFI.<a href="#section-12-4" class="pilcrow">¶</a></p>
<p id="section-12-5">Since CAR SAFI is a separate BGP SAFI that carries transport or
      infrastructure routes for routers in the operator network, it provides
      automatic separation of infrastructure routes and the service routes
      that are carried in existing BGP SAFIs such as BGP IPv4/IPv6 (SAFI=1),
      and BGP-LU (SAFI=4) (e.g., 6PE <span>[<a href="#RFC4798" class="cite xref">RFC4798</a>]</span>).  Using CAR
      SAFI thus provides better security (such as protection against route
      leaking) than would be obtained by distributing the infrastructure
      routes in existing SAFIs that also carry service routes.<a href="#section-12-5" class="pilcrow">¶</a></p>
<p id="section-12-6">BGP CAR distributes label binding similar to <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>;
      hence, its security considerations apply.<a href="#section-12-6" class="pilcrow">¶</a></p>
<p id="section-12-7">In SR deployments, BGP CAR distributes infrastructure prefixes along
      with their SID information for both SR-MPLS and SRv6. These deployments
      are within an SR domain <span>[<a href="#RFC8402" class="cite xref">RFC8402</a>]</span> and the security
      considerations of <span>[<a href="#RFC8402" class="cite xref">RFC8402</a>]</span> apply. Additionally, security
      considerations related to SRv6 deployments that are discussed in <span><a href="https://rfc-editor.org/rfc/rfc9252#section-9.3" class="relref">Section 9.3</a> of [<a href="#RFC9252" class="cite xref">RFC9252</a>]</span> also apply.<a href="#section-12-7" class="pilcrow">¶</a></p>
<p id="section-12-8">As <span>[<a href="#RFC4272" class="cite xref">RFC4272</a>]</span> discusses, BGP is vulnerable to
      traffic-diversion attacks. This SAFI route adds a new means by which an
      attacker could cause the traffic to be diverted from its normal
      path. Potential consequences include "hijacking" of traffic (insertion
      of an undesired node in the path, which allows for inspection or
      modification of traffic, or avoidance of security controls) or denial of
      service (directing traffic to a node that doesn't desire to receive it).<a href="#section-12-8" class="pilcrow">¶</a></p>
<p id="section-12-9">The restriction of the applicability of this SAFI to its intended well-defined scope 
    and the use of techniques described above limit the likelihood of traffic diversions.<a href="#section-12-9" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2545">[RFC2545]</dt>
        <dd>
<span class="refAuthor">Marques, P.</span> and <span class="refAuthor">F. Dupont</span>, <span class="refTitle">"Use of BGP-4 Multiprotocol Extensions for IPv6 Inter-Domain Routing"</span>, <span class="seriesInfo">RFC 2545</span>, <span class="seriesInfo">DOI 10.17487/RFC2545</span>, <time datetime="1999-03" class="refDate">March 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2545">https://www.rfc-editor.org/info/rfc2545</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4360">[RFC4360]</dt>
        <dd>
<span class="refAuthor">Sangli, S.</span>, <span class="refAuthor">Tappan, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Extended Communities Attribute"</span>, <span class="seriesInfo">RFC 4360</span>, <span class="seriesInfo">DOI 10.17487/RFC4360</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4360">https://www.rfc-editor.org/info/rfc4360</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4684">[RFC4684]</dt>
        <dd>
<span class="refAuthor">Marques, P.</span>, <span class="refAuthor">Bonica, R.</span>, <span class="refAuthor">Fang, L.</span>, <span class="refAuthor">Martini, L.</span>, <span class="refAuthor">Raszuk, R.</span>, <span class="refAuthor">Patel, K.</span>, and <span class="refAuthor">J. Guichard</span>, <span class="refTitle">"Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4684</span>, <span class="seriesInfo">DOI 10.17487/RFC4684</span>, <time datetime="2006-11" class="refDate">November 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4684">https://www.rfc-editor.org/info/rfc4684</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4760">[RFC4760]</dt>
        <dd>
<span class="refAuthor">Bates, T.</span>, <span class="refAuthor">Chandra, R.</span>, <span class="refAuthor">Katz, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"Multiprotocol Extensions for BGP-4"</span>, <span class="seriesInfo">RFC 4760</span>, <span class="seriesInfo">DOI 10.17487/RFC4760</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4760">https://www.rfc-editor.org/info/rfc4760</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7311">[RFC7311]</dt>
        <dd>
<span class="refAuthor">Mohapatra, P.</span>, <span class="refAuthor">Fernando, R.</span>, <span class="refAuthor">Rosen, E.</span>, and <span class="refAuthor">J. Uttaro</span>, <span class="refTitle">"The Accumulated IGP Metric Attribute for BGP"</span>, <span class="seriesInfo">RFC 7311</span>, <span class="seriesInfo">DOI 10.17487/RFC7311</span>, <time datetime="2014-08" class="refDate">August 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7311">https://www.rfc-editor.org/info/rfc7311</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7606">[RFC7606]</dt>
        <dd>
<span class="refAuthor">Chen, E., Ed.</span>, <span class="refAuthor">Scudder, J., Ed.</span>, <span class="refAuthor">Mohapatra, P.</span>, and <span class="refAuthor">K. Patel</span>, <span class="refTitle">"Revised Error Handling for BGP UPDATE Messages"</span>, <span class="seriesInfo">RFC 7606</span>, <span class="seriesInfo">DOI 10.17487/RFC7606</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7606">https://www.rfc-editor.org/info/rfc7606</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8277">[RFC8277]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span>, <span class="refTitle">"Using BGP to Bind MPLS Labels to Address Prefixes"</span>, <span class="seriesInfo">RFC 8277</span>, <span class="seriesInfo">DOI 10.17487/RFC8277</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8277">https://www.rfc-editor.org/info/rfc8277</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8402">[RFC8402]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S., Ed.</span>, <span class="refAuthor">Ginsberg, L.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing Architecture"</span>, <span class="seriesInfo">RFC 8402</span>, <span class="seriesInfo">DOI 10.17487/RFC8402</span>, <time datetime="2018-07" class="refDate">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8402">https://www.rfc-editor.org/info/rfc8402</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8669">[RFC8669]</dt>
        <dd>
<span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Lindem, A., Ed.</span>, <span class="refAuthor">Sreekantiah, A.</span>, and <span class="refAuthor">H. Gredler</span>, <span class="refTitle">"Segment Routing Prefix Segment Identifier Extensions for BGP"</span>, <span class="seriesInfo">RFC 8669</span>, <span class="seriesInfo">DOI 10.17487/RFC8669</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8669">https://www.rfc-editor.org/info/rfc8669</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8986">[RFC8986]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Camarillo, P., Ed.</span>, <span class="refAuthor">Leddy, J.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Matsushima, S.</span>, and <span class="refAuthor">Z. Li</span>, <span class="refTitle">"Segment Routing over IPv6 (SRv6) Network Programming"</span>, <span class="seriesInfo">RFC 8986</span>, <span class="seriesInfo">DOI 10.17487/RFC8986</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8986">https://www.rfc-editor.org/info/rfc8986</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9012">[RFC9012]</dt>
        <dd>
<span class="refAuthor">Patel, K.</span>, <span class="refAuthor">Van de Velde, G.</span>, <span class="refAuthor">Sangli, S.</span>, and <span class="refAuthor">J. Scudder</span>, <span class="refTitle">"The BGP Tunnel Encapsulation Attribute"</span>, <span class="seriesInfo">RFC 9012</span>, <span class="seriesInfo">DOI 10.17487/RFC9012</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9012">https://www.rfc-editor.org/info/rfc9012</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9252">[RFC9252]</dt>
        <dd>
<span class="refAuthor">Dawra, G., Ed.</span>, <span class="refAuthor">Talaulikar, K., Ed.</span>, <span class="refAuthor">Raszuk, R.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Zhuang, S.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"BGP Overlay Services Based on Segment Routing over IPv6 (SRv6)"</span>, <span class="seriesInfo">RFC 9252</span>, <span class="seriesInfo">DOI 10.17487/RFC9252</span>, <time datetime="2022-07" class="refDate">July 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9252">https://www.rfc-editor.org/info/rfc9252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9256">[RFC9256]</dt>
        <dd>
<span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Talaulikar, K., Ed.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Bogdanov, A.</span>, and <span class="refAuthor">P. Mattes</span>, <span class="refTitle">"Segment Routing Policy Architecture"</span>, <span class="seriesInfo">RFC 9256</span>, <span class="seriesInfo">DOI 10.17487/RFC9256</span>, <time datetime="2022-07" class="refDate">July 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9256">https://www.rfc-editor.org/info/rfc9256</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9350">[RFC9350]</dt>
      <dd>
<span class="refAuthor">Psenak, P., Ed.</span>, <span class="refAuthor">Hegde, S.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Talaulikar, K.</span>, and <span class="refAuthor">A. Gulko</span>, <span class="refTitle">"IGP Flexible Algorithm"</span>, <span class="seriesInfo">RFC 9350</span>, <span class="seriesInfo">DOI 10.17487/RFC9350</span>, <time datetime="2023-02" class="refDate">February 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9350">https://www.rfc-editor.org/info/rfc9350</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.hr-spring-intentaware-routing-using-color">[INTENT-AWARE]</dt>
        <dd>
<span class="refAuthor">Hegde, S.</span>, <span class="refAuthor">Rao, D.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Bogdanov, A.</span>, and <span class="refAuthor">L. Jalil</span>, <span class="refTitle">"Problem statement for Inter-domain Intent-aware Routing using Color"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-hr-spring-intentaware-routing-using-color-04</span>, <time datetime="2025-01-31" class="refDate">31 January 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-hr-spring-intentaware-routing-using-color-04">https://datatracker.ietf.org/doc/html/draft-hr-spring-intentaware-routing-using-color-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4271">[RFC4271]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y., Ed.</span>, <span class="refAuthor">Li, T., Ed.</span>, and <span class="refAuthor">S. Hares, Ed.</span>, <span class="refTitle">"A Border Gateway Protocol 4 (BGP-4)"</span>, <span class="seriesInfo">RFC 4271</span>, <span class="seriesInfo">DOI 10.17487/RFC4271</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4271">https://www.rfc-editor.org/info/rfc4271</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4272">[RFC4272]</dt>
        <dd>
<span class="refAuthor">Murphy, S.</span>, <span class="refTitle">"BGP Security Vulnerabilities Analysis"</span>, <span class="seriesInfo">RFC 4272</span>, <span class="seriesInfo">DOI 10.17487/RFC4272</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4272">https://www.rfc-editor.org/info/rfc4272</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4364">[RFC4364]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP/MPLS IP Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4364</span>, <span class="seriesInfo">DOI 10.17487/RFC4364</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4364">https://www.rfc-editor.org/info/rfc4364</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4659">[RFC4659]</dt>
        <dd>
<span class="refAuthor">De Clercq, J.</span>, <span class="refAuthor">Ooms, D.</span>, <span class="refAuthor">Carugi, M.</span>, and <span class="refAuthor">F. Le Faucheur</span>, <span class="refTitle">"BGP-MPLS IP Virtual Private Network (VPN) Extension for IPv6 VPN"</span>, <span class="seriesInfo">RFC 4659</span>, <span class="seriesInfo">DOI 10.17487/RFC4659</span>, <time datetime="2006-09" class="refDate">September 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4659">https://www.rfc-editor.org/info/rfc4659</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4798">[RFC4798]</dt>
        <dd>
<span class="refAuthor">De Clercq, J.</span>, <span class="refAuthor">Ooms, D.</span>, <span class="refAuthor">Prevost, S.</span>, and <span class="refAuthor">F. Le Faucheur</span>, <span class="refTitle">"Connecting IPv6 Islands over IPv4 MPLS Using IPv6 Provider Edge Routers (6PE)"</span>, <span class="seriesInfo">RFC 4798</span>, <span class="seriesInfo">DOI 10.17487/RFC4798</span>, <time datetime="2007-02" class="refDate">February 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4798">https://www.rfc-editor.org/info/rfc4798</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5082">[RFC5082]</dt>
        <dd>
<span class="refAuthor">Gill, V.</span>, <span class="refAuthor">Heasley, J.</span>, <span class="refAuthor">Meyer, D.</span>, <span class="refAuthor">Savola, P., Ed.</span>, and <span class="refAuthor">C. Pignataro</span>, <span class="refTitle">"The Generalized TTL Security Mechanism (GTSM)"</span>, <span class="seriesInfo">RFC 5082</span>, <span class="seriesInfo">DOI 10.17487/RFC5082</span>, <time datetime="2007-10" class="refDate">October 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5082">https://www.rfc-editor.org/info/rfc5082</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5462">[RFC5462]</dt>
        <dd>
<span class="refAuthor">Andersson, L.</span> and <span class="refAuthor">R. Asati</span>, <span class="refTitle">"Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field"</span>, <span class="seriesInfo">RFC 5462</span>, <span class="seriesInfo">DOI 10.17487/RFC5462</span>, <time datetime="2009-02" class="refDate">February 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5462">https://www.rfc-editor.org/info/rfc5462</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5925">[RFC5925]</dt>
        <dd>
<span class="refAuthor">Touch, J.</span>, <span class="refAuthor">Mankin, A.</span>, and <span class="refAuthor">R. Bonica</span>, <span class="refTitle">"The TCP Authentication Option"</span>, <span class="seriesInfo">RFC 5925</span>, <span class="seriesInfo">DOI 10.17487/RFC5925</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5925">https://www.rfc-editor.org/info/rfc5925</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6811">[RFC6811]</dt>
        <dd>
<span class="refAuthor">Mohapatra, P.</span>, <span class="refAuthor">Scudder, J.</span>, <span class="refAuthor">Ward, D.</span>, <span class="refAuthor">Bush, R.</span>, and <span class="refAuthor">R. Austein</span>, <span class="refTitle">"BGP Prefix Origin Validation"</span>, <span class="seriesInfo">RFC 6811</span>, <span class="seriesInfo">DOI 10.17487/RFC6811</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6811">https://www.rfc-editor.org/info/rfc6811</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7911">[RFC7911]</dt>
        <dd>
<span class="refAuthor">Walton, D.</span>, <span class="refAuthor">Retana, A.</span>, <span class="refAuthor">Chen, E.</span>, and <span class="refAuthor">J. Scudder</span>, <span class="refTitle">"Advertisement of Multiple Paths in BGP"</span>, <span class="seriesInfo">RFC 7911</span>, <span class="seriesInfo">DOI 10.17487/RFC7911</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7911">https://www.rfc-editor.org/info/rfc7911</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8205">[RFC8205]</dt>
        <dd>
<span class="refAuthor">Lepinski, M., Ed.</span> and <span class="refAuthor">K. Sriram, Ed.</span>, <span class="refTitle">"BGPsec Protocol Specification"</span>, <span class="seriesInfo">RFC 8205</span>, <span class="seriesInfo">DOI 10.17487/RFC8205</span>, <time datetime="2017-09" class="refDate">September 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8205">https://www.rfc-editor.org/info/rfc8205</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9315">[RFC9315]</dt>
        <dd>
<span class="refAuthor">Clemm, A.</span>, <span class="refAuthor">Ciavaglia, L.</span>, <span class="refAuthor">Granville, L. Z.</span>, and <span class="refAuthor">J. Tantsura</span>, <span class="refTitle">"Intent-Based Networking - Concepts and Definitions"</span>, <span class="seriesInfo">RFC 9315</span>, <span class="seriesInfo">DOI 10.17487/RFC9315</span>, <time datetime="2022-10" class="refDate">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9315">https://www.rfc-editor.org/info/rfc9315</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9723">[RFC9723]</dt>
        <dd>
<span class="refAuthor">Wang, H.</span>, <span class="refAuthor">Dong, J.</span>, <span class="refAuthor">Talaulikar, K.</span>, <span class="refAuthor">Han, T.</span>, and <span class="refAuthor">R. Chen</span>, <span class="refTitle">"BGP Colored Prefix Routing (CPR) for Services Based on Segment Routing over IPv6 (SRv6)"</span>, <span class="seriesInfo">RFC 9723</span>, <span class="seriesInfo">DOI 10.17487/RFC9723</span>, <time datetime="2025-05" class="refDate">May 2025</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9723">https://www.rfc-editor.org/info/rfc9723</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-spring-srv6-mpls-interworking">[SRv6-INTERWORK]</dt>
      <dd>
<span class="refAuthor">Agrawal, S.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Dawra, G.</span>, <span class="refAuthor">Li, Z.</span>, and <span class="refAuthor">S. Hegde</span>, <span class="refTitle">"SRv6 and MPLS interworking"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-spring-srv6-mpls-interworking-01</span>, <time datetime="2025-07-07" class="refDate">7 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-spring-srv6-mpls-interworking-01">https://datatracker.ietf.org/doc/html/draft-ietf-spring-srv6-mpls-interworking-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="SSTEERINGAPNDX">
<section id="appendix-A">
      <h2 id="name-illustrations-of-service-st">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-illustrations-of-service-st" class="section-name selfRef">Illustrations of Service Steering</a>
      </h2>
<p id="appendix-A-1">The following sub-sections illustrate example scenarios of colored 
      service route steering over end-to-end (E2E) BGP CAR paths, resolving over different 
      intra-domain mechanisms.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">The examples in this section use MPLS/SR for the transport data plane. Scenarios
      related to SRv6 encapsulation are in a section below.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<div id="SFAUSECASE">
<section id="appendix-A.1">
        <h3 id="name-e2e-bgp-transport-car-inten">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-e2e-bgp-transport-car-inten" class="section-name selfRef">E2E BGP Transport CAR Intent Realized Using IGP Flexible Algorithm</a>
        </h3>
<span id="name-bgp-flexible-algorithm-awar"></span><div id="FAUSECASE">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="appendix-A.1-1.1">
<pre>
                              RD:V/v via E2
          +-----+             vpn label: 30030       +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;.......
   :      +-----+             Color C1               +-----+        :
   :                                                                :
   :                                                                :
   :                                                                :
+-:-----------------------+----------------------+------------------:--+
| :                       |                      |                  :  |
| :                       |                      |                  :  |
| :   (E2,C1) via 121     |   (E2,C1) via 231    | (E2,C1)via E2    :  |
| :   L=168002,AIGP=110 +---+ L=168002,AIGP=10 +---+ L=0x3,LI=8002  :  |
| : |-------------------|121|&lt;-----------------|231|&lt;-------------| :  |
| : V LI=8002           +---+ LI=8002          +---+              | :  |
|----+                    |                      |               +-----|
| E1 |                    |                      |               | E2  |
|----+(E2,C1) via 122     |   (E2,C1) via 232    |  (E2,C1)via E2+-----|
|   ^ L=168002,AIGP=210 +---+ L=168002,AIGP=20 +---+ L=0x3        |    |
|   |----------------   |122|&lt;-----------------|232|&lt;-------------|    |
|     LI=8002           +---+ LI=8002          +---+ LI=8002           |
|                         |                      |                     |
|         IS-IS SR        |      IS-IS SR        |     IS-IS SR        |
|         FA128           |      FA128           |     FA128           |
+-------------------------+----------------------+---------------------+
 iPE                     iABR                   eABR               ePE

         ---------direction of traffic--------&gt;
+------+                  +------+
|168121|                  |168231|
+------+                  +------+
+------+                  +------+                 +------+
|168002|                  |168002|                 |168002|
+------+                  +------+                 +------+
+------+                  +------+                 +------+
|30030 |                  |30030 |                 |30030 |
+------+                  +------+                 +------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-bgp-flexible-algorithm-awar" class="selfRef">BGP Flexible Algorithm Aware Transport CAR Path</a>
          </figcaption></figure>
</div>
<p id="appendix-A.1-2">Use case: Provide end-to-end intent for service flows.<a href="#appendix-A.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-3.1">
            <p id="appendix-A.1-3.1.1">The following description applies to the reference topology above:<a href="#appendix-A.1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-3.1.2.1">
                <p id="appendix-A.1-3.1.2.1.1">IGP Flex-Algo 128 is running in each domain, and mapped to color C1.<a href="#appendix-A.1-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.1-3.1.2.2">
                <p id="appendix-A.1-3.1.2.2.1">Egress PE E2 advertises a VPN route RD:V/v colored with Color-EC C1 
            to steer traffic to BGP transport CAR (E2, C1).
            VPN route propagates via service RRs to ingress PE E1.<a href="#appendix-A.1-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.1-3.1.2.3">
                <p id="appendix-A.1-3.1.2.3.1">BGP CAR route (E2, C1) with next hop, label index, and
                label as shown above are advertised through BRs in
                each domain.  When an RR is used in the domain, ADD-PATH is
                enabled to advertise multiple available paths.<a href="#appendix-A.1-3.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.1-3.1.2.4">
                <p id="appendix-A.1-3.1.2.4.1">On each BGP hop, the (E2, C1) route's next hop is resolved over IGP Flex-Algo 128 
            of the domain. The AIGP attribute influences the BGP CAR route best path decision as 
            per <span>[<a href="#RFC7311" class="cite xref">RFC7311</a>]</span>. The BGP CAR label swap entry is installed that goes
            over Flex-Algo 128 LSP to next hop providing intent in each IGP domain. The AIGP 
            metric should be updated to reflect Flex-Algo 128 metric to next hop.<a href="#appendix-A.1-3.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.1-3.1.2.5">
                <p id="appendix-A.1-3.1.2.5.1">Ingress PE E1 learns CAR route (E2, C1). It steers colored 
            VPN route RD:V/v into (E2, C1).<a href="#appendix-A.1-3.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.1-3.2">
            <p id="appendix-A.1-3.2.1">Important:<a href="#appendix-A.1-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-3.2.2.1">
                <p id="appendix-A.1-3.2.2.1.1">IGP Flex-Algo 128 top label provides intent within each domain.<a href="#appendix-A.1-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.1-3.2.2.2">
                <p id="appendix-A.1-3.2.2.2.1">BGP CAR label (e.g., 168002) carries end-to-end
                intent. Thus, it stitches intent over intra-domain Flex-Algo 128.<a href="#appendix-A.1-3.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<section id="appendix-A.2">
        <h3 id="name-e2e-bgp-transport-car-intent">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-e2e-bgp-transport-car-intent" class="section-name selfRef">E2E BGP Transport CAR Intent Realized Using SR Policy</a>
        </h3>
<span id="name-bgp-sr-policy-aware-transpo"></span><div id="SRPUSECASE">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="appendix-A.2-1.1">
<pre>
                              RD:1/8 via E2
          +-----+             vpn label: 30030       +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;......
   :      +-----+             Color C1               +-----+        :
   :                                                                :
   :                                                                :
   :                                                                :
+-:-----------------------+----------------------+------------------:-+
| :                       |                      |                  : |
| :                       |                      |                  : |
| :  &lt;-(E2,C1) via 121    |   &lt;-(E2,C1) via 231  | &lt;-(E2,C1)via E2  : |
| :                     +---+                  +---+                : |
| :  ------------------&gt;|121|-----------------&gt;|231|--------------| : |
| : | SR Policy(C1,121) +---+ SR Policy(C1,231)+---+ SR Policy    v : |
|----+                    |                      |   (C1,E2)      +---|
| E1 |                    |                      |                |E2 |
|----+ &lt;-(E2,C1) via 122  |  (E2,C1) via 232     | &lt;-(E2,C1)via E2+---|
|   |                   +---+                  +---+               ^  |
|    ------------------&gt;|122|-----------------&gt;|232|---------------|  |
|    SR Policy(C1,122)  +---+ SR Policy(C1,232)+---+ SR Policy(C1,E2) |
|                         |                      |                    |
|                         |                      |                    |
|         IS-IS SR        |      IS-IS SR        |     IS-IS SR       |
+-------------------------+----------------------+--------------------+
 iPE                     iABR                   eABR              ePE

        ---------direction of traffic--------&gt;
+------+                  +------+
|  S1  |                  |  S2  |
+------+                  +------+
+------+                  +------+                 +------+
|160121|                  |160231|                 |  S3  |
+------+                  +------+                 +------+
+------+                  +------+                 +------+
|168002|                  |168002|                 |168002|
+------+                  +------+                 +------+
+------+                  +------+                 +------+
|30030 |                  |30030 |                 |30030 |
+------+                  +------+                 +------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-bgp-sr-policy-aware-transpo" class="selfRef">BGP SR Policy Aware Transport CAR Path</a>
          </figcaption></figure>
</div>
<p id="appendix-A.2-2">Use case: Provide end-to-end intent for service flows.<a href="#appendix-A.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.1">
            <p id="appendix-A.2-3.1.1">The following description applies to the reference topology above:<a href="#appendix-A.2-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.1.2.1">
                <p id="appendix-A.2-3.1.2.1.1">An SR Policy provides intra-domain intent. The following are the example SID lists 
            that are realized from SR policies in each domain and correspond to the label stack 
            shown in <a href="#SRPUSECASE" class="auto internal xref">Figure 7</a>:<a href="#appendix-A.2-3.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.1.2.1.2.1">
                    <p id="appendix-A.2-3.1.2.1.2.1.1">SR Policy (C1, 121) segments &lt;S1, 121&gt;,<a href="#appendix-A.2-3.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-A.2-3.1.2.1.2.2">
                    <p id="appendix-A.2-3.1.2.1.2.2.1">SR Policy (C1, 231) segments &lt;S2, 231&gt;, and<a href="#appendix-A.2-3.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-A.2-3.1.2.1.2.3">
                    <p id="appendix-A.2-3.1.2.1.2.3.1">SR Policy (C1, E2) segments &lt;S3, E2&gt;.<a href="#appendix-A.2-3.1.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-A.2-3.1.2.2">
                <p id="appendix-A.2-3.1.2.2.1">Egress PE E2 advertises a VPN route RD:V/v colored with Color-EC C1 
            to steer traffic to BGP transport CAR (E2, C1).
            VPN route propagates via service RRs to ingress PE E1.<a href="#appendix-A.2-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-3.1.2.3">
                <p id="appendix-A.2-3.1.2.3.1">BGP CAR route (E2, C1) with next hop, label index, and label
                as shown above are advertised through BRs in each
                domain.  When an RR is used in the domain, ADD-PATH is enabled
                to advertise multiple available paths.<a href="#appendix-A.2-3.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-3.1.2.4">
                <p id="appendix-A.2-3.1.2.4.1">On each BGP hop, the CAR route (E2, C1) next hop is resolved over an 
            SR Policy (C1, next hop). The BGP CAR label swap entry is installed that goes 
            over SR Policy segment list.<a href="#appendix-A.2-3.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-3.1.2.5">
                <p id="appendix-A.2-3.1.2.5.1">Ingress PE E1 learns CAR route (E2, C1). It steers colored 
            VPN route RD:V/v into (E2, C1).<a href="#appendix-A.2-3.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.2-3.2">
            <p id="appendix-A.2-3.2.1">Important:<a href="#appendix-A.2-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.2.2.1">
                <p id="appendix-A.2-3.2.2.1.1">SR Policy provides intent within each domain.<a href="#appendix-A.2-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.2-3.2.2.2">
                <p id="appendix-A.2-3.2.2.2.1">BGP CAR label (e.g., 168002) carries end-to-end
                intent. Thus, it stitches intent over intra-domain SR
                policies.<a href="#appendix-A.2-3.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
<div id="SHDFAUSECASE">
<section id="appendix-A.3">
        <h3 id="name-bgp-transport-car-intent-re">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-bgp-transport-car-intent-re" class="section-name selfRef">BGP Transport CAR Intent Realized in a Section of the Network</a>
        </h3>
<section id="appendix-A.3.1">
          <h4 id="name-provide-intent-for-service-">
<a href="#appendix-A.3.1" class="section-number selfRef">A.3.1. </a><a href="#name-provide-intent-for-service-" class="section-name selfRef">Provide Intent for Service Flows Only in Core Domain Running IS-IS Flexible Algorithm</a>
          </h4>
<span id="name-bgp-hybrid-flexible-algorit"></span><div id="HDFAUSECASE">
<figure id="figure-8">
            <div class="alignLeft art-text artwork" id="appendix-A.3.1-1.1">
<pre>
                              RD:1/8 via E2
          +-----+             vpn label: 30030       +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;.......
   :      +-----+             Color C1               +-----+        :
   :                                                                :
   :                                                                :
   :                                                                :
+-:-----------------------+----------------------+------------------:--+
| :                       |                      |                  :  |
| :                       |                      |                  :  |
| :   (E2,C1) via 121     |  (E2,C1) via 231     | (E2,C1) via E2   :  |
| :   L=168002,AIGP=1110+---+L=168002,AIGP=1010+---+ L=0x3          :  |
| : |-------------------|121|&lt;-----------------|231|&lt;-------------| :  |
| : V LI=8002           +---+ LI=8002          +---+              | :  |
|----+                    |                      |               +-----|
| E1 |                    |                      |               | E2  |
|----+(E2,C1) via 122     |  (E2,C1) via 232     | (E2,C1) via E2+-----|
|   ^ L=168002,AIGP=1210+---+L=168002,AIGP=1020+---+ L=0x3        |    |
|   |----------------   |122|&lt;-----------------|232|&lt;-------------|    |
|     LI=8002           +---+ LI=8002          +---+                   |
|                         |                      |                     |
|         IS-IS SR        |      IS-IS SR        |     IS-IS SR        |
|         Algo 0          |      Flex-Algo 128   |     Algo 0          |
|         Access          |      Core            |     Access          |
+-------------------------+----------------------+---------------------+
iPE                     iABR                    eABR                ePE

         ---------direction of traffic--------&gt;
+------+                  +------+
|160121|                  |168231|
+------+                  +------+
+------+                  +------+                 +------+
|168002|                  |168002|                 |160002|
+------+                  +------+                 +------+
+------+                  +------+                 +------+
|30030 |                  |30030 |                 |30030 |
+------+                  +------+                 +------+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-bgp-hybrid-flexible-algorit" class="selfRef">BGP Hybrid Flexible Algorithm Aware Transport CAR Path</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-A.3.1-2.1">
              <p id="appendix-A.3.1-2.1.1">The following description applies to the reference topology above:<a href="#appendix-A.3.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.3.1-2.1.2.1">
                  <p id="appendix-A.3.1-2.1.2.1.1">IGP Flex-Algo 128 is only enabled in core (e.g., WAN network),
                  mapped to C1.  Access network domain only has Base Algo
                  0.<a href="#appendix-A.3.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.1.2.2">
                  <p id="appendix-A.3.1-2.1.2.2.1">Egress PE E2 advertises a VPN route RD:V/v colored with Color-EC C1 
              to steer traffic via BGP transport CAR (E2, C1).
              VPN route propagates via service RRs to ingress PE E1.<a href="#appendix-A.3.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.1.2.3">
                  <p id="appendix-A.3.1-2.1.2.3.1">BGP CAR route (E2, C1) with next hop, label index, and label as 
              shown above are advertised through BRs in each domain.
              When an RR is used in the domain, ADD-PATH is enabled to advertise multiple 
              available paths.<a href="#appendix-A.3.1-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.1.2.4">
                  <p id="appendix-A.3.1-2.1.2.4.1">Local policy on 231 and 232 maps intent C1 to resolve CAR
                  route next hop over IGP Base Algo 0 in right access
                  domain. The BGP CAR label swap entry is installed that goes
                  over Base Algo 0 LSP to next hop. AIGP metric is updated to
                  reflect Base Algo 0 metric to next hop with an additional
                  penalty (+1000).<a href="#appendix-A.3.1-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.1.2.5">
                  <p id="appendix-A.3.1-2.1.2.5.1">On 121 and 122, CAR route (E2, C1) next hop learnt from
                  Core domain is resolved over IGP Flex-Algo 128. The BGP CAR label
                  swap entry is installed that goes over Flex-Algo 128 LSP to next
                  hop providing intent in Core IGP domain.<a href="#appendix-A.3.1-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.1.2.6">
                  <p id="appendix-A.3.1-2.1.2.6.1">Ingress PE E1 learns CAR route (E2, C1). It maps intent
                  C1 to resolve CAR route next hop over IGP Base Algo 0. It
                  steers colored VPN route RD:V/v via (E2, C1).<a href="#appendix-A.3.1-2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="appendix-A.3.1-2.2">
              <p id="appendix-A.3.1-2.2.1">Important:<a href="#appendix-A.3.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.3.1-2.2.2.1">
                  <p id="appendix-A.3.1-2.2.2.1.1">IGP Flex-Algo 128 top label provides intent in Core domain.<a href="#appendix-A.3.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.1-2.2.2.2">
                  <p id="appendix-A.3.1-2.2.2.2.1">BGP CAR label (e.g., 168002) carries intent from PEs, which is
              realized in Core domain.<a href="#appendix-A.3.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
<div id="COREDOMAINTE">
<section id="appendix-A.3.2">
          <h4 id="name-provide-intent-for-service-f">
<a href="#appendix-A.3.2" class="section-number selfRef">A.3.2. </a><a href="#name-provide-intent-for-service-f" class="section-name selfRef">Provide Intent for Service Flows Only in Core Domain over TE Tunnel Mesh</a>
          </h4>
<span id="name-bgp-car-over-te-tunnel-mesh"></span><div id="HRSVPDFAUSECASE">
<figure id="figure-9">
            <div class="alignLeft art-text artwork" id="appendix-A.3.2-1.1">
<pre>
                     RD:1/8 via E2
          +-----+         vpn label: 30030           +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;.......
   :      +-----+             Color C1               +-----+        :
   :                                                                :
   :                                                                :
   :                                                                :
 +-:-----------------------+----------------------+-----------------:-+
 | :                       |                      |                 : |
 | :                       |                      |                 : |
 | :   (E2,C1) via 121     |  (E2,C1) via 231     | (E2,C1) via E2  : |
 | :   L=242003,AIGP=1110+---+L=242002,AIGP=1010+---+ L=0x3         : |
 | : |-------------------|121|&lt;-----------------|231|&lt;-------------|: |
 | : V                   +---+ TE tunnel(231)   +---+              |: |
 |----+                    |                      |               +---|
 | E1 |                    |                      |               |E2 |
 |----+(E2,C1) via 122     |  (E2,C1) via 232     | (E2,C1) via E2+---|
 |   ^ L=242004,AIGP=1210+---+L=242001,AIGP=1020+---+ L=0x3        |  |
 |   |----------------   |122|&lt;-----------------|232|&lt;-------------|  |
 |                       +---+ TE tunnel(232)   +---+                 |
 |                         |                      |                   |
 |                         |                      |                   |
 |         IS-IS/LDP       |      IS-IS/RSVP-TE   |     IS-IS/LDP     |
 |         Access 0        |      Core            |     Access 1      |
 +-------------------------+----------------------+-------------------+
  iPE                    iABR                   eABR               ePE

             ---------direction of traffic--------&gt;
     +------+                  +------+
     |240121|                  |241231|
     +------+                  +------+
     +------+                  +------+                 +------+
     |242003|                  |242002|                 |240002|
     +------+                  +------+                 +------+
     +------+                  +------+                 +------+
     |30030 |                  |30030 |                 |30030 |
     +------+                  +------+                 +------+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-bgp-car-over-te-tunnel-mesh" class="selfRef">BGP CAR over TE Tunnel Mesh in Core Network</a>
            </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-A.3.2-2.1">
              <p id="appendix-A.3.2-2.1.1">The following description applies to the reference topology above:<a href="#appendix-A.3.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.3.2-2.1.2.1">
                  <p id="appendix-A.3.2-2.1.2.1.1">RSVP-TE MPLS tunnel mesh is configured only in core
                  (e.g., WAN network).  Access only has IS-IS/LDP. (The figure
                  does not show all TE tunnels.)<a href="#appendix-A.3.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.1.2.2">
                  <p id="appendix-A.3.2-2.1.2.2.1">Egress PE E2 advertises a VPN route RD:V/v colored with
                  Color-EC C1 to steer traffic via BGP transport CAR (E2,
                  C1). VPN route propagates via service RRs to ingress PE
                  E1.<a href="#appendix-A.3.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.1.2.3">
                  <p id="appendix-A.3.2-2.1.2.3.1">BGP CAR route (E2, C1) with next hops and labels as 
            shown above is advertised through BRs in each 
            domain.  When an RR is used in the domain, ADD-PATH is enabled 
            to advertise multiple available paths.<a href="#appendix-A.3.2-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.1.2.4">
                  <p id="appendix-A.3.2-2.1.2.4.1">Local policy on 231 and 232 maps intent C1 to resolve CAR route 
            next hop over best-effort LDP LSP in access domain 1.  The BGP CAR 
            label swap entry is installed that goes over LDP LSP to 
            next hop. AIGP metric is updated to reflect best-effort metric to next hop 
            with an additional penalty (+1000).<a href="#appendix-A.3.2-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.1.2.5">
                  <p id="appendix-A.3.2-2.1.2.5.1">Local policy on 121 and 122 maps intent C1 to resolve CAR route 
            next hop in Core domain over RSVP-TE tunnels. The BGP CAR label swap entry is 
            installed that goes over a TE tunnel to next hop providing intent in Core 
            domain. AIGP metric is updated to reflect TE tunnel metric.<a href="#appendix-A.3.2-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.1.2.6">
                  <p id="appendix-A.3.2-2.1.2.6.1">Ingress PE E1 learns CAR route (E2, C1). It maps intent C1 to 
            resolve CAR route's next hop over best-effort LDP LSP in access domain 0. It 
            steers colored VPN route RD:V/v via (E2, C1).<a href="#appendix-A.3.2-2.1.2.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="appendix-A.3.2-2.2">
              <p id="appendix-A.3.2-2.2.1">Important:<a href="#appendix-A.3.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.3.2-2.2.2.1">
                  <p id="appendix-A.3.2-2.2.2.1.1">RSVP-TE tunnel LSP provides intent in Core domain.<a href="#appendix-A.3.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.3.2-2.2.2.2">
                  <p id="appendix-A.3.2-2.2.2.2.1">Dynamic BGP CAR label carries intent from PEs, which is 
            realized in Core domain by resolution via RSVP-TE tunnel.<a href="#appendix-A.3.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
</section>
</div>
<section id="appendix-A.4">
        <h3 id="name-transit-network-domains-tha">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-transit-network-domains-tha" class="section-name selfRef">Transit Network Domains That Do Not Support CAR</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.4-1.1">
            <p id="appendix-A.4-1.1.1">In a brownfield deployment, color-aware paths between two PEs
            may need to go through a transit domain that does not support CAR.
            Examples of such a brownfield network include an MPLS LDP network
            with IGP best-effort, or a multi-domain network based on BGP-LU. An MPLS
            LDP network with best-effort IGP can adopt the above scheme in
            <a href="#SHDFAUSECASE" class="auto internal xref">Appendix A.3</a>. Below is the example scenario for
            BGP-LU.<a href="#appendix-A.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.2">
            <p id="appendix-A.4-1.2.1">Reference topology:<a href="#appendix-A.4-1.2.1" class="pilcrow">¶</a></p>
<span id="name-bgp-car-not-supported-in-tr"></span><div id="TRANSITNOCAR">
<figure id="figure-10">
              <div class="alignLeft art-text artwork" id="appendix-A.4-1.2.2.1">
<pre>
E1 --- BR1 --- BR2 ......... BR3 ---- BR4 --- E2
    Ci           &lt;----LU----&gt;              Ci
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-bgp-car-not-supported-in-tr" class="selfRef">BGP CAR Not Supported in Transit Domain</a>
              </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-A.4-1.2.3.1">
                <p id="appendix-A.4-1.2.3.1.1">Network between BR2 and BR3 comprises of multiple BGP-LU hops 
            (over IGP-LDP domains).<a href="#appendix-A.4-1.2.3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.4-1.2.3.2">
                <p id="appendix-A.4-1.2.3.2.1">E1, BR1, BR4, and E2 are enabled for BGP CAR, with Ci colors.<a href="#appendix-A.4-1.2.3.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.4-1.2.3.3">
                <p id="appendix-A.4-1.2.3.3.1">BR1 and BR2 are directly connected; BR3 and BR4 are directly connected.<a href="#appendix-A.4-1.2.3.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.4-1.3">
            <p id="appendix-A.4-1.3.1">BR1 and BR4 form an over-the-top peering (via RRs as needed) to exchange 
       BGP CAR routes.<a href="#appendix-A.4-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.4">
            <p id="appendix-A.4-1.4.1">BR1 and BR4 also form direct BGP-LU sessions to BR2 and BR3, respectively, 
          to establish labeled paths between each other through the BGP-LU network. 
          The sessions may be eBGP or iBGP.<a href="#appendix-A.4-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.5">
            <p id="appendix-A.4-1.5.1">BR1 recursively resolves the BGP CAR next hop for CAR routes learnt from 
          BR4 via the BGP-LU path to BR4.<a href="#appendix-A.4-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.6">
            <p id="appendix-A.4-1.6.1">BR1 signals the transport discontinuity to E1 via the AIGP TLV, so that 
          E1 can prefer other paths if available.<a href="#appendix-A.4-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.7">
            <p id="appendix-A.4-1.7.1">BR4 does the same in the reverse direction.<a href="#appendix-A.4-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.8">
            <p id="appendix-A.4-1.8.1">Thus, the color awareness of the routes, and hence the paths
            in the data plane, are maintained between E1 and E2, even if the
            intent is not available within the BGP-LU island.<a href="#appendix-A.4-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.9">
            <p id="appendix-A.4-1.9.1">A similar design can be used for going over network islands of other
          types.<a href="#appendix-A.4-1.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<section id="appendix-A.5">
        <h3 id="name-resource-avoidance-using-bg">
<a href="#appendix-A.5" class="section-number selfRef">A.5. </a><a href="#name-resource-avoidance-using-bg" class="section-name selfRef">Resource Avoidance Using BGP CAR and IGP Flexible Algorithm</a>
        </h3>
<p id="appendix-A.5-1">This example illustrates a case of resource avoidance within a domain for a 
      multi-domain color-aware path.<a href="#appendix-A.5-1" class="pilcrow">¶</a></p>
<span id="name-bgp-car-resolution-over-igp"></span><div id="HRAVOIDUSECASE">
<figure id="figure-11">
          <div class="alignLeft art-text artwork" id="appendix-A.5-2.1">
<pre>
           +-------------+      +-------------+
           |             |      |             | V/v with C1
           |----+        |------|        +----|/
           | E1 |        |      |        | E2 |\
           |----+        |      |        +----| W/w with C2
           |             |------|   IGP FA128 |
           |  IGP FA128  |      |   IGP FA129 |
           |  Domain 1   |      |   Domain 2  |
           +-------------+      +-------------+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-bgp-car-resolution-over-igp" class="selfRef">BGP CAR Resolution over IGP Flexible Algorithm for Resource Avoidance in a Domain</a>
          </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.1">
            <p id="appendix-A.5-3.1.1">C1 and C2 represent the following two unique intents in the multi-domain network:<a href="#appendix-A.5-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.1.2.1">
                <p id="appendix-A.5-3.1.2.1.1">C1 is mapped to "minimize IGP metric", and<a href="#appendix-A.5-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.5-3.1.2.2">
                <p id="appendix-A.5-3.1.2.2.1">C2 is mapped to "minimize IGP metric and avoid resource R".<a href="#appendix-A.5-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.5-3.2">
            <p id="appendix-A.5-3.2.1">Resource R represents link(s) or node(s) to be avoided.<a href="#appendix-A.5-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-3.3">
            <p id="appendix-A.5-3.3.1">Flex-Algo 128 in Domain 2 is mapped to "minimize IGP metric", and hence 
            to C1.<a href="#appendix-A.5-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-3.4">
            <p id="appendix-A.5-3.4.1">Flex-Algo 129 in Domain 2 is mapped to "minimize IGP metric
            and avoid resource R", and hence to C2.<a href="#appendix-A.5-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-3.5">
            <p id="appendix-A.5-3.5.1">Flex-Algo 128 in Domain 1 is mapped to "minimize IGP metric"
            (i.e., there is no resource R to be avoided in Domain 1, hence
            both C1 and C2 are mapped to Flex-Algo 128).<a href="#appendix-A.5-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-3.6">
            <p id="appendix-A.5-3.6.1">E1 receives the following two service routes from E2:<a href="#appendix-A.5-3.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.6.2.1">
                <p id="appendix-A.5-3.6.2.1.1">V/v with BGP Color-EC C1, and<a href="#appendix-A.5-3.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.5-3.6.2.2">
                <p id="appendix-A.5-3.6.2.2.1">W/w with BGP Color-EC C2.<a href="#appendix-A.5-3.6.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.5-3.7">
            <p id="appendix-A.5-3.7.1">E1 has the following color-aware paths:<a href="#appendix-A.5-3.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.7.2.1">
                <p id="appendix-A.5-3.7.2.1.1">(E2, C1) provided by BGP CAR with the following per-domain 
            resolution:<a href="#appendix-A.5-3.7.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.7.2.1.2.1">
                    <p id="appendix-A.5-3.7.2.1.2.1.1">Domain 1: over IGP Flex-Algo 128, and<a href="#appendix-A.5-3.7.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-A.5-3.7.2.1.2.2">
                    <p id="appendix-A.5-3.7.2.1.2.2.1">Domain 2: over IGP Flex-Algo 128.<a href="#appendix-A.5-3.7.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-A.5-3.7.2.2">
                <p id="appendix-A.5-3.7.2.2.1">(E2, C2) provided by BGP CAR with the following per-domain 
            resolution:<a href="#appendix-A.5-3.7.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.7.2.2.2.1">
                    <p id="appendix-A.5-3.7.2.2.2.1.1">Domain 1: over IGP Flex-Algo 128, and<a href="#appendix-A.5-3.7.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-A.5-3.7.2.2.2.2">
                    <p id="appendix-A.5-3.7.2.2.2.2.1">Domain 2: over IGP Flex-Algo 129 (avoiding resource R).<a href="#appendix-A.5-3.7.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.5-3.8">
            <p id="appendix-A.5-3.8.1">E1 automatically steers the received service routes as follows:<a href="#appendix-A.5-3.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-3.8.2.1">
                <p id="appendix-A.5-3.8.2.1.1">V/v via (E2, C1) provided by BGP CAR.<a href="#appendix-A.5-3.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-A.5-3.8.2.2">
                <p id="appendix-A.5-3.8.2.2.1">W/w via (E2, C2) provided by BGP CAR.<a href="#appendix-A.5-3.8.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="appendix-A.5-4">Observations:<a href="#appendix-A.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.5-5.1">
            <p id="appendix-A.5-5.1.1">C1 and C2 are realized over a common intra-domain intent (Flex-Algo 128) in one 
            domain and distinct intents in another domain as required.<a href="#appendix-A.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.5-5.2">
            <p id="appendix-A.5-5.2.1">32-bit Color space provides flexibility in defining a large
            number of intents in a multi-domain network. They may be
            efficiently realized by mapping to a smaller number of
            intra-domain intents in different domains.<a href="#appendix-A.5-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<section id="appendix-A.6">
        <h3 id="name-per-flow-steering-over-car-">
<a href="#appendix-A.6" class="section-number selfRef">A.6. </a><a href="#name-per-flow-steering-over-car-" class="section-name selfRef">Per-Flow Steering over CAR Routes</a>
        </h3>
<p id="appendix-A.6-1">This section provides an example of ingress PE per-flow steering as defined 
        in <span><a href="https://rfc-editor.org/rfc/rfc9256#section-8.6" class="relref">Section 8.6</a> of [<a href="#RFC9256" class="cite xref">RFC9256</a>]</span> 
        onto BGP CAR routes.<a href="#appendix-A.6-1" class="pilcrow">¶</a></p>
<p id="appendix-A.6-2">The following description applies to the reference topology in <a href="#FAUSECASE" class="auto internal xref">Figure 6</a>:<a href="#appendix-A.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.6-3.1">
            <p id="appendix-A.6-3.1.1">Ingress PE E1 learns best-effort BGP-LU route E2.<a href="#appendix-A.6-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.2">
            <p id="appendix-A.6-3.2.1">Ingress PE E1 learns CAR route (E2, C1), C1 is mapped to "low delay".<a href="#appendix-A.6-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.3">
            <p id="appendix-A.6-3.3.1">Ingress PE E1 learns CAR route (E2, C2), C2 is mapped to 
          "low delay and avoid resource R".<a href="#appendix-A.6-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.4">
            <p id="appendix-A.6-3.4.1">Ingress PE E1 is configured to instantiate an array of paths to E2 where 
          entry 0 is the BGP-LU path to next hop, color C1 is the first entry, and 
          color C2 is the second entry. The index into the array is called a 
          Forwarding Class (FC).  The index can have values 0 to 7, especially when 
          derived from the MPLS TC bits <span>[<a href="#RFC5462" class="cite xref">RFC5462</a>]</span>.<a href="#appendix-A.6-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.5">
            <p id="appendix-A.6-3.5.1">E1 is configured to match flows in its ingress interfaces (upon any field 
          such as Ethernet destination/source/VLAN/TOS or IP destination/source/DSCP 
          or transport ports, etc.) and color them with an internal per-packet FC variable
          (0, 1, or 2 in this example).<a href="#appendix-A.6-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.6">
            <p id="appendix-A.6-3.6.1">This array is presented as a composite candidate path of SR Policy (E2, C100) 
          and acts as a container for grouping constituent paths of different 
          colors/best-effort. This representation provides automated steering for 
          services colored with Color-EC C100 via paths of different 
          colors. Note that Color-EC C100 is used as indirection to the 
          composite policy configured on ingress PE.<a href="#appendix-A.6-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-3.7">
            <p id="appendix-A.6-3.7.1">Egress PE E2 advertises a VPN route RD:V/v with Color-EC C100
          to steer traffic via composite SR Policy (E2, C100) (i.e., FC array of paths).<a href="#appendix-A.6-3.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.6-4">E1 receives three packets K, K1, and K2 on its incoming interface. These three 
        packets match on the VPN route that recurses on E2. E1 colors these 3 packets with forwarding class 0, 1, and 2, respectively.<a href="#appendix-A.6-4" class="pilcrow">¶</a></p>
<p id="appendix-A.6-5">As a result:<a href="#appendix-A.6-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.6-6.1">
            <p id="appendix-A.6-6.1.1">E1 forwards K along the best-effort path to E2 (i.e., for the MPLS data plane, 
          it pushes the best-effort label of E2).<a href="#appendix-A.6-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-6.2">
            <p id="appendix-A.6-6.2.1">E1 forwards K1 along the (E2, C1) BGP CAR route.<a href="#appendix-A.6-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-6.3">
            <p id="appendix-A.6-6.3.1">E1 forwards K2 along the (E2, C2) BGP CAR route.<a href="#appendix-A.6-6.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<div id="SHAREDIP">
<section id="appendix-A.7">
        <h3 id="name-advertising-bgp-car-routes-">
<a href="#appendix-A.7" class="section-number selfRef">A.7. </a><a href="#name-advertising-bgp-car-routes-" class="section-name selfRef">Advertising BGP CAR Routes for Shared IP Addresses</a>
        </h3>
<span id="name-bgp-car-advertisements-for-"></span><div id="HSHIPUSECASE">
<figure id="figure-12">
          <div class="alignLeft art-text artwork" id="appendix-A.7-1.1">
<pre>
          +-------------+      +--------------+
          |             |      |         +----|
          |             |------|         | E2 |(IP1)
          |----+        |      |         +----|
          | E1 |        |      |  Domain 2    |
          |----+        |      +--------------+
          |             |      +--------------+
          |             |      |         +----|
          |  Domain 1   |------|         | E3 |(IP1)
          +-------------+      |         +----|
                               |  Domain 3    |
                               +--------------+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-bgp-car-advertisements-for-" class="selfRef">BGP CAR Advertisements for Shared IP Addresses</a>
          </figcaption></figure>
</div>
<p id="appendix-A.7-2">This example describes a case where a route for the same transport
        IP address is originated from multiple nodes in different network
        domains.<a href="#appendix-A.7-2" class="pilcrow">¶</a></p>
<p id="appendix-A.7-3">One use of this scenario is an anycast transport service, where packet 
        encapsulation (e.g., LSP) may terminate on any one among a set of nodes. All the 
        nodes are capable of forwarding the inner payload, typically via an IP lookup in 
        the global table for Internet routes.<a href="#appendix-A.7-3" class="pilcrow">¶</a></p>
<p id="appendix-A.7-4">A couple of variations of the use case are described in the example below.<a href="#appendix-A.7-4" class="pilcrow">¶</a></p>
<p id="appendix-A.7-5">One node is shown in each domain, but there will be multiple nodes in practice
        for redundancy.<a href="#appendix-A.7-5" class="pilcrow">¶</a></p>
<p id="appendix-A.7-6">Example 1: Anycast with forwarding to nearest egress:<a href="#appendix-A.7-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.7-7.1">
            <p id="appendix-A.7-7.1.1">Both E2 (in egress domain 2) and E3 (in egress domain 3) advertise 
          Anycast (shared) IP (IP1, C1) with same label L1.<a href="#appendix-A.7-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-7.2">
            <p id="appendix-A.7-7.2.1">An ingress PE E1 receives by default the best path(s) for (IP1, C1) 
          propagated through BGP hops across the network.<a href="#appendix-A.7-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-7.3">
            <p id="appendix-A.7-7.3.1">The paths to (IP1, C1) from E2 and E3 may merge at a common node 
          along the path to E1, forming equal cost multipaths or active-backup paths 
          at that node.<a href="#appendix-A.7-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-7.4">
            <p id="appendix-A.7-7.4.1">Service route V/v is advertised from egress domains D2 and D3 with color
          C1 and next hop IP1.<a href="#appendix-A.7-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-7.5">
            <p id="appendix-A.7-7.5.1">Traffic for V/v steered at E1 via (IP1, C1) is forwarded to
            either E2 or E3 (or both) as determined by routing along the
            network (nodes in the path).<a href="#appendix-A.7-7.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.7-8">Example 2: Anycast with egress domain visibility at ingress PE:<a href="#appendix-A.7-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.7-9.1">
            <p id="appendix-A.7-9.1.1">E2 advertises (IP1, C1) and E3 advertises (IP1, C2) CAR routes for the 
          Anycast IP IP1. C1 and C2 are colors assigned to distinguish the egress 
          domains originating the routes to IP1.<a href="#appendix-A.7-9.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-9.2">
            <p id="appendix-A.7-9.2.1">An ingress PE E1 receives the best path(s) propagated through BGP hops 
          across the network for both (IP1, C1) and (IP1, C2).<a href="#appendix-A.7-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-9.3">
            <p id="appendix-A.7-9.3.1">The CAR routes (IP1, C1) and (IP1, C2) do not get merged at any 
          intermediate node, providing E1 control over path selection and load-balancing
          of traffic across these two routes. Each route may itself provide multipathing 
          or anycast to a set of egress nodes.<a href="#appendix-A.7-9.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-9.4">
            <p id="appendix-A.7-9.4.1">Service route V/v advertised from egress domains D2 and D3 with colors
          C1 and C2, respectively, but with same next hop IP1.<a href="#appendix-A.7-9.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-9.5">
            <p id="appendix-A.7-9.5.1">E1 will resolve and steer V/v path from D2 via (IP1, C1) and path from 
          D3 via (IP2, C2). E1 will load-balance traffic to V/v across the two paths 
          as determined by a local load-balancing policy.<a href="#appendix-A.7-9.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-9.6">
            <p id="appendix-A.7-9.6.1">Traffic for colored service routes steered at E1 is forwarded to either E2 
          or E3 (or load-balanced across both) as determined by E1.<a href="#appendix-A.7-9.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.7-10">In above example, D2 and D3 belonged to the same color or
        administrative domain. If D2 and D3 belong to different color domains,
        the domains will coordinate the assignment of colors with shared IP
        IP1 so that they do not cause conflicts.  For instance, in Example
        1:<a href="#appendix-A.7-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.7-11.1">
            <p id="appendix-A.7-11.1.1">D2 and D3 may both use C1 for the same intent when they originate CAR route for IP1.<a href="#appendix-A.7-11.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.7-11.1.2.1">
                <p id="appendix-A.7-11.1.2.1.1">In this case, neither D2 nor D3 will reuse C1 for some
                other intent.<a href="#appendix-A.7-11.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-A.7-11.2">
            <p id="appendix-A.7-11.2.1">Alternatively, D2 may use C2 and D3 may use C3 for originating
            a CAR route for IP1 for the same intent.<a href="#appendix-A.7-11.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.7-11.2.2.1">
                <p id="appendix-A.7-11.2.2.1.1">In this case, D2 will not use C3 for originating CAR route
                for IP1 for some other intent. Similarly, D3 will not use C2
                for originating CAR route for IP1 for some other intent.<a href="#appendix-A.7-11.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="ColorMapping">
<section id="appendix-B">
      <h2 id="name-color-mapping-illustrations">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-color-mapping-illustrations" class="section-name selfRef">Color Mapping Illustrations</a>
      </h2>
<p id="appendix-B-1">
      There are a variety of deployment scenarios that arise when different
      color mappings are used in an inter-domain environment. This section
      attempts to enumerate them and provide clarity into the usage of the
      color-related protocol constructs.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<section id="appendix-B.1">
        <h3 id="name-single-color-domain-contain">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-single-color-domain-contain" class="section-name selfRef">Single Color Domain Containing Network Domains with N:N Color
        Distribution</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1">
            <p id="appendix-B.1-1.1.1">All network domains (ingress, egress, and all transit domains)
            are enabled for the same N colors.<a href="#appendix-B.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1.2.1">
                <p id="appendix-B.1-1.1.2.1.1">A color may of course be realized by different
                technologies in different domains as described above.<a href="#appendix-B.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-B.1-1.2">
            <p id="appendix-B.1-1.2.1">The N intents are both signaled end-to-end via BGP CAR routes,
            as well as realized in the data plane.<a href="#appendix-B.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-1.3">
            <p id="appendix-B.1-1.3.1">
          <a href="#SFAUSECASE" class="auto internal xref">Appendix A.1</a> is an example of this case.<a href="#appendix-B.1-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<div id="APPENDIXNM">
<section id="appendix-B.2">
        <h3 id="name-single-color-domain-containi">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-single-color-domain-containi" class="section-name selfRef">Single Color Domain Containing Network Domains with N:M Color Distribution</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.2-1.1">
            <p id="appendix-B.2-1.1.1">
          Certain network domains may not be enabled for some of the
          colors used for end-to-end intents, but may still be required to provide 
          transit for routes of those colors.<a href="#appendix-B.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.2">
            <p id="appendix-B.2-1.2.1">
          When a (E, C1) route traverses a domain where color C1 is not
          available, the operator may decide to use a different intent of color
          C2 that is available in that domain to resolve the next hop and establish
          a path through the domain.<a href="#appendix-B.2-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-1.2.2.1">
                <p id="appendix-B.2-1.2.2.1.1">
            The next-hop resolution may occur via paths of any intra-domain
            protocol or even via paths provided by BGP CAR.<a href="#appendix-B.2-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-1.2.2.2">
                <p id="appendix-B.2-1.2.2.2.1">
            The next-hop resolution color C2 may be defined as a local policy at
            ingress or transit nodes of the domain.<a href="#appendix-B.2-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-1.2.2.3">
                <p id="appendix-B.2-1.2.2.3.1">
            It may also be automatically signaled from egress border nodes by
            attaching a Color-EC with value C2 to the BGP CAR routes.<a href="#appendix-B.2-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-B.2-1.3">
            <p id="appendix-B.2-1.3.1">
          Hence, routes of N end-to-end colors may be resolved over paths from a smaller 
          set of M colors in a transit domain, while preserving the original
          color awareness end-to-end.<a href="#appendix-B.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.4">
            <p id="appendix-B.2-1.4.1">
          Any ingress PE that installs a service (VPN) route with a color C1
          must have C1 enabled locally to install IP routes to (E, C1) and
          resolve the service route's next hop.<a href="#appendix-B.2-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-1.5">
            <p id="appendix-B.2-1.5.1">
          A degenerate variation of this scenario is where a transit domain does
          not support any color. <a href="#SHDFAUSECASE" class="auto internal xref">Appendix A.3</a> describes an example 
          of this case.<a href="#appendix-B.2-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-B.2-2">Illustration for N end-to-end intents over fewer M intra-domain intents:<a href="#appendix-B.2-2" class="pilcrow">¶</a></p>
<span id="name-nm-illustration"></span><div id="NMUSECASE">
<figure id="figure-13">
          <div class="alignLeft art-text artwork" id="appendix-B.2-3.1">
<pre>
                     RD:V/v via E2 Color-EC: 100
                     RD:W/w via E2 Color-EC: 200
          +-----+    RD:X/x via E2 Color-EC: 300     +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;........
  :       +-----+    RD:Y/y via E2 Color-EC: 400     +-----+          :
  :                                                                   :
  :                                                                   :
  :                                                                   :
+-:---------------------+---------------------+----------------------:-+
| :                     |                     |                      : |
|                       |                     |                        |
|     (E2,100) via 121  |   (E2,100) via 231  |     (E2,100) via E2    |
|      Color-EC: 1,10   |    Color-EC: 1,10   |      Color-EC: 1,10    |
|                       |                     |                        |
|     (E2,200) via 121  |   (E2,200) via 231  |     (E2,200) via E2    |
|      Color-EC: 1,20   |    Color-EC: 1,20   |      Color-EC: 1,20    |
|                     &lt;---                  &lt;----                      |
|     (E2,300) via 121  |   (E2,300) via 231  |     (E2,300) via E2    |
|      Color-EC: 2,30   |    Color-EC: 2,30   |      Color-EC: 2,30    |
|                       |                     |                        |
|     (E2,400) via 121  |   (E2,400) via 231  |     (E2,400) via E2    |
|      Color-EC: 2,40   |    Color-EC: 2,40   |      Color-EC: 2,40    |
|                       |                     |                        |
|                     +===+                 +===+                      |
|====+                |   |-------C10-------|   |                +=====|
|    |-------C1-------|   |-------C20-------|   |-------C1-------|     |
| E1 |                |121|                 |231|                | E2  |
|    |-------C2-------|   |-------C30-------|   |-------C2-------|     |
|====+                |   |-------C40-------|   |                +=====|
|                     +===+                 +===+                      |
|       C1=FA132        |      C10=FA128      |       C1=FA132         |
|       C2=FA133        |      C20=FA129      |       C2=FA133         |
|                       |      C30=FA130      |                        |
|                       |      C40=FA131      |                        |
|                       |                     |                        |
|        IS-IS SR       |      IS-IS SR       |     IS-IS SR           |
|        ACCESS         |       CORE          |     ACCESS             |
+-----------------------+---------------------+------------------------+
 iPE                  iABR                  eABR                    ePE
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-nm-illustration" class="selfRef">N:M Illustration</a>
          </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.1">
            <p id="appendix-B.2-4.1.1">The following description applies to the reference topology above:<a href="#appendix-B.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.1.2.1">
                <p id="appendix-B.2-4.1.2.1.1">Core domain provides 4 intra-domain intents as described below:<a href="#appendix-B.2-4.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.1.2.1.2.1">
                    <p id="appendix-B.2-4.1.2.1.2.1.1">FA128 mapped to C10,<a href="#appendix-B.2-4.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.1.2.2">
                    <p id="appendix-B.2-4.1.2.1.2.2.1">FA129 mapped to C20,<a href="#appendix-B.2-4.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.1.2.3">
                    <p id="appendix-B.2-4.1.2.1.2.3.1">FA130 mapped to C30, and<a href="#appendix-B.2-4.1.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.1.2.4">
                    <p id="appendix-B.2-4.1.2.1.2.4.1">FA131 mapped to C40.<a href="#appendix-B.2-4.1.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-B.2-4.1.2.2">
                <p id="appendix-B.2-4.1.2.2.1">Access domain provides the following 2 intra-domain intents:<a href="#appendix-B.2-4.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.1.2.2.2.1">
                    <p id="appendix-B.2-4.1.2.2.2.1.1">FA132 mapped to C1, and<a href="#appendix-B.2-4.1.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.2.2.2">
                    <p id="appendix-B.2-4.1.2.2.2.2.1">FA133 mapped to C2.<a href="#appendix-B.2-4.1.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-B.2-4.1.2.3">
                <p id="appendix-B.2-4.1.2.3.1">Operator defines the following 4 BGP CAR end-to-end intents as below:<a href="#appendix-B.2-4.1.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.1.2.3.2.1">
                    <p id="appendix-B.2-4.1.2.3.2.1.1">CAR color C100 that resolves on C1 in access and C10 in Core domain,<a href="#appendix-B.2-4.1.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.3.2.2">
                    <p id="appendix-B.2-4.1.2.3.2.2.1">CAR color C200 that resolves on C1 in access and C20 in Core domain,<a href="#appendix-B.2-4.1.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.3.2.3">
                    <p id="appendix-B.2-4.1.2.3.2.3.1">CAR color C300 that resolves on C2 in access and C30 in Core domain, and<a href="#appendix-B.2-4.1.2.3.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="appendix-B.2-4.1.2.3.2.4">
                    <p id="appendix-B.2-4.1.2.3.2.4.1">CAR color C400 that resolves on C2 in access and C40 in Core domain.<a href="#appendix-B.2-4.1.2.3.2.4.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="appendix-B.2-4.1.2.4">
                <p id="appendix-B.2-4.1.2.4.1">E2 may originate BGP CAR routes with multiple BGP Color-ECs
                as shown above.  At each hop, CAR route's next hop is resolved
                over the available intra-domain color. For example (E2, C100)
                with BGP Color-ECs C1, C10 resolves over C1 at ABR 231, C10 at
                ABR 121, and C1 at E1.<a href="#appendix-B.2-4.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-4.1.2.5">
                <p id="appendix-B.2-4.1.2.5.1">Egress PE E2 advertises a VPN route RD:V/v colored with BGP Color-EC C100 to 
            steer traffic through Flex-Algo 132 in access and Flex-Algo 128 in core. It also advertises
            another VPN route RD:W/w colored with BGP Color-EC C200 to steer traffic through 
            Flex-Algo 132 in access and Flex-Algo 129 in core.<a href="#appendix-B.2-4.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-B.2-4.2">
            <p id="appendix-B.2-4.2.1">Important:<a href="#appendix-B.2-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-4.2.2.1">
                <p id="appendix-B.2-4.2.2.1.1"> End-to-end (BGP CAR) colors can be decoupled from intra-domain transport colors.<a href="#appendix-B.2-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-4.2.2.2">
                <p id="appendix-B.2-4.2.2.2.1">Each end-to-end BGP CAR color is a combination of various intra-domain colors or intents.<a href="#appendix-B.2-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-4.2.2.3">
                <p id="appendix-B.2-4.2.2.3.1">Combination can be expressed by local policy at ABRs or by attaching 
            multiple BGP Color-ECs at origination point of BGP CAR route.<a href="#appendix-B.2-4.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-4.2.2.4">
                <p id="appendix-B.2-4.2.2.4.1">Service traffic is steered into suitable CAR color to use the most granular intent
            in a domain multiple hops away from ingress PE.<a href="#appendix-B.2-4.2.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-B.2-4.2.2.5">
                <p id="appendix-B.2-4.2.2.5.1">Consistent reuse of standard color-based resolution mechanism at both service and 
     transport layers.<a href="#appendix-B.2-4.2.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="APPENDIXMCD">
<section id="appendix-B.3">
        <h3 id="name-multiple-color-domains">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-multiple-color-domains" class="section-name selfRef">Multiple Color Domains</a>
        </h3>
<p id="appendix-B.3-1">When the routes are distributed between domains with different
        color-to-intent mapping schemes, both N:N and N:M cases are possible.
        Although an N:M mapping is more likely to occur.<a href="#appendix-B.3-1" class="pilcrow">¶</a></p>
<p id="appendix-B.3-2">Reference topology:<a href="#appendix-B.3-2" class="pilcrow">¶</a></p>
<span id="name-multiple-color-domains-2"></span><div id="MCD">
<figure id="figure-14">
          <div class="alignLeft art-text artwork" id="appendix-B.3-3.1">
<pre>
   D1 ----- D2 ----- D3
   C1       C2       C3
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-multiple-color-domains-2" class="selfRef">Multiple Color Domains</a>
          </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="appendix-B.3-4.1">
            <p id="appendix-B.3-4.1.1">C1 in D1 maps to C2 in D2 and to C3 in D3.<a href="#appendix-B.3-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-4.2">
            <p id="appendix-B.3-4.2.1">BGP CAR is enabled in all three color domains.<a href="#appendix-B.3-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-B.3-5">
          The reference topology above is used to elaborate on the design
          described in <a href="#SDIFFCOLORS" class="auto internal xref">Section 2.8</a><a href="#appendix-B.3-5" class="pilcrow">¶</a></p>
<p id="appendix-B.3-6">
          When the route originates in color domain D1 and gets advertised
          to a different color domain D2, the following procedures apply:<a href="#appendix-B.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.3-7.1">
            <p id="appendix-B.3-7.1.1">The NLRI of the BGP CAR route is preserved end to end (i.e.,
            route is (E, C1)).<a href="#appendix-B.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-7.2">
            <p id="appendix-B.3-7.2.1">A BR of D1 attaches LCM-EC with value C1 when advertising to a
            BR in D2.<a href="#appendix-B.3-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-7.3">
            <p id="appendix-B.3-7.3.1">A BR in D2 receiving (E, C1) maps C1 in received LCM-EC to
            local color, say C2.<a href="#appendix-B.3-7.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.3-7.3.2.1">
                <p id="appendix-B.3-7.3.2.1.1">A BR in D2 may receive (E, C1) from multiple D1 BRs, which provide 
          equal cost or primary/backup paths.<a href="#appendix-B.3-7.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-B.3-7.4">
            <p id="appendix-B.3-7.4.1">
       Within D2, this LCM-EC value of C2 is used instead of the Color in
    CAR route NLRI (E, C1). This applies to all procedures described in the
    earlier section for a single color domain, such as next-hop resolution and
    service steering.<a href="#appendix-B.3-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-7.5">
            <p id="appendix-B.3-7.5.1">
       A colored service route V/v originated in color domain D1 with next hop E
    and Color-EC C1 will also have its Color-EC value re-mapped
    to C2, typically at a service RR.<a href="#appendix-B.3-7.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-7.6">
            <p id="appendix-B.3-7.6.1">
       On an ingress PE in D2, V/v will resolve via C2.<a href="#appendix-B.3-7.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.3-7.7">
            <p id="appendix-B.3-7.7.1">
          When a BR in D2 advertises the route to a BR in D3, the same process
          repeats.<a href="#appendix-B.3-7.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="SRv6ILLUS">
<section id="appendix-C">
      <h2 id="name-car-srv6-illustrations">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-car-srv6-illustrations" class="section-name selfRef">CAR SRv6 Illustrations</a>
      </h2>
<div id="SECLOCHBYH">
<section id="appendix-C.1">
        <h3 id="name-bgp-car-srv6-locator-reacha">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-bgp-car-srv6-locator-reacha" class="section-name selfRef">BGP CAR SRv6 Locator Reachability Hop-by-Hop Distribution</a>
        </h3>
<div id="SRv6LOCHopByHOP">
<figure id="figure-15">
          <div class="alignLeft art-text artwork" id="appendix-C.1-1.1">
<pre>
                            RD:V/v via E2
           +-----+          SRv6SID=B:C11:2:DT4::     +-----+
    ...... |S-RR1| &lt;..................................|S-RR2| &lt;.....
   :       +-----+                                    +-----+       :
   :                                                                :
   :                                                                :
   :             AS2                                         AS1    :
 +-:------------------------------------+            +--------------:--+
 | :                                    |            |              :  |
 | :                 B:C11::/32 via IP1 |            |              :  |
 | :          +-----+ LCM=C1, AIGP=10   |            |              :  |
 | :          |T-RR |&lt;..............    |            |              :  |
 | :          +-----+&lt;..........     :  |            |              :  |
 | :             :    B:C11::/32 :   :  |            |              :  |
 | :             :       via IP2 :   :  |            |              :  |
 | :             : LCM=C1,AIGP=10:   :  |            |              :  |
 | :   ......... :               :   :  | B:C11::/32 |              :  |
 | : :           :               :   :  | via 231    |           +-----|
 | : :           :               :   :  |  LCM=C1    |           | E2  |
   : :    +---+  :   +---+       :   :  |  AIGP=10   |           +-----|
 | : :    |P11|&lt;.:..&gt;|P13|       :  +----+        +---+             :  |
 | : :    +---+  :   +---+       :  | 121|-----IP1|231|             :  |
 | V V           :               :  +----+  eBGP  +---+             :  |
 |----+          :               :      |            |           +-----|
 | E1 |   +---+  :   +---+       :      |            |           | En  |
 |----+   |P12|&lt;.:..&gt;|P14|       :      |            |           +-----|
 |        +---+      +---+       :  +----+  eBGP  +---+                |
 |        IPv6 FIB:              ...| 122|-----IP2|232|                |
 |        B:C11::/32 via IP1        +----+        +---+                |
 |                   via IP2            | B:C11::/32 |                 |
 |                                      | via 232    |                 |
 |                                      | LCM=C1     |                 |
 |                                      | AIGP=10    |                 |
 |         IS-ISv6                      |            |     IS-ISv6     |
 |  FA128 (B:C12::/32)                  |            |FA128(B:C11::/32)|
 |  FA0    (B:02::/32)                  |            |FA0  (B:01::/32) |
 +--------------------------------------+            +-----------------+
 iPE                                  ASBR          ASBR             ePE
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a></figcaption></figure>
</div>
<p id="appendix-C.1-2">The topology above is an example to illustrate the BGP CAR SRv6
        locator prefix route-based design (<a href="#SECRTDSSID" class="auto internal xref">Section 7.1.1</a>) with
        hop-by-hop IPv6 routing within and between domains.<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.1-3.1">
            <p id="appendix-C.1-3.1.1">Multi-AS network with eBGP CAR session between ASBRs.<a href="#appendix-C.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.2">
            <p id="appendix-C.1-3.2.1">Transport RR (T-RR) peers with P, BR, and PE clients within an AS to propagate 
              CAR prefixes. ADD-PATH is enabled to propagate multiple paths.<a href="#appendix-C.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.3">
            <p id="appendix-C.1-3.3.1">IS-IS (IGP) Flex-Algo 128 for SRv6 is running in each AS (AS may consist 
              of multiple IGP domains), where the following steps apply:<a href="#appendix-C.1-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.1-3.3.2.1">
                <p id="appendix-C.1-3.3.2.1.1">Prefix B:C11::/32 summarizes Flex-Algo 128 block in AS1 for the given 
                intent. Node locators in the egress domain are sub-allocated from the 
                block for the given intent.<a href="#appendix-C.1-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.1-3.3.2.2">
                <p id="appendix-C.1-3.3.2.2.1">Similarly, Prefix B:C12::/32 summarizes Flex-Algo 128 block in AS2.<a href="#appendix-C.1-3.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.1-3.3.2.3">
                <p id="appendix-C.1-3.3.2.3.1">Per Flex-Algo external subnets for eBGP next hops IP1 and IP2 are 
                distributed in IS-IS within AS2.<a href="#appendix-C.1-3.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-C.1-3.4">
            <p id="appendix-C.1-3.4.1">BGP CAR prefix route B:C11::/32 with LCM C1 is originated by AS1 
              BRs 231 and 232 on eBGP sessions to AS2 BRs 121 and 122.<a href="#appendix-C.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.5">
            <p id="appendix-C.1-3.5.1">ASBR 121 and 122 propagate the route in AS2 to all the P, ABRs, and PEs 
              through T-RR.<a href="#appendix-C.1-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.6">
            <p id="appendix-C.1-3.6.1">Every router in AS2 resolves BGP CAR prefix B:C11::/32 next hops 
              IP1 and IP2 in IS-ISv6 Flex-Algo 128 and programs B:C11::/32 prefix in global 
              IPv6 forwarding table.<a href="#appendix-C.1-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.7">
            <p id="appendix-C.1-3.7.1">AIGP attribute influences BGP CAR route best path decision.<a href="#appendix-C.1-3.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.8">
            <p id="appendix-C.1-3.8.1">Egress PE E2 advertises a VPN route RD:V/v with SRv6 Service 
              SID B:C11:2:DT4::. Service SID is allocated by E2 from its locator of 
              color C1 intent.<a href="#appendix-C.1-3.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.9">
            <p id="appendix-C.1-3.9.1">Ingress PE E1 learns (via service RRs S-RR1 and S-RR2) VPN route RD:V/v 
              with SRv6 SID B:C11:2:DT4::.<a href="#appendix-C.1-3.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.10">
            <p id="appendix-C.1-3.10.1">Service traffic encapsulated with SRv6 Service SID B:C11:2:DT4:: is 
              inherently steered hop by hop along IPv6 routed path to B:C11::/32 provided 
              by BGP CAR in AS2.<a href="#appendix-C.1-3.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.11">
            <p id="appendix-C.1-3.11.1">Encapsulated service traffic is inherently steered along IPv6 routed path 
              to B:C11::/32 provided by IS-ISv6 Flex-Algo 128 in AS1.<a href="#appendix-C.1-3.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-3.12">
            <p id="appendix-C.1-3.12.1">Design applies to multiple ASNs. BGP next hop is rewritten across an eBGP hop.<a href="#appendix-C.1-3.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.1-4">Important:<a href="#appendix-C.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.1-5.1">
            <p id="appendix-C.1-5.1.1">No tunneling/encapsulation on ingress PE and BRs for BGP CAR provided 
              transport.<a href="#appendix-C.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.1-5.2">
            <p id="appendix-C.1-5.2.1">Uses longest prefix match of SRv6 Service SID to BGP CAR IP prefix. 
              No mapping to labels/SIDs, instead use of simple IP-based forwarding.<a href="#appendix-C.1-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.1-6">Packet forwarding:<a href="#appendix-C.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-C.1-7">
<pre>
@E1:  IPv4 VRF V/v =&gt; H.Encaps.red &lt;B:C11:2:DT4::&gt; =&gt; Forward based
                                                      on B:C11::/32
@P*:  IPv6 table: B:C11::/32 =&gt; Forward to interface, NH
@121: IPv6 Table: B:C11::/32 =&gt; Forward to interface, NH
@231: IPv6 table: B:C11:2::/48 :: =&gt; Forward via IS-ISv6 Flex-Algo
                                     path to E2
@231: IPv6 Table B:C11:2::/48 =&gt; Forward via IS-ISv6 Flex-Algo
                                 path to E2
@E2:  My SID table B:C11:2:DT4:: =&gt; Pop the outer header and look up
                                    the inner DA in the VRF
</pre><a href="#appendix-C.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="SECSRv6LOCencap">
<section id="appendix-C.2">
        <h3 id="name-bgp-car-srv6-locator-reachab">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-bgp-car-srv6-locator-reachab" class="section-name selfRef">BGP CAR SRv6 Locator Reachability Distribution with Encapsulation</a>
        </h3>
<div id="SRv6LOCencap">
<figure id="figure-16">
          <div class="alignLeft art-text artwork" id="appendix-C.2-1.1">
<pre>
                           RD:V/v via E2
          +-----+          SRv6SID=B:C11:2:DT4::     +-----+
   ...... |S-RR1| &lt;..................................|S-RR2| &lt;.......
   :      +-----+                                    +-----+        :
   :                                                                :
   :                                                                :
   :                                                                :
+-:-----------------------+----------------------+------------------:--+
| :                       |                      |                  :  |
| :                       |                      |                  :  |
| :  B:C11::/32 via 121   |  B:C11::/32 via 231  |                  :  |
| :  SID=B:C13:121:END::  |  SID=B:C12:231:END:: |                  :  |
| :  LCM=C1,AIGP=110    +---+LCM=C1 AIGP=10    +---+                :  |
| : |-------------------|121|&lt;-----------------|231|&lt;-------------| :  |
| : V                   +---+                  +---+              | :  |
|----+                    |                      |               +-----|
| E1 |                    |                      |               | E2  |
|----+                    |                      |               +-----|
|   ^                     |                      |                  :  |
|   |                     |                      |                  :  |
|   |                     |                      |               +-----|
|   |                     |                      |               | En  |
|   |                     |                      |               +-----|
|   |                   +---+                  +---+              |    |
|   |----------------   |122|&lt;-----------------|232|&lt;-------------|    |
|                       +---+                  +---+                   |
|    B:C11::/32 via 122   |  B:C11::/32 via 232  |                     |
|    SID=B:C13:122:END::  |  SID=B:C12:232:END:: |                     |
|    LCM=C1 AIGP=120      |  LCM=C1 AIGP=20      |                     |
|                         |                      |                     |
|         IS-ISv6         |      IS-ISv6         |     IS-ISv6         |
|  FA128 (B:C13::/32)     | FA128 (B:C12::/32)   |  FA128 (B:C11::/32) |
|  FA0    (B:03::/32)     | FA0    (B:02::/32)   |  FA0   (B:01::/32)  |
+-------------------------+----------------------+---------------------+
 iPE                    iABR                    eABR                ePE
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a></figcaption></figure>
</div>
<p id="appendix-C.2-2">The topology above is an example to illustrate the BGP CAR SRv6 locator 
          prefix route-based design (<a href="#SECRTDSSID" class="auto internal xref">Section 7.1.1</a>) with intra-domain encapsulation. 
          The example shown is iBGP, but also applies to eBGP (multi-AS).<a href="#appendix-C.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.2-3.1">
            <p id="appendix-C.2-3.1.1">IGP Flex-Algo 128 is running in each domain, where:<a href="#appendix-C.2-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.2-3.1.2.1">
                <p id="appendix-C.2-3.1.2.1.1">Prefix B:C11::/32 summarizes Flex-Algo 128 block in egress domain for the 
              given intent. Node locators in the egress domain are sub-allocated from 
              the block.<a href="#appendix-C.2-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.2-3.1.2.2">
                <p id="appendix-C.2-3.1.2.2.1">Prefix B:C12::/32 summarizes Flex-Algo 128 block in transit domain.<a href="#appendix-C.2-3.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.2-3.1.2.3">
                <p id="appendix-C.2-3.1.2.3.1">Prefix B:C13::/32 summarizes Flex-Algo 128 block in ingress domain.<a href="#appendix-C.2-3.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-C.2-3.2">
            <p id="appendix-C.2-3.2.1">BGP CAR route B:C11::/32 is originated by ABRs 231 and 232 with LCM C1. 
            Along the propagation path, BRs set next-hop-self and appropriately 
            update the intra-domain encapsulation information for the C1 intent.
            For example, 231 and 121 signal SRv6 SID of End behavior 
            <span>[<a href="#RFC8986" class="cite xref">RFC8986</a>]</span> allocated from their respective 
            locators for the C1 intent. (Note: IGP Flexible Algorithm is shown for intra-domain path, 
            but SR Policy may also provide the path as shown in
            <a href="#SECSRv6EC" class="auto internal xref">Appendix C.3</a>.)<a href="#appendix-C.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.2-3.3">
            <p id="appendix-C.2-3.3.1">AIGP attribute influences BGP CAR route best path decision.<a href="#appendix-C.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.2-3.4">
            <p id="appendix-C.2-3.4.1">Egress PE E2 advertises a VPN route RD:V/v with SRv6 
            Service SID B:C11:2:DT4::. Service SID is allocated by E2 from its 
            locator of color C1 intent.<a href="#appendix-C.2-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.2-3.5">
            <p id="appendix-C.2-3.5.1">Ingress PE E1 learns CAR route B:C11::/32 and VPN route RD:V/v with 
            SRv6 SID B:C11:2:DT4::.<a href="#appendix-C.2-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.2-3.6">
            <p id="appendix-C.2-3.6.1">Traffic encapsulated with SRv6 Service SID B:C11:2:DT4:: is steered 
            along IPv6 routed path provided by BGP CAR IP Prefix route to locator 
            B:C11::/32.<a href="#appendix-C.2-3.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.2-4">Important:<a href="#appendix-C.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.2-5.1">
            <p id="appendix-C.2-5.1.1">Uses longest prefix match of SRv6 Service SID to BGP CAR prefix. 
            There is no mapping labels/SIDs; there is simple IP-based forwarding instead.<a href="#appendix-C.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.2-5.2">
            <p id="appendix-C.2-5.2.1">Originating domain PE locators of the given intent can be summarized on 
            transit BGP hops eliminating per PE state on BRs.<a href="#appendix-C.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.2-6">Packet forwarding:<a href="#appendix-C.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-C.2-7">
<pre>
@E1:   IPv4 VRF V/v =&gt; H.Encaps.red &lt;B:C13:121:END::, B:C11:2:DT4::&gt;
@121: My SID table: B:C13:121:END:: =&gt; Update DA with B:C11:2:DT4::
@121: IPv6 Table: B:C11::/32 =&gt; H.Encaps.red &lt;B:C12:231:END::&gt;
@231: My SID table: B:C12:231:END:: =&gt; Remove IPv6 header;
                                       Inner DA B:C11:2:DT4::
@231: IPv6 Table B:C11:2::/48 =&gt; Forward via IS-ISv6 Flex-Algo
                                 path to E2
@E2: My SID table B:C11:2:DT4:: =&gt; Pop the outer header and look up
                                   the inner DA in the VRF
</pre><a href="#appendix-C.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="SECSRv6EC">
<section id="appendix-C.3">
        <h3 id="name-bgp-car-e-c-route-distribut">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-bgp-car-e-c-route-distribut" class="section-name selfRef">BGP CAR (E, C) Route Distribution for Steering Non-Routed Service SID</a>
        </h3>
<div id="SRv6EC">
<figure id="figure-17">
          <div class="alignLeft art-text artwork" id="appendix-C.3-1.1">
<pre>
                          RD:V/v via E2
         +-----+          SRv6SID: B:01:2:DT4::     +-----+
  ...... |S-RR1| &lt;..................................|S-RR2| &lt;.......
  :      +-----+             Color C2               +-----+        :
  :                                                                :
  :                  +-----+ (E2,C2) via 231                       :
  : -----------------|T-RR |-------------------|                   :
  :|                 +-----+  SID=B:C21:2:B6:: |                   :
+-:|---------------------+---------------------|+------------------:--+
| :|                     |                     ||                  :  |
| :|                     |                     ||                  :  |
| :|  B:C21::/32 via 121 |  B:C21::/32 via 231 ||SR Policy(E2,C2)  :  |
| :|  LCM=C2,AIGP=110    |  LCM=C2 AIGP=10     ||BSID=B:C21:2:B6:: :  |
| :|                   +---+                  +---+                :  |
| :|-------------------|121|&lt;-----------------|231|&lt;-------------| :  |
| :V SR Policy(121,C2) +---+SR Policy(231,C2) +---+              | :  |
|----+                   |                      |               +-----|
| E1 |                   |                      |               | E2  |
|----+                   |                      |               +-----|
|  ^ SR Policy(122,C2) +---+SR Policy(232,C2) +---+              |    |
|  |----------------   |122|&lt;-----------------|232|&lt;-------------|    |
|    B:C21::/32 via 121+---+B:C21::/32 via 232+---+ SR Policy(E2,C2)  |
|    LCM=C2,AIGP=120     |   LCM=C2 AIGP=20     |   BSID=B:C21:2:B6:: |
|                        |                      |                     |
|        IS-ISv6         |      IS-ISv6         |     IS-ISv6         |
|     FA0 (B:03::/32)    |   FA0 (B:02::/32)    |   FA0(B:01::/32)    |
+------------------------+----------------------+---------------------+
 iPE                    iABR                   eABR                ePE
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a></figcaption></figure>
</div>
<p id="appendix-C.3-2">The topology above is an example to illustrate the BGP CAR (E, C)
        route-based design (<a href="#SECNRSSID" class="auto internal xref">Section 7.1.2</a>). The example is iBGP,
        but the design also applies to eBGP (multi-AS).<a href="#appendix-C.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-3.1">
            <p id="appendix-C.3-3.1.1">SR Policy (E2, C2) provides given intent in egress domain.<a href="#appendix-C.3-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-3.1.2.1">
                <p id="appendix-C.3-3.1.2.1.1">SR Policy (E2, C2) with segments  &lt;B:01:z:END::, B:01:2:END::&gt;,
              where z is the node id in egress domain.<a href="#appendix-C.3-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-C.3-3.2">
            <p id="appendix-C.3-3.2.1">Egress ABRs 231 and 232 redistribute SR Policy into BGP CAR Type-1 NLRI
            (E2, C2) to other domains, with SRv6 SID of End.B6 behavior. This route is 
            propagated to ingress PEs through T-RR or inline through BRs (121 and 122) 
            with next-hop-unchanged.<a href="#appendix-C.3-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-3.3">
            <p id="appendix-C.3-3.3.1">The ABRs also advertise BGP CAR prefix route (B:C21::/32) summarizing locator 
            part of SRv6 SIDs for SR policies of given intent to different PEs in 
            egress domain. BGP CAR prefix route propagates through BRs. 
            At each BGP hop, BGP CAR prefix next-hop resolution triggers intra-domain 
            transit SR Policy (C2, CAR next hop). For example:<a href="#appendix-C.3-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-3.3.2.1">
                <p id="appendix-C.3-3.3.2.1.1">SR Policy (231, C2) with segments &lt;B:02:y:END::, B:02:231:END::&gt;, and<a href="#appendix-C.3-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.3-3.3.2.2">
                <p id="appendix-C.3-3.3.2.2.1">SR Policy (121, C2) with segments &lt;B:03:x:END::, B:03:121:END::&gt;,<a href="#appendix-C.3-3.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-C.3-3.3.2.3">
                <p id="appendix-C.3-3.3.2.3.1">where x and y are node ids within the respective domains.<a href="#appendix-C.3-3.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-C.3-3.4">
            <p id="appendix-C.3-3.4.1">Egress PE E2 advertises a VPN route RD:V/v with Color-EC C2.<a href="#appendix-C.3-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-3.5">
            <p id="appendix-C.3-3.5.1">Ingress PE E1 steers VPN route from E2 onto BGP CAR route (E2, C2) that 
            results in H.Encaps.red of SRv6 transport SID B:C21:2:B6:: and SRv6 Service SID 
            as last segment in IPv6 header.<a href="#appendix-C.3-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-3.6">
            <p id="appendix-C.3-3.6.1">IPv6 destination B:C21:2:B6:: match on CAR prefix B:C21::/32 that
            steers the packet into intra-domain (intent-aware) SR Policy on ingress PE E1 
            and ABR 121.<a href="#appendix-C.3-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-3.7">
            <p id="appendix-C.3-3.7.1">IPv6 packet destination B:C21:2:B6:: lookup in mySID table on ABR 
            231 or 232 results in END.B6 behavior (i.e., push of policy segments to E2).<a href="#appendix-C.3-3.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.3-4">Important:<a href="#appendix-C.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-5.1">
            <p id="appendix-C.3-5.1.1">Ingress PE steers services via (E, C) CAR route as per 
            <span>[<a href="#RFC9256" class="cite xref">RFC9256</a>]</span>.<a href="#appendix-C.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-5.2">
            <p id="appendix-C.3-5.2.1">In data plane (E, C), resolution results in IPv6 header destination being 
            SRv6 SID of END.B6 behavior whose locator is of given intent on 
            originating ABRs.<a href="#appendix-C.3-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-5.3">
            <p id="appendix-C.3-5.3.1">CAR IP Prefix route along the transit path provides simple Longest Prefix Match (LPM) IPv6 forwarding 
            along the transit BGP hops.<a href="#appendix-C.3-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.3-5.4">
            <p id="appendix-C.3-5.4.1">CAR NLRI Type-2 prefix summarizes binding SIDs of all SR policies on 
            originating ABR of a given intent to different PEs in egress domain. 
            This eliminates per PE state on transit routers.<a href="#appendix-C.3-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.3-6">Packet forwarding:<a href="#appendix-C.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-C.3-7">
<pre>
@E1:   IPv4 VRF V/v =&gt; H.Encaps.red &lt;B:C21:2:B6::, B:0:E2:DT4::&gt;
                       H.Encaps.red &lt;SR Policy (C2,121) sid list&gt;
@121: My SID table: B:03:121:END:: =&gt; Remove outer IPv6 header;
                                      Inner DA B:C21:2:B6::
@121: IPv6 Table: B:C21::/32 =&gt; H.Encaps.red &lt;SR Policy (C2,231) sid
                                                                list&gt;
@231: My SID table: B:02:231:END:: =&gt; Remove outer IPv6 header;
                                      Inner DA B:C21:2:B6::

@231: MySIDtable B:C21:2:B6:: =&gt; H.Encaps.red &lt;SR Policy (C2,E2) sid
                                                                list&gt;
@E2: IPv6 Table B:0:2:DT4:: =&gt; Pop the outer header and look up the
                               inner DA in the VRF
</pre><a href="#appendix-C.3-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="UPDATEPACKING">
<section id="appendix-D">
      <h2 id="name-car-safi-nlri-update-packin">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-car-safi-nlri-update-packin" class="section-name selfRef">CAR SAFI NLRI Update Packing Efficiency Calculation</a>
      </h2>
<p id="appendix-D-1">
      CAR SAFI NLRI encoding is optimized for update packing. It allows 
      per-route information (for example, label, label index, and SRv6 SID encapsulation data) to be 
      carried in the non-key TLV part of NLRI. This allows multiple NLRIs to be packed in a
      single update message when other attributes (including LCM-EC, when present) are shared. 
      The table below shows a theoretical analysis calculated from observed BGP update message 
      size in operational networks. It compares total BGP data on the wire for CAR SAFI against encoding as specified in [RFC8277] in the following cases: an MPLS label (CASE A), an SR extension with MPLS
   (per-prefix label index in Prefix-SID attribute; see [RFC8669]) (CASE B), and
   an SRv6 SID (CASE C).
      The packing scenarios considered are as follows:<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D-2.1">the ideal case (where the maximum number of routes are packed to the update message
 limit of 4k bytes),<a href="#appendix-D-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-D-2.2">the practical case of average packing (where 5 routes share a set
 of BGP path attributes, and hence are packed in a single update
 message), and<a href="#appendix-D-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-D-2.3">the worst case of no packing (where each route is in a separate update message).<a href="#appendix-D-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<span id="name-summary-of-the-ideal-practi"></span><div id="UPFIGURE">
<table class="center" id="table-5">
        <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-summary-of-the-ideal-practi" class="selfRef">Summary of the Ideal, Practical, and Worst Cases of Packing BGP Data</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Encoding</th>
            <th class="text-left" rowspan="1" colspan="1">BGP CAR NLRI</th>
            <th class="text-left" rowspan="1" colspan="1">NLRI as per <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>
</th>
            <th class="text-left" rowspan="1" colspan="1">Result</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th class="text-left" rowspan="1" colspan="4">CASE A: Label</th>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Ideal)</td>
            <td class="text-left" rowspan="1" colspan="1">27.5 MB</td>
            <td class="text-left" rowspan="1" colspan="1">26 MB</td>
            <td class="text-left" rowspan="3" colspan="1">No degradation compared to encoding as specified in <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span>.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Practical)</td>
            <td class="text-left" rowspan="1" colspan="1">86 MB</td>
            <td class="text-left" rowspan="1" colspan="1">84 MB</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Worst; no packing)</td>
            <td class="text-left" rowspan="1" colspan="1">325 MB</td>
            <td class="text-left" rowspan="1" colspan="1">324 MB</td>
          </tr>
          <tr>
            <th class="text-left" rowspan="1" colspan="4">CASE B: Label &amp; Label-Index</th>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Ideal)</td>
            <td class="text-left" rowspan="1" colspan="1">42 MB</td>
            <td class="text-left" rowspan="1" colspan="1">339 MB Packing not possible</td>
            <td class="text-left" rowspan="3" colspan="1">CAR SAFI encoding is more efficient by 88% in the best case and
      71% in the average case over the encoding as specified in <span>[<a href="#RFC8277" class="cite xref">RFC8277</a>]</span> (which precludes
      packing).</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Practical)</td>
            <td class="text-left" rowspan="1" colspan="1">99 MB</td>
            <td class="text-left" rowspan="1" colspan="1">339 MB Packing not possible</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Worst; no packing)</td>
            <td class="text-left" rowspan="1" colspan="1">339 MB</td>
            <td class="text-left" rowspan="1" colspan="1">339 MB</td>
          </tr>
          <tr>
            <th class="text-left" rowspan="1" colspan="4">CASE C: SRv6 SID</th>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Ideal)</td>
            <td class="text-left" rowspan="1" colspan="1">49 MB</td>
            <td class="text-left" rowspan="1" colspan="1">378 MB Packing not possible</td>
            <td class="text-left" rowspan="3" colspan="1">Results are similar to the SR-MPLS case. Transposition provides a further 20% reduction in BGP data.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Practical)</td>
            <td class="text-left" rowspan="1" colspan="1">115 MB</td>
            <td class="text-left" rowspan="1" colspan="1">378 MB Packing not possible</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">(Worst; no packing)</td>
            <td class="text-left" rowspan="1" colspan="1">378 MB</td>
            <td class="text-left" rowspan="1" colspan="1">378 MB</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="appendix-D-4">This analysis considers 1.5 million routes (5 colors across 300k endpoints).<a href="#appendix-D-4" class="pilcrow">¶</a></p>
<p id="appendix-D-5">CASE A: BGP data exchanged for MPLS (non-SR):<a href="#appendix-D-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-D-6">
<pre>
    Consider 200 bytes of shared attributes
    CAR SAFI signals label in non-key TLV part of NLRI
       Each NLRI size for AFI 1 = 12(key) + 5(label) = 17 bytes
         Ideal packing:
          Number of NLRIs in 4k update size = 223 (4k-200/17)
          Number of update messages of 4k size = 1.5 million/223 = 6726
          Total BGP data on wire = 6726 * 4k = ~27.5 MB
         Practical packing (5 routes in update message):
          Size of update message = (17 * 5) + 200 = 285
          Total BGP data on wire = 285 * 300k = ~86 MB
         No-packing case (1 route per update message):
          Size of update message = 17 + 200 = 217
          Total BGP data on wire = 217 * 1.5 million = ~325 MB
    SAFI 128 using encoding specified in RFC 8277 with label in NLRI
       Each NLRI size for AFI 1 = 13(key) + 3(label) = 16 bytes
         Ideal packing:
          Number of NLRIs in 4k update size = 237 (4k-200/16)
          Number of update messages of 4k size = 1.5 million/237 = ~6330
          Total BGP data on wire = 6330 * 4k = ~25.9 MB
         Practical packing (5 routes in update message):
          Size of update message = (16 * 5) + 200 = 280
          Total BGP data on wire = 280 * 300k = ~84 MB
         No-packing case (1 route per update message):
          Size of update message = 16 + 200 = 216
          Total BGP data on wire = 216 * 1.5 million = ~324 MB
</pre><a href="#appendix-D-6" class="pilcrow">¶</a>
</div>
<p id="appendix-D-7">CASE B: BGP data exchanged for SR-MPLS label index:<a href="#appendix-D-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-D-8">
<pre>
    Consider 200 bytes of shared attributes
    CAR SAFI signals label index in non-key TLV part of NLRI
       Each NLRI size for AFI 1
                        = 12(key) + 5(label) + 9(Index) = 26 bytes
         Ideal packing:
          Number of NLRIs in 4k update size = 146 (4k-200/26)
          Number of update messages of 4k size = 1.5 million/146 = 6726
          Total BGP data on wire = 10274 * 4k = ~42 MB
         Practical packing (5 routes in update message)
          Size of update message = (26 * 5) + 200 = 330
          Total BGP data on wire = 330 * 300k = ~99 MB
         No-packing case (1 route per update message)
          Size of update message = 26 + 200 = 226
          Total BGP data on wire = 226 * 1.5 million = ~339 MB
    SAFI 128 using encoding specified in RFC 8277 with label in NLRI
       Each NLRI size for AFI 1 = 13(key) + 3(label) = 16 bytes
         Ideal packing:
          Not supported as label index is encoded in Prefix-SID
                                                        attribute
         Practical packing (5 routes in update message):
          Not supported as label index is encoded in Prefix-SID
                                                        attribute
         No-packing case (1 route per update message):
          Size of update message = 16 + 210 = 226
          Total BGP data on wire = 216 * 1.5 million = ~339 MB
</pre><a href="#appendix-D-8" class="pilcrow">¶</a>
</div>
<p id="appendix-D-9">CASE C: BGP data exchanged with 128 bit single SRv6 SID:<a href="#appendix-D-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-D-10">
<pre>
    Consider 200 bytes of shared attributes
    CAR SAFI signals SRv6 SID in non-key TLV part of NLRI
       Each NLRI size for AFI 1 = 12(key) + 18(SRv6 SID) = 30 bytes
         Ideal packing:
          Number of NLRIs in 4k update size = 126 (4k-200/30)
          Number of update messages of 4k size = 1.5 million/126 = ~12k
          Total BGP data on wire = 12k * 4k = ~49 MB
         Practical packing (5 routes in update message):
          Size of update message
                        = (30 * 5) + 236 (including Prefix-SID) = 386
          Total BGP data on wire = 386 * 300k = ~115 MB
         No-packing case (1 route per update message):
          Size of update message = 12 + 236 (SID in Prefix-SID) = 252
          Total BGP data on wire = 252 * 1.5 million = ~378 MB
    SAFI 128 using encoding specified in RFC 8277 with label in NLRI
    (No transposition)
       Each NLRI size for AFI 1 = 13(key) + 3(label) = 16 bytes
         Ideal packing:
          Not supported as SRv6 SID is encoded in Prefix-SID
                                                        attribute
         Practical packing (5 routes in update message):
          Not supported as SRv6 SID is encoded in Prefix-SID
                                                        attribute
         No-packing case (1 route per update message):
          Size of update message = 16 + 236 = 252
          Total BGP data on wire = 252 * 1.5 million = ~378 MB
</pre><a href="#appendix-D-10" class="pilcrow">¶</a>
</div>
<p id="appendix-D-11">BGP data exchanged with transposition of 4 bytes from SRv6 SID into SRv6 SID TLV:<a href="#appendix-D-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-D-12">
<pre>
    Consider 200 bytes of shared attributes
    CAR SAFI signals SRv6 SID in non-key TLV part of NLRI
       Each NLRI size for AFI 1 = 12(key) + 6(SRv6 SID) = 18 bytes
         Ideal packing:
          Number of NLRIs in 4k update size = 211 (4k-200/18)
          Number of update messages of 4k size = 1.5 million/211 = ~7110
          Total BGP data on wire = 7110 * 4k = ~29 MB
         Practical packing (5 routes in update message):
          Size of update message
                        = (18 * 5) + 236 (including Prefix-SID) = 326
          Total BGP data on wire = 326 * 300k = ~98 MB
         No-packing case (1 route per update message):
          Size of update message
                        = 12 + 236 (SID in Prefix-SID attribute) = 252
          Total BGP data on wire = 252 * 1.5 million = ~378 MB
</pre><a href="#appendix-D-12" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Acknowledgements">
<section id="appendix-E">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-E-1">
      The authors would like to acknowledge the invaluable contributions of
      many collaborators towards the BGP CAR solution and this document in
      providing input about use cases, participating in brainstorming and
      mailing list discussions and in reviews of the solution and draft
      revisions. In addition to the contributors listed in the Contributors
      section, the authors would like to thank <span class="contact-name">Robert       Raszuk</span>, <span class="contact-name">Bin Wen</span>, <span class="contact-name">Chaitanya       Yadlapalli</span>, <span class="contact-name">Satoru Matsushima</span>, <span class="contact-name">Moses Nagarajah</span>, <span class="contact-name">Gyan Mishra</span>,
      <span class="contact-name">Jorge Rabadan</span>, <span class="contact-name">Daniel Voyer</span>,
      <span class="contact-name">Stephane Litkowski</span>, <span class="contact-name">Hannes       Gredler</span>, <span class="contact-name">Jose Liste</span>, <span class="contact-name">Jakub       Horn</span>, <span class="contact-name">Brent Foster</span>, <span class="contact-name">Dave       Smith</span>, <span class="contact-name">Jiri Chaloupka</span>, <span class="contact-name">Miya       Kohno</span>, <span class="contact-name">Kamran Raza</span>, <span class="contact-name">Zafar       Ali</span>, <span class="contact-name">Xing Jiang</span>, <span class="contact-name">Oleksander       Nestorov</span>, <span class="contact-name">Peter Psenak</span>, <span class="contact-name">Kaliraj Vairavakkalai</span>, <span class="contact-name">Natrajan       Venkataraman</span>, <span class="contact-name">Srihari Sangli</span>, <span class="contact-name">Ran Chen</span>, and <span class="contact-name">Jingrong Xie</span>.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">The authors also appreciate the detailed reviews and astute
      suggestions provided by <span class="contact-name">Sue Hares</span> (as document
      shepherd), <span class="contact-name">Jeff Haas</span>, <span class="contact-name">Yingzhen       Qu</span>, and <span class="contact-name">John Scudder</span> that have greatly improved
      the document.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Contributors">
<section id="appendix-F">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="appendix-F-1">The following people gave substantial contributions to the content
        of this document and should be considered as coauthors:<a href="#appendix-F-1" class="pilcrow">¶</a></p>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Clarence Filsfils</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="country-name">Belgium</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cfilsfil@cisco.com" class="email">cfilsfil@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bruno Decraene</span></div>
<div dir="auto" class="left"><span class="org">Orange</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bruno.decraene@orange.com" class="email">bruno.decraene@orange.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Luay Jalil</span></div>
<div dir="auto" class="left"><span class="org">Verizon</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:luay.jalil@verizon.com" class="email">luay.jalil@verizon.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yuanchao Su</span></div>
<div dir="auto" class="left"><span class="org">Alibaba, Inc</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yitai.syc@alibaba-inc.com" class="email">yitai.syc@alibaba-inc.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jim Uttaro</span></div>
<div dir="auto" class="left"><span class="org">Individual</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:juttaro@ieee.org" class="email">juttaro@ieee.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jim Guichard</span></div>
<div dir="auto" class="left"><span class="org">Futurewei</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:james.n.guichard@futurewei.com" class="email">james.n.guichard@futurewei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ketan Talaulikar</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="country-name">India</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ketant.ietf@gmail.com" class="email">ketant.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Keyur Patel</span></div>
<div dir="auto" class="left"><span class="org">Arrcus, Inc</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:keyur@arrcus.com" class="email">keyur@arrcus.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Haibo Wang</span></div>
<div dir="auto" class="left"><span class="org">Huawei Technologies</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rainsword.wang@huawei.com" class="email">rainsword.wang@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jie Dong</span></div>
<div dir="auto" class="left"><span class="org">Huawei Technologies</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jie.dong@huawei.com" class="email">jie.dong@huawei.com</a>
</div>
</address>
<p id="appendix-F-2">Additional contributors:<a href="#appendix-F-2" class="pilcrow">¶</a></p>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dirk Steinberg</span></div>
<div dir="auto" class="left"><span class="org">Lapishills Consulting Limited</span></div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dirk@lapishills.com" class="email">dirk@lapishills.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Israel Means</span></div>
<div dir="auto" class="left"><span class="org">AT&amp;T</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:im8327@att.com" class="email">im8327@att.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Reza Rokui</span></div>
<div dir="auto" class="left"><span class="org">Ciena</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rrokui@ciena.com" class="email">rrokui@ciena.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-G">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dhananjaya Rao (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dhrao@cisco.com" class="email">dhrao@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Swadesh Agrawal (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:swaagraw@cisco.com" class="email">swaagraw@cisco.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
