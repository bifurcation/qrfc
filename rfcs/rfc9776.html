<!DOCTYPE html>
<html lang="en" class="RFC STD">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9776: Internet Group Management Protocol, Version 3</title>
<meta content="Brian Haberman" name="author">
<meta content="
       The Internet Group Management
   Protocol (IGMP) is the protocol used by IPv4 systems to
   report their IP multicast group memberships to neighboring multicast
   routers.  Version 3 of IGMP (IGMPv3) adds support for source filtering, that
   is, the ability for a system to report interest in receiving packets
   only from specific source addresses, or from all but specific
   source addresses, sent to a particular multicast address.  That
   information may be used by multicast routing protocols to avoid
   delivering multicast packets from specific sources to networks where
   there are no interested receivers. 
       This document specifies IGMPv3.  It is a revised
   version of RFC 3376 that includes
   clarifications and fixes for errata, and it is backward compatible
   with RFC 3376. 
       This document updates RFC 2236 and obsoletes RFC 3376. 
    " name="description">
<meta content="xml2rfc 3.28.0" name="generator">
<meta content="9776" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.28.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 64.1
-->
<link href="rfc9776.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-pim-3376bis-12" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9776" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9776</td>
<td class="center">IGMPv3</td>
<td class="right">March 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Haberman</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9776" class="eref">9776</a></dd>
<dt class="label-std">STD:</dt>
<dd class="std">100</dd>
<dt class="label-obsoletes">Obsoletes:</dt>
<dd class="obsoletes">
<a href="https://www.rfc-editor.org/rfc/rfc3376" class="eref">3376</a> </dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc2236" class="eref">2236</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-03" class="published">March 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Haberman, <span class="editor">Ed.</span>
</div>
<div class="org">JHU APL</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9776</h1>
<h1 id="title">Internet Group Management Protocol, Version 3</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Internet Group Management
   Protocol (IGMP) is the protocol used by IPv4 systems to
   report their IP multicast group memberships to neighboring multicast
   routers.  Version 3 of IGMP (IGMPv3) adds support for source filtering, that
   is, the ability for a system to report interest in receiving packets
   only from specific source addresses, or from all but specific
   source addresses, sent to a particular multicast address.  That
   information may be used by multicast routing protocols to avoid
   delivering multicast packets from specific sources to networks where
   there are no interested receivers.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">This document specifies IGMPv3.  It is a revised
   version of RFC 3376 that includes
   clarifications and fixes for errata, and it is backward compatible
   with RFC 3376.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">This document updates RFC 2236 and obsoletes RFC 3376.<a href="#section-abstract-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9776">https://www.rfc-editor.org/info/rfc9776</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-3">
            This document may contain material from IETF Documents or IETF
            Contributions published or made publicly available before November
            10, 2008. The person(s) controlling the copyright in some of this
            material may not have granted the IETF Trust the right to allow
            modifications of such material outside the IETF Standards Process.
            Without obtaining an adequate license from the person(s)
            controlling the copyright in such materials, this document may not
            be modified outside the IETF Standards Process, and derivative
            works of it may not be created outside the IETF Standards Process,
            except to format it for publication as an RFC or to translate it
            into languages other than English.<a href="#section-boilerplate.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-conventions-used-in-this-do" class="internal xref">Conventions Used in This Document</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-the-service-interface-for-r" class="internal xref">The Service Interface for Requesting IP Multicast Reception</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-multicast-reception-state-m" class="internal xref">Multicast Reception State Maintained by Systems</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-socket-state" class="internal xref">Socket State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-interface-state" class="internal xref">Interface State</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-message-formats" class="internal xref">Message Formats</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-membership-query-message" class="internal xref">Membership Query Message</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-max-response-code" class="internal xref">Max Response Code</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-checksum" class="internal xref">Checksum</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="auto internal xref">4.1.3</a>.  <a href="#name-group-address" class="internal xref">Group Address</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.4">
                    <p id="section-toc.1-1.4.2.1.2.4.1"><a href="#section-4.1.4" class="auto internal xref">4.1.4</a>.  <a href="#name-flags" class="internal xref">Flags</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.5">
                    <p id="section-toc.1-1.4.2.1.2.5.1"><a href="#section-4.1.5" class="auto internal xref">4.1.5</a>.  <a href="#name-s-flag-suppress-router-side" class="internal xref">S Flag (Suppress Router-Side Processing)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.6">
                    <p id="section-toc.1-1.4.2.1.2.6.1"><a href="#section-4.1.6" class="auto internal xref">4.1.6</a>.  <a href="#name-qrv-queriers-robustness-var" class="internal xref">QRV (Querier's Robustness Variable)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.7">
                    <p id="section-toc.1-1.4.2.1.2.7.1"><a href="#section-4.1.7" class="auto internal xref">4.1.7</a>.  <a href="#name-qqic-queriers-query-interva" class="internal xref">QQIC (Querier's Query Interval Code)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.8">
                    <p id="section-toc.1-1.4.2.1.2.8.1"><a href="#section-4.1.8" class="auto internal xref">4.1.8</a>.  <a href="#name-number-of-sources-n" class="internal xref">Number of Sources (N)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.9">
                    <p id="section-toc.1-1.4.2.1.2.9.1"><a href="#section-4.1.9" class="auto internal xref">4.1.9</a>.  <a href="#name-source-address-i" class="internal xref">Source Address [i]</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.10">
                    <p id="section-toc.1-1.4.2.1.2.10.1"><a href="#section-4.1.10" class="auto internal xref">4.1.10</a>. <a href="#name-additional-data" class="internal xref">Additional Data</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.11">
                    <p id="section-toc.1-1.4.2.1.2.11.1"><a href="#section-4.1.11" class="auto internal xref">4.1.11</a>. <a href="#name-query-variants" class="internal xref">Query Variants</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.12">
                    <p id="section-toc.1-1.4.2.1.2.12.1"><a href="#section-4.1.12" class="auto internal xref">4.1.12</a>. <a href="#name-ip-destination-addresses-fo" class="internal xref">IP Destination Addresses for Queries</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-igmpv3-membership-report-me" class="internal xref">IGMPv3 Membership Report Message</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-reserved" class="internal xref">Reserved</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-checksum-2" class="internal xref">Checksum</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-flags-2" class="internal xref">Flags</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.4">
                    <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="auto internal xref">4.2.4</a>.  <a href="#name-number-of-group-records-m" class="internal xref">Number of Group Records (M)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.5">
                    <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="auto internal xref">4.2.5</a>.  <a href="#name-group-record" class="internal xref">Group Record</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.6">
                    <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="auto internal xref">4.2.6</a>.  <a href="#name-record-type" class="internal xref">Record Type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.7">
                    <p id="section-toc.1-1.4.2.2.2.7.1"><a href="#section-4.2.7" class="auto internal xref">4.2.7</a>.  <a href="#name-aux-data-len" class="internal xref">Aux Data Len</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.8">
                    <p id="section-toc.1-1.4.2.2.2.8.1"><a href="#section-4.2.8" class="auto internal xref">4.2.8</a>.  <a href="#name-number-of-sources-n-2" class="internal xref">Number of Sources (N)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.9">
                    <p id="section-toc.1-1.4.2.2.2.9.1"><a href="#section-4.2.9" class="auto internal xref">4.2.9</a>.  <a href="#name-multicast-address" class="internal xref">Multicast Address</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.10">
                    <p id="section-toc.1-1.4.2.2.2.10.1"><a href="#section-4.2.10" class="auto internal xref">4.2.10</a>. <a href="#name-source-address-i-2" class="internal xref">Source Address [i]</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.11">
                    <p id="section-toc.1-1.4.2.2.2.11.1"><a href="#section-4.2.11" class="auto internal xref">4.2.11</a>. <a href="#name-auxiliary-data" class="internal xref">Auxiliary Data</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.12">
                    <p id="section-toc.1-1.4.2.2.2.12.1"><a href="#section-4.2.12" class="auto internal xref">4.2.12</a>. <a href="#name-additional-data-2" class="internal xref">Additional Data</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.13">
                    <p id="section-toc.1-1.4.2.2.2.13.1"><a href="#section-4.2.13" class="auto internal xref">4.2.13</a>. <a href="#name-group-record-types" class="internal xref">Group Record Types</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.14">
                    <p id="section-toc.1-1.4.2.2.2.14.1"><a href="#section-4.2.14" class="auto internal xref">4.2.14</a>. <a href="#name-ip-source-addresses-for-rep" class="internal xref">IP Source Addresses for Reports</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.15">
                    <p id="section-toc.1-1.4.2.2.2.15.1"><a href="#section-4.2.15" class="auto internal xref">4.2.15</a>. <a href="#name-ip-destination-addresses-for" class="internal xref">IP Destination Addresses for Reports</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.16">
                    <p id="section-toc.1-1.4.2.2.2.16.1"><a href="#section-4.2.16" class="auto internal xref">4.2.16</a>. <a href="#name-notation-for-group-records" class="internal xref">Notation for Group Records</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.17">
                    <p id="section-toc.1-1.4.2.2.2.17.1"><a href="#section-4.2.17" class="auto internal xref">4.2.17</a>. <a href="#name-membership-report-size" class="internal xref">Membership Report Size</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-description-of-the-protocol" class="internal xref">Description of the Protocol for Group Members</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-action-on-change-of-interfa" class="internal xref">Action on Change of Interface State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-action-on-reception-of-a-qu" class="internal xref">Action on Reception of a Query</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-description-of-the-protocol-" class="internal xref">Description of the Protocol for Multicast Routers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-conditions-for-igmp-queries" class="internal xref">Conditions for IGMP Queries</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-igmp-state-maintained-by-mu" class="internal xref">IGMP State Maintained by Multicast Routers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-definition-of-router-filter" class="internal xref">Definition of Router Filter Mode</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-definition-of-group-timers" class="internal xref">Definition of Group Timers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="auto internal xref">6.2.3</a>.  <a href="#name-definition-of-source-timers" class="internal xref">Definition of Source Timers</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-igmpv3-source-specific-forw" class="internal xref">IGMPv3 Source-Specific Forwarding Rules</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-action-on-reception-of-repo" class="internal xref">Action on Reception of Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="auto internal xref">6.4.1</a>.  <a href="#name-reception-of-current-state-" class="internal xref">Reception of Current-State Records</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="auto internal xref">6.4.2</a>.  <a href="#name-reception-of-filter-mode-ch" class="internal xref">Reception of Filter-Mode-Change and Source-List-Change Records</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="auto internal xref">6.5</a>.  <a href="#name-switching-router-filter-mod" class="internal xref">Switching Router Filter Modes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="auto internal xref">6.6</a>.  <a href="#name-action-on-reception-of-quer" class="internal xref">Action on Reception of Queries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6.2.1">
                    <p id="section-toc.1-1.6.2.6.2.1.1"><a href="#section-6.6.1" class="auto internal xref">6.6.1</a>.  <a href="#name-timer-updates" class="internal xref">Timer Updates</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6.2.2">
                    <p id="section-toc.1-1.6.2.6.2.2.1"><a href="#section-6.6.2" class="auto internal xref">6.6.2</a>.  <a href="#name-querier-election" class="internal xref">Querier Election</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6.2.3">
                    <p id="section-toc.1-1.6.2.6.2.3.1"><a href="#section-6.6.3" class="auto internal xref">6.6.3</a>.  <a href="#name-building-and-sending-specif" class="internal xref">Building and Sending Specific Queries</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-interoperation-with-older-v" class="internal xref">Interoperation With Older Versions of IGMP</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-query-version-distinctions" class="internal xref">Query Version Distinctions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-group-member-behavior" class="internal xref">Group Member Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="auto internal xref">7.2.1</a>.  <a href="#name-in-the-presence-of-older-ve" class="internal xref">In the Presence of Older Version Queriers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.2">
                    <p id="section-toc.1-1.7.2.2.2.2.1"><a href="#section-7.2.2" class="auto internal xref">7.2.2</a>.  <a href="#name-in-the-presence-of-older-ver" class="internal xref">In the Presence of Older Version Group Members</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-multicast-router-behavior" class="internal xref">Multicast Router Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.1">
                    <p id="section-toc.1-1.7.2.3.2.1.1"><a href="#section-7.3.1" class="auto internal xref">7.3.1</a>.  <a href="#name-in-the-presence-of-older-vers" class="internal xref">In the Presence of Older Version Queriers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.2">
                    <p id="section-toc.1-1.7.2.3.2.2.1"><a href="#section-7.3.2" class="auto internal xref">7.3.2</a>.  <a href="#name-in-the-presence-of-older-versi" class="internal xref">In the Presence of Older Version Group Members</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-list-of-timers-counters-and" class="internal xref">List of Timers, Counters, and Their Default Values</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-robustness-variable" class="internal xref">Robustness Variable</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-query-interval" class="internal xref">Query Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-query-response-interval" class="internal xref">Query Response Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-group-membership-interval" class="internal xref">Group Membership Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-other-querier-present-inter" class="internal xref">Other Querier Present Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-startup-query-interval" class="internal xref">Startup Query Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="auto internal xref">8.7</a>.  <a href="#name-startup-query-count" class="internal xref">Startup Query Count</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.8">
                <p id="section-toc.1-1.8.2.8.1"><a href="#section-8.8" class="auto internal xref">8.8</a>.  <a href="#name-last-member-query-interval" class="internal xref">Last Member Query Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.9">
                <p id="section-toc.1-1.8.2.9.1"><a href="#section-8.9" class="auto internal xref">8.9</a>.  <a href="#name-last-member-query-count" class="internal xref">Last Member Query Count</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.10">
                <p id="section-toc.1-1.8.2.10.1"><a href="#section-8.10" class="auto internal xref">8.10</a>. <a href="#name-last-member-query-time" class="internal xref">Last Member Query Time</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.11">
                <p id="section-toc.1-1.8.2.11.1"><a href="#section-8.11" class="auto internal xref">8.11</a>. <a href="#name-unsolicited-report-interval" class="internal xref">Unsolicited Report Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.12">
                <p id="section-toc.1-1.8.2.12.1"><a href="#section-8.12" class="auto internal xref">8.12</a>. <a href="#name-older-version-querier-prese" class="internal xref">Older Version Querier Present Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.13">
                <p id="section-toc.1-1.8.2.13.1"><a href="#section-8.13" class="auto internal xref">8.13</a>. <a href="#name-older-host-present-interval" class="internal xref">Older Host Present Interval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.14">
                <p id="section-toc.1-1.8.2.14.1"><a href="#section-8.14" class="auto internal xref">8.14</a>. <a href="#name-configuring-timers" class="internal xref">Configuring Timers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.14.2.1">
                    <p id="section-toc.1-1.8.2.14.2.1.1"><a href="#section-8.14.1" class="auto internal xref">8.14.1</a>.  <a href="#name-robustness-variable-2" class="internal xref">Robustness Variable</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.14.2.2">
                    <p id="section-toc.1-1.8.2.14.2.2.1"><a href="#section-8.14.2" class="auto internal xref">8.14.2</a>.  <a href="#name-query-interval-2" class="internal xref">Query Interval</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.14.2.3">
                    <p id="section-toc.1-1.8.2.14.2.3.1"><a href="#section-8.14.3" class="auto internal xref">8.14.3</a>.  <a href="#name-max-response-time" class="internal xref">Max Response Time</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-query-message" class="internal xref">Query Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-current-state-report-messag" class="internal xref">Current-State Report Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-state-change-report-message" class="internal xref">State-Change Report Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-ipsec-usage" class="internal xref">IPsec Usage</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-design-rationale" class="internal xref">Design Rationale</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-the-need-for-state-change-m" class="internal xref">The Need for State-Change Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-host-suppression" class="internal xref">Host Suppression</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-switching-router-filter-mode" class="internal xref">Switching Router Filter Modes from EXCLUDE to INCLUDE</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-summary-of-changes-from-igm" class="internal xref">Summary of Changes from IGMPv2</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-summary-of-changes-from-rfc" class="internal xref">Summary of Changes from RFC 3376</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Internet Group Management Protocol (IGMP) is used by IPv4 systems
   (hosts and routers) to report their IP multicast group memberships to
   any neighboring multicast routers.  Note that an IP multicast router
   may itself be a member of one or more multicast groups, in which case
   it performs both the multicast router part of the protocol (to
   collect the membership information needed by its multicast routing
   protocol) and the group member part of the protocol (to inform
   itself and other, neighboring multicast routers of its memberships).<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">IGMP is also used for other IP multicast management functions, using
   message types other than those used for group membership reporting.
   This document specifies only the group membership reporting functions
   and messages.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document specifies Version 3 of IGMP.  Version 1, specified in
   <span>[<a href="#RFC1112" class="cite xref">RFC1112</a>]</span>, was the first widely deployed version and the first
   version to become an Internet Standard.  Version 2, specified in
   <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span>, added support for low leave latency, that is, a
   reduction in the time it takes for a multicast router to learn that
   there are no longer any members of a particular group present on an
   attached network.  Version 3 adds support for source filtering,
   that is, the ability for a system to report interest in receiving
   packets only from specific source addresses, as required to support
   Source-Specific Multicast (SSM) <span>[<a href="#RFC3569" class="cite xref">RFC3569</a>]</span>, or from all but specific source
   addresses, sent to a particular multicast address.  Version 3 is
      designed to be interoperable with Versions 1 and 2.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document uses "SSM-aware" to refer to systems
      that support SSM as defined in <span>[<a href="#RFC4607" class="cite xref">RFC4607</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document updates <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span> as a proper implementation of IGMPv3 needs to implement IGMPv2 Report and Leave message handling.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">This document obsoletes <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span> as it provides clarifications and fixes
   for errata in <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span>. Detailed updates for those changes are described in <a href="#errata-details" class="auto internal xref">Appendix C</a>.<a href="#section-1-6" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-conventions-used-in-this-do">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-conventions-used-in-this-do" class="section-name selfRef">Conventions Used in This Document</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
   "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>", "<span class="bcp14">MAY</span>", and
   "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as described in
   BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all
   capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<section id="section-2">
      <h2 id="name-the-service-interface-for-r">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-the-service-interface-for-r" class="section-name selfRef">The Service Interface for Requesting IP Multicast Reception</a>
      </h2>
<p id="section-2-1">Within an IP system, there is (at least conceptually) a service
   interface used by upper-layer protocols or application programs to
   ask the IP layer to enable and disable reception of packets sent to
   specific IP multicast addresses.  In order to take full advantage of
   the capabilities of IGMPv3, a system's IP service interface must
   support the following operation:<a href="#section-2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-2-2">
<pre>
      IPMulticastListen ( socket, interface, multicast-address,
                          filter-mode, source-list )</pre><a href="#section-2-2" class="pilcrow">¶</a>
</div>
<p id="section-2-3">where:<a href="#section-2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-4.1">
          <p id="section-2-4.1.1">"socket" is an implementation-specific parameter used to
     distinguish among different requesting entities (e.g., programs or
     processes) within the system; the socket parameter of BSD Unix
     system calls is a specific example.<a href="#section-2-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.2">
          <p id="section-2-4.2.1">"interface" is a local identifier of the network interface on which
     reception of the specified multicast address is to be enabled or
     disabled.  Interfaces may be physical (e.g., an Ethernet interface)
     or virtual (e.g., the endpoint of a Frame Relay virtual circuit or
     the endpoint of an IP-in-IP "tunnel").  An implementation may allow
     a special "unspecified" value to be passed as the interface
     parameter, in which case the request would apply to the "primary"
     or "default" interface of the system (perhaps established by system
     configuration).  If reception of the same multicast address is
     desired on more than one interface, IPMulticastListen is invoked
     separately for each desired interface.<a href="#section-2-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.3">
          <p id="section-2-4.3.1">"multicast-address" is the IP multicast address, or group, to which
     the request pertains.  If reception of more than one multicast
     address on a given interface is desired, IPMulticastListen is
     invoked separately for each desired multicast address.<a href="#section-2-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.4">
          <p id="section-2-4.4.1">"filter-mode" may be either INCLUDE or EXCLUDE.  In INCLUDE mode,
     reception of packets sent to the specified multicast address is
     requested only from those IP source addresses listed in the
     source-list parameter.  In EXCLUDE mode, reception of packets sent
     to the given multicast address is requested from all IP source
     addresses except those listed in the source-list parameter.<a href="#section-2-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-4.5">
          <p id="section-2-4.5.1">"source-list" is an unordered list of zero or more IP unicast
     addresses from which multicast reception is desired or not desired,
     depending on the filter-mode.  An implementation <span class="bcp14">MAY</span> impose a limit
     on the size of source-lists, but that limit <span class="bcp14">MUST NOT</span> be less than
     64 addresses per list.  When an operation causes the source-list
     size limit to be exceeded, the service interface <span class="bcp14">MUST</span> return an
     error.<a href="#section-2-4.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-5">For a given combination of socket, interface, and multicast address,
   only a single filter-mode and source-list can be in effect at any one
   time.  However, either the filter-mode or the source-list, or both,
   may be changed by subsequent IPMulticastListen requests that specify
   the same socket, interface, and multicast address.  Each subsequent
   request completely replaces any earlier request for the given socket,
   interface, and multicast address.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Previous versions of IGMP did not support source filters and had a
   simpler service interface consisting of Join and Leave operations to
   enable and disable reception of a given multicast address (from all
   sources) on a given interface.  The equivalent operations in the new
    service interface follow:<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">The Join operation is equivalent to:<a href="#section-2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-2-8">
<pre>
      IPMulticastListen ( socket, interface, multicast-address,
                          EXCLUDE, {} )</pre><a href="#section-2-8" class="pilcrow">¶</a>
</div>
<p id="section-2-9">and the Leave operation is equivalent to:<a href="#section-2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-2-10">
<pre>
      IPMulticastListen ( socket, interface, multicast-address,
                          INCLUDE, {} )</pre><a href="#section-2-10" class="pilcrow">¶</a>
</div>
<p id="section-2-11">where {} is an empty source-list.<a href="#section-2-11" class="pilcrow">¶</a></p>
<p id="section-2-12">An example of an API providing the capabilities outlined in this
   service interface is in <span>[<a href="#RFC3678" class="cite xref">RFC3678</a>]</span>.<a href="#section-2-12" class="pilcrow">¶</a></p>
</section>
<section id="section-3">
      <h2 id="name-multicast-reception-state-m">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-multicast-reception-state-m" class="section-name selfRef">Multicast Reception State Maintained by Systems</a>
      </h2>
<section id="section-3.1">
        <h3 id="name-socket-state">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-socket-state" class="section-name selfRef">Socket State</a>
        </h3>
<p id="section-3.1-1">For each socket on which IPMulticastListen has been invoked, the
   system records the desired multicast reception state for that socket.
    That state conceptually consists of a set of records of the form:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-3.1-2">
<pre>
      (interface, multicast-address, filter-mode, source-list)</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">The socket state evolves in response to each invocation of
   IPMulticastListen on the socket, as follows:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">If the requested filter-mode is INCLUDE and the requested source-list
     is empty, then the entry corresponding to the requested
     interface and multicast address is deleted if present.  If no such
    entry is present, the request is ignored.<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">If the requested filter-mode is EXCLUDE or the requested source-list
     is non-empty, then the entry corresponding to the requested
     interface and multicast address, if present, is changed to contain
     the requested filter-mode and source-list.  If no such entry is
     present, a new entry is created, using the parameters specified in
    the request.<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<div id="if_state">
<section id="section-3.2">
        <h3 id="name-interface-state">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-interface-state" class="section-name selfRef">Interface State</a>
        </h3>
<p id="section-3.2-1">In addition to the per-socket multicast reception state, a system
     must also maintain or compute multicast reception state for each of
     its interfaces.  That state conceptually consists of a set of
    records of the form:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-3.2-2">
<pre>
        (multicast-address, filter-mode, source-list)</pre><a href="#section-3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2-3">At most, one record per multicast-address exists for a given
     interface.  This per-interface state is derived from the per-socket
     state, but it may differ from the per-socket state when different
     sockets have differing filter-modes and/or source-lists for the
     same multicast address and interface. For example, suppose one
     application or process invokes the following operation on socket
    s1:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-3.2-4">
<pre>
        IPMulticastListen ( s1, i, m, INCLUDE, {a, b, c} )</pre><a href="#section-3.2-4" class="pilcrow">¶</a>
</div>
<p id="section-3.2-5">requesting reception on interface i of packets sent to multicast
     address m, only if they come from source a, b, or c.  Suppose
     another application or process invokes the following operation on
    socket s2:<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-3.2-6">
<pre>
        IPMulticastListen ( s2, i, m, INCLUDE, {b, c, d} )</pre><a href="#section-3.2-6" class="pilcrow">¶</a>
</div>
<p id="section-3.2-7">requesting reception on the same interface i of packets sent to the
     same multicast address m, only if they come from sources b, c, or
     d.  In order to satisfy the reception requirements of both sockets,
     it is necessary for interface i to receive packets sent to m from
     any one of the sources a, b, c, or d.  Thus, in this example, the
     reception state of interface i for multicast address m has filter-mode
     INCLUDE and source-list {a, b, c, d}.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2-8">After a multicast packet has been accepted from an interface by the
     IP layer, its subsequent delivery to the application or process
     listening on a particular socket depends on the multicast reception
     state of that socket (and possibly also on other conditions, such
     as what transport-layer port the socket is bound to).  So, in the
     above example, if a packet arrives on interface i, destined to
     multicast address m, with source address a, it will be delivered on
     socket s1 but not on socket s2.  Note that IGMP Queries and Reports
     are not subject to source filtering and must always be processed by
 hosts and routers.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
<p id="section-3.2-9">Filtering of packets based upon a socket's multicast reception
     state is a feature of this service interface.  The previous
     service interface <span>[<a href="#RFC1112" class="cite xref">RFC1112</a>]</span> described no filtering based upon
     multicast join state; rather, a join on a socket simply caused the
     host to join a group on the given interface, and packets destined
     for that group could be delivered to all sockets whether they had
    joined or not.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<p id="section-3.2-10">The general rules for deriving the per-interface state from the
     per-socket state are as follows:  For each distinct (interface,
     multicast-address) pair that appears in any socket state, a per-interface record is created for that multicast address on that
     interface.  Considering all socket records containing the same
     (interface, multicast-address) pair,<a href="#section-3.2-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.1">
            <p id="section-3.2-11.1.1">if any such record has a filter-mode of EXCLUDE, then the
            filter-mode of the interface record is EXCLUDE, and the source-list
            of the interface record is the intersection of the source-lists
            of all socket records in EXCLUDE mode, minus those source 
            addresses that appear in any socket record in INCLUDE mode.  For
            example, if the socket records for multicast address m on
            interface i are:<a href="#section-3.2-11.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.1.2.1">from socket s1:  ( i, m, EXCLUDE, {a, b, c, d} )<a href="#section-3.2-11.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.2-11.1.2.2">from socket s2:  ( i, m, EXCLUDE, {b, c, d, e} )<a href="#section-3.2-11.1.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.2-11.1.2.3">from socket s3:  ( i, m, INCLUDE, {d, e, f} )<a href="#section-3.2-11.1.2.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-3.2-11.1.3">then the corresponding interface record on interface i is:<a href="#section-3.2-11.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.1.4.1">( m, EXCLUDE, {b, c} )<a href="#section-3.2-11.1.4.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-3.2-11.1.5">If a fourth socket is added, such as:<a href="#section-3.2-11.1.5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.1.6.1">from socket s4:  ( i, m, EXCLUDE, {} )<a href="#section-3.2-11.1.6.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-3.2-11.1.7">then the interface record becomes:<a href="#section-3.2-11.1.7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.1.8.1">( m, EXCLUDE, {} )<a href="#section-3.2-11.1.8.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.2-11.2">
            <p id="section-3.2-11.2.1">if all such records have a filter-mode of INCLUDE, then the
            filter-mode of the interface record is INCLUDE, and the source-list
            of the interface record is the union of the source-lists of
            all the socket records.  For example, if the socket records for
            multicast address m on interface i are:<a href="#section-3.2-11.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.2.2.1">from socket s1:  ( i, m, INCLUDE, {a, b, c} )<a href="#section-3.2-11.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.2-11.2.2.2">from socket s2:  ( i, m, INCLUDE, {b, c, d} )<a href="#section-3.2-11.2.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.2-11.2.2.3">from socket s3:  ( i, m, INCLUDE, {e, f} )<a href="#section-3.2-11.2.2.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-3.2-11.2.3"> then the corresponding interface record on interface i is:<a href="#section-3.2-11.2.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-11.2.4.1">( m, INCLUDE, {a, b, c, d, e, f} )<a href="#section-3.2-11.2.4.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-3.2-11.2.5">An implementation <span class="bcp14">MUST NOT</span> use an EXCLUDE
            interface record to represent a group when all sockets for this
            group are in INCLUDE state.  If system resource limits are reached
            when an interface state source-list is calculated, an error
            <span class="bcp14">MUST</span> be returned to the application that requested
            the operation.<a href="#section-3.2-11.2.5" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-12">The above rules for deriving the interface state are (re-)evaluated
   whenever an IPMulticastListen invocation modifies the socket state by
   adding, deleting, or modifying a per-socket state record.  Note that
   a change  of socket state does not necessarily result in a change of
    interface state.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<section id="section-4">
      <h2 id="name-message-formats">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-message-formats" class="section-name selfRef">Message Formats</a>
      </h2>
<p id="section-4-1">IGMP messages are encapsulated in IPv4 datagrams, with an IP protocol
      number of 2.
      Every IGMP message described in this document is sent
   with an IP Time-to-Live of 1, IP Precedence of Internetwork Control
   (e.g., Type of Service 0xc0), and carries an IP Router Alert option
   <span>[<a href="#RFC2113" class="cite xref">RFC2113</a>]</span> in its IP header.  IGMP message types are
   registered per <span>[<a href="#BCP57" class="cite xref">BCP57</a>]</span>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">There are two IGMP message types of concern to the IGMPv3 protocol
      described in this document:<a href="#section-4-2" class="pilcrow">¶</a></p>
<span id="name-new-messages-introduced-by-"></span><div id="v3-msgs">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-new-messages-introduced-by-" class="selfRef">New Messages Introduced by IGMPv3</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Type Number (hex)</th>
            <th class="text-left" rowspan="1" colspan="1">Message Name</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x11</td>
            <td class="text-left" rowspan="1" colspan="1">Membership Query</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x22</td>
            <td class="text-left" rowspan="1" colspan="1">IGMPv3 Membership Report</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-4-4">An implementation of IGMPv3 <span class="bcp14">MUST</span> also support the following three
   message types, for interoperation with previous versions of IGMP (see
    <a href="#interop" class="auto internal xref">Section 7</a>):<a href="#section-4-4" class="pilcrow">¶</a></p>
<span id="name-legacy-igmp-messages"></span><div id="legacy-msgs">
<table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-legacy-igmp-messages" class="selfRef">Legacy IGMP Messages</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Type Number (hex)</th>
            <th class="text-left" rowspan="1" colspan="1">Message Name</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x12</td>
            <td class="text-left" rowspan="1" colspan="1">IGMPv1 Membership Report</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC1112" class="cite xref">RFC1112</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x16</td>
            <td class="text-left" rowspan="1" colspan="1">IGMPv2 Membership Report</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x17</td>
            <td class="text-left" rowspan="1" colspan="1">IGMPv2 Leave Group</td>
            <td class="text-left" rowspan="1" colspan="1">
              <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span>
</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-4-6">Unrecognized message types <span class="bcp14">MUST</span> be silently ignored.  Other message
   types may be used by newer versions or extensions of IGMP, by
    multicast routing protocols, or for other uses.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">In this document, unless otherwise qualified, the capitalized words
   "Query" and "Report" refer to IGMP Membership Queries and IGMPv3
    Membership Reports, respectively.<a href="#section-4-7" class="pilcrow">¶</a></p>
<section id="section-4.1">
        <h3 id="name-membership-query-message">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-membership-query-message" class="section-name selfRef">Membership Query Message</a>
        </h3>
<p id="section-4.1-1">Membership Queries are sent by IP multicast routers to query the
   multicast reception state of neighboring interfaces.  Queries have
    the following format:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-igmpv3-query-message"></span><div id="v3-qry">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Type = 0x11  | Max Resp Code |           Checksum            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Group Address                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Flags |S| QRV |     QQIC      |     Number of Sources (N)     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Source Address [1]                      |
    +-                                                             -+
    |                       Source Address [2]                      |
    +-                              .                              -+
    .                               .                               .
    .                               .                               .
    +-                                                             -+
    |                       Source Address [N]                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-igmpv3-query-message" class="selfRef">IGMPv3 Query Message</a>
          </figcaption></figure>
</div>
<div id="max_resp_code">
<section id="section-4.1.1">
          <h4 id="name-max-response-code">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-max-response-code" class="section-name selfRef">Max Response Code</a>
          </h4>
<p id="section-4.1.1-1">The Max Resp Code field specifies the maximum time allowed before
          sending a responding report.  The actual time allowed, called the
          "Max Response Time", is represented in units of 1/10 second and is derived
          from the Max Resp Code as follows:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1">If Max Resp Code &lt; 128, Max Response Time = Max Resp Code<a href="#section-4.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.1.1-2.2">
              <p id="section-4.1.1-2.2.1">If Max Resp Code &gt;= 128, Max Resp Code represents a
            floating-point value as follows:<a href="#section-4.1.1-2.2.1" class="pilcrow">¶</a></p>
<span id="name-max-resp-code-representatio"></span><div id="max-resp">
<figure id="figure-2">
                <div class="alignLeft art-text artwork" id="section-4.1.1-2.2.2.1">
<pre>
       0 1 2 3 4 5 6 7
      +-+-+-+-+-+-+-+-+
      |1| exp | mant  |
      +-+-+-+-+-+-+-+-+

   Max Response Time = (mant | 0x10) &lt;&lt; (exp + 3)</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-max-resp-code-representatio" class="selfRef">Max Resp Code Representation</a>
                </figcaption></figure>
</div>
</li>
          </ul>
<p id="section-4.1.1-3">Small values of Max Response Time allow IGMPv3 routers to tune the "leave
   latency" (the time between the moment the last host leaves a group
   and the moment the routing protocol is notified that there are no
   more members).  Larger values, especially in the exponential range,
   allow tuning of the burstiness of IGMP traffic on a network.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-4.1.2">
          <h4 id="name-checksum">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-checksum" class="section-name selfRef">Checksum</a>
          </h4>
<p id="section-4.1.2-1">The Checksum field is the 16-bit one's complement of the one's complement
   sum of the whole IGMP message (the entire IP payload).  For computing
   the checksum, the Checksum field is set to zero.  When receiving
   packets, the checksum <span class="bcp14">MUST</span> be verified before processing a packet
   <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.3">
          <h4 id="name-group-address">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-group-address" class="section-name selfRef">Group Address</a>
          </h4>
<p id="section-4.1.3-1">The Group Address field is set to zero when sending a General Query
   and set to the IP multicast address being queried when sending a
   Group-Specific Query or Group-and-Source Specific Query (see 
   <a href="#qry_vars" class="auto internal xref">Section 4.1.11</a>, below).<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.4">
          <h4 id="name-flags">
<a href="#section-4.1.4" class="section-number selfRef">4.1.4. </a><a href="#name-flags" class="section-name selfRef">Flags</a>
          </h4>
<p id="section-4.1.4-1">The Flags field is a bitstring managed by the "IGMP Type Numbers" registry defined in
   <span>[<a href="#BCP57" class="cite xref">BCP57</a>]</span>.<a href="#section-4.1.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.5">
          <h4 id="name-s-flag-suppress-router-side">
<a href="#section-4.1.5" class="section-number selfRef">4.1.5. </a><a href="#name-s-flag-suppress-router-side" class="section-name selfRef">S Flag (Suppress Router-Side Processing)</a>
          </h4>
<p id="section-4.1.5-1">When set to one, the S flag indicates to any receiving multicast
   routers that they are to suppress the normal timer updates they
   perform upon receiving a Query.  It does not, however, suppress the
   Querier election or the normal "host-side" processing of a Query that
   a router may be required to perform as a consequence of itself being
    a group member.<a href="#section-4.1.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.6">
          <h4 id="name-qrv-queriers-robustness-var">
<a href="#section-4.1.6" class="section-number selfRef">4.1.6. </a><a href="#name-qrv-queriers-robustness-var" class="section-name selfRef">QRV (Querier's Robustness Variable)</a>
          </h4>
<p id="section-4.1.6-1">If non-zero, the QRV field contains the [Robustness Variable] value
   used by the querier, i.e., the sender of the Query.  If the querier's
   [Robustness Variable] exceeds 7, the maximum value of the QRV field,
   the QRV is set to zero.  Routers adopt the QRV value from the most
   recently received Query as their own [Robustness Variable] value,
   unless that most recently received QRV was zero, in which case the
   receivers use the default [Robustness Variable] value specified in
   <a href="#robust" class="auto internal xref">Section 8.1</a> or a statically configured value.<a href="#section-4.1.6-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.7">
          <h4 id="name-qqic-queriers-query-interva">
<a href="#section-4.1.7" class="section-number selfRef">4.1.7. </a><a href="#name-qqic-queriers-query-interva" class="section-name selfRef">QQIC (Querier's Query Interval Code)</a>
          </h4>
<p id="section-4.1.7-1">The QQIC field specifies the [Query
   Interval] used by the querier.  The actual interval, called the
   "Querier's Query Interval (QQI)", is represented in units of seconds
    and is derived from the QQIC as follows:<a href="#section-4.1.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.7-2.1">If QQIC &lt; 128, QQI = QQIC<a href="#section-4.1.7-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.1.7-2.2">
              <p id="section-4.1.7-2.2.1">If QQIC &gt;= 128, QQIC represents a floating-point value as follows:<a href="#section-4.1.7-2.2.1" class="pilcrow">¶</a></p>
<span id="name-qqic-representation"></span><div id="QQIC">
<figure id="figure-3">
                <div class="alignLeft art-text artwork" id="section-4.1.7-2.2.2.1">
<pre>
       0 1 2 3 4 5 6 7
      +-+-+-+-+-+-+-+-+
      |1| exp | mant  |
      +-+-+-+-+-+-+-+-+

   QQI = (mant | 0x10) &lt;&lt; (exp + 3)</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-qqic-representation" class="selfRef">QQIC Representation</a>
                </figcaption></figure>
</div>
</li>
          </ul>
<p id="section-4.1.7-3">Multicast routers that are not the current querier adopt the QQI
   value from the most recently received Query as their own [Query
   Interval] value, unless that most recently received QQI was zero, in
   which case the receiving routers use the default [Query Interval]
    value specified in <a href="#qry_int" class="auto internal xref">Section 8.2</a>.<a href="#section-4.1.7-3" class="pilcrow">¶</a></p>
</section>
<section id="section-4.1.8">
          <h4 id="name-number-of-sources-n">
<a href="#section-4.1.8" class="section-number selfRef">4.1.8. </a><a href="#name-number-of-sources-n" class="section-name selfRef">Number of Sources (N)</a>
          </h4>
<p id="section-4.1.8-1">The Number of Sources (N) field specifies how many source addresses
   are present in the Query.  This number is zero in a General Query or
   a Group Specific Query and non-zero in a Group-and-Source Specific
   Query.  This number is limited by the MTU of the network over which
   the Query is transmitted.  For example, on an Ethernet with an MTU of
   1500 octets, the IP header including the Router Alert option consumes
   24 octets, and the IGMP fields up to and including the Number of Sources
   (N) field consume 12 octets, leaving 1464 octets for source
   addresses, which limits the number of source addresses to 366 (1464/4).<a href="#section-4.1.8-1" class="pilcrow">¶</a></p>
</section>
<div id="src_addr_field">
<section id="section-4.1.9">
          <h4 id="name-source-address-i">
<a href="#section-4.1.9" class="section-number selfRef">4.1.9. </a><a href="#name-source-address-i" class="section-name selfRef">Source Address [i]</a>
          </h4>
<p id="section-4.1.9-1">The Source Address [i] fields are a vector of n IP unicast addresses,
    where n is the value in the Number of Sources (N) field.<a href="#section-4.1.9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-4.1.10">
          <h4 id="name-additional-data">
<a href="#section-4.1.10" class="section-number selfRef">4.1.10. </a><a href="#name-additional-data" class="section-name selfRef">Additional Data</a>
          </h4>
<p id="section-4.1.10-1">If the Packet Length field in the IP header of a received Query
   indicates that there are additional octets of data present, beyond
   the fields described here, IGMPv3 implementations <span class="bcp14">MUST</span> include those
   octets in the computation to verify the received IGMP Checksum but 
   <span class="bcp14">MUST</span> otherwise ignore those additional octets.  When sending a Query,
   an IGMPv3 implementation <span class="bcp14">MUST NOT</span> include additional octets beyond
    the fields described here.<a href="#section-4.1.10-1" class="pilcrow">¶</a></p>
</section>
<div id="qry_vars">
<section id="section-4.1.11">
          <h4 id="name-query-variants">
<a href="#section-4.1.11" class="section-number selfRef">4.1.11. </a><a href="#name-query-variants" class="section-name selfRef">Query Variants</a>
          </h4>
<p id="section-4.1.11-1">There are three variants of the Query Message:<a href="#section-4.1.11-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1.11-2">
<li id="section-4.1.11-2.1">
              <p id="section-4.1.11-2.1.1">A General Query is sent by a multicast router to learn the
      complete multicast reception state of the neighboring interfaces
      (that is, the interfaces attached to the network on which the
      Query is transmitted).  In a General Query, both the Group Address
    field and the Number of Sources (N) field are zero.<a href="#section-4.1.11-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.1.11-2.2">
              <p id="section-4.1.11-2.2.1">A Group Specific Query is sent by a multicast router to learn
      the reception state, with respect to a single multicast address,
      of the neighboring interfaces.  In a Group Specific Query, the
      Group Address field contains the multicast address of interest,
    and the Number of Sources (N) field contains zero.<a href="#section-4.1.11-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.1.11-2.3">
              <p id="section-4.1.11-2.3.1">A Group-and-Source Specific Query is sent by a multicast router
      to learn if any neighboring interface desires reception of packets
      sent to a specified multicast address, from any of a specified
      list of sources.  In a Group-and-Source Specific Query, the Group
      Address field contains the multicast address of interest, and the
      Source Address [i] fields contain the source address(es) of
    interest.<a href="#section-4.1.11-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<section id="section-4.1.12">
          <h4 id="name-ip-destination-addresses-fo">
<a href="#section-4.1.12" class="section-number selfRef">4.1.12. </a><a href="#name-ip-destination-addresses-fo" class="section-name selfRef">IP Destination Addresses for Queries</a>
          </h4>
<p id="section-4.1.12-1">In IGMPv3, General Queries are sent with an IP destination address of
   224.0.0.1, the all-systems multicast address.  Group Specific and
   Group-and-Source Specific Queries are sent with an IP destination
   address equal to the  multicast address of interest.  However, a
   system <span class="bcp14">MUST</span> accept and  process any Query whose IP Destination
   Address field contains any of the addresses (unicast or multicast)
    assigned to the interface on which the Query arrives.<a href="#section-4.1.12-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4.2">
        <h3 id="name-igmpv3-membership-report-me">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-igmpv3-membership-report-me" class="section-name selfRef">IGMPv3 Membership Report Message</a>
        </h3>
<p id="section-4.2-1">IGMPv3 Membership Reports are sent by IP systems to report (to
   neighboring routers) the current multicast reception state, or
   changes in the multicast reception state, of their interfaces.
    Reports have the following format:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<span id="name-igmpv3-report-message"></span><div id="v3-rpt">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.2-2.1">
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Type = 0x22  |    Reserved   |           Checksum            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             Flags             |  Number of Group Records (M)  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                        Group Record [1]                       .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                        Group Record [2]                       .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                               .                               |
    .                               .                               .
    |                               .                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                        Group Record [M]                       .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-igmpv3-report-message" class="selfRef">IGMPv3 Report Message</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">where each Group Record has the following internal format:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<span id="name-igmpv3-report-group-record"></span><div id="v3-grp">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.2-4.1">
<pre>
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Record Type  |  Aux Data Len |     Number of Sources (N)     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Multicast Address                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Source Address [1]                      |
    +-                                                             -+
    |                       Source Address [2]                      |
    +-                                                             -+
    .                               .                               .
    .                               .                               .
    .                               .                               .
    +-                                                             -+
    |                       Source Address [N]                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                         Auxiliary Data                        .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-igmpv3-report-group-record" class="selfRef">IGMPv3 Report Group Record</a>
          </figcaption></figure>
</div>
<section id="section-4.2.1">
          <h4 id="name-reserved">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-reserved" class="section-name selfRef">Reserved</a>
          </h4>
<p id="section-4.2.1-1">The Reserved field is set to zero on transmission and ignored on
   reception.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.2">
          <h4 id="name-checksum-2">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-checksum-2" class="section-name selfRef">Checksum</a>
          </h4>
<p id="section-4.2.2-1">The Checksum field is the 16-bit one's complement of the one's complement
   sum of the whole IGMP message (the entire IP payload).  For computing
   the checksum, the Checksum field is set to zero.  When receiving
    packets, the checksum <span class="bcp14">MUST</span> be verified before processing a message.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.3">
          <h4 id="name-flags-2">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-flags-2" class="section-name selfRef">Flags</a>
          </h4>
<p id="section-4.2.3-1">The Flags field is a bitstring managed by the "IGMP Type Numbers" registry defined in
   <span>[<a href="#BCP57" class="cite xref">BCP57</a>]</span>.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.4">
          <h4 id="name-number-of-group-records-m">
<a href="#section-4.2.4" class="section-number selfRef">4.2.4. </a><a href="#name-number-of-group-records-m" class="section-name selfRef">Number of Group Records (M)</a>
          </h4>
<p id="section-4.2.4-1">The Number of Group Records (M) field specifies how many Group
    Records are present in this Report.<a href="#section-4.2.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.5">
          <h4 id="name-group-record">
<a href="#section-4.2.5" class="section-number selfRef">4.2.5. </a><a href="#name-group-record" class="section-name selfRef">Group Record</a>
          </h4>
<p id="section-4.2.5-1">Each Group Record is a block of fields containing information
   pertaining to the sender's membership in a single multicast group on
    the interface from which the Report is sent.<a href="#section-4.2.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.6">
          <h4 id="name-record-type">
<a href="#section-4.2.6" class="section-number selfRef">4.2.6. </a><a href="#name-record-type" class="section-name selfRef">Record Type</a>
          </h4>
<p id="section-4.2.6-1">See <a href="#grp_rec_types" class="auto internal xref">Section 4.2.13</a>, below.<a href="#section-4.2.6-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.7">
          <h4 id="name-aux-data-len">
<a href="#section-4.2.7" class="section-number selfRef">4.2.7. </a><a href="#name-aux-data-len" class="section-name selfRef">Aux Data Len</a>
          </h4>
<p id="section-4.2.7-1">The Aux Data Len field contains the length of the Auxiliary Data
   field in this Group Record, in units of 32-bit words.  It may contain
    zero, to indicate the absence of any auxiliary data.<a href="#section-4.2.7-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.8">
          <h4 id="name-number-of-sources-n-2">
<a href="#section-4.2.8" class="section-number selfRef">4.2.8. </a><a href="#name-number-of-sources-n-2" class="section-name selfRef">Number of Sources (N)</a>
          </h4>
<p id="section-4.2.8-1">The Number of Sources (N) field specifies how many source addresses
    are present in this Group Record.<a href="#section-4.2.8-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.9">
          <h4 id="name-multicast-address">
<a href="#section-4.2.9" class="section-number selfRef">4.2.9. </a><a href="#name-multicast-address" class="section-name selfRef">Multicast Address</a>
          </h4>
<p id="section-4.2.9-1">The Multicast Address field contains the IP multicast address to
    which this Group Record pertains.<a href="#section-4.2.9-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.10">
          <h4 id="name-source-address-i-2">
<a href="#section-4.2.10" class="section-number selfRef">4.2.10. </a><a href="#name-source-address-i-2" class="section-name selfRef">Source Address [i]</a>
          </h4>
<p id="section-4.2.10-1">The Source Address [i] fields are a vector of n IP unicast addresses,
    where n is the value in this record's Number of Sources (N) field.<a href="#section-4.2.10-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.11">
          <h4 id="name-auxiliary-data">
<a href="#section-4.2.11" class="section-number selfRef">4.2.11. </a><a href="#name-auxiliary-data" class="section-name selfRef">Auxiliary Data</a>
          </h4>
<p id="section-4.2.11-1">The Auxiliary Data field, if present, contains additional information
   pertaining to this Group Record.  The protocol specified in this
   document, IGMPv3, does not define any auxiliary data.  Therefore,
   implementations of IGMPv3 <span class="bcp14">MUST NOT</span> include any auxiliary data (i.e.,
   <span class="bcp14">MUST</span> set the Aux Data Len field to zero) in any transmitted Group
   Record and <span class="bcp14">MUST</span> ignore any auxiliary data present in any received
   Group Record.  The semantics and internal encoding of the Auxiliary
   Data field are to be defined by any future version or extension of
    IGMP that uses this field.<a href="#section-4.2.11-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.12">
          <h4 id="name-additional-data-2">
<a href="#section-4.2.12" class="section-number selfRef">4.2.12. </a><a href="#name-additional-data-2" class="section-name selfRef">Additional Data</a>
          </h4>
<p id="section-4.2.12-1">If the Packet Length field in the IP header of a received Report
   indicates that there are additional octets of data present, beyond
   the last Group Record, IGMPv3 implementations <span class="bcp14">MUST</span> include those
   octets in the computation to verify the received IGMP Checksum but
   <span class="bcp14">MUST</span> otherwise ignore those additional octets.  When sending a
   Report, an IGMPv3 implementation <span class="bcp14">MUST NOT</span> include additional octets
    beyond the last Group Record.<a href="#section-4.2.12-1" class="pilcrow">¶</a></p>
</section>
<div id="grp_rec_types">
<section id="section-4.2.13">
          <h4 id="name-group-record-types">
<a href="#section-4.2.13" class="section-number selfRef">4.2.13. </a><a href="#name-group-record-types" class="section-name selfRef">Group Record Types</a>
          </h4>
<p id="section-4.2.13-1">There are a number of different types of Group Records that may be
   included in a Report message:<a href="#section-4.2.13-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.13-2.1">
              <p id="section-4.2.13-2.1.1">A Current-State Record is sent by a system in response to a
              Query received on an interface.  It reports the current
              reception state of that interface, with respect to a single
              multicast address.  The Record Type of a Current-State Record
              may be one of the following two values:<a href="#section-4.2.13-2.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2.13-2.1.2">
 <li id="section-4.2.13-2.1.2.1">
                  <p id="section-4.2.13-2.1.2.1.1">MODE_IS_INCLUDE - indicates that the interface has a
                  filter-mode of INCLUDE for the specified multicast address.
                  The Source Address [i] fields in this Group Record contain
                  the interface's source-list for the specified multicast
                  address, if it is non-empty.<a href="#section-4.2.13-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-4.2.13-2.1.2.2">
                  <p id="section-4.2.13-2.1.2.2.1">MODE_IS_EXCLUDE - indicates that the interface has a
                  filter-mode of EXCLUDE for the specified multicast
                  address. The Source Address [i] fields in this Group Record
                  contain the interface's source-list for the specified
                  multicast address, if it is non-empty. An SSM-aware host
                  <span class="bcp14">SHOULD NOT</span> send a MODE_IS_EXCLUDE record type
                  for multicast addresses that fall within the SSM address
                  range as they will be ignored by SSM-aware routers <span>[<a href="#RFC4604" class="cite xref">RFC4604</a>]</span>.<a href="#section-4.2.13-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
            <li class="normal" id="section-4.2.13-2.2">
              <p id="section-4.2.13-2.2.1">A Filter-Mode-Change Record is sent by a system whenever a
              local invocation of IPMulticastListen causes a change of the
              filter-mode (i.e., a change from INCLUDE to EXCLUDE, or from
              EXCLUDE to INCLUDE) of the interface-level state entry for a
              particular multicast address.  The Record is included in a
              Report sent from the interface on which the change occurred.
              The Record Type of a Filter-Mode-Change Record may be one of the
              following two values:<a href="#section-4.2.13-2.2.1" class="pilcrow">¶</a></p>
<ol start="3" type="1" class="normal type-1" id="section-4.2.13-2.2.2">
<li id="section-4.2.13-2.2.2.1">
                  <p id="section-4.2.13-2.2.2.1.1">CHANGE_TO_INCLUDE_MODE - indicates that the interface has
                  changed to INCLUDE filter-mode for the specified multicast
                  address.  The Source Address [i] fields in this Group Record
                  contain the interface's new source-list for the specified
                  multicast address, if it is non-empty.<a href="#section-4.2.13-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-4.2.13-2.2.2.2">
                  <p id="section-4.2.13-2.2.2.2.1">CHANGE_TO_EXCLUDE_MODE - indicates that the interface has
                  changed to EXCLUDE filter-mode for the specified multicast
                  address. The Source Address [i] fields in this Group Record
                  contain the interface's new source-list for the specified
                  multicast address, if it is non-empty. An SSM-aware host
                  <span class="bcp14">SHOULD NOT</span> send a CHANGE_TO_EXCLUDE_MODE
                  record type for multicast addresses that fall within the SSM
                  address range.<a href="#section-4.2.13-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
            <li class="normal" id="section-4.2.13-2.3">
              <p id="section-4.2.13-2.3.1">A Source-List-Change Record is sent by a system whenever a
              local invocation of IPMulticastListen causes a change of the source-list
              that is not coincident with a change of the filter-mode, of the
              interface-level state entry for a particular multicast address.
              The Record is included in a Report sent from the interface on
              which the change occurred.  The Record Type of a
              Source-List-Change Record may be one of the following two
              values:<a href="#section-4.2.13-2.3.1" class="pilcrow">¶</a></p>
<ol start="5" type="1" class="normal type-1" id="section-4.2.13-2.3.2">
 <li id="section-4.2.13-2.3.2.1">
                  <p id="section-4.2.13-2.3.2.1.1">ALLOW_NEW_SOURCES - indicates that the Source Address [i]
                  fields in this Group Record contain a list of the additional
                  sources that the system wishes to receive, for packets
                  sent to the specified multicast address.  If the change was
                  to an INCLUDE source-list, these are the addresses that were
                  added to the list; if the change was to an EXCLUDE source-list,
                  these are the addresses that were deleted from the
                  list.<a href="#section-4.2.13-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-4.2.13-2.3.2.2">
                  <p id="section-4.2.13-2.3.2.2.1">BLOCK_OLD_SOURCES - indicates that the Source Address [i]
                  fields in this Group Record contain a list of the sources
                  that the system no longer wishes to receive, for packets
                  sent to the specified multicast address.  If the change was
                  to an INCLUDE source-list, these are the addresses that were
                  deleted from the list; if the change was to an EXCLUDE
                  source-list, these are the addresses that were added to the
                  list.<a href="#section-4.2.13-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
          </ul>
<p id="section-4.2.13-3">If a change of source-list results in both allowing new sources
          and blocking old sources, then two Group Records are sent for the
          same multicast address, one of type ALLOW_NEW_SOURCES and one of
          type BLOCK_OLD_SOURCES.<a href="#section-4.2.13-3" class="pilcrow">¶</a></p>
<p id="section-4.2.13-4">We use the term "State-Change Record" to refer to either a Filter-
    Mode-Change Record or a Source-List-Change Record.<a href="#section-4.2.13-4" class="pilcrow">¶</a></p>
<p id="section-4.2.13-5">Unrecognized Record Type values <span class="bcp14">MUST</span> be silently ignored.<a href="#section-4.2.13-5" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-4.2.14">
          <h4 id="name-ip-source-addresses-for-rep">
<a href="#section-4.2.14" class="section-number selfRef">4.2.14. </a><a href="#name-ip-source-addresses-for-rep" class="section-name selfRef">IP Source Addresses for Reports</a>
          </h4>
<p id="section-4.2.14-1">An IGMP report is sent with a valid unicast IPv4 source address for the
   destination subnet.  The 0.0.0.0 source address may be used by a
   system that has not yet acquired an IP address.  Note that the
   0.0.0.0 source address may simultaneously be used by multiple systems
   on a LAN.  Routers <span class="bcp14">MUST</span> accept a report with a source address of
   0.0.0.0.<a href="#section-4.2.14-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.15">
          <h4 id="name-ip-destination-addresses-for">
<a href="#section-4.2.15" class="section-number selfRef">4.2.15. </a><a href="#name-ip-destination-addresses-for" class="section-name selfRef">IP Destination Addresses for Reports</a>
          </h4>
<p id="section-4.2.15-1">Version 3 Reports are sent with an IP destination address of
   224.0.0.22, to which all IGMPv3-capable multicast routers listen.  A
   system that is operating in v1 or v2 compatibility
   modes sends v1 or v2 Reports to the multicast group
   specified in the Group Address field of the Report.  In addition, a
   system <span class="bcp14">MUST</span> accept and process any v1 or v2 Report
   whose IP Destination Address field contains any of the addresses
   (unicast or multicast) assigned to the interface on which the Report
   arrives.<a href="#section-4.2.15-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2.16">
          <h4 id="name-notation-for-group-records">
<a href="#section-4.2.16" class="section-number selfRef">4.2.16. </a><a href="#name-notation-for-group-records" class="section-name selfRef">Notation for Group Records</a>
          </h4>
<p id="section-4.2.16-1">In the rest of this document, we use the following notation to
   describe the contents of a Group Record pertaining to a particular
   multicast address:<a href="#section-4.2.16-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.2.16-2.1">IS_IN ( x )  -  Type MODE_IS_INCLUDE, source addresses x<a href="#section-4.2.16-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.2.16-2.2">IS_EX ( x )  -  Type MODE_IS_EXCLUDE, source addresses x<a href="#section-4.2.16-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.2.16-2.3">TO_IN ( x )  -  Type CHANGE_TO_INCLUDE_MODE, source addresses x<a href="#section-4.2.16-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.2.16-2.4">TO_EX ( x )  -  Type CHANGE_TO_EXCLUDE_MODE, source addresses x<a href="#section-4.2.16-2.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.2.16-2.5">ALLOW ( x )  -  Type ALLOW_NEW_SOURCES, source addresses x<a href="#section-4.2.16-2.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.2.16-2.6">BLOCK ( x )  -  Type BLOCK_OLD_SOURCES, source addresses x<a href="#section-4.2.16-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.16-3">where x is either:<a href="#section-4.2.16-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.16-4.1">
              <p id="section-4.2.16-4.1.1">a capital letter (e.g., "A") to represent the set of source
    addresses or<a href="#section-4.2.16-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.16-4.2">
              <p id="section-4.2.16-4.2.1">a set expression (e.g., "A+B"), where "A+B" means the union of sets
     A and B, "A*B" means the intersection of sets A and B, and "A-B"
    means the removal of all elements of set B from set A.<a href="#section-4.2.16-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
<section id="section-4.2.17">
          <h4 id="name-membership-report-size">
<a href="#section-4.2.17" class="section-number selfRef">4.2.17. </a><a href="#name-membership-report-size" class="section-name selfRef">Membership Report Size</a>
          </h4>
<p id="section-4.2.17-1">If the set of Group Records required in a report does not fit within
   the size limit of a single Report message (as determined by the MTU
   of the network on which it will be sent), the Group Records are sent
    in as many Report messages as needed to report the entire set.<a href="#section-4.2.17-1" class="pilcrow">¶</a></p>
<p id="section-4.2.17-2">If a single Group Record contains so many source addresses that it
   does not fit within the size limit of a single Report message, and if its
   Type is not MODE_IS_EXCLUDE or CHANGE_TO_EXCLUDE_MODE, it is split
   into multiple Group Records, each containing a different subset of
   the source addresses and each sent in a separate Report message.  If
   its Type is MODE_IS_EXCLUDE or CHANGE_TO_EXCLUDE_MODE, a single Group
   Record is sent, containing as many source addresses as can fit, and
   the remaining source addresses are not reported; though the choice of
   which sources to report is arbitrary, it is preferable to report the
   same set of sources in each subsequent report, rather than reporting
    different sources each time.<a href="#section-4.2.17-2" class="pilcrow">¶</a></p>
</section>
</section>
</section>
<div id="grp_mbrs">
<section id="section-5">
      <h2 id="name-description-of-the-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-description-of-the-protocol" class="section-name selfRef">Description of the Protocol for Group Members</a>
      </h2>
<p id="section-5-1">IGMP is an asymmetric protocol, specifying separate behaviors for
   group members -- that is, hosts or routers that wish to receive
   multicast packets -- and multicast routers.  This section describes
   the part of IGMPv3 that applies to all group members.  (Note that a
   multicast router that is also a group member performs both parts of
   IGMPv3, receiving and responding to its own IGMP message
   transmissions as well as those of its neighbors.  The multicast
    router part of IGMPv3 is described in <a href="#mcast_rtrs" class="auto internal xref">Section 6</a>.)<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">A system performs the protocol described in this section over all
   interfaces on which multicast reception is supported, even if more
    than one of those interfaces is connected to the same network.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">For interoperability with multicast routers running older versions of
   IGMP, systems maintain a MulticastRouterVersion variable for each
   interface on which multicast reception is supported.  This section
   describes the behavior of group member systems on interfaces for
   which MulticastRouterVersion = 3.  The algorithm for determining
   MulticastRouterVersion, and the behavior for versions other than 3,
    are described in <a href="#interop" class="auto internal xref">Section 7</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The all-systems multicast address, 224.0.0.1, is handled as a special
   case.  On all systems -- that is, all hosts and routers including
   multicast routers -- reception of packets destined to the all-systems
   multicast address, from all sources, is permanently enabled on all
   interfaces on which multicast reception is supported.  No IGMP
    messages are ever sent regarding the all-systems multicast address.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">There are two types of events that trigger IGMPv3 protocol actions on
    an interface:<a href="#section-5-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-6.1">
          <p id="section-5-6.1.1">A change of the interface reception state, caused by a local
    invocation of IPMulticastListen.<a href="#section-5-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-6.2">
          <p id="section-5-6.2.1">The reception of a Query.<a href="#section-5-6.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-7">(Received IGMP messages of types other than Query are silently
   ignored, except as required for interoperation with earlier versions
    of IGMP.)<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">The following subsections describe the actions to be taken for each
   of these two cases.  In those descriptions, timer and counter names
   appear in square brackets.  The default values for those timers and
    counters are specified in <a href="#timers" class="auto internal xref">Section 8</a>.<a href="#section-5-8" class="pilcrow">¶</a></p>
<section id="section-5.1">
        <h3 id="name-action-on-change-of-interfa">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-action-on-change-of-interfa" class="section-name selfRef">Action on Change of Interface State</a>
        </h3>
<p id="section-5.1-1">An invocation of IPMulticastListen may cause the multicast reception
   state of an interface to change, according to the rules in 
   <a href="#if_state" class="auto internal xref">Section 3.2</a>.  Each such change affects the per-interface entry for a single
    multicast address.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">A change of interface state causes the system to immediately transmit
   a State-Change Report from that interface.  The type and contents of
   the Group Record(s) in that Report are determined by comparing the
   filter-mode and source-list for the affected multicast address before
   and after the change, according to <a href="#state-change-record" class="auto internal xref">Table 3</a>.  If no interface
   state existed for that multicast address before the change (i.e., the
   change consisted of creating a new per-interface record), or if no
   state exists after the change (i.e., the change consisted of deleting
   a per-interface record), then the "non-existent" state is considered
 to have a filter-mode of INCLUDE and an empty source-list.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<span id="name-transmitted-group-records-f"></span><div id="state-change-record">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-transmitted-group-records-f" class="selfRef">Transmitted Group Records for State Changes</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Old State</th>
              <th class="text-left" rowspan="1" colspan="1">New State</th>
              <th class="text-left" rowspan="1" colspan="1">State-Change Record Sent</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE (B)</td>
              <td class="text-left" rowspan="1" colspan="1">ALLOW (B-A), BLOCK (A-B)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE (B)</td>
              <td class="text-left" rowspan="1" colspan="1">ALLOW (A-B), BLOCK (B-A)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE (B)</td>
              <td class="text-left" rowspan="1" colspan="1">TO_EX (B)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE (B)</td>
              <td class="text-left" rowspan="1" colspan="1">TO_IN (B)</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-5.1-4">If the computed source-list for either an ALLOW or a BLOCK State-
   Change Record is empty, that record is omitted from the Report
    message.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">To cover the possibility of the State-Change Report being missed by
   one or more multicast routers, it is retransmitted [Robustness
   Variable] - 1 more times, at intervals chosen at random from the
    range (0, [Unsolicited Report Interval]).<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">If more changes to the same interface state entry occur before all
   the retransmissions of the State-Change Report for the first change
   have been completed, each such additional change triggers the
    immediate transmission of a State-Change Report.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">The contents of the new transmitted report are calculated as follows.
   As was done with the first report, the interface state for the
   affected group before and after the latest change is compared.  The
   report records expressing the difference are built according to <a href="#state-change-record" class="auto internal xref">Table 3</a>.  However, these records are not transmitted in a message
   but instead are merged with the contents of the pending report to create
   the new State-Change report.  The rules for merging the difference
   report resulting from the state change and the pending report are
    described below.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">The transmission of the merged State-Change Report terminates
   retransmissions of the earlier State-Change Reports for the same
   multicast address, and becomes the first of [Robustness Variable]
    transmissions of State-Change Reports.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">Each time a source is included in the difference report calculated
   above, retransmission state for that source needs to be maintained
   until [Robustness Variable] State-Change Reports have been sent by
   the host.  This is done in order to ensure that a series of
    successive state changes do not break the protocol robustness.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<p id="section-5.1-10">If the interface reception-state change that triggers the new report
   is a filter-mode change, then the next [Robustness Variable] State-Change 
   Reports will include a Filter-Mode-Change Record.  This
   applies even if any number of source-list changes occur in that
   period.  The host has to maintain retransmission state for the group
   until the [Robustness Variable] State-Change Reports have been sent.
   When [Robustness Variable] State-Change Reports with Filter-Mode-Change
   Records have been transmitted after the last filter-mode
   change, and if source-list changes to the interface reception have
   scheduled additional reports, then the next State-Change Report will
    include Source-List-Change Records.<a href="#section-5.1-10" class="pilcrow">¶</a></p>
<p id="section-5.1-11">Each time a State-Change Report is transmitted, the contents are
 determined as follows.

 If the report should contain a Filter-Mode-Change
   Record, and if the current filter-mode of the interface is
   INCLUDE, a TO_IN record is included in the report; otherwise, a TO_EX
   record is included.  If instead the report should contain a Source-List-Change
   Record, an ALLOW and a BLOCK record are included.  The
    contents of these records are built according to <a href="#sources_included" class="auto internal xref">Table 4</a>.<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<span id="name-change-record-construction"></span><div id="sources_included">
<table class="center" id="table-4">
          <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-change-record-construction" class="selfRef">Change Record Construction</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Record</th>
              <th class="text-left" rowspan="1" colspan="1">Sources Included</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TO_IN</td>
              <td class="text-left" rowspan="1" colspan="1">All in the current interface state that must be forwarded</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TO_EX</td>
              <td class="text-left" rowspan="1" colspan="1">All in the current interface state that must be blocked</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ALLOW</td>
              <td class="text-left" rowspan="1" colspan="1">All with retransmission state that must be forwarded</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">BLOCK</td>
              <td class="text-left" rowspan="1" colspan="1">All with retransmission state that must be blocked</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-5.1-13">If the computed source-list for either an ALLOW or a BLOCK record is
 empty, that record is omitted from the State-Change Report.<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<aside id="section-5.1-14">
          <p id="section-5.1-14.1">Note: When the first State-Change Report is sent, the non-existent
   pending report to merge with can be treated as a Source-Change
   Report with empty ALLOW and BLOCK records (no sources have
    retransmission state).<a href="#section-5.1-14.1" class="pilcrow">¶</a></p>
</aside>
</section>
<section id="section-5.2">
        <h3 id="name-action-on-reception-of-a-qu">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-action-on-reception-of-a-qu" class="section-name selfRef">Action on Reception of a Query</a>
        </h3>
<p id="section-5.2-1">When a system receives a Query, it does not respond immediately.
   Instead, it delays its response by a random amount of time, bounded
   by the Max Response Time value derived from the Max Resp Code in the
   received Query Message.  A system may receive a variety of Queries on
   different interfaces and of different kinds (e.g., General Queries,
   Group Specific Queries, and Group-and-Source Specific Queries), each
   of which may require its own delayed response.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Before scheduling a response to a Query, the system must first
   consider previously scheduled pending responses as, in many cases,
   it can schedule a combined response.  Therefore, the system must be able to
   maintain the following state:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1">A timer per interface for scheduling responses to General Queries.<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">A per-group and Interface Timer for scheduling responses to Group
    Specific and Group-and-Source Specific Queries.<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.3">
            <p id="section-5.2-3.3.1">A per-group and interface list of sources to be reported in the
    response to a Group-and-Source Specific Query.<a href="#section-5.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-4">When a Query with the Router Alert option arrives on an
   interface, provided the system has state to report, a delay for a
   response is randomly selected in the range (0, [Max Response Time]) where
   Max Response Time is derived from Max Resp Code in the received Query
   Message.  The following rules are then used to determine if a Report
   needs to be scheduled and the type of Report to schedule.  The rules
   are considered in order and only the first matching rule is applied.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.2-5">
<li id="section-5.2-5.1">
            <p id="section-5.2-5.1.1">If there is a pending response to a previous General Query
      scheduled sooner than the selected delay, no additional response
      needs to be scheduled.<a href="#section-5.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-5.2">
            <p id="section-5.2-5.2.1">If the received Query is a General Query, the Interface Timer is
      used to schedule a response to the General Query after the
      selected delay.  Any previously pending response to a General
      Query is canceled.<a href="#section-5.2-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-5.3">
            <p id="section-5.2-5.3.1">If the received Query is a Group Specific Query or a Group-and-
      Source Specific Query and there is no pending response to a
      previous Query for this group, then the Group Timer is used to
      schedule a report.  If the received Query is a Group-and-Source
      Specific Query, the list of queried sources is recorded to be used
      when generating a response.<a href="#section-5.2-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-5.4">
            <p id="section-5.2-5.4.1">If there already is a pending response to a previous Query
      scheduled for this group, and either the new Query is a Group
      Specific Query or the recorded source-list associated with the
      group is empty, then the group source-list is cleared and a single
      response is scheduled using the Group Timer.  The new response is
      scheduled to be sent at the earliest of the remaining time for the
      pending report and the selected delay.<a href="#section-5.2-5.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-5.5">
            <p id="section-5.2-5.5.1">If the received Query is a Group-and-Source Specific Query and
      there is a pending response for this group with a non-empty
      source-list, then the group source-list is augmented to contain
      the list of sources in the new Query and a single response is
      scheduled using the Group Timer.  The new response is scheduled to
      be sent at the earliest of the remaining time for the pending
     report and the selected delay.<a href="#section-5.2-5.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.2-6">When the timer in a pending response record expires, the system
   transmits, on the associated interface, one or more Report messages
    carrying one or more Current-State Records (see <a href="#grp_rec_types" class="auto internal xref">Section 4.2.13</a>), as
   follows:<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.2-7">
<li id="section-5.2-7.1">
            <p id="section-5.2-7.1.1">If the expired timer is the Interface Timer (i.e., it is a pending
      response to a General Query), then one Current-State Record is
      sent for each multicast address for which the specified interface
    has reception state, as described in <a href="#if_state" class="auto internal xref">Section 3.2</a>.  The Current-State Record carries the multicast address and its associated
      filter-mode (MODE_IS_INCLUDE or MODE_IS_EXCLUDE) and source-list.
      Multiple Current-State Records are packed into individual Report
      messages, to the extent possible.<a href="#section-5.2-7.1.1" class="pilcrow">¶</a></p>
<p id="section-5.2-7.1.2">
      This naive algorithm may result in bursts of packets when a system
      is a member of a large number of groups.  Instead of using a
      single Interface Timer, implementations are recommended to spread
      transmission of such Report messages over the interval (0, [Max
      Response Time]).  Note that any such implementation <span class="bcp14">MUST</span> avoid the
      "ack-implosion" problem, i.e., <span class="bcp14">MUST NOT</span> send a Report immediately
      on reception of a General Query.<a href="#section-5.2-7.1.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-7.2">
            <p id="section-5.2-7.2.1">If the expired timer is a Group Timer and the list of recorded
      sources for that group is empty (i.e., it is a pending
      response to a Group Specific Query), then if and only if the
      interface has reception state for that group address, a single
      Current-State Record is sent for that address.  The Current-State
      Record carries the multicast address and its associated filter-mode
    (MODE_IS_INCLUDE or MODE_IS_EXCLUDE) and source-list.<a href="#section-5.2-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.2-7.3">
            If the expired timer is a Group Timer and the list of recorded
      sources for that group is non-empty (i.e., it is a pending
      response to a Group-and-Source Specific Query), then if and only
      if the interface has reception state for that group address, the
      contents of the responding Current-State Record is determined from
      the interface state and the pending response record, as specified
    in <a href="#per-interface-state" class="auto internal xref">Table 5</a>.<a href="#section-5.2-7.3" class="pilcrow">¶</a>
</li>
        </ol>
<span id="name-current-state-record-constr"></span><div id="per-interface-state">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-current-state-record-constr" class="selfRef">Current-State Record Construction</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Per-Interface State</th>
              <th class="text-left" rowspan="1" colspan="1">Set of Sources in the Pending Response Record</th>
              <th class="text-left" rowspan="1" colspan="1">Current-State Record</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">B</td>
              <td class="text-left" rowspan="1" colspan="1">IS_IN (A*B)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A)</td>
              <td class="text-left" rowspan="1" colspan="1">B</td>
              <td class="text-left" rowspan="1" colspan="1">IS_IN (B-A)</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-5.2-9">If the resulting Current-State Record has an empty set of source
    addresses, then no response is sent.<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<p id="section-5.2-10">Finally, after any required Report messages have been generated, the
    source-lists associated with any reported groups are cleared.<a href="#section-5.2-10" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="mcast_rtrs">
<section id="section-6">
      <h2 id="name-description-of-the-protocol-">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-description-of-the-protocol-" class="section-name selfRef">Description of the Protocol for Multicast Routers</a>
      </h2>
<p id="section-6-1">The purpose of IGMP is to enable each multicast router to learn, for
   each of its directly attached networks, which multicast addresses are
   of interest to the systems attached to those networks.  IGMPv3 adds the capability for a multicast router to also learn  which
   sources are of interest to neighboring systems, for packets sent to
   any particular multicast address.  The information gathered by IGMP
   is provided to whichever multicast routing protocol is being used by
   the router, in order to ensure that multicast packets are delivered
    to all networks where there are interested receivers.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">This section describes the part of IGMPv3 that is performed by
   multicast routers.  Multicast routers may also themselves become
   members of multicast groups, and therefore also perform the group
    member part of IGMPv3, as described in <a href="#grp_mbrs" class="auto internal xref">Section 5</a>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">A multicast router performs the protocol described in this section
   over each of its directly attached networks.  If a multicast router
   has more than one interface to the same network, it only needs to
   operate this protocol over one of those interfaces.  On each
   interface over which this protocol is being run, the router <span class="bcp14">MUST</span>
   enable reception of multicast address 224.0.0.22 from all sources
   (and <span class="bcp14">MUST</span> perform the group member part of IGMPv3 for that address on
    that interface).<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Multicast routers need to know only that at least one system on an
   attached network is interested in packets to a particular multicast
   address from a particular source; a multicast router is not required
   to keep track of the interests of each individual neighboring system.
    (However, see <a href="#suppression" class="auto internal xref">Appendix A.2</a>, item 1 for discussion.)<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">IGMPv3 is backward compatible with previous versions of the IGMP
   protocol.  In order to remain backward compatible with older IGMP
   systems, IGMPv3 multicast routers <span class="bcp14">MUST</span> also implement versions 1 and
    2 of the protocol (see <a href="#interop" class="auto internal xref">Section 7</a>).<a href="#section-6-5" class="pilcrow">¶</a></p>
<section id="section-6.1">
        <h3 id="name-conditions-for-igmp-queries">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-conditions-for-igmp-queries" class="section-name selfRef">Conditions for IGMP Queries</a>
        </h3>
<p id="section-6.1-1">Multicast routers send General Queries periodically to request group
   membership information from an attached network.  These Queries are
   used to build and refresh the group membership state of systems on
   attached networks.  Systems respond to these Queries by reporting
   their group membership state (and their desired set of sources) with
    Current-State Records in IGMPv3 Membership Reports.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">As a member of a multicast group, a system may express interest in
   receiving or not receiving traffic from particular sources.  As the
   desired reception state of a system changes, it reports these changes
   using Filter-Mode-Change Records or Source-List-Change Records.
   These records indicate an explicit state change in a group at a
   system in either the Group Record's source-list or its filter-mode.
   When a group membership is terminated at a system or traffic from a
   particular source is no longer desired, a multicast router must query
   for other members of the group or listeners of the source before
    deleting the group (or source) and pruning its traffic.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">To enable all systems on a network to respond to changes in group
 membership, multicast routers send specific queries. A Group Specific
   Query is sent to verify there are no systems that desire
   reception of the specified group or to "rebuild" the desired
   reception state for a particular group.  Group Specific Queries are
   sent when a router receives a State-Change Record indicating a system
    is leaving a group.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">A Group-and-Source Specific Query is used to verify there are no
   systems on a network that desire receiving traffic from a set of
   sources.  Group-and-Source Specific Queries list sources for a
   particular group that have been requested to no longer be forwarded.
   This query is sent by a multicast router to learn if any systems
   desire reception of packets to the specified group address from the
   specified source addresses.  Group-and-Source Specific Queries are
   only sent in response to State-Change Records and never in response
    to Current-State Records.  <a href="#qry_vars" class="auto internal xref">Section 4.1.11</a> describes each query in
    more detail.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
</section>
<section id="section-6.2">
        <h3 id="name-igmp-state-maintained-by-mu">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-igmp-state-maintained-by-mu" class="section-name selfRef">IGMP State Maintained by Multicast Routers</a>
        </h3>
<p id="section-6.2-1">Multicast routers implementing IGMPv3 keep state per group per
   attached network.  This group state consists of a filter-mode, a list
   of sources, and various timers.  For each attached network running
   IGMP, a multicast router records the desired reception state for that
   network.  That state conceptually consists of a set of records of the
   form:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-6.2-2">
<pre>
  (multicast address, Group Timer, Router Filter Mode, (source records))</pre><a href="#section-6.2-2" class="pilcrow">¶</a>
</div>
<p id="section-6.2-3">Each source record is of the form:<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-pseudocode art-text artwork" id="section-6.2-4">
<pre>
  (source address, Source Timer)</pre><a href="#section-6.2-4" class="pilcrow">¶</a>
</div>
<p id="section-6.2-5">If all sources within a given group are desired, an empty source
   record list is kept with filter-mode set to EXCLUDE.  This means
   hosts on this network want all sources for this group to be
   forwarded.  This is the IGMPv3 equivalent to an IGMPv1 or IGMPv2 group
   join.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<div id="sec-rfm">
<section id="section-6.2.1">
          <h4 id="name-definition-of-router-filter">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-definition-of-router-filter" class="section-name selfRef">Definition of Router Filter Mode</a>
          </h4>
<p id="section-6.2.1-1">To reduce internal state, IGMPv3 routers keep a filter-mode per group
   per attached network.  This filter-mode is used to condense the total
   desired reception state of a group to a minimum set such that all
   systems' memberships are satisfied.  This filter-mode may change in
   response to the reception of particular types of Group Records or
   when certain timer conditions occur.  In the following sections, we
   use the term Router Filter Mode to refer to the filter-mode of a
    particular group within a router.  <a href="#rcv_rpts" class="auto internal xref">Section 6.4</a> describes the changes of a Router Filter Mode per Group Record received.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">Conceptually, when a Group Record is received, the Router Filter Mode
   for that group is updated to cover all the requested sources using
   the least amount of state.  As a rule, once a Group Record with a
   filter-mode of EXCLUDE is received, the Router Filter Mode for that
    group will be EXCLUDE.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-3">When a Router Filter Mode for a group is EXCLUDE, the source record
   list contains two types of sources.  The first type is the set that
   represents conflicts in the desired reception state; this set must be
   forwarded by some router on the network.  The second type is the set
   of sources that hosts have requested to not be forwarded.  <a href="#rationale" class="auto internal xref">Appendix A</a>
   describes the reasons for keeping two different sets when in EXCLUDE
    mode.<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4">When a Router Filter Mode for a group is INCLUDE, the source record
   list is the list of sources desired for the group.  This is the total
   desired set of sources for that group.  Each source in the source
    record list must be forwarded by some router on the network.<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
<p id="section-6.2.1-5">Because a reported Group Record with a filter-mode of EXCLUDE will
   cause a router to transition its filter-mode for that group to
   EXCLUDE, a mechanism for transitioning a router's filter-mode back to
   INCLUDE must exist.  If all systems with a Group Record in EXCLUDE
   filter-mode cease reporting, it is desirable for the Router Filter
   Mode for that group to transition back to INCLUDE mode.  This
   transition occurs when the Group Timer expires and is explained in
    detail in <a href="#fltr_modes" class="auto internal xref">Section 6.5</a>.<a href="#section-6.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.2.2">
          <h4 id="name-definition-of-group-timers">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-definition-of-group-timers" class="section-name selfRef">Definition of Group Timers</a>
          </h4>
<p id="section-6.2.2-1">The Group Timer is only used when a group is in EXCLUDE mode and it
   represents the time for the filter-mode of the group to expire and
   switch to INCLUDE mode.  We define a Group Timer as a decrementing
   timer with a lower bound of zero kept per group per attached network.
   Group timers are updated according to the types of Group Records
    received.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-2">A Group Timer expiring when a Router Filter Mode for the group is
   EXCLUDE means there are no listeners on the attached network in
   EXCLUDE mode.  At this point, a router will transition to INCLUDE
    filter-mode.  <a href="#fltr_modes" class="auto internal xref">Section 6.5</a> describes the actions taken when a Group
    Timer expires while in EXCLUDE mode.<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3"><a href="#group-timer" class="auto internal xref">Table 6</a> summarizes the role of the Group Timer.  
   <a href="#rcv_rpts" class="auto internal xref">Section 6.4</a> describes the details of setting the Group Timer per type of
    Group Record received.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
<span id="name-group-timer-actions"></span><div id="group-timer">
<table class="center" id="table-6">
            <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-group-timer-actions" class="selfRef">Group Timer Actions</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Group Filter-Mode</th>
                <th class="text-left" rowspan="1" colspan="1">Group Timer Value</th>
                <th class="text-left" rowspan="1" colspan="1">Actions/Comments</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE</td>
                <td class="text-left" rowspan="1" colspan="1">Timer &gt;= 0</td>
                <td class="text-left" rowspan="1" colspan="1">All members in INCLUDE mode.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE</td>
                <td class="text-left" rowspan="1" colspan="1">Timer &gt; 0</td>
                <td class="text-left" rowspan="1" colspan="1">At least one member in EXCLUDE mode.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE</td>
                <td class="text-left" rowspan="1" colspan="1">Timer == 0</td>
                <td class="text-left" rowspan="1" colspan="1">No more listeners to group.  If all source timers have expired, then
       delete Group Record.  If there are still source record timers running,
       switch to INCLUDE filter-mode using those source records with running
       timers as the INCLUDE source record state.</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
<section id="section-6.2.3">
          <h4 id="name-definition-of-source-timers">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-definition-of-source-timers" class="section-name selfRef">Definition of Source Timers</a>
          </h4>
<p id="section-6.2.3-1">A Source Timer is kept per source record and is a decrementing timer
   with a lower bound of zero.  Source timers are updated according to
   the type and filter-mode of the Group Record received.  Source timers
   are always updated (for a particular group) whenever the source is
   present in a received record for that group.  <a href="#rcv_rpts" class="auto internal xref">Section 6.4</a> describes
   the setting of source timers per type of Group Records received.<a href="#section-6.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.3-2">A source record with a running timer with a Router Filter Mode for
   the group of INCLUDE means that there is currently one or more
   systems (in INCLUDE filter-mode) that desire to receive that source.
   If a Source Timer expires with a Router Filter Mode for the group of
   INCLUDE, the router concludes that traffic from this particular
   source is no longer desired on the attached network and deletes the
   associated source record.<a href="#section-6.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.2.3-3">Source timers are treated differently when a Router Filter Mode for a
   group is EXCLUDE.  If a source record has a running timer with a
   Router Filter Mode for the group of EXCLUDE, it means that at least
   one system desires the source.  It should therefore be forwarded by a
   router on the network.  <a href="#rationale" class="auto internal xref">Appendix A</a> describes the reasons for keeping
   state for sources that have been requested to be forwarded while in
   EXCLUDE state.<a href="#section-6.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.2.3-4">If a Source Timer expires with a Router Filter Mode for the group of
   EXCLUDE, the router informs the routing protocol that there is no
   longer a receiver on the network interested in traffic from this
   source.<a href="#section-6.2.3-4" class="pilcrow">¶</a></p>
<p id="section-6.2.3-5">When a Router Filter Mode for a group is EXCLUDE, source records are
   only deleted when the Group Timer expires.  <a href="#ss_fwd" class="auto internal xref">Section 6.3</a> describes the
   actions that should be taken dependent upon the value of a Source
   Timer.<a href="#section-6.2.3-5" class="pilcrow">¶</a></p>
</section>
</section>
<div id="ss_fwd">
<section id="section-6.3">
        <h3 id="name-igmpv3-source-specific-forw">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-igmpv3-source-specific-forw" class="section-name selfRef">IGMPv3 Source-Specific Forwarding Rules</a>
        </h3>
<p id="section-6.3-1">When a multicast router receives a datagram from a source destined to
   a particular group, a decision has to be made whether to forward the
   datagram onto an attached network or not.  The multicast routing
   protocol in use is in charge of this decision and should use the
   IGMPv3 information to ensure that all sources/groups desired on a
   subnetwork are forwarded to that subnetwork.  IGMPv3 information does
   not override multicast routing information; for example, if the
   IGMPv3 filter-mode group for G is EXCLUDE, a router may still forward
    packets for excluded sources to a transit subnet.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">To summarize, <a href="#forwarding_suggestions" class="auto internal xref">Table 7</a> describes the forwarding
   suggestions made by IGMP to the routing protocol for traffic
   originating from a source destined to a group.  It also summarizes
   the actions taken upon the expiration of a Source Timer based on the
    Router Filter Mode of the group.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<span id="name-igmp-forwarding-recommendat"></span><div id="forwarding_suggestions">
<table class="center" id="table-7">
          <caption>
<a href="#table-7" class="selfRef">Table 7</a>:
<a href="#name-igmp-forwarding-recommendat" class="selfRef">IGMP Forwarding Recommendations</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Group Filter-Mode</th>
              <th class="text-left" rowspan="1" colspan="1">Group Timer Value</th>
              <th class="text-left" rowspan="1" colspan="1">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">TIMER &gt; 0</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to forward traffic from source.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">TIMER == 0</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to stop forwarding traffic from
       source and remove source record.  If there are no more source
       records for the group, delete Group Record.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">INCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">No Source Elements</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to not forward source.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">TIMER &gt; 0</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to forward traffic from source.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">TIMER == 0</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to not forward traffic from source (DO NOT remove record).</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXCLUDE</td>
              <td class="text-left" rowspan="1" colspan="1">No Source Elements</td>
              <td class="text-left" rowspan="1" colspan="1">Suggest to forward traffic from source.</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="rcv_rpts">
<section id="section-6.4">
        <h3 id="name-action-on-reception-of-repo">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-action-on-reception-of-repo" class="section-name selfRef">Action on Reception of Reports</a>
        </h3>
<p id="section-6.4-1">SSM-aware routers <span class="bcp14">SHOULD</span> ignore records that contain multicast addresses
   in the SSM address range if the record type is MODE_IS_EXCLUDE or
   CHANGE_TO_EXCLUDE_MODE. SSM-aware routers <span class="bcp14">SHOULD</span> ignore IGMPv1/IGMPv2
   Report and IGMPv2 DONE messages that contain multicast addresses in the SSM address range, <span class="bcp14">SHOULD NOT</span>
   use such Reports to establish IP forwarding state, and <span class="bcp14">MAY</span> log an error if it receives
   such a message.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<section id="section-6.4.1">
          <h4 id="name-reception-of-current-state-">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-reception-of-current-state-" class="section-name selfRef">Reception of Current-State Records</a>
          </h4>
<p id="section-6.4.1-1">When receiving Current-State Records, a router updates both its group
   and source timers.  In some circumstances, the reception of a type of
   Group Record will cause the Router Filter Mode for that group to
   change.  <a href="#router_state_8" class="auto internal xref">Table 8</a> describes the actions, with respect to state
   and timers that occur to a router's state upon reception of Current-
   State Records.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">The following notation is used to describe the updating of source
   timers.  The notation ( A, B ) will be used to represent the total
   number of sources for a particular group, where<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4.1-3.1"> A = set of source records whose source timers &gt; 0 (Sources that at
     least one host has requested to be forwarded)<a href="#section-6.4.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.4.1-3.2"> B = set of source records whose source timers = 0 (Sources that IGMP
will suggest to the routing protocol not to forward)<a href="#section-6.4.1-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.4.1-4">Note that there will only be two sets when a router's filter-mode for
   a group is EXCLUDE.  When a router's filter-mode for a group is
   INCLUDE, a single set is used to describe the set of sources
   requested to be forwarded (e.g., simply (A)).<a href="#section-6.4.1-4" class="pilcrow">¶</a></p>
<p id="section-6.4.1-5">In Tables <a href="#router_state_8" class="auto internal xref">8</a> and <a href="#router_state_9" class="auto internal xref">9</a>, abbreviations are used for several variables
    (all of which are described in detail in <a href="#timers" class="auto internal xref">Section 8</a>).  The variable
   GMI is an abbreviation for the Group Membership Interval, which is
   the time in which group memberships will time out.  The variable LMQT
   is an abbreviation for the Last Member Query Time, which is the total
   time spent after [Last Member Query Count] retransmissions.  LMQT
   represents the leave latency or the difference between the
   transmission of a membership change and the change in the information
   given to the routing protocol.<a href="#section-6.4.1-5" class="pilcrow">¶</a></p>
<p id="section-6.4.1-6">Within the "Actions" section of the router state tables, we use the
   notation 'A=J', which means that the set A of source records should
   have their source timers set to value J.  'Delete A' means that the
   set A of source records should be deleted.  'Group Timer=J' means
   that the Group Timer for the group should be set to value J.<a href="#section-6.4.1-6" class="pilcrow">¶</a></p>
<span id="name-actions-on-current-state-re"></span><div id="router_state_8">
<table class="center" id="table-8">
            <caption>
<a href="#table-8" class="selfRef">Table 8</a>:
<a href="#name-actions-on-current-state-re" class="selfRef">Actions on Current-State Report Reception</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Router State</th>
                <th class="text-left" rowspan="1" colspan="1">Report Rec'd</th>
                <th class="text-left" rowspan="1" colspan="1">New Router State</th>
                <th class="text-left" rowspan="1" colspan="1">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">IS_IN (B)</td>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A+B)</td>
                <td class="text-left" rowspan="1" colspan="1">(B)=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">IS_EX (B)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A*B,B-A)</td>
                <td class="text-left" rowspan="1" colspan="1">(B-A)=0<br>Delete (A-B)<br>Group Timer=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">IS_IN (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X+A,Y-A)</td>
                <td class="text-left" rowspan="1" colspan="1">(A)=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">IS_EX (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A-Y,Y*A)</td>
                <td class="text-left" rowspan="1" colspan="1">(A-X-Y)=GMI<br>Delete (X-A)<br>Delete (Y-A)<br>Group Timer=GMI</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
<div id="slc_recs">
<section id="section-6.4.2">
          <h4 id="name-reception-of-filter-mode-ch">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-reception-of-filter-mode-ch" class="section-name selfRef">Reception of Filter-Mode-Change and Source-List-Change Records</a>
          </h4>
<p id="section-6.4.2-1">When a change in the global state of a group occurs in a system, the
   system sends either a Source-List-Change Record or a Filter-Mode-
   Change Record for that group.  As with Current-State Records, routers
   must act upon these records and possibly change their own state to
   reflect the new desired membership state of the network.<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<p id="section-6.4.2-2">Routers must query sources that are requested to be no longer
   forwarded to a group.  When a router queries or receives a query for
   a specific set of sources, it lowers its source timers for those
   sources to a small interval of [Last Member Query Time] seconds.  If
   Group Records are received in response to the queries which express
   interest in receiving traffic from the queried sources, the
   corresponding timers are updated.<a href="#section-6.4.2-2" class="pilcrow">¶</a></p>
<p id="section-6.4.2-3">Similarly, when a router queries a specific group, it lowers its
   Group Timer for that group to a small interval of [Last Member Query
   Time] seconds.  If any Group Records expressing EXCLUDE mode interest
   in the group are received within the interval, the Group Timer for
   the group is updated and the suggestion to the routing protocol to
   forward the group stands without any interruption.<a href="#section-6.4.2-3" class="pilcrow">¶</a></p>
<p id="section-6.4.2-4">During a query period (i.e., [Last Member Query Time] seconds), the
   IGMP component in the router continues to suggest to the routing
   protocol that it forwards traffic from the groups or sources that it
   is querying.  It is not until after [Last Member Query Time] seconds
   without receiving a record expressing interest in the queried group
   or sources that the router may prune the group or sources from the
   network.<a href="#section-6.4.2-4" class="pilcrow">¶</a></p>
<p id="section-6.4.2-5"> <a href="#router_state_9" class="auto internal xref">Table 9</a> describes the changes in group state and the
   action(s) taken when receiving either Filter-Mode-Change or Source-List-Change
   Records.  This table also describes the queries that are
   sent by the querier when a particular report is received.<a href="#section-6.4.2-5" class="pilcrow">¶</a></p>
<p id="section-6.4.2-6">We use the following notation for describing the queries that are
   sent.  We use the notation 'Q(G)' to describe a Group Specific Query
   to G.  We use the notation 'Q(G,A)' to describe a Group-and-Source
   Specific Query to G with source-list A.  If source-list A is null as
   a result of the action (e.g., A*B), then no query is sent as a result
   of the operation.<a href="#section-6.4.2-6" class="pilcrow">¶</a></p>
<p id="section-6.4.2-7">In order to maintain protocol robustness, queries sent by actions in
   <a href="#router_state_9" class="auto internal xref">Table 9</a> need to be transmitted [Last Member Query Count]
   times, once every [Last Member Query Interval].<a href="#section-6.4.2-7" class="pilcrow">¶</a></p>
<p id="section-6.4.2-8">If while scheduling new queries there are already pending queries to
   be retransmitted for the same group, the new and pending queries have
   to be merged.  In addition, received host reports for a group with
   pending queries may affect the contents of those queries.  
   <a href="#ssqs" class="auto internal xref">Section 6.6.3</a> describes the process of building and maintaining the state of
   pending queries.<a href="#section-6.4.2-8" class="pilcrow">¶</a></p>
<span id="name-actions-on-change-record-re"></span><div id="router_state_9">
<table class="center" id="table-9">
            <caption>
<a href="#table-9" class="selfRef">Table 9</a>:
<a href="#name-actions-on-change-record-re" class="selfRef">Actions on Change Record Reception</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Router State</th>
                <th class="text-left" rowspan="1" colspan="1">Report Rec'd</th>
                <th class="text-left" rowspan="1" colspan="1">New Router State</th>
                <th class="text-left" rowspan="1" colspan="1">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">ALLOW (B)</td>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A+B)</td>
                <td class="text-left" rowspan="1" colspan="1">(B)=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">BLOCK (B)</td>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">Send Q(G,A*B)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">TO_EX (B)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A*B,B-A)</td>
                <td class="text-left" rowspan="1" colspan="1">(B-A)=0<br>Delete (A-B)<br>Send Q(G,A*B)<br>Group Timer=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A)</td>
                <td class="text-left" rowspan="1" colspan="1">TO_IN (B)</td>
                <td class="text-left" rowspan="1" colspan="1">INCLUDE (A+B)</td>
                <td class="text-left" rowspan="1" colspan="1">(B)=GMI<br>Send Q(G,A-B)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">ALLOW (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X+A,Y-A)</td>
                <td class="text-left" rowspan="1" colspan="1">(A)=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">BLOCK (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X+(A-Y),Y)</td>
                <td class="text-left" rowspan="1" colspan="1">(A-X-Y)=Group Timer<br>Send Q(G,A-Y)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">TO_EX (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (A-Y,Y*A)</td>
                <td class="text-left" rowspan="1" colspan="1">(A-X-Y)=Group Timer<br>Delete (X-A)<br>Delete (Y-A)<br>Send Q(G,A-Y)<br>Group Timer=GMI</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X,Y)</td>
                <td class="text-left" rowspan="1" colspan="1">TO_IN (A)</td>
                <td class="text-left" rowspan="1" colspan="1">EXCLUDE (X+A,Y-A)</td>
                <td class="text-left" rowspan="1" colspan="1">(A)=GMI<br>Send Q(G,X-A)<br>Send Q(G)</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
</section>
</div>
<div id="fltr_modes">
<section id="section-6.5">
        <h3 id="name-switching-router-filter-mod">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-switching-router-filter-mod" class="section-name selfRef">Switching Router Filter Modes</a>
        </h3>
<p id="section-6.5-1">The Group Timer is used as a mechanism for transitioning the Router
   Filter Mode from EXCLUDE to INCLUDE.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">When a Group Timer expires with a Router Filter Mode of EXCLUDE, a
   router assumes that there are no systems with a filter-mode of
   EXCLUDE present on the attached network.  When a router's filter-mode
   for a group is EXCLUDE and the Group Timer expires, the Router
   Filter Mode for the group transitions to INCLUDE.<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<p id="section-6.5-3">A router uses source records with running source timers as its state
   for the switch to a filter-mode of INCLUDE.  If there are any source
   records with source timers greater than zero (i.e., requested to be
   forwarded), a router switches to filter-mode of INCLUDE using those
   source records.  Source records whose timers are zero (from the
   previous EXCLUDE mode) are deleted.<a href="#section-6.5-3" class="pilcrow">¶</a></p>
<p id="section-6.5-4">For example, if a router's state for a group is EXCLUDE(X,Y) and the
   Group Timer expires for that group, the router switches to filter-
   mode of INCLUDE with state INCLUDE(X).<a href="#section-6.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6.6">
        <h3 id="name-action-on-reception-of-quer">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-action-on-reception-of-quer" class="section-name selfRef">Action on Reception of Queries</a>
        </h3>
<section id="section-6.6.1">
          <h4 id="name-timer-updates">
<a href="#section-6.6.1" class="section-number selfRef">6.6.1. </a><a href="#name-timer-updates" class="section-name selfRef">Timer Updates</a>
          </h4>
<p id="section-6.6.1-1">When a router sends or receives a query with a clear Suppress
   Router-Side Processing flag, it must update its timers to reflect the
   correct timeout values for the group or sources being queried. <a href="#timer_actions" class="auto internal xref">Table 10</a> describes the timer actions when sending or receiving
   a Group Specific or Group-and-Source Specific Query with the S flag not set.<a href="#section-6.6.1-1" class="pilcrow">¶</a></p>
<span id="name-timer-updates-on-query"></span><div id="timer_actions">
<table class="center" id="table-10">
            <caption>
<a href="#table-10" class="selfRef">Table 10</a>:
<a href="#name-timer-updates-on-query" class="selfRef">Timer Updates on Query</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Query</th>
                <th class="text-left" rowspan="1" colspan="1">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Q(G,A)</td>
                <td class="text-left" rowspan="1" colspan="1">Source Timer for sources in A are lowered to LMQT</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Q(G)</td>
                <td class="text-left" rowspan="1" colspan="1">Group Timer is lowered to LMQT</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-6.6.1-3">When a router sends or receives a query with the S flag set, it will not update its timers.<a href="#section-6.6.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-6.6.2">
          <h4 id="name-querier-election">
<a href="#section-6.6.2" class="section-number selfRef">6.6.2. </a><a href="#name-querier-election" class="section-name selfRef">Querier Election</a>
          </h4>
<p id="section-6.6.2-1">IGMPv3 elects a single querier per subnet using the same Querier
   election mechanism as IGMPv2, namely by IP address.  When a router
   receives a General Query with a lower IP address, it sets the Other-Querier-Present
   Timer to [Other Querier Present Interval] and ceases to send
   general queries on the network if it was the previously elected querier.
   After its Other-Querier-Present Timer expires, it should begin
   sending General Queries.<a href="#section-6.6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.6.2-2">If a router receives an older version General Query, it <span class="bcp14">MUST</span> use the oldest
   version of IGMP on the network.  For a detailed description of
    compatibility issues between IGMP versions, see <a href="#interop" class="auto internal xref">Section 7</a>.<a href="#section-6.6.2-2" class="pilcrow">¶</a></p>
</section>
<div id="ssqs">
<section id="section-6.6.3">
          <h4 id="name-building-and-sending-specif">
<a href="#section-6.6.3" class="section-number selfRef">6.6.3. </a><a href="#name-building-and-sending-specif" class="section-name selfRef">Building and Sending Specific Queries</a>
          </h4>
<section id="section-6.6.3.1">
            <h5 id="name-building-and-sending-group-">
<a href="#section-6.6.3.1" class="section-number selfRef">6.6.3.1. </a><a href="#name-building-and-sending-group-" class="section-name selfRef">Building and Sending Group Specific Queries</a>
            </h5>
<p id="section-6.6.3.1-1">When a table action "Send Q(G)" is encountered, the Group Timer
   must be lowered to LMQT.  The router must then immediately send a
   Group Specific Query as well as schedule [Last Member Query Count] - 1
   query retransmission(s) to be sent every [Last Member Query
    Interval] over [Last Member Query Time].<a href="#section-6.6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.6.3.1-2">When transmitting a Group Specific Query, if the Group Timer is
   larger than LMQT, the "Suppress Router-Side Processing" bit is set in
    the Query Message.<a href="#section-6.6.3.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-6.6.3.2">
            <h5 id="name-building-and-sending-group-a">
<a href="#section-6.6.3.2" class="section-number selfRef">6.6.3.2. </a><a href="#name-building-and-sending-group-a" class="section-name selfRef">Building and Sending Group-and-Source Specific Queries</a>
            </h5>
<p id="section-6.6.3.2-1">When a table action "Send Q(G,X)" is encountered by a querier in <a href="#router_state_9" class="auto internal xref">Table 9</a> (<a href="#slc_recs" class="auto internal xref">Section 6.4.2</a>), the following actions must be performed for each of the sources in X of group G, with the Source Timer larger than
   LMQT:<a href="#section-6.6.3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.6.3.2-2.1">
                <p id="section-6.6.3.2-2.1.1">Set the number of retransmissions for each source to [Last Member Query Count].<a href="#section-6.6.3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.6.3.2-2.2">
                <p id="section-6.6.3.2-2.2.1">Lower the Source Timer to LMQT.<a href="#section-6.6.3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.6.3.2-3">The router must then immediately send a Group-and-Source Specific
   Query as well as schedule [Last Member Query Count] - 1 query
   retransmission(s) to be sent every [Last Member Query Interval] over
   [Last Member Query Time].  The contents of these queries are
   calculated as follows.<a href="#section-6.6.3.2-3" class="pilcrow">¶</a></p>
<p id="section-6.6.3.2-4">When building a Group-and-source Specific Query for group G, two
   separate Query Messages are sent for the group.  The first one has
   the "Suppress Router-Side Processing" bit set and contains all the
   sources with retransmission state and timers greater than LMQT.  The
   second has the "Suppress Router-Side Processing" bit clear and
   contains all the sources with retransmission state and timers lower
   or equal to LMQT.  If either of the two calculated messages does not
   contain any sources, then its transmission is suppressed.<a href="#section-6.6.3.2-4" class="pilcrow">¶</a></p>
<aside id="section-6.6.3.2-5">
              <p id="section-6.6.3.2-5.1">Note: If a Group Specific Query is scheduled to be transmitted at the
   same time as a Group-and-Source Specific Query for the same group,
   then transmission of the Group-and-Source Specific Query Message with the
   "Suppress Router-Side Processing" bit set may be suppressed.<a href="#section-6.6.3.2-5.1" class="pilcrow">¶</a></p>
</aside>
</section>
</section>
</div>
</section>
</section>
</div>
<div id="interop">
<section id="section-7">
      <h2 id="name-interoperation-with-older-v">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-interoperation-with-older-v" class="section-name selfRef">Interoperation With Older Versions of IGMP</a>
      </h2>
<p id="section-7-1">IGMPv3 hosts and routers interoperate with hosts and routers
   that have not yet been upgraded to IGMPv3.  This compatibility is
   maintained by hosts and routers taking appropriate actions depending
   on the versions of IGMP operating on hosts and routers within a
   network.<a href="#section-7-1" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-query-version-distinctions">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-query-version-distinctions" class="section-name selfRef">Query Version Distinctions</a>
        </h3>
<p id="section-7.1-1">The IGMP version of a Membership Query Message is determined as
   follows:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">
            <p id="section-7.1-2.1.1">IGMPv1 Query: length = 8 octets AND Max Resp Code field is zero<a href="#section-7.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-2.2">
            <p id="section-7.1-2.2.1">IGMPv2 Query: length = 8 octets AND Max Resp Code field is non-zero<a href="#section-7.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-2.3">
            <p id="section-7.1-2.3.1">IGMPv3 Query: length &gt;= 12 octets<a href="#section-7.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.1-3">Query Messages that do not match any of the above conditions (e.g., a
   Query of length 10 octets) <span class="bcp14">MUST</span> be silently ignored.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2">
        <h3 id="name-group-member-behavior">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-group-member-behavior" class="section-name selfRef">Group Member Behavior</a>
        </h3>
<section id="section-7.2.1">
          <h4 id="name-in-the-presence-of-older-ve">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-in-the-presence-of-older-ve" class="section-name selfRef">In the Presence of Older Version Queriers</a>
          </h4>
<p id="section-7.2.1-1">In order to be compatible with older version routers, IGMPv3 hosts
   <span class="bcp14">MUST</span> operate in v1 and v2 compatibility modes. IGMPv3
   hosts <span class="bcp14">MUST</span> keep state per local interface regarding the compatibility mode of each attached network.  A host's compatibility mode is
   determined from the Host Compatibility Mode variable, which can be in
   one of three states:  IGMPv1, IGMPv2, or IGMPv3.  This variable is
   kept per interface and is dependent on the version of General Queries
   received on that interface as well as the Older-Version-Querier-Present
    Timer for the interface.<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-2">In order to switch gracefully between versions of IGMP, hosts keep
   both an IGMPv1-Querier-Present Timer and an IGMPv2-Querier-Present
   Timer per interface.  IGMPv1-Querier-Present Timer is set to [Older Version
   Querier Present Interval] seconds whenever an IGMPv1 Membership Query
   is received.  IGMPv2-Querier-Present Timer is set to [Older Version Querier
    Present Interval] seconds whenever an IGMPv2 General Query is received.<a href="#section-7.2.1-2" class="pilcrow">¶</a></p>
<p id="section-7.2.1-3">The Host Compatibility Mode of an interface changes whenever an older
   version query (than the current compatibility mode) is received or when
   certain timer conditions occur.  When the IGMPv1-Querier-Present
   Timer expires, a host switches to Host Compatibility Mode of IGMPv2
   if it has a running IGMPv2 Querier Present timer.  If it does not
   have a running IGMPv2 Querier Present timer, then it switches to Host
   Compatibility of IGMPv3.  When the IGMPv2 Querier Present timer
    expires, a host switches to Host Compatibility Mode of IGMPv3.<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<p id="section-7.2.1-4">The Host Compatibility Mode variable is based on whether an older
   version General Query was received in the last [Older Version Querier
   Present Interval] seconds. The Host Compatibility Mode variable value <span class="bcp14">MUST NOT</span>
   be changed by an older version Group Specific Query.
   The Host Compatibility Mode is set depending on the following:<a href="#section-7.2.1-4" class="pilcrow">¶</a></p>
<span id="name-host-compatibility-mode-set"></span><table class="center" id="table-11">
            <caption>
<a href="#table-11" class="selfRef">Table 11</a>:
<a href="#name-host-compatibility-mode-set" class="selfRef">Host Compatibility Mode Settings</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Host Compatibility Mode</th>
                <th class="text-left" rowspan="1" colspan="1">Timer State</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv3 (default)</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2 Querier Present not running and IGMPv1 Querier Present not running</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2 Querier Present running and IGMPv1 Querier Present not running</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv1</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv1 Querier Present running</td>
              </tr>
            </tbody>
          </table>
<p id="section-7.2.1-6">If a host receives a query that causes its Querier Present timers to
   be updated and correspondingly its compatibility mode, it should
   switch compatibility modes immediately.<a href="#section-7.2.1-6" class="pilcrow">¶</a></p>
<p id="section-7.2.1-7">When Host Compatibility Mode is IGMPv3, a host acts using the IGMPv3
   protocol on that interface.  When Host Compatibility Mode is IGMPv2,
   a host acts in IGMPv2 compatibility mode, using only the IGMPv2
   protocol, on that interface.  When Host Compatibility Mode is IGMPv1,
   a host acts in IGMPv1 compatibility mode, using only the IGMPv1
   protocol on that interface.<a href="#section-7.2.1-7" class="pilcrow">¶</a></p>
<p id="section-7.2.1-8">An IGMPv1 router will send General Queries with the Max Resp Code set
   to 0.  This <span class="bcp14">MUST</span> be interpreted as a value of 100 (10 seconds).<a href="#section-7.2.1-8" class="pilcrow">¶</a></p>
<p id="section-7.2.1-9">An IGMPv2 router will send General Queries with the Max Resp Code set
   to the desired Max Response Time, i.e., the full range of this field is
    linear and the exponential algorithm described in <a href="#max_resp_code" class="auto internal xref">Section 4.1.1</a> is
   not used.<a href="#section-7.2.1-9" class="pilcrow">¶</a></p>
<p id="section-7.2.1-10">Whenever a host changes its compatibility mode, it cancels all its
   pending response and retransmission timers.<a href="#section-7.2.1-10" class="pilcrow">¶</a></p>
<p id="section-7.2.1-11">An SSM-aware host that receives an IGMPv1 Query, an IGMPv2 General Query,
   or an IGMPv2 Group Specific Query for a multicast address in the SSM address range
   <span class="bcp14">SHOULD</span> log an error. It is <span class="bcp14">RECOMMENDED</span> that implementations provide a configuration option
   to disable use of the Host Compatibility Mode to allow networks to operate only in SSM mode.
   This configuration option <span class="bcp14">SHOULD</span> be disabled by default.<a href="#section-7.2.1-11" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2">
          <h4 id="name-in-the-presence-of-older-ver">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-in-the-presence-of-older-ver" class="section-name selfRef">In the Presence of Older Version Group Members</a>
          </h4>
<p id="section-7.2.2-1">An IGMPv3 host may be placed on a network where there are hosts that
   have not yet been upgraded to IGMPv3.  A host <span class="bcp14">MAY</span> allow its IGMPv3
   Membership Record to be suppressed by either an IGMPv1 Membership
   Report or an IGMPv2 Membership Report. SSM-aware hosts <span class="bcp14">MUST NOT</span> allow
   its IGMPv3 Membership Record to be suppressed.<a href="#section-7.2.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-7.3">
        <h3 id="name-multicast-router-behavior">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-multicast-router-behavior" class="section-name selfRef">Multicast Router Behavior</a>
        </h3>
<section id="section-7.3.1">
          <h4 id="name-in-the-presence-of-older-vers">
<a href="#section-7.3.1" class="section-number selfRef">7.3.1. </a><a href="#name-in-the-presence-of-older-vers" class="section-name selfRef">In the Presence of Older Version Queriers</a>
          </h4>
<p id="section-7.3.1-1">IGMPv3 routers may be placed on a network where at least one router
   on the network has not yet been upgraded to IGMPv3.  The following
   requirements apply:<a href="#section-7.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.1-2.1">
              <p id="section-7.3.1-2.1.1">If any older versions of IGMP are present on routers, the querier
     <span class="bcp14">MUST</span> use the lowest version of IGMP present on the network.  This
     must be administratively assured; routers that desire to be
     compatible with IGMPv1 and IGMPv2 <span class="bcp14">MUST</span> have a configuration option
     to act in IGMPv1 or IGMPv2 compatibility modes.  When in IGMPv1
     mode, routers <span class="bcp14">MUST</span> send Periodic Queries with a Max Resp Code of 0
     and truncated at the Group Address field (i.e., 8 bytes long) and
     <span class="bcp14">MUST</span> ignore Leave Group messages.  They <span class="bcp14">SHOULD</span> also warn about
     receiving an IGMPv2 or IGMPv3 query, although such warnings <span class="bcp14">MUST</span> be
     rate-limited.  When in IGMPv2 mode, routers <span class="bcp14">MUST</span> send Periodic
     Queries truncated at the Group Address field (i.e., 8 bytes long)
     and <span class="bcp14">SHOULD</span> also warn about receiving an IGMPv3 query (such warnings
     <span class="bcp14">MUST</span> be rate-limited).  They also <span class="bcp14">MUST</span> fill in the Max Response Time in
     the Max Resp Code field, i.e., the exponential algorithm described
    in <a href="#max_resp_code" class="auto internal xref">Section 4.1.1</a> is not used.<a href="#section-7.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.3.1-2.2">
              <p id="section-7.3.1-2.2.1">If a router is not explicitly configured to use IGMPv1 or IGMPv2
     and receives an IGMPv1 Query or IGMPv2 General Query, it <span class="bcp14">SHOULD</span> log a
   warning.  These warnings <span class="bcp14">MUST</span> be rate-limited.<a href="#section-7.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.3.1-2.3">
              <p id="section-7.3.1-2.3.1">It is <span class="bcp14">RECOMMENDED</span> that implementations provide a configuration option
   to disable use of compatibility mode to allow networks to operate only
   in SSM mode. This configuration option <span class="bcp14">SHOULD</span> be disabled by default.<a href="#section-7.3.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
<section id="section-7.3.2">
          <h4 id="name-in-the-presence-of-older-versi">
<a href="#section-7.3.2" class="section-number selfRef">7.3.2. </a><a href="#name-in-the-presence-of-older-versi" class="section-name selfRef">In the Presence of Older Version Group Members</a>
          </h4>
<p id="section-7.3.2-1">IGMPv3 routers may be placed on a network where there are hosts that
   have not yet been upgraded to IGMPv3.  In order to be compatible with
   older version hosts, IGMPv3 routers <span class="bcp14">MUST</span> operate in v1 and
   v2 compatibility modes.  IGMPv3 routers keep a compatibility
   mode per Group Record.  A group's compatibility mode is determined
   from the Group Compatibility Mode variable, which can be in one of
   three states:  IGMPv1, IGMPv2, or IGMPv3.  This variable is kept per
   Group Record and is dependent on the version of Membership Reports
   received for that group as well as the Older-Version-Host-Present Timer
   for the group.<a href="#section-7.3.2-1" class="pilcrow">¶</a></p>
<p id="section-7.3.2-2">In order to switch gracefully between versions of IGMP, routers keep
   an IGMPv1-Host-Present Timer and an IGMPv2-Host-Present Timer per
   Group Record.  The IGMPv1-Host-Present Timer is set to [Older Version
   Host Present Interval] seconds whenever an IGMPv1 Membership Report is
   received.  The IGMPv2-Host-Present Timer is set to [Older Version Host
   Present Interval] seconds whenever an IGMPv2 Membership Report is
   received.<a href="#section-7.3.2-2" class="pilcrow">¶</a></p>
<p id="section-7.3.2-3">The Group Compatibility Mode of a Group Record changes whenever an
   older version report (than the current compatibility mode) is received
   or when certain timer conditions occur.  When the IGMPv1-Host-Present
   Timer expires, a router switches to Group Compatibility Mode of
   IGMPv2 if it has a running IGMPv2 Host Present timer.  If it does not
   have a running IGMPv2 Host Present timer, then it switches to Group
   Compatibility Mode of IGMPv3.  When the IGMPv2-Host-Present Timer expires
   and the IGMPv1-Host-Present Timer is not running, a router switches
   to Group Compatibility Mode of IGMPv3.  Note that when a group
   switches back to IGMPv3 mode, it takes some time to regain source-
   specific state information.  Source-specific information will be
   learned during the next General Query, but sources that should be
   blocked will not be blocked until [Group Membership Interval] after
   that.<a href="#section-7.3.2-3" class="pilcrow">¶</a></p>
<p id="section-7.3.2-4">The Group Compatibility Mode variable is based on whether an older
   version report was received in the last [Older Version Host Present
   Interval] seconds.  The Group Compatibility Mode is set depending on
    the following:<a href="#section-7.3.2-4" class="pilcrow">¶</a></p>
<span id="name-group-compatibility-mode-se"></span><table class="center" id="table-12">
            <caption>
<a href="#table-12" class="selfRef">Table 12</a>:
<a href="#name-group-compatibility-mode-se" class="selfRef">Group Compatibility Mode Settings</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Group Compatibility Mode</th>
                <th class="text-left" rowspan="1" colspan="1">Timer State</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv3 (default)</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2 Host Present not running and IGMPv1 Host Present not running</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv2 Host Present running and IGMPv1 Host Present not running</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">IGMPv1</td>
                <td class="text-left" rowspan="1" colspan="1">IGMPv1 Host Present running</td>
              </tr>
            </tbody>
          </table>
<p id="section-7.3.2-6">If a router receives a report that causes its older Host Present
   timers to be updated and correspondingly its compatibility mode, it
   <span class="bcp14">SHOULD</span> switch compatibility modes immediately.<a href="#section-7.3.2-6" class="pilcrow">¶</a></p>
<p id="section-7.3.2-7">When Group Compatibility Mode is IGMPv3, a router acts using the
   IGMPv3 protocol for that group.<a href="#section-7.3.2-7" class="pilcrow">¶</a></p>
<p id="section-7.3.2-8">When Group Compatibility Mode is IGMPv2, a router internally
   translates the following IGMPv2 messages for that group to their
    IGMPv3 equivalents:<a href="#section-7.3.2-8" class="pilcrow">¶</a></p>
<span id="name-igmpv2-compatibility-mode-m"></span><table class="center" id="table-13">
            <caption>
<a href="#table-13" class="selfRef">Table 13</a>:
<a href="#name-igmpv2-compatibility-mode-m" class="selfRef">IGMPv2 Compatibility Mode Message Translation</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">IGMPv2 Message</th>
                <th class="text-left" rowspan="1" colspan="1">IGMPv3 Equivalent</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Report</td>
                <td class="text-left" rowspan="1" colspan="1">IS_EX( {} )</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Leave</td>
                <td class="text-left" rowspan="1" colspan="1">TO_IN( {} )</td>
              </tr>
            </tbody>
          </table>
<p id="section-7.3.2-10">IGMPv3 BLOCK messages are ignored, as are source-lists in TO_EX()
   messages (i.e., any TO_EX() message is treated as TO_EX( {} )).<a href="#section-7.3.2-10" class="pilcrow">¶</a></p>
<p id="section-7.3.2-11">When Group Compatibility Mode is IGMPv1, a router internally
   translates the following IGMPv1 and IGMPv2 messages for that group to
    their IGMPv3 equivalents:<a href="#section-7.3.2-11" class="pilcrow">¶</a></p>
<span id="name-igmpv1-compatibility-mode-m"></span><table class="center" id="table-14">
            <caption>
<a href="#table-14" class="selfRef">Table 14</a>:
<a href="#name-igmpv1-compatibility-mode-m" class="selfRef">IGMPv1 Compatibility Mode Message Translation</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">IGMPv2 Message</th>
                <th class="text-left" rowspan="1" colspan="1">IGMPv3 Equivalent</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">v1 Report</td>
                <td class="text-left" rowspan="1" colspan="1">IS_EX( {} )</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">v2 Report</td>
                <td class="text-left" rowspan="1" colspan="1">IS_EX( {} )</td>
              </tr>
            </tbody>
          </table>
<p id="section-7.3.2-13">In addition to ignoring IGMPv3 BLOCK messages and source-lists in
   TO_EX() messages as in IGMPv2 Group Compatibility Mode, IGMPv2 Leave
   messages and IGMPv3 TO_IN() messages are also ignored.<a href="#section-7.3.2-13" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<div id="timers">
<section id="section-8">
      <h2 id="name-list-of-timers-counters-and">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-list-of-timers-counters-and" class="section-name selfRef">List of Timers, Counters, and Their Default Values</a>
      </h2>
<p id="section-8-1">Most timers and counters are configurable.  If non-default settings are
   used, they <span class="bcp14">MUST</span> be consistent among all systems on a single link.
   Note that parentheses are used to group expressions to make the
   algebra clear.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="robust">
<section id="section-8.1">
        <h3 id="name-robustness-variable">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-robustness-variable" class="section-name selfRef">Robustness Variable</a>
        </h3>
<p id="section-8.1-1">The Robustness Variable allows tuning for the expected packet loss on
   a network.  If a network is expected to be lossy, the Robustness
   Variable may be increased.  IGMP is robust to (Robustness Variable -
   1) packet losses.  The Robustness Variable <span class="bcp14">MUST NOT</span> be zero and
   <span class="bcp14">SHOULD NOT</span> be one.  Default: 2.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="qry_int">
<section id="section-8.2">
        <h3 id="name-query-interval">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-query-interval" class="section-name selfRef">Query Interval</a>
        </h3>
<p id="section-8.2-1">The Query Interval is the interval between General Queries sent by
   the Querier.  Default: 125 seconds.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">By varying the Query Interval, an administrator may tune the number
   of IGMP messages on the network; larger values cause IGMP Queries to
   be sent less often.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8.3">
        <h3 id="name-query-response-interval">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-query-response-interval" class="section-name selfRef">Query Response Interval</a>
        </h3>
<p id="section-8.3-1">The Query Response Interval uses the Max Response Time to calculate the Max Resp Code that is inserted into the periodic General Queries.  Default: 100 (10 seconds).<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">By varying the [Query Response Interval], an administrator may tune
   the burstiness of IGMP messages on the network; larger values make
   the traffic less bursty, as host responses are spread out over a
   larger interval.  The number of seconds represented by the [Query
   Response Interval] must be less than the [Query Interval].<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
<section id="section-8.4">
        <h3 id="name-group-membership-interval">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-group-membership-interval" class="section-name selfRef">Group Membership Interval</a>
        </h3>
<p id="section-8.4-1">The Group Membership Interval is the amount of time that must pass
   before a multicast router decides there are no more members of a
   group or a particular source on a network.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">This value <span class="bcp14">MUST</span> be ([Robustness Variable] times [Query
   Interval]) plus (2 * [Query Response Interval]).<a href="#section-8.4-2" class="pilcrow">¶</a></p>
</section>
<section id="section-8.5">
        <h3 id="name-other-querier-present-inter">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-other-querier-present-inter" class="section-name selfRef">Other Querier Present Interval</a>
        </h3>
<p id="section-8.5-1">The Other Querier Present Interval is the length of time that must
   pass before a multicast router decides that there is no longer
   another multicast router that should be the querier.  This value
   <span class="bcp14">MUST</span> be ([Robustness Variable] times [Query Interval]) plus
   (0.5 times [Query Response Interval]).<a href="#section-8.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.6">
        <h3 id="name-startup-query-interval">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-startup-query-interval" class="section-name selfRef">Startup Query Interval</a>
        </h3>
<p id="section-8.6-1">The Startup Query Interval is the interval between General Queries
   sent by a Querier on startup.  Default: 1/4 times [Query Interval].<a href="#section-8.6-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.7">
        <h3 id="name-startup-query-count">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-startup-query-count" class="section-name selfRef">Startup Query Count</a>
        </h3>
<p id="section-8.7-1">The Startup Query Count is the number of Queries sent out on startup,
   separated by the Startup Query Interval.  Default: [Robustness
   Variable].<a href="#section-8.7-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.8">
        <h3 id="name-last-member-query-interval">
<a href="#section-8.8" class="section-number selfRef">8.8. </a><a href="#name-last-member-query-interval" class="section-name selfRef">Last Member Query Interval</a>
        </h3>
<p id="section-8.8-1">The Last Member Query Interval (LMQI) is the Max Response Time used to
   calculate the Max Resp Code that is inserted into Group Specific Queries sent
   in response to Leave Group messages.  It is also the Max Response
   Time used in calculating the Max Resp Code for Group-and-Source Specific
 Query Messages.  Default: 10 (1 second).<a href="#section-8.8-1" class="pilcrow">¶</a></p>
<p id="section-8.8-2">Note that for values of LMQI greater than 12.8 seconds, a limited set
   of values can be represented, corresponding to sequential values of
   Max Resp Code.  When converting a configured time to a Max Resp Code
   value, it is recommended to use the exact value, if possible, or the
   next lower value if the requested value is not exactly representable.<a href="#section-8.8-2" class="pilcrow">¶</a></p>
<p id="section-8.8-3">This value may be tuned to modify the leave latency of the network.
   A reduced value results in reduced time to detect the loss of the
   last member of a group or source.<a href="#section-8.8-3" class="pilcrow">¶</a></p>
</section>
<section id="section-8.9">
        <h3 id="name-last-member-query-count">
<a href="#section-8.9" class="section-number selfRef">8.9. </a><a href="#name-last-member-query-count" class="section-name selfRef">Last Member Query Count</a>
        </h3>
<p id="section-8.9-1">The Last Member Query Count is the number of Group Specific Queries
   sent before the router assumes there are no local members.  The Last
   Member Query Count is also the number of Group-and-Source Specific
   Queries sent before the router assumes there are no listeners for a
   particular source.  Default: [Robustness Variable].<a href="#section-8.9-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.10">
        <h3 id="name-last-member-query-time">
<a href="#section-8.10" class="section-number selfRef">8.10. </a><a href="#name-last-member-query-time" class="section-name selfRef">Last Member Query Time</a>
        </h3>
<p id="section-8.10-1">The Last Member Query Time is the time value represented by [Last
   Member Query Interval] times [Last Member Query Count].  It
   is not a tunable value, but it may be tuned by changing its components.<a href="#section-8.10-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.11">
        <h3 id="name-unsolicited-report-interval">
<a href="#section-8.11" class="section-number selfRef">8.11. </a><a href="#name-unsolicited-report-interval" class="section-name selfRef">Unsolicited Report Interval</a>
        </h3>
<p id="section-8.11-1">The Unsolicited Report Interval is the time between repetitions of a
   host's initial report of membership in a group.  Default: 1 second.<a href="#section-8.11-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.12">
        <h3 id="name-older-version-querier-prese">
<a href="#section-8.12" class="section-number selfRef">8.12. </a><a href="#name-older-version-querier-prese" class="section-name selfRef">Older Version Querier Present Interval</a>
        </h3>
<p id="section-8.12-1">The Older Version Querier Present Interval is the timeout for transitioning
   a host back to IGMPv3 mode once an older version query is received.
   When an older version query is received, hosts set their Older-Version-Querier-Present
   Timer to [Older Version Querier Present Interval].<a href="#section-8.12-1" class="pilcrow">¶</a></p>
<p id="section-8.12-2">It is <span class="bcp14">RECOMMENDED</span> to use the default values for calculating the interval value
   as hosts do not know the values configured on the querying routers.
   This value <span class="bcp14">SHOULD</span> be [Robustness Variable] times [Query
   Interval] plus (10 times the Max Response Time in the last received Query Message).<a href="#section-8.12-2" class="pilcrow">¶</a></p>
</section>
<section id="section-8.13">
        <h3 id="name-older-host-present-interval">
<a href="#section-8.13" class="section-number selfRef">8.13. </a><a href="#name-older-host-present-interval" class="section-name selfRef">Older Host Present Interval</a>
        </h3>
<p id="section-8.13-1">The Older Host Present Interval is the timeout for transitioning a
   group back to IGMPv3 mode once an older version report is sent for
   that group.  When an older version report is received, routers set
   their Older-Host-Present Timer to [Older Host Present Interval].<a href="#section-8.13-1" class="pilcrow">¶</a></p>
<p id="section-8.13-2">This value <span class="bcp14">MUST</span> be ([Robustness Variable] times [Query
   Interval]) plus [Query Response Interval].<a href="#section-8.13-2" class="pilcrow">¶</a></p>
</section>
<section id="section-8.14">
        <h3 id="name-configuring-timers">
<a href="#section-8.14" class="section-number selfRef">8.14. </a><a href="#name-configuring-timers" class="section-name selfRef">Configuring Timers</a>
        </h3>
<p id="section-8.14-1">This section is meant to provide advice to network administrators on
   how to tune these settings to their network.  Ambitious router
   implementations might tune these settings dynamically based upon
   changing characteristics of the network.<a href="#section-8.14-1" class="pilcrow">¶</a></p>
<section id="section-8.14.1">
          <h4 id="name-robustness-variable-2">
<a href="#section-8.14.1" class="section-number selfRef">8.14.1. </a><a href="#name-robustness-variable-2" class="section-name selfRef">Robustness Variable</a>
          </h4>
<p id="section-8.14.1-1">The Robustness Variable tunes IGMP to expected losses on a link.
   IGMPv3 is robust to ([Robustness Variable] - 1) packet losses, e.g., if
   the Robustness Variable is set to the default value of 2, IGMPv3 is
   robust to a single packet loss but may operate imperfectly if more
   losses occur.  On lossy subnetworks, the Robustness Variable should
   be increased to allow for the expected level of packet loss. However,
   increasing the Robustness Variable increases the leave latency of the
   subnetwork.  (The leave latency is the time between when the last
   member stops listening to a source or group and when the traffic
   stops flowing.)<a href="#section-8.14.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.14.2">
          <h4 id="name-query-interval-2">
<a href="#section-8.14.2" class="section-number selfRef">8.14.2. </a><a href="#name-query-interval-2" class="section-name selfRef">Query Interval</a>
          </h4>
<p id="section-8.14.2-1">The overall level of periodic IGMP traffic is inversely proportional
   to the Query Interval.  A longer Query Interval results in a lower
   overall level of IGMP traffic.  The Query Interval <span class="bcp14">MUST</span> be equal to
   or longer than the Max Response Time inserted in General Query
   Messages.<a href="#section-8.14.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.14.3">
          <h4 id="name-max-response-time">
<a href="#section-8.14.3" class="section-number selfRef">8.14.3. </a><a href="#name-max-response-time" class="section-name selfRef">Max Response Time</a>
          </h4>
<p id="section-8.14.3-1">The burstiness of IGMP traffic is inversely proportional to the Max
   Response Time.  A longer Max Response Time will spread Report
   messages over a longer interval.  However, a longer Max Response Time
   in Group Specific and Source-and-Group Specific Queries extends the
   leave latency.  (The leave latency is the time between when the last
   member stops listening to a source or group and when the traffic
   stops flowing.)  The expected rate of Report messages can be
   calculated by dividing the expected number of Reporters by the Max
   Response Time.  The Max Response Time may be dynamically calculated
   per Query by using the expected number of Reporters for that Query as
    follows:<a href="#section-8.14.3-1" class="pilcrow">¶</a></p>
<span id="name-expected-number-of-igmp-rep"></span><table class="center" id="table-15">
            <caption>
<a href="#table-15" class="selfRef">Table 15</a>:
<a href="#name-expected-number-of-igmp-rep" class="selfRef">Expected Number of IGMP Reporters</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Query Type</th>
                <th class="text-left" rowspan="1" colspan="1">Expected Number of Reporters</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">General Query</td>
                <td class="text-left" rowspan="1" colspan="1">All systems on the subnetwork</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Group Specific Query</td>
                <td class="text-left" rowspan="1" colspan="1">All systems that had expressed interest in the group on the subnetwork</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Source-and-Group Specific Query</td>
                <td class="text-left" rowspan="1" colspan="1">All systems on the subnetwork that had expressed interest in
       the source and group</td>
              </tr>
            </tbody>
          </table>
<p id="section-8.14.3-3">A router is not required to calculate these populations or tune the
   Max Response Time dynamically; these are simply guidelines.<a href="#section-8.14.3-3" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1">IGMP provides any form of confidentiality. This means any device
   on a link can passively receive any IGMP message on the link. Such access
   can lead to privacy concerns around potentially sensitive multicast groups
   or the ability to identify/map the devices on a link.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">We consider the ramifications of a forged message of each type and
   describe the usage of an IPsec Authentication Header (AH) to authenticate messages if desired.<a href="#section-9-2" class="pilcrow">¶</a></p>
<section id="section-9.1">
        <h3 id="name-query-message">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-query-message" class="section-name selfRef">Query Message</a>
        </h3>
<p id="section-9.1-1">A forged Query Message from a machine with a lower IP address than
   the current Querier will cause Querier duties to be assigned to the
   forger.  If the forger then sends no more Query Messages, other
   routers' Other-Querier-Present Timer will time out and one will
   resume the role of Querier.  During this time, if the forger ignores
   Leave messages, traffic might flow to groups with no members for up
   to [Group Membership Interval].<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">A Denial-of-Service (DoS) attack on a host could be staged through forged Group-and-
   Source Specific Queries.  The attacker can find out about membership
   of a specific host with a General Query.  After that, it could send a
   large number of Group-and-Source Specific Queries, each with a large
   source-list and the Maximum Response Time set to a large value.  The
   host will have to store and maintain the sources specified in all of
   those Queries for as long as it takes to send the delayed response.
   This would consume both memory and CPU cycles in order to augment the
   recorded sources with the source-lists included in the successive
   Queries.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">To protect against such a DoS attack, a host stack implementation
   could restrict the number of Group-and-Source Specific Queries per
   group membership within this interval and/or record only a limited
   number of sources.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">Forged Query Messages from the local network can be easily traced.
   There are three measures necessary to defend against externally
   forged Queries:<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-5.1">
            <p id="section-9.1-5.1.1">Routers <span class="bcp14">SHOULD NOT</span> forward Queries.  This is easier for a router to
     accomplish if the Query carries the Router Alert option.<a href="#section-9.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-5.2">
            <p id="section-9.1-5.2.1">Hosts <span class="bcp14">SHOULD</span> ignore v2 or v3 Queries without the Router Alert
     option.<a href="#section-9.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-5.3">
            <p id="section-9.1-5.3.1">Hosts <span class="bcp14">SHOULD</span> ignore v1, v2, or v3 General Queries sent to a
     multicast address other than 224.0.0.1, the all-systems address.<a href="#section-9.1-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
<section id="section-9.2">
        <h3 id="name-current-state-report-messag">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-current-state-report-messag" class="section-name selfRef">Current-State Report Messages</a>
        </h3>
<p id="section-9.2-1">A forged Report message may cause multicast routers to think there
   are members of a group on a network when there are not.  Forged
   Report messages from the local network are meaningless, as joining
   a group on a host is generally an unprivileged operation, so a local
   user may trivially gain the same result without forging any messages.
   Forged Report messages from external sources are more troublesome;
   there are two defenses against externally forged Reports:<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.2-2">
          <li id="section-9.2-2.1">
            <p id="section-9.2-2.1.1">Ignore the Report if you cannot identify the source address of the
     packet as belonging to a network assigned to the interface on which
     the packet was received.  This solution means that Reports sent by
     mobile hosts without addresses on the local network will be
     ignored.  Report messages with a source address of 0.0.0.0 <span class="bcp14">SHOULD</span>
     be accepted on any interface.<a href="#section-9.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.2-2.2">
            <p id="section-9.2-2.2.1">Ignore Report messages without Router Alert options <span>[<a href="#RFC2113" class="cite xref">RFC2113</a>]</span> and
     require routers to not forward Report messages.  (The requirement
     is not a requirement of generalized filtering in the forwarding
     path, as the packets already have Router Alert options in them.)
     This solution breaks backwards compatibility with implementations
     of IGMPv1 or earlier versions of IGMPv2 that did not require a
   Router Alert.<a href="#section-9.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-9.2-3">A forged v1 Report message may put a router into "v1
   members present" state for a particular group, meaning that the
   router will ignore Leave messages.  This can cause traffic to flow to
   groups with no members for up to [Group Membership Interval].  This
   can be solved by providing routers with a configuration switch to
   ignore v1 messages completely.  This breaks automatic
   compatibility with v1 hosts, so it should only be used in
   situations where "fast leave" is critical.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">A forged v2 Report message may put a router into "v2
   members present" state for a particular group, meaning that the
   router will ignore IGMPv3 source-specific state messages.  This can
   cause traffic to flow from unwanted sources for up to [Group
   Membership Interval].  This can be solved by providing routers with a
   configuration switch to ignore v2 messages completely.  This
   breaks automatic compatibility with v2 hosts, so it should only
   be used in situations where source include and exclude is critical.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
</section>
<section id="section-9.3">
        <h3 id="name-state-change-report-message">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-state-change-report-message" class="section-name selfRef">State-Change Report Messages</a>
        </h3>
<p id="section-9.3-1">A forged State-Change Report message will cause the Querier to send
   out Group Specific or Source-and-Group Specific Queries for the group
   in question.  This causes extra processing on each router and on each
   member of the group, but it cannot cause loss of desired traffic.
   There are two defenses against externally forged State-Change Report
   messages:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.3-2">
          <li id="section-9.3-2.1">
            <p id="section-9.3-2.1.1">Ignore the State-Change Report message if you cannot identify the
     source address of the packet as belonging to a subnet assigned to
     the interface on which the packet was received.  This solution
     means that State-Change Report messages sent by mobile hosts
     without addresses on the local subnet will be ignored.  State-
     Change Report messages with a source address of 0.0.0.0 <span class="bcp14">SHOULD</span> be
    accepted on any interface.<a href="#section-9.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.3-2.2">
            <p id="section-9.3-2.2.1">Ignore State-Change Report messages without Router Alert options
   <span>[<a href="#RFC2113" class="cite xref">RFC2113</a>]</span> and require routers to not forward State-Change
     Report messages.  (The requirement is not a requirement of
     generalized filtering in the forwarding path, as the packets
     already have Router Alert options in them.)<a href="#section-9.3-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
<section id="section-9.4">
        <h3 id="name-ipsec-usage">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-ipsec-usage" class="section-name selfRef">IPsec Usage</a>
        </h3>
<p id="section-9.4-1">In addition to these measures, IPsec in AH mode
   <span>[<a href="#RFC4302" class="cite xref">RFC4302</a>]</span> may be used to protect against remote attacks by ensuring that IGMPv3 messages came from a system on the LAN (or, more specifically,
   from a system with the proper key).  When using IPsec, the messages sent
   to 224.0.0.1 and 224.0.0.22 should be authenticated using AH.  When
   keying, there are two possibilities:<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.4-2">
<li id="section-9.4-2.1">
            <p id="section-9.4-2.1.1">Use a symmetric signature algorithm with a single key for the LAN
      (or a key for each group).  This allows validation that a packet
      was sent by a system with the key.  This has the limitation that
      any system with the key can forge a message; it is not possible to
      authenticate the individual sender precisely.  It also requires
      disabling IPsec's Replay Protection.<a href="#section-9.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.4-2.2">
            <p id="section-9.4-2.2.1">When appropriate key management standards have been developed, use
      an asymmetric signature algorithm.  All systems need to know the
      public key of all routers, and all routers need to know the public
      key of all systems.  This requires a large amount of key
      management but has the advantage that senders can be authenticated
      individually so, e.g., a host cannot forge a message that only
      routers should be allowed to send.<a href="#section-9.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-9.4-3">This solution only directly applies to Query and Leave messages in
   IGMPv1 and IGMPv2 as Reports are sent to the group being reported,
   and it is not feasible to agree on a key for host-to-router
   communication for arbitrary multicast groups.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">All IGMP types described in this document are managed via <span>[<a href="#BCP57" class="cite xref">BCP57</a>]</span>.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">IANA has replaced each reference to <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span> with a reference to this document in both the "IGMP Type Numbers" and "IPFIX Information Elements" registries.<a href="#section-10-2" class="pilcrow">¶</a></p>
</section>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="BCP57">[BCP57]</dt>
        <dd>
<div class="refInstance">Best Current Practice 57, <span>&lt;<a href="https://www.rfc-editor.org/info/bcp57">https://www.rfc-editor.org/info/bcp57</a>&gt;</span>.<br><span>At the time of writing, this BCP comprises the following:</span>
</div>
<div class="refInstance" id="RFC9778">
            <span class="refAuthor">Haberman, B., Ed.</span>, <span class="refTitle">"IANA Considerations for Internet Group Management Protocols"</span>, <span class="seriesInfo">BCP 57</span>, <span class="seriesInfo">RFC 9778</span>, <span class="seriesInfo">DOI 10.17487/RFC9778</span>, <time datetime="2025-03" class="refDate">March 2025</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9778">https://www.rfc-editor.org/info/rfc9778</a>&gt;</span>. </div>
</dd>
<dd class="break"></dd>
<dt id="RFC1112">[RFC1112]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span>, <span class="refTitle">"Host extensions for IP multicasting"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 1112</span>, <span class="seriesInfo">DOI 10.17487/RFC1112</span>, <time datetime="1989-08" class="refDate">August 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1112">https://www.rfc-editor.org/info/rfc1112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2113">[RFC2113]</dt>
        <dd>
<span class="refAuthor">Katz, D.</span>, <span class="refTitle">"IP Router Alert Option"</span>, <span class="seriesInfo">RFC 2113</span>, <span class="seriesInfo">DOI 10.17487/RFC2113</span>, <time datetime="1997-02" class="refDate">February 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2113">https://www.rfc-editor.org/info/rfc2113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2236">[RFC2236]</dt>
        <dd>
<span class="refAuthor">Fenner, W.</span>, <span class="refTitle">"Internet Group Management Protocol, Version 2"</span>, <span class="seriesInfo">RFC 2236</span>, <span class="seriesInfo">DOI 10.17487/RFC2236</span>, <time datetime="1997-11" class="refDate">November 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2236">https://www.rfc-editor.org/info/rfc2236</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4302">[RFC4302]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span>, <span class="refTitle">"IP Authentication Header"</span>, <span class="seriesInfo">RFC 4302</span>, <span class="seriesInfo">DOI 10.17487/RFC4302</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4302">https://www.rfc-editor.org/info/rfc4302</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4604">[RFC4604]</dt>
        <dd>
<span class="refAuthor">Holbrook, H.</span>, <span class="refAuthor">Cain, B.</span>, and <span class="refAuthor">B. Haberman</span>, <span class="refTitle">"Using Internet Group Management Protocol Version 3 (IGMPv3) and Multicast Listener Discovery Protocol Version 2 (MLDv2) for Source-Specific Multicast"</span>, <span class="seriesInfo">RFC 4604</span>, <span class="seriesInfo">DOI 10.17487/RFC4604</span>, <time datetime="2006-08" class="refDate">August 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4604">https://www.rfc-editor.org/info/rfc4604</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4607">[RFC4607]</dt>
        <dd>
<span class="refAuthor">Holbrook, H.</span> and <span class="refAuthor">B. Cain</span>, <span class="refTitle">"Source-Specific Multicast for IP"</span>, <span class="seriesInfo">RFC 4607</span>, <span class="seriesInfo">DOI 10.17487/RFC4607</span>, <time datetime="2006-08" class="refDate">August 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4607">https://www.rfc-editor.org/info/rfc4607</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC1071">[RFC1071]</dt>
        <dd>
<span class="refAuthor">Braden, R.</span>, <span class="refAuthor">Borman, D.</span>, and <span class="refAuthor">C. Partridge</span>, <span class="refTitle">"Computing the Internet checksum"</span>, <span class="seriesInfo">RFC 1071</span>, <span class="seriesInfo">DOI 10.17487/RFC1071</span>, <time datetime="1988-09" class="refDate">September 1988</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1071">https://www.rfc-editor.org/info/rfc1071</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3376">[RFC3376]</dt>
        <dd>
<span class="refAuthor">Cain, B.</span>, <span class="refAuthor">Deering, S.</span>, <span class="refAuthor">Kouvelas, I.</span>, <span class="refAuthor">Fenner, B.</span>, and <span class="refAuthor">A. Thyagarajan</span>, <span class="refTitle">"Internet Group Management Protocol, Version 3"</span>, <span class="seriesInfo">RFC 3376</span>, <span class="seriesInfo">DOI 10.17487/RFC3376</span>, <time datetime="2002-10" class="refDate">October 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3376">https://www.rfc-editor.org/info/rfc3376</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3569">[RFC3569]</dt>
        <dd>
<span class="refAuthor">Bhattacharyya, S., Ed.</span>, <span class="refTitle">"An Overview of Source-Specific Multicast (SSM)"</span>, <span class="seriesInfo">RFC 3569</span>, <span class="seriesInfo">DOI 10.17487/RFC3569</span>, <time datetime="2003-07" class="refDate">July 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3569">https://www.rfc-editor.org/info/rfc3569</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3678">[RFC3678]</dt>
      <dd>
<span class="refAuthor">Thaler, D.</span>, <span class="refAuthor">Fenner, B.</span>, and <span class="refAuthor">B. Quinn</span>, <span class="refTitle">"Socket Interface Extensions for Multicast Source Filters"</span>, <span class="seriesInfo">RFC 3678</span>, <span class="seriesInfo">DOI 10.17487/RFC3678</span>, <time datetime="2004-01" class="refDate">January 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3678">https://www.rfc-editor.org/info/rfc3678</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="rationale">
<section id="appendix-A">
      <h2 id="name-design-rationale">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-design-rationale" class="section-name selfRef">Design Rationale</a>
      </h2>
<div id="state-change">
<section id="appendix-A.1">
        <h3 id="name-the-need-for-state-change-m">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-the-need-for-state-change-m" class="section-name selfRef">The Need for State-Change Messages</a>
        </h3>
<p id="appendix-A.1-1">IGMPv3 specifies two types of Membership Reports: Current-State and
   State-Change.  This section describes the rationale for needing both types of Reports.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<p id="appendix-A.1-2">Routers need to distinguish Membership Reports that were sent in
   response to Queries from those that were sent as a result of a change
   in interface state.  Membership reports that are sent in response to
   Membership Queries are used mainly to refresh the existing state at
   the router; they typically do not cause transitions in state at the
   router.  Membership Reports that are sent in response to changes in
   interface state require the router to take some action in response to
    the received report (see <a href="#rcv_rpts" class="auto internal xref">Section 6.4</a>).<a href="#appendix-A.1-2" class="pilcrow">¶</a></p>
<p id="appendix-A.1-3">The inability to distinguish between the two types of reports would
   force a router to treat all Membership Reports as potential changes
   in state, and it could result in increased processing at the router as
   well as an increase in IGMP traffic on the network.<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suppression">
<section id="appendix-A.2">
        <h3 id="name-host-suppression">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-host-suppression" class="section-name selfRef">Host Suppression</a>
        </h3>
<p id="appendix-A.2-1">In IGMPv1 and IGMPv2, a host would cancel sending pending
   Membership Reports if a similar report was observed from another
   member on the network.  In IGMPv3, this suppression of host
   Membership Reports has been removed.  The following points explain
   the reasons behind this decision.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-A.2-2">
<li id="appendix-A.2-2.1">
            <p id="appendix-A.2-2.1.1">Routers may want to track per-host membership status on an
      interface.  This allows routers to implement fast leaves (e.g.,
      for layered multicast congestion control schemes) as well as track
    membership status for possible accounting purposes.<a href="#appendix-A.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-2.2">
            <p id="appendix-A.2-2.2.1">Membership Report suppression does not work well on bridged LANs.
      Many bridges and Layer 2 / Layer 3 switches that implement IGMP
      snooping do not forward IGMP messages across LAN segments in order
      to prevent Membership Report suppression.  Removing Membership
      Report suppression eases the job of these IGMP snooping devices.<a href="#appendix-A.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-2.3">
            <p id="appendix-A.2-2.3.1">By eliminating Membership Report suppression, hosts have fewer
      messages to process; this leads to a simpler state machine
    implementation.<a href="#appendix-A.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-A.2-2.4">
            <p id="appendix-A.2-2.4.1">In IGMPv3, a single Membership Report now bundles multiple
      multicast Group Records to decrease the number of packets sent.
      In comparison, the previous versions of IGMP required that each
    multicast group be reported in a separate message.<a href="#appendix-A.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="switch-modes">
<section id="appendix-A.3">
        <h3 id="name-switching-router-filter-mode">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-switching-router-filter-mode" class="section-name selfRef">Switching Router Filter Modes from EXCLUDE to INCLUDE</a>
        </h3>
<p id="appendix-A.3-1">If hosts exist in both EXCLUDE and INCLUDE modes for a single
   multicast group in a network, the router must be in EXCLUDE mode as
   well (see <a href="#sec-rfm" class="auto internal xref">Section 6.2.1</a>).  In EXCLUDE mode, a router forwards traffic
   from all sources unless that source exists in the exclusion source-list.
   If all hosts in EXCLUDE mode cease to exist, it would be
   desirable for the router to switch back to INCLUDE mode seamlessly
    without interrupting the flow of traffic to existing receivers.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
<p id="appendix-A.3-2">One of the ways to accomplish this is for routers to keep track of
   all sources desired by hosts that are in INCLUDE mode even though the
   router itself is in EXCLUDE mode.  If the Group Timer now expires in
   EXCLUDE mode, it implies that there are no hosts in EXCLUDE mode on
   the network (otherwise, a Membership Report from that host would have
   refreshed the Group Timer).  The router can then switch to INCLUDE
   mode seamlessly with the list of sources currently being forwarded in
    its source-list.<a href="#appendix-A.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="summary">
<section id="appendix-B">
      <h2 id="name-summary-of-changes-from-igm">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-summary-of-changes-from-igm" class="section-name selfRef">Summary of Changes from IGMPv2</a>
      </h2>
<p id="appendix-B-1">While the main additional feature of IGMPv3 is the addition of source
   filtering, the following is a summary of other changes from <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span>.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">State is maintained as Group + List-of-Sources, not simply Group as
   in IGMPv2.<a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.2">
          <p id="appendix-B-2.2.1">Interoperability with IGMPv1 and IGMPv2 systems is defined as
    operations on the IGMPv3 state.<a href="#appendix-B-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.3">
          <p id="appendix-B-2.3.1">The IP service interface has changed, to allow specification of
    source-lists.<a href="#appendix-B-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.4">
          <p id="appendix-B-2.4.1">The Querier includes its Robustness Variable and Query Interval in
     Query packets to allow synchronization of these variables on non-
    Queriers.<a href="#appendix-B-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.5">
          <p id="appendix-B-2.5.1">The Max Response Time in Query Messages has an exponential range,
     changing the maximum from 25.5 seconds to about 53 minutes, for use
    on links with a huge number of systems.<a href="#appendix-B-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.6">
          <p id="appendix-B-2.6.1">Hosts retransmit state-change messages for increased robustness.<a href="#appendix-B-2.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.7">
          <p id="appendix-B-2.7.1">Additional data sections are defined, to allow later extensions.<a href="#appendix-B-2.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.8">
          <p id="appendix-B-2.8.1">Report packets are sent to 224.0.0.22, to assist Layer 2 switches
    in snooping.<a href="#appendix-B-2.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.9">
          <p id="appendix-B-2.9.1">Report packets can contain multiple Group Records, to allow
    reporting of full current state using fewer packets.<a href="#appendix-B-2.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.10">
          <p id="appendix-B-2.10.1">Hosts no longer perform suppression, to simplify implementations
    and permit explicit membership tracking.<a href="#appendix-B-2.10.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.11">
          <p id="appendix-B-2.11.1">A new S flag in Query Messages
    fixes robustness issues, which were also present in IGMPv2.<a href="#appendix-B-2.11.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="errata-details">
<section id="appendix-C">
      <h2 id="name-summary-of-changes-from-rfc">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-summary-of-changes-from-rfc" class="section-name selfRef">Summary of Changes from RFC 3376</a>
      </h2>
<p id="appendix-C-1">The following is a list of changes made since <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span> was published.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-2.1">
          <p id="appendix-C-2.1.1">Modified the definition of Older Version Querier Present
    Interval to address Erratum 4375.<a href="#appendix-C-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.2">
          <p id="appendix-C-2.2.1">Modified the metadata to fix the Obsoletes vs. Updates relationship with <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span> per Erratum 1501.<a href="#appendix-C-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.3">
          <p id="appendix-C-2.3.1">Updated the introductory text to describe the Updates relationship with <span>[<a href="#RFC2236" class="cite xref">RFC2236</a>]</span> per Erratum 7339.<a href="#appendix-C-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.4">
          <p id="appendix-C-2.4.1">Updated the definition of Group Membership Interval to address Erratum 6725.<a href="#appendix-C-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.5">
          <p id="appendix-C-2.5.1">Updated the text relating to the Router Filter Mode to address Erratum 5562.<a href="#appendix-C-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.6">
          <p id="appendix-C-2.6.1">Clarified the use of General Queries in the Querier election process.<a href="#appendix-C-2.6.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<section id="appendix-D">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-D-1">We would like to thank <span class="contact-name">Ran Atkinson</span>, <span class="contact-name">Luis Costa</span>, <span class="contact-name">Toerless Eckert</span>, <span class="contact-name">Dino Farinacci</span>, <span class="contact-name">Serge Fdida</span>, <span class="contact-name">Wilbert de Graaf</span>, <span class="contact-name">Sumit Gupta</span>,
      <span class="contact-name">Mark Handley</span>, <span class="contact-name">Bob Quinn</span>,
      <span class="contact-name">Michael Speer</span>, <span class="contact-name">Dave Thaler</span>,
      and <span class="contact-name">Rolland Vida</span> for comments and suggestions on
      <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span>.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2"><span class="contact-name">Stig Venaas</span>, <span class="contact-name">Hitoshi       Asaeda</span>, and <span class="contact-name">Mike McBride</span> have provided valuable
      feedback on this specification, and we thank them for their input.<a href="#appendix-D-2" class="pilcrow">¶</a></p>
</section>
<section id="appendix-E">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="appendix-E-1"><span class="contact-name">Brad Cain</span>, <span class="contact-name">Steve Deering</span>,
      <span class="contact-name">Isidor Kouvelas</span>, <span class="contact-name">Bill       Fenner</span>, and <span class="contact-name">Ajit Thyagarajan</span> are the authors of
      <span>[<a href="#RFC3376" class="cite xref">RFC3376</a>]</span>, which forms the bulk of the content contained herein.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2"><span class="contact-name">Anuj Budhiraja</span>, <span class="contact-name">Toerless       Eckert</span>, <span class="contact-name">Olufemi Komolafe</span>, and <span class="contact-name">Tim Winters</span> have contributed valuable content to this
      specification.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Brian Haberman (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Johns Hopkins University Applied Physics Lab</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:brian@innovationslab.net" class="email">brian@innovationslab.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
