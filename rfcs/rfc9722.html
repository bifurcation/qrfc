<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9722: Fast Recovery for EVPN Designated Forwarder Election</title>
<meta content="Patrice Brissette" name="author">
<meta content="Ali Sajassi" name="author">
<meta content="Luc AndrÃ© Burdet" name="author">
<meta content="John Drake" name="author">
<meta content="Jorge Rabadan" name="author">
<meta content="
       The Ethernet Virtual Private Network (EVPN) solution in RFC 7432
      provides Designated Forwarder (DF) election procedures for multihomed
      Ethernet Segments. These procedures have been enhanced further by
      applying the Highest Random Weight (HRW) algorithm for DF election to
      avoid unnecessary DF status changes upon a failure.  This document
      improves these procedures by providing a fast DF election upon recovery
      of the failed link or node associated with the multihomed Ethernet
      Segment.  This document updates RFC 8584 by optionally introducing
      delays between some of the events therein. 
       The solution is independent of the number of EVPN Instances (EVIs)
      associated with that Ethernet Segment, and it is performed via a simple
      signaling in BGP between the recovered node and each of the other nodes
      in the multihoming group. 
    " name="description">
<meta content="xml2rfc 3.28.1" name="generator">
<meta content="EVPN" name="keyword">
<meta content="Designated Forwarder" name="keyword">
<meta content="Convergence" name="keyword">
<meta content="Recovery" name="keyword">
<meta content="9722" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.28.1
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 65.0
-->
<link href="rfc9722.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-bess-evpn-fast-df-recovery-12" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9722" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9722</td>
<td class="center">Fast Recovery for EVPN DF Election</td>
<td class="right">May 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Brissette, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9722" class="eref">9722</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc8584" class="eref">8584</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-05" class="published">May 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">P. Brissette</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">A. Sajassi</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">LA. Burdet, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">J. Drake</div>
<div class="org">Independent</div>
</div>
<div class="author">
      <div class="author-name">J. Rabadan</div>
<div class="org">Nokia</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9722</h1>
<h1 id="title">Fast Recovery for EVPN Designated Forwarder Election</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Ethernet Virtual Private Network (EVPN) solution in RFC 7432
      provides Designated Forwarder (DF) election procedures for multihomed
      Ethernet Segments. These procedures have been enhanced further by
      applying the Highest Random Weight (HRW) algorithm for DF election to
      avoid unnecessary DF status changes upon a failure.  This document
      improves these procedures by providing a fast DF election upon recovery
      of the failed link or node associated with the multihomed Ethernet
      Segment.  This document updates RFC 8584 by optionally introducing
      delays between some of the events therein.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
<p id="section-abstract-2">The solution is independent of the number of EVPN Instances (EVIs)
      associated with that Ethernet Segment, and it is performed via a simple
      signaling in BGP between the recovered node and each of the other nodes
      in the multihoming group.<a href="#section-abstract-2" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9722">https://www.rfc-editor.org/info/rfc9722</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.Â Â <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.Â Â <a href="#name-requirements-language" class="internal xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.Â Â <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.Â Â <a href="#name-challenges-with-existing-me" class="internal xref">Challenges with Existing Mechanism</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="auto internal xref">1.4</a>.Â Â <a href="#name-design-principles-for-a-sol" class="internal xref">Design Principles for a Solution</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.Â Â <a href="#name-df-election-synchronization" class="internal xref">DF Election Synchronization Solution</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.Â Â <a href="#name-bgp-encoding" class="internal xref">BGP Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.Â Â <a href="#name-timestamp-verification" class="internal xref">Timestamp Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.Â Â <a href="#name-updates-to-rfc-8584" class="internal xref">Updates to RFC 8584</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.Â Â <a href="#name-synchronization-scenarios" class="internal xref">Synchronization Scenarios</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.Â Â <a href="#name-concurrent-recoveries" class="internal xref">Concurrent Recoveries</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.Â Â <a href="#name-backwards-compatibility" class="internal xref">Backwards Compatibility</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.Â Â <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.Â Â <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.Â Â <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.Â Â <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.Â Â <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Ethernet Virtual Private Network (EVPN) solution <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> is
     widely used in data center (DC) applications for Network
     Virtualization Overlay (NVO) and Data Center Interconnect (DCI) services and
     in service provider (SP) applications for next-generation virtual
     private LAN services.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2"><span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> describes Designated Forwarder (DF) election procedures for
     multihomed Ethernet Segments. These procedures are enhanced further in
     <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span> by applying the Highest Random Weight (HRW) algorithm for DF
     election in order to avoid unnecessary DF status changes upon a link
     or node failure associated with the multihomed Ethernet Segment.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">This document makes further improvements to the DF election procedures in
     <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span> by providing an option for a fast DF election upon
     recovery of the failed link or node associated with the multihomed
     Ethernet Segment. This DF election is achieved independent of the number
     of EVPN Instances (EVIs) associated with that Ethernet Segment, and it is performed via
     straightforward signaling in BGP between the recovered node and each of the other nodes
     in the multihomed Ethernet Segment redundancy group.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">This document updates the DF Election Finite State Machine (FSM)
     described in <span><a href="https://rfc-editor.org/rfc/rfc8584#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC8584" class="cite xref">RFC8584</a>]</span> by optionally
     introducing delays between some events, as further detailed in <a href="#fsm_8584" class="auto internal xref">Section 2.3</a>.  The solution is based on a simple one-way signaling
     mechanism.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCPÂ 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">Â¶</a></p>
</section>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-1.2-1">
          <dt id="section-1.2-1.1">PE:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.2">Provider Edge<a href="#section-1.2-1.2" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.3">DF:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.4">Designated Forwarder. A PE that is currently forwarding
           (encapsulating/decapsulating) traffic for a given VLAN in and out of
           a site.<a href="#section-1.2-1.4" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.5">NDF:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.6">Non-Designated Forwarder. A PE that is currently blocking traffic (see
           DF above).<a href="#section-1.2-1.6" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.7">EVI:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.8">EVPN Instance. It spans the PE devices participating in that
          EVPN.<a href="#section-1.2-1.8" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.9">HRW:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.10">Highest Random Weight algorithm <span>[<a href="#HRW98" class="cite xref">HRW98</a>]</span><a href="#section-1.2-1.10" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.11">Service carving:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.12">This refers to DF election, as defined in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>.<a href="#section-1.2-1.12" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-1.13">SCT:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-1.14">Service Carving Time. Defined in this document as the time at
           which all nodes participating in an Ethernet Segment perform DF Election.<a href="#section-1.2-1.14" class="pilcrow">Â¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="challenges">
<section id="section-1.3">
        <h3 id="name-challenges-with-existing-me">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-challenges-with-existing-me" class="section-name selfRef">Challenges with Existing Mechanism</a>
        </h3>
<p id="section-1.3-1">In EVPN technology, multiple PE devices encapsulate
        and decapsulate data belonging to the same VLAN. Under certain conditions, this
        may cause duplicated Ethernet packets and potential loops if there is a momentary
        overlap in forwarding roles between two or more PE devices, potentially also leading
        to broadcast storms of frames forwarded back into the VLAN.<a href="#section-1.3-1" class="pilcrow">Â¶</a></p>
<p id="section-1.3-2">EVPN <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> currently specifies timer-based synchronization among PE
        devices within an Ethernet Segment redundancy group. This approach can lead to duplications and potential
        loops due to multiple DFs if the timer interval is too short
        or can lead to packet drops if the timer interval is too long.<a href="#section-1.3-2" class="pilcrow">Â¶</a></p>
<p id="section-1.3-3">Split-horizon filtering, as described in <span><a href="https://rfc-editor.org/rfc/rfc7432#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>,
        can prevent loops but does not address duplicates.
        However, if there are overlapping DFs of two
        different sites simultaneously for the same VLAN, the site identifier will differ when the
        packet re-enters the Ethernet Segment. Consequently, the split-horizon check will fail,
        resulting in Layer 2 loops.<a href="#section-1.3-3" class="pilcrow">Â¶</a></p>
<p id="section-1.3-4">The updated DF procedures outlined in <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>
        use the well-known
        HRW algorithm to prevent the reshuffling of VLANs among
        PE devices within the Ethernet Segment redundancy group during failure or recovery events. This
        approach minimizes the impact on VLANs not assigned to the failed or recovered ports
        and eliminates the occurrence of loops or duplicates during such events.<a href="#section-1.3-4" class="pilcrow">Â¶</a></p>
<p id="section-1.3-5">However, upon PE insertion or a port being newly added to a multihomed Ethernet Segment,
        the HRW cannot help either, as a transfer of the DF role to the new port must occur
        while the old DF is still active.<a href="#section-1.3-5" class="pilcrow">Â¶</a></p>
<span id="name-ce1-multihomed-to-pe1-and-p"></span><div id="topology">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.3-6.1">
<pre>
                                  +---------+
               +-------------+    |         |
               |             |    |         |
             / |    PE1      |----|         |   +-------------+
            /  |             |    |  MPLS/  |   |             |---CE3
           /   +-------------+    |  VxLAN/ |   |     PE3     |
      CE1 -                       |  Cloud  |   |             |
           \   +-------------+    |         |---|             |
            \  |             |    |         |   +-------------+
             \ |     PE2     |----|         |
               |             |    |         |
               +-------------+    |         |
                                  +---------+</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-ce1-multihomed-to-pe1-and-p" class="selfRef">CE1 Multihomed to PE1 and PE2</a>
          </figcaption></figure>
</div>
<p id="section-1.3-7">In <a href="#topology" class="auto internal xref">Figure 1</a>, when PE2 is inserted in the Ethernet Segment or its
        CE1-facing interface is recovered, PE1 will transfer
        the DF role of some VLANs to PE2 to achieve load-balancing. However,
        because there is no handshake mechanism between PE1 and PE2,
        overlapping of DF roles for a given VLAN is possible, which leads to duplication of
        traffic as well as Layer 2 loops.<a href="#section-1.3-7" class="pilcrow">Â¶</a></p>
<p id="section-1.3-8">Current EVPN specifications <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> and <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>
        rely on a timer-based approach for transferring the DF role to the newly inserted device.
        This can cause the following issues:<a href="#section-1.3-8" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-9.1">Loops and duplicates, if the timer value is too short<a href="#section-1.3-9.1" class="pilcrow">Â¶</a>
</li>
          <li class="normal" id="section-1.3-9.2">Prolonged traffic loss, if the timer value is too long<a href="#section-1.3-9.2" class="pilcrow">Â¶</a>
</li>
        </ul>
</section>
</div>
<div id="advantages">
<section id="section-1.4">
        <h3 id="name-design-principles-for-a-sol">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-design-principles-for-a-sol" class="section-name selfRef">Design Principles for a Solution</a>
        </h3>
<p id="section-1.4-1">The clock-synchronization solution for fast DF recovery presented in this document
        follows several design principles and offers
        multiple advantages, namely:<a href="#section-1.4-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-2.1">Complex handshake signaling mechanisms and state machines are
            avoided in favor of a simple unidirectional signaling approach.<a href="#section-1.4-2.1" class="pilcrow">Â¶</a>
</li>
          <li class="normal" id="section-1.4-2.2">The fast DF recovery solution maintains backwards compatibility (see <a href="#ntpcompat" class="auto internal xref">Section 4</a>) by ensuring that PEs reject any unrecognized new BGP EVPN Extended Community.<a href="#section-1.4-2.2" class="pilcrow">Â¶</a>
</li>
          <li class="normal" id="section-1.4-2.3">Existing DF Election algorithms remain supported.<a href="#section-1.4-2.3" class="pilcrow">Â¶</a>
</li>
          <li class="normal" id="section-1.4-2.4">The fast DF recovery solution is independent of any BGP delays in propagation of Ethernet Segment
          routes (Route Type 4)<a href="#section-1.4-2.4" class="pilcrow">Â¶</a>
</li>
          <li class="normal" id="section-1.4-2.5">The fast DF recovery solution is agnostic of the actual time synchronization mechanism
          used; however, an NTP-based representation of time is used for EVPN signaling.<a href="#section-1.4-2.5" class="pilcrow">Â¶</a>
</li>
        </ul>
<p id="section-1.4-3">The solution in this document relies on nodes in the topology, more specifically
        the peering nodes of each Ethernet-Segment, to be clock-synchronized and to advertise the Time
        Synchronization capability.
        When this is not the case, or when clocks are badly desynchronized, network convergence and DF
        Election is no worse than that described in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> due to the timestamp range checking (<a href="#timestamp_verification" class="auto internal xref">Section 2.2</a>).<a href="#section-1.4-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="sync">
<section id="section-2">
      <h2 id="name-df-election-synchronization">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-df-election-synchronization" class="section-name selfRef">DF Election Synchronization Solution</a>
      </h2>
<p id="section-2-1">The fast DF recovery solution relies on the concept of common clock alignment between partner PEs participating
      in a common Ethernet Segment, i.e., PE1 and PE2 in <a href="#topology" class="auto internal xref">Figure 1</a>. The main idea is to have all peering PEs of that
      Ethernet Segment perform DF election and apply the result at the same previously announced time.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">The DF Election procedure, as described in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> and as optionally
      signaled in <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>, is applied.
      All PEs attached to a given Ethernet Segment are clock-synchronized
      using a networking protocol for clock synchronization (e.g., NTP, Precision Time Protocol (PTP)).
      Whenever possible, recovery activities for failed PEs <span class="bcp14">SHOULD NOT</span> be initiated until after the
      underlying clock synchronization protocol has converged to benefit from this document's fast DF recovery
      procedures.  
      When a new PE is inserted in an Ethernet Segment or when a failed PE of the Ethernet
      Segment recovers, that PE communicates to peering partners the current time plus the value of
      the timer for partner discovery from step 2 in <span><a href="https://rfc-editor.org/rfc/rfc7432#section-8.5" class="relref">Section 8.5</a> of [<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>.
      This constitutes an "end time" or "absolute time" as seen from the local PE.
      That absolute time is called the Service Carving Time (SCT).<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<p id="section-2-3">A new BGP EVPN Extended Community, the Service Carving Time, is advertised along with
      the Ethernet Segment Route Type 4 (RT-4) and communicates the SCT to other
      partners to ensure an orderly transfer of forwarding duties.<a href="#section-2-3" class="pilcrow">Â¶</a></p>
<p id="section-2-4">Upon receipt of the new BGP EVPN Extended Community, partner PEs can determine the SCT
      of the newly inserted PE. To eliminate any potential for duplicate traffic or loops, the
      concept of "skew" is introduced: a small time offset to ensure a controlled and orderly
      transition when multiple PE devices are involved.

      The previously inserted PE(s) must perform service carving first for NDF to DF transitions.
      The receiving PEs subtract this skew (default = 10 ms) to the Service Carving Time and apply NDF
      to DF transitions first. This is followed shortly by the NDF to DF transitions on both PEs, after the skew delay.
      On the recovering PE, all services are already in NDF state, and no
      skew for DF to NDF transitions is required.<a href="#section-2-4" class="pilcrow">Â¶</a></p>
<p id="section-2-5">This document proposes a default skew value of 10 ms to allow completion of programming the DF
      to NDF transitions, but implementations may make the skew larger (or configurable) taking
      into consideration scale, hardware capabilities, and clock accuracy.<a href="#section-2-5" class="pilcrow">Â¶</a></p>
<p id="section-2-6">To summarize, all peering PEs perform service carving almost
      simultaneously at the time announced by the newly added/recovered
      PE. The newly inserted PE initiates the SCT and triggers service carving
      immediately on its local timer expiry. The previously inserted PE(s)
      receiving Ethernet Segment route (RT-4) with an SCT BGP extended
      community perform service carving shortly before the SCT for DF to NDF
      transitions and at the SCT for NDF to DF transitions.<a href="#section-2-6" class="pilcrow">Â¶</a></p>
<div id="ntpencoding">
<section id="section-2.1">
        <h3 id="name-bgp-encoding">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-bgp-encoding" class="section-name selfRef">BGP Encoding</a>
        </h3>
<p id="section-2.1-1">A BGP extended community, with Type 0x06 and Sub-Type 0x0F, is defined to communicate the
        SCT for each Ethernet Segment:<a href="#section-2.1-1" class="pilcrow">Â¶</a></p>
<span id="name-service-carving-time"></span><figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-2.1-2.1">
<pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Type = 0x06   | Sub-Type(0x0F)|      Timestamp Seconds        ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~  Timestamp Seconds            |      Timestamp Fraction       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-service-carving-time" class="selfRef">Service Carving Time</a>
          </figcaption></figure>
<p id="section-2.1-3">The timestamp exchanged uses the NTP prime epoch of 0 h 1 January 
   1900 UTC <span>[<a href="#RFC5905" class="cite xref">RFC5905</a>]</span> and an adapted form of the 64-bit NTP timestamp format.<a href="#section-2.1-3" class="pilcrow">Â¶</a></p>
<p id="section-2.1-4">The 64-bit NTP timestamp format consists of a 32-bit unsigned seconds
   field and a 32-bit fraction field, which are encoded in the
        Service Carving Time as follows:<a href="#section-2.1-4" class="pilcrow">Â¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-5">
          <dt id="section-2.1-5.1">Timestamp Seconds:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.2">32-bit NTP seconds are encoded in this field.<a href="#section-2.1-5.2" class="pilcrow">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.3">Timestamp Fraction:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.4">The high-order 16 bits of
          the NTP "Fraction" field are encoded in this field.<a href="#section-2.1-5.4" class="pilcrow">Â¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-6">When rebuilding a 64-bit NTP timestamp format using the values from a received SCT BGP extended community, the lower-order 16 bits of the
        NTP "Fraction" field are set to 0. The use of a 16-bit fractional seconds value yields adequate precision of 15 microseconds
        (2<sup>-16</sup> s).<a href="#section-2.1-6" class="pilcrow">Â¶</a></p>
<p id="section-2.1-7">The format of the DF Election Extended Community that is used in this document is:<a href="#section-2.1-7" class="pilcrow">Â¶</a></p>
<span id="name-df-election-extended-commun"></span><figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-2.1-8.1">
<pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Type = 0x06   | Sub-Type(0x06)| RSV |  DF Alg |    Bitmap     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~     Bitmap    |            Reserved                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-df-election-extended-commun" class="selfRef">DF Election Extended Community (RFC 8584)</a>
          </figcaption></figure>
<p id="section-2.1-9">The Bitmap field (2 octets) encodes "capabilities" <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>, where this
        document introduces a new Time Synchronization capability indicated by "T".<a href="#section-2.1-9" class="pilcrow">Â¶</a></p>
<span id="name-bitmap-field-in-the-df-elec"></span><figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-2.1-10.1">
<pre>
                     1         1
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| |A| |T|                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-bitmap-field-in-the-df-elec" class="selfRef">Bitmap Field in the DF Election Extended Community</a>
          </figcaption></figure>
<span class="break"></span><dl class="dlParallel" id="section-2.1-11">
          <dt id="section-2.1-11.1">Bit 3:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-11.2">Time Synchronization (corresponds to Bit 27 of
          the DF Election Extended Community). When set to 1, it indicates the
          desire to use the Time Synchronization capability with the rest of the
          PEs in the Ethernet Segment.<a href="#section-2.1-11.2" class="pilcrow">Â¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-12">
        This capability is utilized in conjunction with the agreed-upon DF Election Type.
        For instance, if all the PE devices in the Ethernet Segment indicate the desire to use the
        Time Synchronization capability and request the DF Election Type to be the HRW,
        then the HRW algorithm is used in conjunction with this capability. A PE that does not
        support the procedures set out in this document or that receives a route from another PE in
        which the capability is not set <span class="bcp14">MUST NOT</span> delay DF election as this could
        lead to duplicate traffic in some instances (overlapping DFs).<a href="#section-2.1-12" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="timestamp_verification">
<section id="section-2.2">
        <h3 id="name-timestamp-verification">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-timestamp-verification" class="section-name selfRef">Timestamp Verification</a>
        </h3>
<p id="section-2.2-1">The NTP Era value is not exchanged, and participating PEs may consider the timestamps to be in the same Era as their local value.
        A DF Election operation occurring exactly at the next Era transition will be some time on
        February 7, 2036. Implementors and operators may address credible
        cases of rollover ambiguity (adjacent Eras n and n+1) as well as the security issue of unreasonably
        large or unreasonably small NTP timestamps in the following manner.<a href="#section-2.2-1" class="pilcrow">Â¶</a></p>
<p id="section-2.2-2">The procedures in this document address implicitly what occurs with receiving an SCT value
        in the past. This would be a naturally occurring event with a large BGP propagation delay:
        the receiving PE treats
        the DF Election at the peer as having already occurred and proceeds without starting any
        timer to further delay service carving, effectively falling back on behavior as specified in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>.
        A PE that receives an SCT value smaller than its current time <span class="bcp14">MUST</span> discard the Service Carving Time and <span class="bcp14">SHALL</span> treat the DF Election at
   the peer as having occurred already.<a href="#section-2.2-2" class="pilcrow">Â¶</a></p>
<p id="section-2.2-3">The more problematic scenario is the PE in Era n+1 that receives an SCT advertised by
        the PE still in Era n, with a very large SCT value. To address this Era rollover as well as
        the large values attack vector, implementations <span class="bcp14">MUST</span> validate the received SCT against
        an upper bound.<a href="#section-2.2-3" class="pilcrow">Â¶</a></p>
<p id="section-2.2-4">It is left to implementations to decide what constitutes an "unreasonably large" SCT value.
        A recommended approach, however, is to compare the received offset to the local peering timer value.
        In practice, peering timer values are configured uniformly across Ethernet Segment peers and
        may be treated as an upper bound on the offset of received SCT values.
        A PE that receives an SCT representing an offset larger than the local peering timer <span class="bcp14">MUST</span>
        discard the SCT and <span class="bcp14">SHALL</span> treat
        the DF Election at the peer as having already occurred, as above.<a href="#section-2.2-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="fsm_8584">
<section id="section-2.3">
        <h3 id="name-updates-to-rfc-8584">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-updates-to-rfc-8584" class="section-name selfRef">Updates to RFC 8584</a>
        </h3>
<p id="section-2.3-1">This document introduces an additional delay to the events and
        transitions defined for the default DF election algorithm FSM in
        <span><a href="https://rfc-editor.org/rfc/rfc8584#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC8584" class="cite xref">RFC8584</a>]</span> without changing the FSM state or event definitions
        themselves.<a href="#section-2.3-1" class="pilcrow">Â¶</a></p>
<p id="section-2.3-2">Upon receiving an RCVD_ES message, the peering PE's FSM transitions
        from the DF_DONE state (indicating the DF election process was complete) to the DF_CALC state
        (indicating that a new DF calculation is needed). Due to the 
        SCT included in the Ethernet Segment update, the completion of the DF_CALC state and the
        subsequent transition back to the DF_DONE state are delayed. This delay ensures proper
        synchronization and prevents conflicts. Consequently, the accompanying forwarding updates to
        the DF and NDF states are also deferred.<a href="#section-2.3-2" class="pilcrow">Â¶</a></p>
<p id="section-2.3-3">Item 9 in <span><a href="https://rfc-editor.org/rfc/rfc8584#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>, in the list "Corresponding actions when transitions
are performed or states are entered/exited", is changed as follows:<a href="#section-2.3-3" class="pilcrow">Â¶</a></p>
<blockquote id="section-2.3-4">
          <ol start="9" type="1" class="normal type-1" id="section-2.3-4.1">
          <li id="section-2.3-4.1.1">
              <p id="section-2.3-4.1.1.1">DF_CALC on CALCULATED: Mark the election result for the VLAN
          or VLAN bundle.<a href="#section-2.3-4.1.1.1" class="pilcrow">Â¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-2.3-4.1.1.2">
            <dt>9.1</dt>
<dd id="section-2.3-4.1.1.2.1">If no Service Carving Time is present during the RCVD_ES event of Action 11,
            proceed to step 9.4<a href="#section-2.3-4.1.1.2.1" class="pilcrow">Â¶</a>
</dd>
                <dd class="break"></dd>
<dt>9.2</dt>
<dd id="section-2.3-4.1.1.2.2">If a Service Carving Time is present during the RCVD_ES event of
            Action 11, wait until the time indicated by the SCT minus skew before proceeding to step
            9.3.<a href="#section-2.3-4.1.1.2.2" class="pilcrow">Â¶</a>
</dd>
                <dd class="break"></dd>
<dt>9.3</dt>
<dd id="section-2.3-4.1.1.2.3">Assume the role of NDF for the local PE concerning the VLAN or VLAN bundle.
            Wait the remaining skew time before proceeding to step 9.4.<a href="#section-2.3-4.1.1.2.3" class="pilcrow">Â¶</a>
</dd>
                <dd class="break"></dd>
<dt>9.4</dt>
<dd id="section-2.3-4.1.1.2.4">Assume the election result's role (DF or NDF) for the local PE concerning the VLAN or
            VLAN bundle and transition to the DF_DONE state.<a href="#section-2.3-4.1.1.2.4" class="pilcrow">Â¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</li>
          </ol>
</blockquote>
<p id="section-2.3-5">This revised approach ensures proper timing and synchronization in the DF election
        process, avoiding conflicts and ensuring accurate forwarding updates.<a href="#section-2.3-5" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="example">
<section id="section-3">
      <h2 id="name-synchronization-scenarios">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-synchronization-scenarios" class="section-name selfRef">Synchronization Scenarios</a>
      </h2>
<p id="section-3-1">Consider <a href="#topology" class="auto internal xref">Figure 1</a> as an example, where initially PE2
      has failed and PE1 has taken over.  This scenario illustrates the
      problem with the DF Election mechanism described in <span><a href="https://rfc-editor.org/rfc/rfc7432#section-8.5" class="relref">Section 8.5</a> of [<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>, specifically in the context of the
      timer value configured for all PEs on the Ethernet Segment.<a href="#section-3-1" class="pilcrow">Â¶</a></p>
<p id="section-3-2">The following procedure is based on <span><a href="https://rfc-editor.org/rfc/rfc7432#section-8.5" class="relref">Section 8.5</a> of [<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> with the default 3-second timer in step 2.<a href="#section-3-2" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-3">
        <li id="section-3-3.1">Initial state: PE1 is in a steady-state and PE2 is recovering.<a href="#section-3-3.1" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-3.2">Recovery: PE2 recovers at an absolute time of t=99.<a href="#section-3-3.2" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-3.3">Advertisement: PE2 advertises RT-4, sent at t=100, to its partner (PE1).<a href="#section-3-3.3" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-3.4">Timer Start: PE2 starts a 3-second timer to allow the reception of
        RT-4 from other PE nodes.<a href="#section-3-3.4" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-3.5">Immediate carving: PE1 performs service carving immediately upon
        RT-4 reception, i.e., t=100 plus some BGP propagation delay.<a href="#section-3-3.5" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-3.6">Delayed Carving: PE2 performs service carving at time t=103.<a href="#section-3-3.6" class="pilcrow">Â¶</a>
</li>
      </ol>
<p id="section-3-4"><span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> favors traffic drops over duplicate traffic.
      With the above procedure, traffic drops will occur as part of each PE
      recovery sequence since PE1 transitions some VLANs to
      an NDF immediately upon RT-4 reception. The timer value
      (default = 3 seconds) directly affects the duration of the packet
      drops. A shorter (or zero) timer may result in duplicate traffic or
      traffic loops.<a href="#section-3-4" class="pilcrow">Â¶</a></p>
<p id="section-3-5">The following procedure is based on the SCT approach:<a href="#section-3-5" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-6">
        <li id="section-3-6.1">Initial state: PE1 is in a steady state, and PE2 is recovering.<a href="#section-3-6.1" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-6.2">Recovery: PE2 recovers at an absolute time of t=99.<a href="#section-3-6.2" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-6.3">Timer Start: PE2 starts at t=100 a 3-second timer to allow the reception of RT-4 from other PE
          nodes.<a href="#section-3-6.3" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-6.4">Advertisement: PE2 advertises RT-4, sent at t=100, with a target SCT value of t=103 to
          its partner (PE1).<a href="#section-3-6.4" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-6.5">Service Carving Timer: PE1 starts the service carving timer, with the remaining time
          until t=103.<a href="#section-3-6.5" class="pilcrow">Â¶</a>
</li>
        <li id="section-3-6.6">Simultaneous Carving: Both PE1 and PE2 carve at an absolute time of t=103.<a href="#section-3-6.6" class="pilcrow">Â¶</a>
</li>
      </ol>
<p id="section-3-7">
        To maintain the preference for minimal loss over duplicate traffic, PE1 <span class="bcp14">SHOULD</span> carve
        slightly before PE2 (with skew). The recovering PE2 performs both DF-to-NDF and NDF-to-DF
        transitions per VLAN at the timer's expiry. The original PE1, which received the SCT, applies the following:<a href="#section-3-7" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-8.1">DF-to-NDF Transition(s): at t=SCT minus skew, where both PEs are NDF for the skew duration.<a href="#section-3-8.1" class="pilcrow">Â¶</a>
</li>
        <li class="normal" id="section-3-8.2">NDF-to-DF Transition(s): at t=SCT.<a href="#section-3-8.2" class="pilcrow">Â¶</a>
</li>
      </ul>
<p id="section-3-9">
        This split behavior ensures a smooth DF role transition with minimal loss.<a href="#section-3-9" class="pilcrow">Â¶</a></p>
<p id="section-3-10">The SCT approach mitigates the negative effect of requiring a timer for discovery of
      Ethernet Segment (ES) RT-4 from other PE nodes. Furthermore, the BGP
        transmission delay (from PE2 to PE1) of the ES RT-4 becomes a non-issue. The SCT approach shortens the
        3-second timer window to the order of milliseconds.<a href="#section-3-10" class="pilcrow">Â¶</a></p>
<p id="section-3-11">The peering timer is a configurable value where 3 seconds represents the default.
        Configuring a timer value of 0, or so small as to expire during propagation of the BGP
        routes, is outside the scope of this document.
        In reality, the use of the SCT approach presented in this document encourages the use of
        larger peering timer values to overcome any sort of BGP route propagation delays.<a href="#section-3-11" class="pilcrow">Â¶</a></p>
<div id="concurrent">
<section id="section-3.1">
        <h3 id="name-concurrent-recoveries">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-concurrent-recoveries" class="section-name selfRef">Concurrent Recoveries</a>
        </h3>
<p id="section-3.1-1">In the eventuality that two or more PEs in a peering Ethernet Segment group are recovering
        concurrently or roughly at the same time, each will advertise a SCT.
        This SCT value would correspond to what each recovering PE considers the "end time" for DF
        Election. A similar situation arises in sequentially recovering PEs, when a second PE
        recovers approximately at the time of the first PE's advertised SCT expiry and with its own
        new SCT-2 outside of the initial SCT window.<a href="#section-3.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1-2">In the case of multiple concurrent DF elections, each initiated by one of the recovering
        PEs, the SCTs must be ordered chronologically. All PEs <span class="bcp14">SHALL</span> execute only a single DF
        Election at the service carving time corresponding to the largest (latest) received timestamp value.
        This DF Election will lead peering PEs into a single coordinated DF Election update.<a href="#section-3.1-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1-3">Example:<a href="#section-3.1-3" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1-4">
          <li id="section-3.1-4.1">Initial State: PE1 is in a steady state, with services elected at PE1.<a href="#section-3.1-4.1" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.2">Recovery of PE2: PE2 recovers at time t=100 and advertises RT-4 with a target SCT
          value of t=103 to its partner (PE1).<a href="#section-3.1-4.2" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.3">Timer Initiation by PE2: PE2 starts a 3-second timer to allow the reception of RT-4
          from other PE nodes.<a href="#section-3.1-4.3" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.4">Timer Initiation by PE1: PE1 starts the service carving timer, with the remaining time
          until t=103.<a href="#section-3.1-4.4" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.5">Recovery of PE3: PE3 recovers at time t=102 and advertises RT-4 with a target SCT
          value of t=105 to its partners (PE1, PE2).<a href="#section-3.1-4.5" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.6">Timer Initiation by PE3: PE3 starts a 3-second timer to allow the reception of RT-4
          from other PE nodes.<a href="#section-3.1-4.6" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.7">Timer Update by PE2: PE2 cancels the running timer and starts the service carving
          timer with the remaining time until t=105.<a href="#section-3.1-4.7" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.8">Timer Update by PE1: PE1 updates its service carving timer, with the remaining time
          until t=105.<a href="#section-3.1-4.8" class="pilcrow">Â¶</a>
</li>
          <li id="section-3.1-4.9">Service Carving: PE1, PE2, and PE3 perform service carving at the absolute time of t=105.<a href="#section-3.1-4.9" class="pilcrow">Â¶</a>
</li>
        </ol>
<p id="section-3.1-5">In the eventuality that a PE in an Ethernet Segment group recovers during the discovery window
        specified in <span><a href="https://rfc-editor.org/rfc/rfc7432#section-8.5" class="relref">Section 8.5</a> of [<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> and does not support or advertise the
        T-bit, all PEs in the current peering sequence <span class="bcp14">SHALL</span> immediately revert to the default
        behavior described in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>.<a href="#section-3.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="ntpcompat">
<section id="section-4">
      <h2 id="name-backwards-compatibility">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-backwards-compatibility" class="section-name selfRef">Backwards Compatibility</a>
      </h2>
<p id="section-4-1">For the DF election procedures to achieve global convergence and unanimity within a
          redundancy group, it is essential that all participating PEs agree on the DF election
          algorithm to be employed. However, it is possible that some PEs may continue to use the
          existing modulo-based DF election algorithm from <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> and not utilize the new 
          SCT BGP extended community. PEs that operate using the baseline DF election mechanism
          will simply discard the new SCT BGP extended community as unrecognized.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<p id="section-4-2">A PE can indicate its willingness to support clock-synchronized carving by signaling
          the new "T" DF Election Capability and including the new SCT BGP extended community along
          with the Ethernet Segment Route Type 4. If one or more PEs attached to the Ethernet
          Segment do not signal T=1, then all PEs in the Ethernet Segment <span class="bcp14">SHALL</span> revert to the
          timer-based approach as specified in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>. This reversion is particularly crucial in
          preventing VLAN shuffling when more than two PEs are involved.<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<p id="section-4-3">In the event a new or extra RT-4 is received without the new "T" DF Election
          Capability in the midst of an ongoing DF Election sequence, all SCT-based delays are
          canceled, and the DF Election is immediately applied as specified in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>, as if no SCT had been previously exchanged.<a href="#section-4-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="security">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">The mechanisms in this document use the EVPN control plane as defined
      in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span>. Security considerations described in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> are equally applicable.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">For the new SCT Extended Community, attack vectors may be setting the
      value to zero, to a value in the past, or to large times in the
      future. Handling of this attack vector is addressed in <a href="#timestamp_verification" class="auto internal xref">Section 2.2</a> alongside NTP Era rollover
      ambiguity.<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<p id="section-5-3">This document uses MPLS- and IP-based tunnel technologies to support
      data plane transport.  Security considerations described in <span>[<a href="#RFC7432" class="cite xref">RFC7432</a>]</span> and <span>[<a href="#RFC8365" class="cite xref">RFC8365</a>]</span> are equally
      applicable.<a href="#section-5-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">IANA has made the following assignment in the "EVPN Extended
      Community Sub-Types" registry set up by <span>[<a href="#RFC7153" class="cite xref">RFC7153</a>]</span>.<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Sub-Type Value</th>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0x0F</td>
            <td class="text-left" rowspan="1" colspan="1">Service Carving Time</td>
            <td class="text-left" rowspan="1" colspan="1">RFC 9722</td>
          </tr>
        </tbody>
      </table>
<p id="section-6-3">IANA has made the following assignment in the "DF Election
      Capabilities" registry set up by <span>[<a href="#RFC8584" class="cite xref">RFC8584</a>]</span>.<a href="#section-6-3" class="pilcrow">Â¶</a></p>
<table class="center" id="table-2">
        <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Bit</th>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">3</td>
            <td class="text-left" rowspan="1" colspan="1">Time Synchronization</td>
            <td class="text-left" rowspan="1" colspan="1">RFC 9722</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5905">[RFC5905]</dt>
        <dd>
<span class="refAuthor">Mills, D.</span>, <span class="refAuthor">Martin, J., Ed.</span>, <span class="refAuthor">Burbank, J.</span>, and <span class="refAuthor">W. Kasch</span>, <span class="refTitle">"Network Time Protocol Version 4: Protocol and Algorithms Specification"</span>, <span class="seriesInfo">RFC 5905</span>, <span class="seriesInfo">DOI 10.17487/RFC5905</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5905">https://www.rfc-editor.org/info/rfc5905</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7153">[RFC7153]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"IANA Registries for BGP Extended Communities"</span>, <span class="seriesInfo">RFC 7153</span>, <span class="seriesInfo">DOI 10.17487/RFC7153</span>, <time datetime="2014-03" class="refDate">March 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7153">https://www.rfc-editor.org/info/rfc7153</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8365">[RFC8365]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Drake, J., Ed.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Shekhar, R.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 8365</span>, <span class="seriesInfo">DOI 10.17487/RFC8365</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8365">https://www.rfc-editor.org/info/rfc8365</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8584">[RFC8584]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Mohanty, S., Ed.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Nagaraj, K.</span>, and <span class="refAuthor">S. Sathappan</span>, <span class="refTitle">"Framework for Ethernet VPN Designated Forwarder Election Extensibility"</span>, <span class="seriesInfo">RFC 8584</span>, <span class="seriesInfo">DOI 10.17487/RFC8584</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8584">https://www.rfc-editor.org/info/rfc8584</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="HRW98">[HRW98]</dt>
      <dd>
<span class="refAuthor">Thaler, D.</span> and <span class="refAuthor">C. Ravishankar</span>, <span class="refTitle">"Using Name-Based Mappings to Increase Hit Rates"</span>, <span class="refContent">IEEE/ACM Transactions on Networking, vol. 6, no. 1</span>, <time datetime="1998-02" class="refDate">February 1998</time>, <span>&lt;<a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2017/02/HRW98.pdf">https://www.microsoft.com/en-us/research/wp-content/uploads/2017/02/HRW98.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">Authors would like to acknowledge helpful comments and contributions
      of <span class="contact-name">Satya Mohanty</span> and <span class="contact-name">Bharath       Vasudevan</span>.  Also thank you to <span class="contact-name">Anoop Ghanwani</span>
      and <span class="contact-name">Gunter van de Velde</span> for their thorough review
      with valuable comments and corrections.<a href="#appendix-A-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="contributors">
<section id="appendix-B">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="appendix-B-1">In addition to the authors listed on the front page, the following
      coauthors have also contributed substantially to this document:<a href="#appendix-B-1" class="pilcrow">Â¶</a></p>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Gaurav Badoni</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:gbadoni@cisco.com" class="email">gbadoni@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dhananjaya Rao</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dhrao@cisco.com" class="email">dhrao@cisco.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Patrice Brissette</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:pbrisset@cisco.com" class="email">pbrisset@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ali Sajassi</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sajassi@cisco.com" class="email">sajassi@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Luc AndrÃ© Burdet (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lburdet@cisco.com" class="email">lburdet@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Drake</span></div>
<div dir="auto" class="left"><span class="org">Independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:je_drake@yahoo.com" class="email">je_drake@yahoo.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jorge Rabadan</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jorge.rabadan@nokia.com" class="email">jorge.rabadan@nokia.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
