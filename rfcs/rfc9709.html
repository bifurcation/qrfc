<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9709: Encryption Key Derivation in the Cryptographic Message Syntax (CMS) Using HKDF with SHA-256</title>
<meta content="Russ Housley" name="author">
<meta content="
       This document specifies the derivation of the content-encryption key or the
content-authenticated-encryption key in the Cryptographic Message Syntax (CMS)
using the HMAC-based Extract-and-Expand Key Derivation Function (HKDF) with SHA-256.
The use of this mechanism provides protection against an attacker that manipulates the
content-encryption algorithm identifier or the content-authenticated-encryption
algorithm identifier. 
    " name="description">
<meta content="xml2rfc 3.25.0" name="generator">
<meta content="content-encryption key" name="keyword">
<meta content="content-authenticated-encryption key" name="keyword">
<meta content="9709" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.25.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    pydyf 0.10.0
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 62.3
-->
<link href="rfc9709.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-lamps-cms-cek-hkdf-sha256-05" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9709" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9709</td>
<td class="center">Encryption Key Derivation in CMS</td>
<td class="right">January 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Housley</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9709" class="eref">9709</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-01" class="published">January 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Housley</div>
<div class="org">Vigil Security</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9709</h1>
<h1 id="title">Encryption Key Derivation in the Cryptographic Message Syntax (CMS) Using HKDF with SHA-256</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies the derivation of the content-encryption key or the
content-authenticated-encryption key in the Cryptographic Message Syntax (CMS)
using the HMAC-based Extract-and-Expand Key Derivation Function (HKDF) with SHA-256.
The use of this mechanism provides protection against an attacker that manipulates the
content-encryption algorithm identifier or the content-authenticated-encryption
algorithm identifier.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9709">https://www.rfc-editor.org/info/rfc9709</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-asn1" class="internal xref">ASN.1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-cryptographic-algorithm-agi" class="internal xref">Cryptographic Algorithm Agility Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-use-of-hkdf-with-sha-256-to" class="internal xref">Use of HKDF with SHA-256 to Derive Encryption Keys</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-the-id-alg-cek-hkdf-sha256-" class="internal xref">The id-alg-cek-hkdf-sha256 Algorithm Identifier</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-smimecapabilities-attribute" class="internal xref">SMIMECapabilities Attribute Conventions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-use-of-hkdf-with-sha-256-wi" class="internal xref">Use of HKDF with SHA-256 with CMS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-enveloped-data-content-type" class="internal xref">Enveloped-Data Content Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-encrypted-data-content-type" class="internal xref">Encrypted-Data Content Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-authenticated-enveloped-dat" class="internal xref">Authenticated-Enveloped-Data Content Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-asn1-module" class="internal xref">ASN.1 Module</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-cms_cek_hkdf_sha256-functio" class="internal xref">CMS_CEK_HKDF_SHA256 Function Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-cms_cek_hkdf_sha256-with-ae" class="internal xref">CMS_CEK_HKDF_SHA256 with AES-128-GCM</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-cms_cek_hkdf_sha256-with-aes" class="internal xref">CMS_CEK_HKDF_SHA256 with AES-128-CBC</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies the derivation of the content-encryption key for the
Cryptographic Message Syntax (CMS) enveloped-data content type <span>[<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>, the
content-encryption key for the CMS encrypted-data content type <span>[<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>, or the
content-authenticated-encryption key for the authenticated-enveloped-data
content type <span>[<a href="#RFC5083" class="cite xref">RFC5083</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The use of this mechanism provides protection against an attacker that manipulates the
content-encryption algorithm identifier or the content-authenticated-encryption
algorithm identifier.  Johannes Roth and Falko Strenzke presented such an attack
at IETF 118 <span>[<a href="#RS2023" class="cite xref">RS2023</a>]</span>, where:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-3">
<li id="section-1-3.1">
          <p id="section-1-3.1.1">The attacker intercepts a CMS authenticated-enveloped-data content <span>[<a href="#RFC5083" class="cite xref">RFC5083</a>]</span>
that uses either AES-CCM or AES-GCM <span>[<a href="#RFC5084" class="cite xref">RFC5084</a>]</span>.<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-3.2">
          <p id="section-1-3.2.1">The attacker turns the intercepted content into a "garbage" CMS enveloped-data
content (<span><a href="https://rfc-editor.org/rfc/rfc5652#section-6" class="relref">Section 6</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>) that is composed of AES-CBC guess blocks.<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-3.3">
          <p id="section-1-3.3.1">The attacker sends the "garbage" message to the victim, and the victim reveals
the result of the decryption to the attacker.<a href="#section-1-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-3.4">
          <p id="section-1-3.4.1">If any of the transformed plaintext blocks match the guess for that block, then
the attacker learns the plaintext for that block.<a href="#section-1-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-1-4">With highly structured messages, one block can reveal the only sensitive part of
the original message.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This attack is thwarted if the encryption key depends upon the delivery of
the unmodified algorithm identifier.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The mitigation for this attack has three parts:<a href="#section-1-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-7">
        <li id="section-1-7.1">Potential recipients include the id-alg-cek-hkdf-sha256 algorithm
        identifier (with no parameters) in S/MIME Capabilities to indicate
        support for this mitigation.<a href="#section-1-7.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-7.2">As a flag to the recipient that this mitigation is being used,
        carry the id-alg-cek-hkdf-sha256 algorithm identifier as the
        contentEncryptionAlgorithm in the EncryptedContentInfo structure.
        This structure is used in the enveloped-data content type, the
        encrypted-data content type, and the authenticated-enveloped-data
        content type.  The parameters field of the id-alg-cek-hkdf-sha256
        algorithm identifier identifies the content-encryption algorithm or
        the content-authenticated-encryption algorithm and any associated
        parameters.<a href="#section-1-7.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-7.3">
          <p id="section-1-7.3.1">Perform encryption with a derived content-encryption key or
        content-authenticated-encryption key:<a href="#section-1-7.3.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1-7.3.2">
<pre>
      CEK' = HKDF(CEK, AlgorithmIdentifier)
</pre><a href="#section-1-7.3.2" class="pilcrow">¶</a>
</div>
</li>
      </ol>
<div id="asn1">
<section id="section-1.1">
        <h3 id="name-asn1">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-asn1" class="section-name selfRef">ASN.1</a>
        </h3>
<p id="section-1.1-1">CMS values are generated using ASN.1 <span>[<a href="#X680" class="cite xref">X680</a>]</span>, using the Basic
Encoding Rules (BER) and the Distinguished Encoding Rules
(DER) <span>[<a href="#X690" class="cite xref">X690</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptographic-algorithm-agility-considerations">
<section id="section-1.3">
        <h3 id="name-cryptographic-algorithm-agi">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-cryptographic-algorithm-agi" class="section-name selfRef">Cryptographic Algorithm Agility Considerations</a>
        </h3>
<p id="section-1.3-1">There is no provision for key derivation functions other than HKDF, and
there is no provision for hash functions other than SHA-256.  If there is
ever a need to support another key derivation function or another hash
function, it will be very straightforward to assign a new object
identifier.  At this point, keeping the design very simple seems most
important.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="cmskdf">
<section id="section-2">
      <h2 id="name-use-of-hkdf-with-sha-256-to">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-use-of-hkdf-with-sha-256-to" class="section-name selfRef">Use of HKDF with SHA-256 to Derive Encryption Keys</a>
      </h2>
<p id="section-2-1">The mitigation uses the HMAC-based Extract-and-Expand Key Derivation
Function (HKDF) <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span> to derive output keying material (OKM) from
input keying material (IKM).  HKDF is used with the SHA-256 hash function
<span>[<a href="#FIPS180" class="cite xref">FIPS180</a>]</span>.  The derivation includes the DER-encoded AlgorithmIdentifier as
the optional info input value.  The encoded value includes the ASN.1 tag
for SEQUENCE (0x30), the length, and the value.  This AlgorithmIdentifier is
carried as the parameter to the id-alg-cek-hkdf-sha256 algorithm identifier.  If
an attacker were to change the originator-provided AlgorithmIdentifier, then the
recipient will derive a different content-encryption key or
content-authenticated-encryption key.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The CMS_CEK_HKDF_SHA256 function uses the HKDF-Extract and HKDF-Expand functions
to derive the OKM from the IKM:<a href="#section-2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-2-3">
        <dt id="section-2-3.1">Inputs:</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.2">
          <span class="break"></span><dl class="dlCompact dlParallel" id="section-2-3.2.1">
            <dt id="section-2-3.2.1.1">IKM</dt>
            <dd style="margin-left: 3.0em" id="section-2-3.2.1.2">input keying material<a href="#section-2-3.2.1.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2-3.2.1.3">info</dt>
            <dd style="margin-left: 3.0em" id="section-2-3.2.1.4">DER-encoded AlgorithmIdentifier<a href="#section-2-3.2.1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">Output:</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.4">
          <span class="break"></span><dl class="dlCompact dlParallel" id="section-2-3.4.1">
            <dt id="section-2-3.4.1.1">OKM</dt>
            <dd style="margin-left: 3.0em" id="section-2-3.4.1.2">output keying material (same size as IKM)<a href="#section-2-3.4.1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-2-4">The output OKM is calculated as follows:<a href="#section-2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2-5">
<pre>
   OKM_SIZE = len(IKM)  /* length in octets */
   IF OKM_SIZE &gt; 8160 THEN raise error

   salt = "The Cryptographic Message Syntax"
   PRK = HKDF-Extract(salt, IKM)

   OKM = HKDF-Expand(PRK, info, OKM_SIZE)
</pre><a href="#section-2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="alg-def">
<section id="section-3">
      <h2 id="name-the-id-alg-cek-hkdf-sha256-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-id-alg-cek-hkdf-sha256-" class="section-name selfRef">The id-alg-cek-hkdf-sha256 Algorithm Identifier</a>
      </h2>
<p id="section-3-1">The id-alg-cek-hkdf-sha256 algorithm identifier indicates that the CMS_CEK_HKDF_SHA256
function defined in <a href="#cmskdf" class="auto internal xref">Section 2</a> is used to derive the content-encryption key or the
content-authenticated-encryption key.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The following object identifier identifies the id-alg-cek-hkdf-sha256
algorithm:<a href="#section-3-2" class="pilcrow">¶</a></p>
<div class="lang-asn.1 sourcecode" id="section-3-3">
<pre>
   id-alg-cek-hkdf-sha256 OBJECT IDENTIFIER ::= { iso(1)
      member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9)
      id-smime(16) alg(3) 31 }
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">The id-alg-cek-hkdf-sha256 parameters field has an ASN.1 type of AlgorithmIdentifier.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">Using the conventions from <span>[<a href="#RFC5911" class="cite xref">RFC5911</a>]</span>, the id-alg-cek-hkdf-sha256 algorithm identifier
is defined as:<a href="#section-3-5" class="pilcrow">¶</a></p>
<div class="lang-asn.1 sourcecode" id="section-3-6">
<pre>
  ContentEncryptionAlgorithmIdentifier ::=
    AlgorithmIdentifier{CONTENT-ENCRYPTION, { ... } }

  cea-CEKHKDFSHA256 CONTENT-ENCRYPTION ::= {
    IDENTIFIER id-alg-cek-hkdf-sha256
    PARAMS TYPE ContentEncryptionAlgorithmIdentifier ARE required
    SMIME-CAPS { IDENTIFIED BY id-alg-cek-hkdf-sha256 } }
</pre><a href="#section-3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="smimecapabilities-attribute-conventions">
<section id="section-4">
      <h2 id="name-smimecapabilities-attribute">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-smimecapabilities-attribute" class="section-name selfRef">SMIMECapabilities Attribute Conventions</a>
      </h2>
<p id="section-4-1">The SMIMECapabilities attribute is defined in <span><a href="https://rfc-editor.org/rfc/rfc8551#section-2.5.2" class="relref">Section 2.5.2</a> of [<a href="#RFC8551" class="cite xref">RFC8551</a>]</span>.  An
S/MIME client announces the set of cryptographic functions it supports using the
SMIMECapabilities attribute.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">If an S/MIME client supports the mechanism in this document, the
id-alg-cek-hkdf-sha256 object identifier <span class="bcp14">SHOULD</span> be included in the set of
cryptographic functions.  The parameter with this encoding <span class="bcp14">MUST</span> be absent.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The encoding for id-alg-cek-hkdf-sha256, in hexadecimal, is:<a href="#section-4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-4">
<pre>
   30 0d 06 0b 2a 86 48 86 f7 0d 01 09 10 03 1f
</pre><a href="#section-4-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="use-of-hkdf-with-sha-256-with-cms">
<section id="section-5">
      <h2 id="name-use-of-hkdf-with-sha-256-wi">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-use-of-hkdf-with-sha-256-wi" class="section-name selfRef">Use of HKDF with SHA-256 with CMS</a>
      </h2>
<p id="section-5-1">This section describes the originator and recipient processing to implement
this mitigation for each of the CMS encrypting content types.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="enveloped-data-content-type">
<section id="section-5.1">
        <h3 id="name-enveloped-data-content-type">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-enveloped-data-content-type" class="section-name selfRef">Enveloped-Data Content Type</a>
        </h3>
<p id="section-5.1-1">The fourth step of constructing an enveloped-data content type is repeated below
from <span><a href="https://rfc-editor.org/rfc/rfc5652#section-6" class="relref">Section 6</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<blockquote id="section-5.1-2">
          <ol start="4" type="1" class="normal type-1" id="section-5.1-2.1">
<li id="section-5.1-2.1.1">The content is encrypted with the content-encryption key.
    Content encryption may require that the content be padded to a
    multiple of some block size; see Section <a href="https://rfc-editor.org/rfc/rfc5652#section-6.3" class="relref">6.3</a>.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a>
</li>
          </ol>
</blockquote>
<p id="section-5.1-3">To implement this mitigation, the originator expands this step as follows:<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.1">Include the id-alg-cek-hkdf-sha256 algorithm identifier in the
          contentEncryptionAlgorithm.algorithm field of the
          EncryptedContentInfo structure, and set the
          contentEncryptionAlgorithm.parameters field to the
          AlgorithmIdentifier for the content-encryption algorithm that will
          be used to encrypt the content, including both the algorithm and
          optional parameters.<a href="#section-5.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-4.2">
            <p id="section-5.1-4.2.1">Derive the new content-encryption key (CEK') from the original
          content-encryption key (CEK) and the
          ContentEncryptionAlgorithmIdentifier, which is carried in the
          contentEncryptionAlgorithm.parameters field:<a href="#section-5.1-4.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-4.2.2">
<pre>
CEK' = CMS_CEK_HKDF_SHA256(CEK, ContentEncryptionAlgorithmIdentifier)
</pre><a href="#section-5.1-4.2.2" class="pilcrow">¶</a>
</div>
</li>
          <li class="normal" id="section-5.1-4.3">The content is encrypted with the new content-encryption key
          (CEK').  Content encryption may require that the content be padded
          to a multiple of some block size; see <span><a href="https://rfc-editor.org/rfc/rfc5652#section-6.3" class="relref">Section 6.3</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>.<a href="#section-5.1-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-5">The presence of the id-alg-cek-hkdf-sha256 algorithm identifier in the
contentEncryptionAlgorithm.algorithm field of the EncryptedContentInfo
structure tells the recipient to derive the new content-encryption
key (CEK') as shown above, and then use it for decryption of the
EncryptedContent.  If the id-alg-cek-hkdf-sha256 algorithm identifier
is not present in the contentEncryptionAlgorithm.algorithm field of
the EncryptedContentInfo structure, then the recipient uses the original
content-encryption key (CEK) for decryption of the EncryptedContent.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encrypted-data-content-type">
<section id="section-5.2">
        <h3 id="name-encrypted-data-content-type">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-encrypted-data-content-type" class="section-name selfRef">Encrypted-Data Content Type</a>
        </h3>
<p id="section-5.2-1">As specified in <span><a href="https://rfc-editor.org/rfc/rfc5652#section-8" class="relref">Section 8</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>, the content-encryption key
is managed by other means.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">To implement this mitigation, the originator performs the following:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">Include the id-alg-cek-hkdf-sha256 algorithm identifier in
          the contentEncryptionAlgorithm.algorithm field of the
          EncryptedContentInfo structure, and set the
          contentEncryptionAlgorithm.parameters field to the
          AlgorithmIdentifier for the content-encryption algorithm that will
          be used to encrypt the content, including both the algorithm and
          optional parameters.<a href="#section-5.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">Derive the new content-encryption key (CEK') from the
          original content-encryption key (CEK) and the
          ContentEncryptionAlgorithmIdentifier, which is carried in the
          contentEncryptionAlgorithm.parameters field:<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-3.2.2">
<pre>
CEK' = CMS_CEK_HKDF_SHA256(CEK, ContentEncryptionAlgorithmIdentifier)
</pre><a href="#section-5.2-3.2.2" class="pilcrow">¶</a>
</div>
</li>
          <li class="normal" id="section-5.2-3.3">The content is encrypted with the new content-encryption key
          (CEK').  Content encryption may require that the content be padded
          to a multiple of some block size; see <span><a href="https://rfc-editor.org/rfc/rfc5652#section-6.3" class="relref">Section 6.3</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>.<a href="#section-5.2-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-4">The presence of the id-alg-cek-hkdf-sha256 algorithm identifier in the
contentEncryptionAlgorithm.algorithm field of the EncryptedContentInfo
structure tells the recipient to derive the new content-encryption
key (CEK') as shown above, and then use it for decryption of the
EncryptedContent.  If the id-alg-cek-hkdf-sha256 algorithm identifier
is not present in the contentEncryptionAlgorithm.algorithm field of
the EncryptedContentInfo structure, then the recipient uses the original
content-encryption key (CEK) for decryption of the EncryptedContent.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authenticated-enveloped-data-content-type">
<section id="section-5.3">
        <h3 id="name-authenticated-enveloped-dat">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-authenticated-enveloped-dat" class="section-name selfRef">Authenticated-Enveloped-Data Content Type</a>
        </h3>
<p id="section-5.3-1">The fifth step of constructing an authenticated-enveloped-data content type is
repeated below from <span><a href="https://rfc-editor.org/rfc/rfc5083#section-2" class="relref">Section 2</a> of [<a href="#RFC5083" class="cite xref">RFC5083</a>]</span>:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<blockquote id="section-5.3-2">
          <ol start="5" type="1" class="normal type-1" id="section-5.3-2.1">
<li id="section-5.3-2.1.1"> The attributes collected in step 4 are authenticated and the CMS
    content is authenticated and encrypted with the content-
    authenticated-encryption key.  If the authenticated encryption
    algorithm requires either the additional authenticated data (AAD)
    or the content to be padded to a multiple of some block size,
    then the padding is added as described in Section <a href="https://rfc-editor.org/rfc/rfc3852#section-6.3" class="relref">6.3</a> of [CMS].<a href="#section-5.3-2.1.1" class="pilcrow">¶</a>
</li>
          </ol>
</blockquote>
<aside id="section-5.3-3">
          <p id="section-5.3-3.1">Note that [CMS] refers to <span>[<a href="#RFC3852" class="cite xref">RFC3852</a>]</span>, which has been obsoleted by <span>[<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>, but the text in Section 6.3 was unchanged in RFC 5652.<a href="#section-5.3-3.1" class="pilcrow">¶</a></p>
</aside>
<p id="section-5.3-4">To implement this mitigation, the originator expands this step as follows:<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-5.1">Include the id-alg-cek-hkdf-sha256 algorithm identifier in the
          contentEncryptionAlgorithm.algorithm field of the
          EncryptedContentInfo structure, and set the
          contentEncryptionAlgorithm.parameters field to the
          AlgorithmIdentifier for the content-authenticated-encryption
          algorithm that will be used for authenticated encryption of the
          content, including both the algorithm and optional parameters.<a href="#section-5.3-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-5.2">
            <p id="section-5.3-5.2.1">Derive the new content-authenticated-encryption key (CEK')
          from the original content-authenticated-encryption key (CEK) and the
          ContentEncryptionAlgorithmIdentifier:<a href="#section-5.3-5.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-5.2.2">
<pre>
CEK' = CMS_CEK_HKDF_SHA256(CEK, ContentEncryptionAlgorithmIdentifier)
</pre><a href="#section-5.3-5.2.2" class="pilcrow">¶</a>
</div>
</li>
          <li class="normal" id="section-5.3-5.3">The attributes collected in step 4 are authenticated and the CMS
          content is authenticated and encrypted with the new
          content-authenticated-encryption key (CEK').  If the authenticated
          encryption algorithm requires either the additional authenticated
          data (AAD) or the content to be padded to a multiple of some block
          size, then the padding is added as described in <span><a href="https://rfc-editor.org/rfc/rfc5652#section-6.3" class="relref">Section 6.3</a> of [<a href="#RFC5652" class="cite xref">RFC5652</a>]</span>.<a href="#section-5.3-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-6">The presence of the id-alg-cek-hkdf-sha256 algorithm identifier in the
contentEncryptionAlgorithm.algorithm field of the EncryptedContentInfo
structure tells the recipient to derive the new content-authenticated-encryption
key (CEK') as shown above, and then use it for authenticated decryption of the
EncryptedContent and the authentication of the AAD.  If the id-alg-cek-hkdf-sha256
algorithm identifier is not present in the contentEncryptionAlgorithm.algorithm
field of the EncryptedContentInfo structure, then the recipient uses the original
content-authenticated-encryption (CEK) for decryption and authentication of
the EncryptedContent and the authentication of the AAD.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">This mitigation always uses HKDF with SHA-256.  One KDF algorithm was
selected to avoid the need for negotiation.  In the future, if a weakness
is found in the KDF algorithm, a new attribute  will need to be assigned for
use with an alternative KDF algorithm.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">If the attacker removes the id-alg-cek-hkdf-sha256 object identifier from the
contentEncryptionAlgorithm.algorithm field of the EncryptedContentInfo
structure prior to delivery to the recipient, then the recipient will not
attempt to derive CEK', which will deny the recipient access to the content
but will not assist the attacker in recovering the plaintext content.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">If the attacker changes contentEncryptionAlgorithm.parameters field of the
EncryptedContentInfo structure prior to delivery to the recipient, then the
recipient will derive a different CEK', which will not assist the attacker in
recovering the plaintext content.  Providing the object identifier as an input to
the key derivation function is sufficient to mitigate the attack described
in <span>[<a href="#RS2023" class="cite xref">RS2023</a>]</span>, but this mitigation includes both the object identifier and the
parameters to protect against some yet-to-be-discovered attack that only
manipulates the parameters.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Implementations <span class="bcp14">MUST</span> protect the content-encryption keys and
content-authenticated-encryption keys, including the CEK and CEK'.
Compromise of a content-encryption key may result in disclosure of the
associated encrypted content.  Compromise of a content-authenticated-encryption
key may result in disclosure of the associated encrypted content or allow
modification of the authenticated content and the AAD.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">Implementations <span class="bcp14">MUST</span> randomly generate content-encryption keys and
content-authenticated-encryption keys.  Using an inadequate pseudorandom
number generator (PRNG) to generate cryptographic keys can result in little or
no security.  An attacker may find it much easier to reproduce the PRNG
environment that produced the keys and then search the resulting small set
of possibilities, rather than brute-force searching the whole key space.  The
generation of quality random numbers is difficult.  <span>[<a href="#RFC4086" class="cite xref">RFC4086</a>]</span> offers important
guidance on this topic.<a href="#section-6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-7">
      <h2 id="name-privacy-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-7-1">If the message-digest attribute is included in the AuthAttributes,
then the attribute value will contain the unencrypted one-way hash
value of the plaintext of the content.  Disclosure of this hash value
enables content tracking, and it can be used to determine if the
content matches one or more candidates.  For these reasons,
the AuthAttributes <span class="bcp14">SHOULD NOT</span> contain the message-digest attribute.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="operational-considerations">
<section id="section-8">
      <h2 id="name-operational-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-8-1">CMS is often used to provide encryption in messaging environments,
where various forms of unsolicited messages (such as spam and phishing)
represent a significant volume of unwanted traffic.  Mitigation strategies for
unwanted message traffic involve analysis of plaintext message content.  When
recipients accept unsolicited encrypted messages, they become even more
vulnerable to unwanted traffic since many mitigation strategies will be
unable to access the plaintext message content.  Therefore, software that
receives messages that have been encrypted using CMS ought to provide alternate
mechanisms to handle the unwanted message traffic.  One approach that
does not require disclosure of keying material to a server is to reject
or discard encrypted messages unless they purport to come from a member
of a previously approved originator list.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">For the ASN.1 module in <a href="#appendix-asn1" class="auto internal xref">Appendix A</a> of this document, IANA has assigned the following object identifier (OID) in the "SMI Security for S/MIME Module Identifier (1.2.840.113549.1.9.16.0)" registry:<a href="#section-9-1" class="pilcrow">¶</a></p>
<div id="tab1">
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Decimal</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
            <th class="text-left" rowspan="1" colspan="1">References</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">80</td>
            <td class="text-left" rowspan="1" colspan="1">id-mod-CMS-CEK-HKDF-SHA256-2023</td>
            <td class="text-left" rowspan="1" colspan="1">RFC 9709</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-9-3">IANA has allocated the id-alg-cek-hkdf-sha256 algorithm identifier as specified
in <a href="#alg-def" class="auto internal xref">Section 3</a> in the "SMI Security for S/MIME Algorithms (1.2.840.113549.1.9.16.3)" registry as follows:<a href="#section-9-3" class="pilcrow">¶</a></p>
<div id="tab2">
<table class="center" id="table-2">
        <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Decimal</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
            <th class="text-left" rowspan="1" colspan="1">References</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">31</td>
            <td class="text-left" rowspan="1" colspan="1">id-alg-cek-hkdf-sha256</td>
            <td class="text-left" rowspan="1" colspan="1">RFC 9709</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS180">[FIPS180]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"Secure Hash Standard (SHS)"</span>, <span class="seriesInfo">FIPS PUB 180-4</span>, <span class="seriesInfo">DOI 10.6028/NIST.FIPS.180-4</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5083">[RFC5083]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type"</span>, <span class="seriesInfo">RFC 5083</span>, <span class="seriesInfo">DOI 10.17487/RFC5083</span>, <time datetime="2007-11" class="refDate">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5083">https://www.rfc-editor.org/info/rfc5083</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5652">[RFC5652]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">STD 70</span>, <span class="seriesInfo">RFC 5652</span>, <span class="seriesInfo">DOI 10.17487/RFC5652</span>, <time datetime="2009-09" class="refDate">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5652">https://www.rfc-editor.org/info/rfc5652</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8551">[RFC8551]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refAuthor">Ramsdell, B.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X680">[X680]</dt>
        <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology -- Abstract Syntax Notation One (ASN.1): Specification of basic notation"</span>, <span class="seriesInfo">ITU-T Recommendation X.680</span>, <span class="seriesInfo">ISO/IEC 8824-1:2021</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.itu.int/rec/T-REC-X.680">https://www.itu.int/rec/T-REC-X.680</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X690">[X690]</dt>
      <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology -- ASN.1 encoding rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)"</span>, <span class="seriesInfo">ITU-T Recommendation X.690</span>, <span class="seriesInfo">ISO/IEC 8825-1-2021</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.itu.int/rec/T-REC-X.690">https://www.itu.int/rec/T-REC-X.690</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC3852">[RFC3852]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 3852</span>, <span class="seriesInfo">DOI 10.17487/RFC3852</span>, <time datetime="2004-07" class="refDate">July 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3852">https://www.rfc-editor.org/info/rfc3852</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4086">https://www.rfc-editor.org/info/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5084">[RFC5084]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Using AES-CCM and AES-GCM Authenticated Encryption in the Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 5084</span>, <span class="seriesInfo">DOI 10.17487/RFC5084</span>, <time datetime="2007-11" class="refDate">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5084">https://www.rfc-editor.org/info/rfc5084</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5911">[RFC5911]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">J. Schaad</span>, <span class="refTitle">"New ASN.1 Modules for Cryptographic Message Syntax (CMS) and S/MIME"</span>, <span class="seriesInfo">RFC 5911</span>, <span class="seriesInfo">DOI 10.17487/RFC5911</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5911">https://www.rfc-editor.org/info/rfc5911</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RS2023">[RS2023]</dt>
      <dd>
<span class="refAuthor">Roth, J.</span> and <span class="refAuthor">F. Strenzke</span>, <span class="refTitle">"AEAD-to-CBC Downgrade Attacks on CMS"</span>, <span class="refContent">IETF 118 Proceedings</span>, <time datetime="2023-11-08" class="refDate">8 November 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/meeting/118/materials/slides-118-lamps-attack-against-aead-in-cms">https://datatracker.ietf.org/meeting/118/materials/slides-118-lamps-attack-against-aead-in-cms</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="appendix-asn1">
<section id="appendix-A">
      <h2 id="name-asn1-module">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-asn1-module" class="section-name selfRef">ASN.1 Module</a>
      </h2>
<p id="appendix-A-1">This ASN.1 module builds upon the conventions established in <span>[<a href="#RFC5911" class="cite xref">RFC5911</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div class="lang-asn.1 sourcecode" id="appendix-A-2">
<pre>&lt;CODE BEGINS&gt;
CMS-CEK-HKDF-SHA256-Module-2023
  { iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9)
    id-smime(16) id-mod(0) id-mod-CMS-CEK-HKDF-SHA256-2023(80) }

DEFINITIONS IMPLICIT TAGS ::= BEGIN

EXPORTS ALL;

IMPORTS
  AlgorithmIdentifier{}, CONTENT-ENCRYPTION, SMIME-CAPS
  FROM AlgorithmInformation-2009 -- in RFC 5911
    { iso(1) identified-organization(3) dod(6) internet(1)
      security(5) mechanisms(5) pkix(7) id-mod(0)
      id-mod-algorithmInformation-02(58) } ;


--
-- CEK-HKDF-SHA256 Algorithm
--

id-alg-cek-hkdf-sha256 OBJECT IDENTIFIER ::= { iso(1) member-body(2)
    us(840) rsadsi(113549) pkcs(1) pkcs-9(9) id-smime(16) alg(3) 31 }

ContentEncryptionAlgorithmIdentifier ::=
    AlgorithmIdentifier{CONTENT-ENCRYPTION, { ... } }

cea-CEKHKDFSHA256 CONTENT-ENCRYPTION ::= {
    IDENTIFIER id-alg-cek-hkdf-sha256
    PARAMS TYPE ContentEncryptionAlgorithmIdentifier ARE required
    SMIME-CAPS { IDENTIFIED BY id-alg-cek-hkdf-sha256 } }

--
-- S/MIME Capability for CEK-HKDF-SHA256 Algorithm
--

SMimeCaps SMIME-CAPS ::= { cap-CMSCEKHKDFSHA256, ... }

cap-CMSCEKHKDFSHA256 SMIME-CAPS ::=
    { -- No value -- IDENTIFIED BY id-alg-cek-hkdf-sha256 }

END

&lt;CODE ENDS&gt;</pre><a href="#appendix-A-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cmscekhkdfsha256-function-examples">
<section id="appendix-B">
      <h2 id="name-cms_cek_hkdf_sha256-functio">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-cms_cek_hkdf_sha256-functio" class="section-name selfRef">CMS_CEK_HKDF_SHA256 Function Examples</a>
      </h2>
<p id="appendix-B-1">This appendix provides two test vectors for the CMS_CEK_HKDF_SHA256 function.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="cmscekhkdfsha256-with-aes-128-gcm">
<section id="appendix-B.1">
        <h3 id="name-cms_cek_hkdf_sha256-with-ae">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-cms_cek_hkdf_sha256-with-ae" class="section-name selfRef">CMS_CEK_HKDF_SHA256 with AES-128-GCM</a>
        </h3>
<p id="appendix-B.1-1">This test vector includes an AlgorithmIdentifier for AES-128-GCM.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="lang-test-vectors sourcecode" id="appendix-B.1-2">
<pre>
IKM = c702e7d0a9e064b09ba55245fb733cf3

The AES-128-GCM AlgorithmIdentifier:
 algorithm=2.16.840.1.101.3.4.1.6
 parameters=GCMParameters:
  aes-nonce=0x5c79058ba2f43447639d29e2
  aes-ICVlen is omitted; it indicates the DEFAULT of 12

DER-encoded AlgorithmIdentifier:
  301b0609608648016503040106300e040c5c79058ba2f43447639d29e2

OKM = 2124ffb29fac4e0fbbc7d5d87492bff3
</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cmscekhkdfsha256-with-aes-128-cbc">
<section id="appendix-B.2">
        <h3 id="name-cms_cek_hkdf_sha256-with-aes">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-cms_cek_hkdf_sha256-with-aes" class="section-name selfRef">CMS_CEK_HKDF_SHA256 with AES-128-CBC</a>
        </h3>
<p id="appendix-B.2-1">This test vector uses includes an AlgorithmIdentifier for AES-128-CBC.<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div class="lang-test-vectors sourcecode" id="appendix-B.2-2">
<pre>
IKM = c702e7d0a9e064b09ba55245fb733cf3

The AES-128-CBC AlgorithmIdentifier:
 algorithm=2.16.840.1.101.3.4.1.2
 parameters=AES-IV=0x651f722ffd512c52fe072e507d72b377

DER-encoded AlgorithmIdentifier:
  301d06096086480165030401020410651f722ffd512c52fe072e507d72b377

OKM = 9cd102c52f1e19ece8729b35bfeceb50
</pre><a href="#appendix-B.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-C">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-C-1">Thanks to <span class="contact-name">Mike Ounsworth</span>, <span class="contact-name">Carl Wallace</span>, and <span class="contact-name">Joe Mandel</span> their
      careful review and constructive comments.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Russ Housley</span></div>
<div dir="auto" class="left"><span class="org">Vigil Security, LLC</span></div>
<div dir="auto" class="left">
<span class="locality">Herndon</span>, <span class="region">VA</span> </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:housley@vigilsec.com" class="email">housley@vigilsec.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
