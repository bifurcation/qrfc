<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 9770: Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</title>
<meta content="Marco Tiloca" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="Sebastian Echeverria" name="author">
<meta content="Grace Lewis" name="author">
<meta content="
       This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an authorization server to notify clients and resource servers (i.e., registered devices) about revoked access tokens. As specified in this document, the method allows clients and resource servers (RSs) to access a Token Revocation List (TRL) on the authorization server by using the Constrained Application Protocol (CoAP), with the possible additional use of resource observation. Resulting (unsolicited) notifications of revoked access tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on clients and RSs. 
    " name="description">
<meta content="xml2rfc 3.28.1" name="generator">
<meta content="9770" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.28.1
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 5.3.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 65.0
-->
<link href="rfc9770.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://datatracker.ietf.org/doc/draft-ietf-ace-revoked-token-notification-09" rel="prev">
  <link href="https://dx.doi.org/10.17487/rfc9770" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9770</td>
<td class="center">Notification of Revoked Tokens in ACE</td>
<td class="right">June 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc9770" class="eref">9770</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-06" class="published">June 2025</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">S. Echeverria</div>
<div class="org">CMU SEI</div>
</div>
<div class="author">
      <div class="author-name">G. Lewis</div>
<div class="org">CMU SEI</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9770</h1>
<h1 id="title">Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an authorization server to notify clients and resource servers (i.e., registered devices) about revoked access tokens. As specified in this document, the method allows clients and resource servers (RSs) to access a Token Revocation List (TRL) on the authorization server by using the Constrained Application Protocol (CoAP), with the possible additional use of resource observation. Resulting (unsolicited) notifications of revoked access tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on clients and RSs.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9770">https://www.rfc-editor.org/info/rfc9770</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-issuing-of-access-tokens-at" class="internal xref">Issuing of Access Tokens at the AS</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-token-hash" class="internal xref">Token Hash</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-motivation-for-the-used-con" class="internal xref">Motivation for the Used Construction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-issuing-of-the-access-token" class="internal xref">Issuing of the Access Token to the Client</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-provisioning-of-access-toke" class="internal xref">Provisioning of Access Tokens to the RS</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="auto internal xref">4.1.3</a>.  <a href="#name-design-rationale" class="internal xref">Design Rationale</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-hash-input-on-the-client-an" class="internal xref">Hash Input on the Client and the AS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-as-to-client-response-encod" class="internal xref">AS-to-Client Response Encoded in CBOR</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-as-to-client-response-encode" class="internal xref">AS-to-Client Response Encoded in JSON</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-hash_input-on-the-rs" class="internal xref">HASH_INPUT on the RS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-access-tokens-as-cwts" class="internal xref">Access Tokens as CWTs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-access-tokens-as-jwts" class="internal xref">Access Tokens as JWTs</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-computing-the-token-hash" class="internal xref">Computing the Token Hash</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-token-revocation-list-trl" class="internal xref">Token Revocation List (TRL)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-update-of-the-trl" class="internal xref">Update of the TRL</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-the-trl-endpoint" class="internal xref">The TRL Endpoint</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-error-responses-with-proble" class="internal xref">Error Responses with Problem Details</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-supporting-diff-queries" class="internal xref">Supporting Diff Queries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-supporting-the-cursor-exten" class="internal xref">Supporting the "Cursor" Extension</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-query-parameters" class="internal xref">Query Parameters</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-full-query-of-the-trl" class="internal xref">Full Query of the TRL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-diff-query-of-the-trl" class="internal xref">Diff Query of the TRL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-response-messages-when-usin" class="internal xref">Response Messages when Using the "Cursor" Extension</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-response-to-full-query" class="internal xref">Response to Full Query</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-response-to-diff-query" class="internal xref">Response to Diff Query</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.1">
                    <p id="section-toc.1-1.9.2.2.2.1.1"><a href="#section-9.2.1" class="auto internal xref">9.2.1</a>.  <a href="#name-empty-update-collection" class="internal xref">Empty Update Collection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.2">
                    <p id="section-toc.1-1.9.2.2.2.2.1"><a href="#section-9.2.2" class="auto internal xref">9.2.2</a>.  <a href="#name-cursor-not-included-in-the-" class="internal xref">Cursor Not Included in the Diff Query Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2.2.3">
                    <p id="section-toc.1-1.9.2.2.2.3.1"><a href="#section-9.2.3" class="auto internal xref">9.2.3</a>.  <a href="#name-cursor-included-in-the-diff" class="internal xref">Cursor Included in the Diff Query Request</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-registration-at-the-authori" class="internal xref">Registration at the Authorization Server</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-notification-of-revoked-acc" class="internal xref">Notification of Revoked Access Tokens</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-handling-of-revoked-access-" class="internal xref">Handling of Revoked Access Tokens and Token Hashes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-ace-token-revocation-list-p" class="internal xref">ACE Token Revocation List Parameters</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-ace-token-revocation-list-e" class="internal xref">ACE Token Revocation List Error Identifiers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="auto internal xref">14.1</a>.  <a href="#name-content-retrieval-from-the-" class="internal xref">Content Retrieval from the TRL</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="auto internal xref">14.2</a>.  <a href="#name-size-of-the-trl" class="internal xref">Size of the TRL</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#section-14.3" class="auto internal xref">14.3</a>.  <a href="#name-communication-patterns" class="internal xref">Communication Patterns</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#section-14.4" class="auto internal xref">14.4</a>.  <a href="#name-request-of-new-access-token" class="internal xref">Request of New Access Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a href="#section-14.5" class="auto internal xref">14.5</a>.  <a href="#name-vulnerable-time-window-at-t" class="internal xref">Vulnerable Time Window at the RS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.6">
                <p id="section-toc.1-1.14.2.6.1"><a href="#section-14.6" class="auto internal xref">14.6</a>.  <a href="#name-preventing-unnoticed-manipu" class="internal xref">Preventing Unnoticed Manipulation of Access Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.7">
                <p id="section-toc.1-1.14.2.7.1"><a href="#section-14.7" class="auto internal xref">14.7</a>.  <a href="#name-two-token-hashes-at-the-rs-" class="internal xref">Two Token Hashes at the RS Using JWTs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.8">
                <p id="section-toc.1-1.14.2.8.1"><a href="#section-14.8" class="auto internal xref">14.8</a>.  <a href="#name-additional-security-measure" class="internal xref">Additional Security Measures</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="auto internal xref">15.1</a>.  <a href="#name-media-type-registrations" class="internal xref">Media Type Registrations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="auto internal xref">15.2</a>.  <a href="#name-coap-content-formats-regist" class="internal xref">CoAP Content-Formats Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.3">
                <p id="section-toc.1-1.15.2.3.1"><a href="#section-15.3" class="auto internal xref">15.3</a>.  <a href="#name-custom-problem-detail-keys-" class="internal xref">Custom Problem Detail Keys Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.4">
                <p id="section-toc.1-1.15.2.4.1"><a href="#section-15.4" class="auto internal xref">15.4</a>.  <a href="#name-ace-token-revocation-list-pa" class="internal xref">ACE Token Revocation List Parameters Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.5">
                <p id="section-toc.1-1.15.2.5.1"><a href="#section-15.5" class="auto internal xref">15.5</a>.  <a href="#name-ace-token-revocation-list-err" class="internal xref">ACE Token Revocation List Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.6">
                <p id="section-toc.1-1.15.2.6.1"><a href="#section-15.6" class="auto internal xref">15.6</a>.  <a href="#name-expert-review-instructions" class="internal xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="auto internal xref">16</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="auto internal xref">16.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-16.2" class="auto internal xref">16.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-on-using-the-series-transfe" class="internal xref">On Using the Series Transfer Pattern</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-local-supportive-parameters" class="internal xref">Local Supportive Parameters of the TRL Endpoint</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-interaction-examples" class="internal xref">Interaction Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.1">
                <p id="section-toc.1-1.19.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-full-query-with-observe" class="internal xref">Full Query with Observe</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.2">
                <p id="section-toc.1-1.19.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-diff-query-with-observe" class="internal xref">Diff Query with Observe</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.3">
                <p id="section-toc.1-1.19.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-full-query-with-observe-and" class="internal xref">Full Query with Observe and Diff Query</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.4">
                <p id="section-toc.1-1.19.2.4.1"><a href="#appendix-C.4" class="auto internal xref">C.4</a>.  <a href="#name-diff-query-with-observe-and" class="internal xref">Diff Query with Observe and "Cursor" Extension</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.5">
                <p id="section-toc.1-1.19.2.5.1"><a href="#appendix-C.5" class="auto internal xref">C.5</a>.  <a href="#name-full-query-with-observe-and-" class="internal xref">Full Query with Observe and Diff Query with "Cursor" Extension</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Authentication and Authorization for Constrained Environments (ACE) <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> is a framework that enforces access control on Internet of Things (IoT) devices acting as resource servers (RSs). In order to use ACE, both clients and RSs have to register with an authorization server (AS) and become registered devices. Once registered, a client can send a request to the AS to obtain an access token for an RS. For a client to access the RS, the client must present the issued access token at the RS, which then validates it before storing it (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Even though access tokens have expiration times, there are circumstances by which an access token may need to be revoked before its expiration time, such as when:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-3">
 <li id="section-1-3.1">a registered device has been compromised or is suspected of being compromised;<a href="#section-1-3.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.2">a registered device is decommissioned;<a href="#section-1-3.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.3">there has been a change in the ACE profile for a registered device;<a href="#section-1-3.3" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.4">there has been a change in access policies for a registered device; or<a href="#section-1-3.4" class="pilcrow">¶</a>
</li>
        <li id="section-1-3.5">there has been a change in the outcome of policy evaluation for a registered device (e.g., if policy assessment depends on dynamic conditions in the execution environment, the user context, or the resource utilization).<a href="#section-1-3.5" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-4">As discussed in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, only client-initiated revocation is currently specified <span>[<a href="#RFC7009" class="cite xref">RFC7009</a>]</span> for OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, based on the assumption that access tokens in OAuth are issued with a relatively short lifetime. However, this is not expected to be the case for constrained, intermittently connected devices that need access tokens with relatively long lifetimes.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document specifies a method for allowing registered devices to access and possibly subscribe to a Token Revocation List (TRL) on the AS in order to obtain updated information about pertaining access tokens that were revoked prior to their expiration. As specified in this document, the registered devices use the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> to communicate with the AS and with one another and can subscribe to the TRL on the AS by using resource observation for CoAP <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. Underlying protocols other than CoAP are not prohibited from being supported in the future, if they are defined to be used in the ACE framework.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Unlike in the case of token introspection (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), a registered device does not provide an owned access token to the AS for inquiring about its current state. Instead, registered devices simply obtain updated information about pertaining access tokens that were revoked prior to their expiration as efficiently identified by corresponding hash values.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">The benefits of this method are that it complements token introspection and does not require the registered devices to support any additional endpoints (see <a href="#terminology" class="auto internal xref">Section 1.1</a>). The only additional requirements for registered devices are a request/response interaction with the AS to access and possibly subscribe to the TRL (see <a href="#sec-overview" class="auto internal xref">Section 2</a>) and the lightweight computation of hash values to use as access token identifiers (see <a href="#sec-token-name" class="auto internal xref">Section 4</a>).<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">The process by which access tokens are declared revoked is out of the scope of this document.  The method by which the AS determines or is notified of revoked access
tokens, according to which the AS consequently updates the TRL as
specified in this document, is also out of scope.<a href="#section-1-8" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts described in the ACE framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, as well as with terms and concepts related to CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> and JSON Web Tokens (JWTs) <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">The terminology for entities in the considered architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. In particular, this includes client, RS, and authorization server (AS).<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">Readers are also expected to be familiar with the terms and concepts related to the Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>, Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, JSON <span>[<a href="#RFC8259" class="cite xref">RFC8259</a>]</span>, CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>, CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, and the use of hash functions to name objects as defined in <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Note that the term "endpoint" is used here following its OAuth definition <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, aimed at denoting resources such as /token and /introspect at the AS, and /authz-info at the RS.  The CoAP definition, which is "[a]n entity participating in the CoAP protocol" <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, is not used in this document.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">This specification also uses the following terminology:<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-7">
          <dt id="section-1.1-7.1">Token hash:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.2">identifier of an access token, in binary
            format encoding. The token hash has no relation to other access
            token identifiers possibly used, such as the 'cti' (CWT ID) claim
            of CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>.<a href="#section-1.1-7.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.3">Token Revocation List (TRL):</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.4">a collection of token
            hashes such that the corresponding access tokens have been revoked
            but are not expired yet.<a href="#section-1.1-7.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.5">TRL endpoint:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.6">an endpoint at the AS with a TRL as its
            representation. The default name of the TRL endpoint in a url-path
            is '/revoke/trl'. Implementations are not required to use this
            name and can define their own instead.<a href="#section-1.1-7.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.7">Registered device:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.8">a device registered at the AS,
            i.e., as a client, an RS, or both. A registered device acts as
            a requester towards the TRL endpoint.<a href="#section-1.1-7.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.9">Administrator:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.10">
            <p id="section-1.1-7.10.1">an entity that is authorized to get full access
            to the TRL at the AS and that acts as a requester towards the TRL
            endpoint. An administrator is not necessarily a registered device
            as defined above, i.e., a client requesting access tokens or an RS
            consuming access tokens.<a href="#section-1.1-7.10.1" class="pilcrow">¶</a></p>
<p id="section-1.1-7.10.2">An administrator might also be authorized to perform further
            administrative operations at the AS, e.g., through a dedicated
            admin interface that is out of the scope of this document. By
            considering the token hashes retrieved from the TRL together with
            other information obtained from the AS, the administrator becomes
            able to derive additional information, e.g., the fact that
            accesses have been revoked for specific registered devices.<a href="#section-1.1-7.10.2" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.11">Pertaining access token:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.12">
            <ul class="normal">
<li class="normal" id="section-1.1-7.12.1.1">
                <p id="section-1.1-7.12.1.1.1">With reference to an administrator, an access token
                issued by the AS.<a href="#section-1.1-7.12.1.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-1.1-7.12.1.2">
                <p id="section-1.1-7.12.1.2.1">With reference to a registered device, an access token
 intended to be owned by that device. An access token pertains
 to a client if the AS has issued the access token for that
 client following its request. An access token pertains to an
 RS if the AS has issued the access token to be consumed by
 that RS.<a href="#section-1.1-7.12.1.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.13">Token hash pertaining to a requester:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.14">a token hash
            corresponding to an access token pertaining to that requester,
            i.e., an administrator or a registered device.<a href="#section-1.1-7.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.15">TRL update pertaining to a requester:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.16">an update to the
            TRL through which token hashes pertaining to that requester have
            been added to or removed from the TRL.<a href="#section-1.1-7.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.17">Full query:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.18">a type of query to the TRL where the AS
            returns the token hashes of the revoked access tokens currently in
            the TRL and pertaining to the requester. Further details are
            specified in Sections <a href="#sec-trl-endpoint" class="auto internal xref">6</a> and <a href="#ssec-trl-full-query" class="auto internal xref">7</a>.<a href="#section-1.1-7.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-7.19">Diff query:</dt>
          <dd style="margin-left: 1.5em" id="section-1.1-7.20">a type of query to the TRL where the AS
            returns a list of diff entries, each related to one update
            that occurred to the TRL and containing a set of token hashes
            pertaining to the requester. Further details are specified in
            Sections <a href="#sec-trl-endpoint" class="auto internal xref">6</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">8</a>.<a href="#section-1.1-7.20" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.1-8">See <a href="#sec-token-name" class="auto internal xref">Section 4</a> for further terminology used throughout that section.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9">Examples throughout this document are expressed in CBOR diagnostic notation as defined in <span><a href="https://rfc-editor.org/rfc/rfc8949#section-8" class="relref">Section 8</a> of [<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc8610#appendix-G" class="relref">Appendix G</a> of [<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>. Diagnostic notation comments are often used to provide a textual representation of the numeric parameter names and values.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">This protocol defines how a CoAP-based AS informs clients and RSs, i.e., registered devices, about pertaining revoked access tokens. How the relationship between a registered device and the AS is established is out of the scope of this specification.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">At a high level, the steps of this protocol are as follows:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-3">
        <li id="section-2-3.1">
          <p id="section-2-3.1.1">Upon startup, the AS creates a single TRL accessible through the TRL endpoint. At any point in time, the TRL represents the list of all revoked access tokens issued by the AS that are not expired yet.<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-3.2">
          <p id="section-2-3.2.1">When a device registers at the AS, it also receives the url-path to the TRL endpoint.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
<p id="section-2-3.2.2">
At any time after the registration procedure is finished, the registered device can send a GET request to the TRL endpoint at the AS. When doing so, it can request the following: the current list of pertaining revoked access tokens (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>) or the most recent updates that occurred over the list of pertaining revoked access tokens (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>).<a href="#section-2-3.2.2" class="pilcrow">¶</a></p>
<p id="section-2-3.2.3">

  
In particular, the registered device can rely on Observation for CoAP <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. In such a case, the GET request sent to the TRL endpoint includes the CoAP Observe Option set to 0 (register), i.e., it is an Observation Request. By doing so, the registered device effectively subscribes to the TRL,
as the device is interested in receiving notifications about the TRL's
update. Upon receiving the Observation Request, the AS adds the registered device to the list of observers of the TRL endpoint.<a href="#section-2-3.2.3" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-3.3">
          <p id="section-2-3.3.1">When an access token is revoked, the AS adds the corresponding token hash to the TRL. Also, when a revoked access token eventually expires, the AS removes the corresponding token hash from the TRL.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
<p id="section-2-3.3.2">
     
In either case, after updating the TRL, the AS sends Observe notifications as per <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.  That is, an Observe notification is sent to each registered device that is subscribed to the TRL and to which the access token pertains.<a href="#section-2-3.3.2" class="pilcrow">¶</a></p>
<p id="section-2-3.3.3">
Depending on the specific subscription established through the
Observation Request, the notification provides either the current
updated list of revoked access tokens in the subset of the TRL
pertaining to that device (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>) or the most recent TRL
updates that occurred over that list of pertaining revoked access
tokens (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>).<a href="#section-2-3.3.3" class="pilcrow">¶</a></p>
<p id="section-2-3.3.4">
Further Observe notifications may be sent, consistent with ongoing additional observations of the TRL endpoint.<a href="#section-2-3.3.4" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-3.4">
          <p id="section-2-3.4.1">An administrator can access and subscribe to the TRL like a registered device while getting the content of the whole TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>) or the most recent updates that occurred to the whole TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>).<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-2-4"><a href="#fig-protocol-overview" class="auto internal xref">Figure 1</a> shows a high-level overview of the service provided by this protocol. For the sake of simplicity, the example shown in the figure considers the simultaneous revocation of the three access tokens t1, t2, and t3 whose corresponding token hashes are th1, th2, and th3, respectively. Consequently, the AS adds the three token hashes to the TRL at once and sends Observe notifications to one administrator and four registered devices. Each dotted line associated with a pair of registered devices indicates the access token that they both own.<a href="#section-2-4" class="pilcrow">¶</a></p>
<span id="name-protocol-overview-2"></span><div id="fig-protocol-overview">
<figure id="figure-1">
        <div id="section-2-5.1">
          <div class="alignCenter art-svg artwork" id="section-2-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="320" width="560" viewBox="0 0 560 320" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,176 L 8,224" fill="none" stroke="black"></path>
              <path d="M 16,112 L 16,168" fill="none" stroke="black"></path>
              <path d="M 136,176 L 136,224" fill="none" stroke="black"></path>
              <path d="M 152,176 L 152,224" fill="none" stroke="black"></path>
              <path d="M 160,112 L 160,168" fill="none" stroke="black"></path>
              <path d="M 168,32 L 168,64" fill="none" stroke="black"></path>
              <path d="M 240,176 L 240,224" fill="none" stroke="black"></path>
              <path d="M 256,176 L 256,224" fill="none" stroke="black"></path>
              <path d="M 264,64 L 264,168" fill="none" stroke="black"></path>
              <path d="M 344,176 L 344,224" fill="none" stroke="black"></path>
              <path d="M 352,32 L 352,64" fill="none" stroke="black"></path>
              <path d="M 360,176 L 360,224" fill="none" stroke="black"></path>
              <path d="M 368,112 L 368,168" fill="none" stroke="black"></path>
              <path d="M 448,176 L 448,224" fill="none" stroke="black"></path>
              <path d="M 464,176 L 464,224" fill="none" stroke="black"></path>
              <path d="M 472,112 L 472,168" fill="none" stroke="black"></path>
              <path d="M 552,176 L 552,224" fill="none" stroke="black"></path>
              <path d="M 168,32 L 352,32" fill="none" stroke="black"></path>
              <path d="M 168,64 L 256,64" fill="none" stroke="black"></path>
              <path d="M 272,64 L 352,64" fill="none" stroke="black"></path>
              <path d="M 16,112 L 472,112" fill="none" stroke="black"></path>
              <path d="M 8,176 L 136,176" fill="none" stroke="black"></path>
              <path d="M 152,176 L 240,176" fill="none" stroke="black"></path>
              <path d="M 256,176 L 344,176" fill="none" stroke="black"></path>
              <path d="M 360,176 L 448,176" fill="none" stroke="black"></path>
              <path d="M 464,176 L 552,176" fill="none" stroke="black"></path>
              <path d="M 8,224 L 136,224" fill="none" stroke="black"></path>
              <path d="M 152,224 L 240,224" fill="none" stroke="black"></path>
              <path d="M 256,224 L 344,224" fill="none" stroke="black"></path>
              <path d="M 360,224 L 448,224" fill="none" stroke="black"></path>
              <path d="M 464,224 L 552,224" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="480,168 468,162.4 468,173.6" fill="black" transform="rotate(90,472,168)"></polygon>
              <polygon class="arrowhead" points="376,168 364,162.4 364,173.6" fill="black" transform="rotate(90,368,168)"></polygon>
              <polygon class="arrowhead" points="272,168 260,162.4 260,173.6" fill="black" transform="rotate(90,264,168)"></polygon>
              <polygon class="arrowhead" points="168,168 156,162.4 156,173.6" fill="black" transform="rotate(90,160,168)"></polygon>
              <polygon class="arrowhead" points="24,168 12,162.4 12,173.6" fill="black" transform="rotate(90,16,168)"></polygon>
              <circle cx="264" cy="64" r="6" class="opendot" fill="white" stroke="black"></circle>
              <g class="text">
                <text x="232" y="52">Authorization</text>
                <text x="316" y="52">server</text>
                <text x="192" y="84">/revoke/trl</text>
                <text x="308" y="84">TRL:</text>
                <text x="384" y="84">(th1,th2,th3)</text>
                <text x="72" y="148">th1,th2,th3</text>
                <text x="200" y="148">th1,th2</text>
                <text x="288" y="148">th1</text>
                <text x="392" y="148">th3</text>
                <text x="512" y="148">th2,th3</text>
                <text x="72" y="196">Administrator</text>
                <text x="188" y="196">Client</text>
                <text x="224" y="196">1</text>
                <text x="300" y="196">Resource</text>
                <text x="396" y="196">Client</text>
                <text x="432" y="196">2</text>
                <text x="508" y="196">Resource</text>
                <text x="292" y="212">server</text>
                <text x="328" y="212">1</text>
                <text x="500" y="212">server</text>
                <text x="536" y="212">2</text>
                <text x="176" y="244">:</text>
                <text x="216" y="244">:</text>
                <text x="288" y="244">:</text>
                <text x="384" y="244">:</text>
                <text x="488" y="244">:</text>
                <text x="528" y="244">:</text>
                <text x="176" y="260">:</text>
                <text x="216" y="260">:</text>
                <text x="252" y="260">t1</text>
                <text x="288" y="260">:</text>
                <text x="384" y="260">:</text>
                <text x="436" y="260">t3</text>
                <text x="488" y="260">:</text>
                <text x="528" y="260">:</text>
                <text x="176" y="276">:</text>
                <text x="252" y="276">:........:</text>
                <text x="436" y="276">:............:</text>
                <text x="528" y="276">:</text>
                <text x="176" y="292">:</text>
                <text x="340" y="292">t2</text>
                <text x="528" y="292">:</text>
                <text x="352" y="308">:...........................................:</text>
              </g>
            </svg><a href="#section-2-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-protocol-overview-2" class="selfRef">Protocol Overview</a>
        </figcaption></figure>
</div>
<p id="section-2-6"><a href="#sec-RS-examples" class="auto internal xref">Appendix C</a> provides examples of the protocol flow and message exchanges between the AS and a registered device.<a href="#section-2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-issuing-access-tokens-as">
<section id="section-3">
      <h2 id="name-issuing-of-access-tokens-at">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-issuing-of-access-tokens-at" class="section-name selfRef">Issuing of Access Tokens at the AS</a>
      </h2>
<p id="section-3-1">An AS that supports the method defined in this document <span class="bcp14">MUST</span> adhere to the following rules when issuing an access token:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">
          <p id="section-3-2.1.1">All the intended header parameters in the access token <span class="bcp14">MUST</span> be specified within integrity-protected fields.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.2">
          <p id="section-3-2.2.1">If the access token is a CWT, the following applies:<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.2.2.1">
              <p id="section-3-2.2.2.1.1">Any "unprotected" field <span class="bcp14">MUST</span> be empty, i.e., its value <span class="bcp14">MUST</span> be encoded as the empty CBOR map (0xa0). This applies to the top-level "unprotected" field of the COSE object used for the CWT, the "unprotected" field of each element of the "signatures" array, and the "unprotected" field of each element of any "recipients" array (see Sections <a href="https://rfc-editor.org/rfc/rfc9052#section-2" class="relref">2</a>, <a href="https://rfc-editor.org/rfc/rfc9052#section-3" class="relref">3</a>, <a href="https://rfc-editor.org/rfc/rfc9052#section-4" class="relref">4</a>, <a href="https://rfc-editor.org/rfc/rfc9052#section-5" class="relref">5</a>, and <a href="https://rfc-editor.org/rfc/rfc9052#section-6" class="relref">6</a> of <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>).<a href="#section-3-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3-2.2.2.2">
              <p id="section-3-2.2.2.2.1">Consistent with the specific COSE object used for the CWT, the corresponding tagged structure in the set COSE_Tagged_Message <span class="bcp14">MUST</span> be used (see <span><a href="https://rfc-editor.org/rfc/rfc9052#section-2" class="relref">Section 2</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>). That is, the CBOR array that encodes the CWT <span class="bcp14">MUST</span> be tagged by using the COSE CBOR tag corresponding to the used COSE object. Table 1 in <span><a href="https://rfc-editor.org/rfc/rfc9052#section-2" class="relref">Section 2</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span> specifies the tag numbers in question.<a href="#section-3-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.2.2">
In turn, the resulting tagged data item <span class="bcp14">MUST</span> be tagged by using the CWT CBOR tag with tag number 61 (see <span><a href="https://rfc-editor.org/rfc/rfc8392#section-6" class="relref">Section 6</a> of [<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>). After that, the resulting data item <span class="bcp14">MUST NOT</span> be further tagged.<a href="#section-3-2.2.2.2.2" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.2.3">
Encoding of the tag numbers <span class="bcp14">MUST</span> be done using definite lengths, and the length of the encoded tag numbers <span class="bcp14">MUST</span> be the minimum possible length. This means that tag number 16 is encoded as 0xd0 and not as 0xd810.<a href="#section-3-2.2.2.2.3" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.2.4">
The example in <a href="#fig-cwt-cose-encrypt0" class="auto internal xref">Figure 2</a> shows a CWT that uses the COSE object COSE_Encrypt0 (see <span><a href="https://rfc-editor.org/rfc/rfc9052#section-5.2" class="relref">Section 5.2</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>).<a href="#section-3-2.2.2.2.4" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-3-2.3">
          <p id="section-3-2.3.1">If, like for JWTs <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span>, the access token relies on a JSON object for encoding its claims, the following applies:<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3-2.3.2">
Consistent with the ACE framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, this document specifically considers JWTs, which are always represented using the  JSON Web Signature (JWS) Compact Serialization from <span>[<a href="#RFC7515" class="cite xref">RFC7515</a>]</span> or the JSON Web Encryption (JWE) Compact Serialization from <span>[<a href="#RFC7516" class="cite xref">RFC7516</a>]</span>. Consequently, all the header parameters are specified within integrity-protected fields.<a href="#section-3-2.3.2" class="pilcrow">¶</a></p>
<p id="section-3-2.3.3">
In case alternative access tokens were used, the following applies:<a href="#section-3-2.3.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.3.4.1">
              <p id="section-3-2.3.4.1.1">If the access token uses the JWS JSON Serialization from <span>[<a href="#RFC7515" class="cite xref">RFC7515</a>]</span>, it <span class="bcp14">MUST NOT</span> include the JWS Unprotected Header.<a href="#section-3-2.3.4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3-2.3.4.2">
              <p id="section-3-2.3.4.2.1">If the access token uses the JWE JSON Serialization from <span>[<a href="#RFC7516" class="cite xref">RFC7516</a>]</span>, it <span class="bcp14">MUST NOT</span> include the JWE Shared Unprotected Header and it <span class="bcp14">MUST NOT</span> include the "header" member in any of the elements of the "recipients" array.<a href="#section-3-2.3.4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ul>
<span id="name-example-of-cwt-using-cose_e"></span><div id="fig-cwt-cose-encrypt0">
<figure id="figure-2">
        <div class="lang-cbor-diag sourcecode" id="section-3-3.1">
<pre>
/ CWT CBOR tag / 61(
  / COSE_Encrypt0 CBOR tag / 16(
    / COSE_Encrypt0 object / [
      / protected /   h'a3010a044c53796d6d65747269633132
                        38054d99a0d7846e762c49ffe8a63e0b',
      / unprotected / {},
      / ciphertext /  h'b918a11fd81e438b7f973d9e2e119bcb
                        22424ba0f38a80f27562f400ee1d0d6c
                        0fdb559c02421fd384fc2ebe22d70713
                        78b0ea7428fff157444d45f7e6afcda1
                        aae5f6495830c58627087fc5b4974f31
                        9a8707a635dd643b'
    ]
  )
)
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-of-cwt-using-cose_e" class="selfRef">Example of CWT Using COSE_Encrypt0</a>
        </figcaption></figure>
</div>
<p id="section-3-4"><a href="#sec-seccons-token-manipulation" class="auto internal xref">Section 14.6</a> discusses how adhering to the rules above neutralizes an attack against the RS where an active adversary can induce the RS to compute a token hash different from the correct one.<a href="#section-3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-token-name">
<section id="section-4">
      <h2 id="name-token-hash">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-hash" class="section-name selfRef">Token Hash</a>
      </h2>
<p id="section-4-1">This section specifies how token hashes are computed.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">First, <a href="#sec-token-hash-input-motivation" class="auto internal xref">Section 4.1</a> provides the motivation for the used construction.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Building on that, the value used as input to compute a token hash is defined in <a href="#sec-token-hash-input-c-as" class="auto internal xref">Section 4.2</a> for the client and the AS and in <a href="#sec-token-hash-input-rs" class="auto internal xref">Section 4.3</a> for the RS. Finally, <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a> defines how such an input is used for computing the token hash.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The process outlined below refers to the base64url encoding and decoding without padding (see <span><a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">Section 5</a> of [<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>) and denotes as "binary representation" of a text string the corresponding UTF-8 encoding <span>[<a href="#RFC3629" class="cite xref">RFC3629</a>]</span>, which is the implied charset used in JSON (see <span><a href="https://rfc-editor.org/rfc/rfc8259#section-8.1" class="relref">Section 8.1</a> of [<a href="#RFC8259" class="cite xref">RFC8259</a>]</span>).<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Consistent with <span><a href="https://rfc-editor.org/rfc/rfc8949#section-3.4" class="relref">Section 3.4</a> of [<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, the term "tag" is used for the entire CBOR data item consisting of both a tag number and the tag content: the tag content is the CBOR data item that is being tagged.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">Also, "tagged access token" is used to denote nested CBOR tags (possibly a single one), with the innermost tag content being a CWT.<a href="#section-4-6" class="pilcrow">¶</a></p>
<div id="sec-token-hash-input-motivation">
<section id="section-4.1">
        <h3 id="name-motivation-for-the-used-con">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-motivation-for-the-used-con" class="section-name selfRef">Motivation for the Used Construction</a>
        </h3>
<p id="section-4.1-1">An access token can have one among different formats. The most expected formats are CWT <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> and JWT <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span>, with the former being the default format to use in the ACE framework (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-3" class="relref">Section 3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). While access tokens are opaque to clients, an RS is aware of whether access tokens that are issued for it to consume are either CWTs or JWTs.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div id="issuing-of-the-access-token-to-the-client">
<section id="section-4.1.1">
          <h4 id="name-issuing-of-the-access-token">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-issuing-of-the-access-token" class="section-name selfRef">Issuing of the Access Token to the Client</a>
          </h4>
<p id="section-4.1.1-1">There are two possible encodings that the AS can use for the AS-to-Client response (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) where the issued access token is included and provided to the requester client. The RS may not be aware of which encoding is used for that response to that particular requester client.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1">
              <p id="section-4.1.1-2.1.1">One method of encoding relies on CBOR, which is required if CoAP is used (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) and is recommended otherwise (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-3" class="relref">Section 3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). That is, the AS-to-Client response has media-type "application/ace+cbor".<a href="#section-4.1.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2.1.2">
This implies that, within the CBOR map specified as message payload, the 'access_token' parameter is a CBOR data item of type CBOR byte string and with a value of BYTES. In particular:<a href="#section-4.1.1-2.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1.3.1">
                  <p id="section-4.1.1-2.1.3.1.1">If the access token is a CWT, then BYTES is the binary representation of the CWT (i.e., of the CBOR array that encodes the untagged CWT) or of a tagged access token with the CWT as the innermost tag content.<a href="#section-4.1.1-2.1.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.1.1-2.1.3.2">
                  <p id="section-4.1.1-2.1.3.2.1">If the access token is a JWT, then BYTES is the binary representation of the JWT (i.e., of the text string that encodes the JWT).<a href="#section-4.1.1-2.1.3.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.1.1-2.2">
              <p id="section-4.1.1-2.2.1">An alternative method of encoding relies on JSON. That is, the AS-to-Client response has media-type "application/ace+json".<a href="#section-4.1.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2.2.2">
This implies that, within the JSON object specified as message payload, the 'access_token' parameter has as a value a text string TEXT. In particular:<a href="#section-4.1.1-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.2.3.1">
                  <p id="section-4.1.1-2.2.3.1.1">If the access token is a JWT, then TEXT is the text string that encodes the JWT.<a href="#section-4.1.1-2.2.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.1.1-2.2.3.2">
                  <p id="section-4.1.1-2.2.3.2.1">If the access token is a CWT, then TEXT is the base64url-encoded text string of BYTES, which is the binary representation of the CWT (i.e., of the CBOR array that encodes the untagged CWT) or of a tagged access token with the CWT as the innermost tag content.<a href="#section-4.1.1-2.2.3.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="sec-token-hash-input-motivation-rs">
<section id="section-4.1.2">
          <h4 id="name-provisioning-of-access-toke">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-provisioning-of-access-toke" class="section-name selfRef">Provisioning of Access Tokens to the RS</a>
          </h4>
<p id="section-4.1.2-1">In accordance with the used transport profile of ACE (e.g., <span>[<a href="#RFC9202" class="cite xref">RFC9202</a>]</span>, <span>[<a href="#RFC9203" class="cite xref">RFC9203</a>]</span>, <span>[<a href="#RFC9431" class="cite xref">RFC9431</a>]</span>), the RS receives a piece of token-related information hereafter denoted as TOKEN_INFO.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">In particular:<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2-3.1">
              <p id="section-4.1.2-3.1.1">If the AS-to-Client response was encoded in CBOR, then TOKEN_INFO is the value of the CBOR byte string conveyed by the 'access_token' parameter of that response. That is, TOKEN_INFO is the binary representation of the access token.<a href="#section-4.1.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-3.2">
              <p id="section-4.1.2-3.2.1">If the AS-to-Client response was encoded in JSON and the access token is a JWT, then TOKEN_INFO is the binary representation of the text string conveyed by the 'access_token' parameter of that response. That is, TOKEN_INFO is the binary representation of the access token.<a href="#section-4.1.2-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-3.3">
              <p id="section-4.1.2-3.3.1">If the AS-to-Client response was encoded in JSON and the access token is a CWT, then TOKEN_INFO is the binary representation of the base64url-encoded text string that encodes the binary representation of the  access token. That is, TOKEN_INFO is the binary representation of the base64url-encoded text string conveyed by the 'access_token' parameter.<a href="#section-4.1.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.2-4">The following overviews how the above specifically applies to the existing transport profiles of ACE:<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2-5.1">
              <p id="section-4.1.2-5.1.1">The access token can be uploaded to the RS by means of a POST request to the /authz-info endpoint (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), using a CoAP Content-Format or HTTP media-type that reflects the format of the access token, if available (e.g., "application/cwt" for CWTs), or "application/octet-stream" otherwise. When doing so (e.g., like in <span>[<a href="#RFC9202" class="cite xref">RFC9202</a>]</span>), TOKEN_INFO is the payload of the POST request.<a href="#section-4.1.2-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-5.2">
              <p id="section-4.1.2-5.2.1">The access token can be uploaded to the RS by means of a POST request to the /authz-info endpoint, using the media-type "application/ace+cbor". When doing so (e.g., like in <span>[<a href="#RFC9203" class="cite xref">RFC9203</a>]</span>), TOKEN_INFO is the value of the CBOR byte string conveyed by the 'access_token' parameter, within the CBOR map specified as payload of the POST request.<a href="#section-4.1.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-5.3">
              <p id="section-4.1.2-5.3.1">The access token can be uploaded to the RS during a DTLS session establishment, e.g., like it is defined in <span><a href="https://rfc-editor.org/rfc/rfc9202#section-3.3.2" class="relref">Section 3.3.2</a> of [<a href="#RFC9202" class="cite xref">RFC9202</a>]</span>. When doing so, TOKEN_INFO is the value of the 'psk_identity' field of the ClientKeyExchange message (when using DTLS 1.2 <span>[<a href="#RFC6347" class="cite xref">RFC6347</a>]</span>) or of the 'identity' field of a PSKIdentity, within the PreSharedKeyExtension of a ClientHello message (when using DTLS 1.3 <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span>).<a href="#section-4.1.2-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-5.4">
              <p id="section-4.1.2-5.4.1">The access token can be uploaded to the RS within the MQTT CONNECT packet, e.g., like it is defined in <span><a href="https://rfc-editor.org/rfc/rfc9431#section-2.2.4.1" class="relref">Section 2.2.4.1</a> of [<a href="#RFC9431" class="cite xref">RFC9431</a>]</span>. When doing so, TOKEN_INFO is specified within the 'Authentication Data' field of the MQTT CONNECT packet, following the property identifier 22 (0x16) and the token length.<a href="#section-4.1.2-5.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.2-6"> Note that, if the access token is a CWT, it is specifically tagged as defined in <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>.<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="design-rationale">
<section id="section-4.1.3">
          <h4 id="name-design-rationale">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-design-rationale" class="section-name selfRef">Design Rationale</a>
          </h4>
<p id="section-4.1.3-1">Considering the possible variants discussed above, it must always be ensured that the same HASH_INPUT value is used as input for generating the token hash of a given access token, by the AS that has issued the access token and by the registered devices to which the access token pertains (both client and RS).<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">This is achieved by building HASH_INPUT according to the content of the 'access_token' parameter in the AS-to-Client responses because that is what the AS, the client, and the RS are all able to see.<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-token-hash-input-c-as">
<section id="section-4.2">
        <h3 id="name-hash-input-on-the-client-an">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-hash-input-on-the-client-an" class="section-name selfRef">Hash Input on the Client and the AS</a>
        </h3>
<p id="section-4.2-1">The client and the AS consider the content of the 'access_token' parameter in the AS-to-Client response, in which the access token is included and provided to the requester client.  Note that, if the access token is a CWT, it is specifically tagged as defined in <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The following defines how the client and the AS determine the HASH_INPUT value to use as input for computing the token hash of the conveyed access token, depending on the AS-to-Client response being encoded in CBOR (see <a href="#sec-token-hash-input-c-as-cbor" class="auto internal xref">Section 4.2.1</a>) or in JSON (see <a href="#sec-token-hash-input-c-as-json" class="auto internal xref">Section 4.2.2</a>).<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Once HASH_INPUT is determined, the client and the AS use it to compute the token hash of the conveyed access token as defined in <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a>.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div id="sec-token-hash-input-c-as-cbor">
<section id="section-4.2.1">
          <h4 id="name-as-to-client-response-encod">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-as-to-client-response-encod" class="section-name selfRef">AS-to-Client Response Encoded in CBOR</a>
          </h4>
<p id="section-4.2.1-1">If the AS-to-Client response is encoded in CBOR, then HASH_INPUT is defined as follows:<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.1">
              <p id="section-4.2.1-2.1.1">BYTES denotes the value of the CBOR byte string conveyed in the 'access_token' parameter.<a href="#section-4.2.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2.1.2">
With reference to the example in <a href="#fig-as-response-cbor" class="auto internal xref">Figure 3</a>, BYTES is the bytes {0xd8, 0x3d, 0xd0, ..., 0x64, 0x3b}.<a href="#section-4.2.1-2.1.2" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2.1.3">
Note that BYTES is the binary representation of the tagged access token if this is a CWT (as per <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>) or of the access token if this is a JWT.<a href="#section-4.2.1-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.2">
              <p id="section-4.2.1-2.2.1">HASH_INPUT_TEXT is the base64url-encoded text string that encodes BYTES.<a href="#section-4.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.3">
              <p id="section-4.2.1-2.3.1">HASH_INPUT is the binary representation of HASH_INPUT_TEXT.<a href="#section-4.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<span id="name-example-of-as-to-client-coa"></span><div id="fig-as-response-cbor">
<figure id="figure-3">
            <div class="lang-coap sourcecode" id="section-4.2.1-3.1">
<pre>
Header: Created (Code=2.01)
Content-Format: 19 (application/ace+cbor)
Max-Age: 85800
Payload:
{
   / access_token / 1 : h'd83dd0835820a3010a044c53796d6d
                          6574726963313238054d99a0d7846e
                          762c49ffe8a63e0ba05858b918a11f
                          d81e438b7f973d9e2e119bcb22424b
                          a0f38a80f27562f400ee1d0d6c0fdb
                          559c02421fd384fc2ebe22d7071378
                          b0ea7428fff157444d45f7e6afcda1
                          aae5f6495830c58627087fc5b4974f
                          319a8707a635dd643b',
   / token_type /  34 : 2 / PoP /,
   / expires_in /   2 : 86400,
   / ace_profile / 38 : 1 / coap_dtls /
   / (remainder of the response omitted for brevity) /
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-as-to-client-coa" class="selfRef">Example of AS-to-Client CoAP Response Using CBOR</a>
            </figcaption></figure>
</div>
</section>
</div>
<div id="sec-token-hash-input-c-as-json">
<section id="section-4.2.2">
          <h4 id="name-as-to-client-response-encode">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-as-to-client-response-encode" class="section-name selfRef">AS-to-Client Response Encoded in JSON</a>
          </h4>
<p id="section-4.2.2-1">If the AS-to-Client response is encoded in JSON, then HASH_INPUT is the binary representation of the text string conveyed by the 'access_token' parameter.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">With reference to the example in <a href="#fig-as-response-json" class="auto internal xref">Figure 4</a>, HASH_INPUT is the binary representation of "eyJh...YFiA". When showing the access token, <a href="#fig-as-response-json" class="auto internal xref">Figure 4</a> uses line breaks for display purposes only.<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2.2-3">Note that:<a href="#section-4.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-4.1">
              <p id="section-4.2.2-4.1.1">If the access token is a JWT, then HASH_INPUT is the binary representation of the JWT.<a href="#section-4.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-4.2">
              <p id="section-4.2.2-4.2.1">If the access token is a CWT, then HASH_INPUT is the binary representation of a base64url-encoded text string, which encodes the binary representation of a tagged access token with the CWT as the innermost tag content (as per <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>).<a href="#section-4.2.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<span id="name-example-of-as-to-client-htt"></span><div id="fig-as-response-json">
<figure id="figure-4">
            <div class="lang-json sourcecode" id="section-4.2.2-5.1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/ace+json
Cache-Control: no-store
Pragma: no-cache
Payload:
{
   "access_token" : "eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJB
                     MTI4Q0JDLUhTMjU2In0.
                     QR1Owv2ug2WyPBnbQrRARTeEk9kDO2w8
                     qDcjiHnSJflSdv1iNqhWXaKH4MqAkQtM
                     oNfABIPJaZm0HaA415sv3aeuBWnD8J-U
                     i7Ah6cWafs3ZwwFKDFUUsWHSK-IPKxLG
                     TkND09XyjORj_CHAgOPJ-Sd8ONQRnJvW
                     n_hXV1BNMHzUjPyYwEsRhDhzjAD26ima
                     sOTsgruobpYGoQcXUwFDn7moXPRfDE8-
                     NoQX7N7ZYMmpUDkR-Cx9obNGwJQ3nM52
                     YCitxoQVPzjbl7WBuB7AohdBoZOdZ24W
                     lN1lVIeh8v1K4krB8xgKvRU8kgFrEn_a
                     1rZgN5TiysnmzTROF869lQ.
                     AxY8DCtDaGlsbGljb3RoZQ.
                     MKOle7UQrG6nSxTLX6Mqwt0orbHvAKeW
                     nDYvpIAeZ72deHxz3roJDXQyhxx0wKaM
                     HDjUEOKIwrtkHthpqEanSBNYHZgmNOV7
                     sln1Eu9g3J8.
                     fiK51VwhsxJ-siBMR-YFiA",
   "token_type"   : "PoP",
   "expires_in"   : 86400,
   "ace_profile"  : "coap_dtls"
}
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-as-to-client-htt" class="selfRef">Example of AS-to-Client HTTP Response Using JSON</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-token-hash-input-rs">
<section id="section-4.3">
        <h3 id="name-hash_input-on-the-rs">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-hash_input-on-the-rs" class="section-name selfRef">HASH_INPUT on the RS</a>
        </h3>
<p id="section-4.3-1">The following defines how the RS determines the HASH_INPUT value to use as input for computing the token hash of an access token, depending on the RS using either CWTs (see <a href="#sec-token-hash-input-rs-cwt" class="auto internal xref">Section 4.3.1</a>) or JWTs (see <a href="#sec-token-hash-input-rs-jwt" class="auto internal xref">Section 4.3.2</a>).<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="sec-token-hash-input-rs-cwt">
<section id="section-4.3.1">
          <h4 id="name-access-tokens-as-cwts">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-access-tokens-as-cwts" class="section-name selfRef">Access Tokens as CWTs</a>
          </h4>
<p id="section-4.3.1-1">If the RS expects access tokens to be CWTs, then the RS performs the following steps:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.1-2">
<li id="section-4.3.1-2.1">
              <p id="section-4.3.1-2.1.1">The RS receives the token-related information TOKEN_INFO, in accordance with what is specified by the used profile of ACE (see <a href="#sec-token-hash-input-motivation-rs" class="auto internal xref">Section 4.1.2</a>).<a href="#section-4.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.1-2.2">
              <p id="section-4.3.1-2.2.1">The RS assumes that the client received the access token in an AS-to-Client response encoded in CBOR (see <a href="#sec-token-hash-input-c-as-cbor" class="auto internal xref">Section 4.2.1</a>). Hence, the RS assumes TOKEN_INFO to be the binary representation of the tagged access token with the CWT as the innermost tag content (as per <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>).<a href="#section-4.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.1-2.3">
              <p id="section-4.3.1-2.3.1">The RS verifies the access token as per <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. If the verification fails, then the RS does not discard the access token yet; instead, it moves to Step 4.<a href="#section-4.3.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2.3.2">
Otherwise, the RS stores the access token and computes the corresponding token hash as defined in <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a>. In particular, the RS considers HASH_INPUT_TEXT as the base64url-encoded text string that encodes TOKEN_INFO. Then, HASH_INPUT is the binary representation of HASH_INPUT_TEXT.<a href="#section-4.3.1-2.3.2" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2.3.3">
After that, the RS stores the computed token hash as associated with the access token; then, it terminates this algorithm.<a href="#section-4.3.1-2.3.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.1-2.4">
              <p id="section-4.3.1-2.4.1">The RS assumes that the client received the access token in an AS-to-Client response encoded in JSON (see <a href="#sec-token-hash-input-c-as-json" class="auto internal xref">Section 4.2.2</a>). Hence, the RS assumes TOKEN_INFO to be the binary representation of HASH_INPUT_TEXT. In turn, HASH_INPUT_TEXT is the base64url-encoded text string that encodes the binary representation of the tagged access token with the CWT as the innermost tag content (as per <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>).<a href="#section-4.3.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.1-2.5">
              <p id="section-4.3.1-2.5.1">The RS performs the base64url decoding of HASH_INPUT_TEXT and considers the result to be the binary representation of the tagged access token.<a href="#section-4.3.1-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.1-2.6">
              <p id="section-4.3.1-2.6.1">The RS verifies the access token as per <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. If the verification fails, then the RS terminates this algorithm.<a href="#section-4.3.1-2.6.1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2.6.2">
Otherwise, the RS stores the access token and computes the corresponding token hash as defined in <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a>. In particular, HASH_INPUT is TOKEN_INFO.<a href="#section-4.3.1-2.6.2" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2.6.3">
After that, the RS stores the computed token hash as associated with the access token.<a href="#section-4.3.1-2.6.3" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="sec-token-hash-input-rs-jwt">
<section id="section-4.3.2">
          <h4 id="name-access-tokens-as-jwts">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-access-tokens-as-jwts" class="section-name selfRef">Access Tokens as JWTs</a>
          </h4>
<p id="section-4.3.2-1">If the RS expects access tokens to be JWTs, then the RS performs the following steps:<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.3.2-2">
<li id="section-4.3.2-2.1">
              <p id="section-4.3.2-2.1.1">The RS receives the token-related information TOKEN_INFO, in accordance with what is specified by the used profile of ACE (see <a href="#sec-token-hash-input-motivation-rs" class="auto internal xref">Section 4.1.2</a>).<a href="#section-4.3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.2-2.2">
              <p id="section-4.3.2-2.2.1">The RS verifies the access token as per <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. If the verification fails, then the RS terminates this algorithm. Otherwise, the RS stores the access token.<a href="#section-4.3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.2-2.3">
              <p id="section-4.3.2-2.3.1">The RS computes a first token hash associated with the access token as defined in <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a>.<a href="#section-4.3.2-2.3.1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2.3.2">
In particular, the RS assumes that the client received the access token in an AS-to-Client response encoded in JSON (see <a href="#sec-token-hash-input-c-as-json" class="auto internal xref">Section 4.2.2</a>). Hence, HASH_INPUT is TOKEN_INFO.<a href="#section-4.3.2-2.3.2" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2.3.3">
After that, the RS stores the computed token hash as associated with the access token.<a href="#section-4.3.2-2.3.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-4.3.2-2.4">
              <p id="section-4.3.2-2.4.1">The RS computes a second token hash associated with the access token as defined in <a href="#sec-token-hash-output" class="auto internal xref">Section 4.4</a>.<a href="#section-4.3.2-2.4.1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2.4.2">
In particular, the RS assumes that the client received the access token in an AS-to-Client response encoded in CBOR (see <a href="#sec-token-hash-input-c-as-cbor" class="auto internal xref">Section 4.2.1</a>). Hence, HASH_INPUT is the binary representation of HASH_INPUT_TEXT, which, in turn, is the base64url-encoded text string that encodes TOKEN_INFO.<a href="#section-4.3.2-2.4.2" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2.4.3">
After that, the RS stores the computed token hash as associated with the access token.<a href="#section-4.3.2-2.4.3" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-4.3.2-3">The RS skips Step 3 only if it is certain that all its pertaining access tokens are provided to any client by means of AS-to-Client responses encoded as CBOR messages. Otherwise, the RS <span class="bcp14">MUST</span> perform Step 3.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
<p id="section-4.3.2-4">The RS skips Step 4 only if it is certain that all its pertaining access tokens are provided to any client by means of AS-to-Client responses encoded as JSON messages. Otherwise, the RS <span class="bcp14">MUST</span> perform Step 4.<a href="#section-4.3.2-4" class="pilcrow">¶</a></p>
<p id="section-4.3.2-5">If the RS performs both Steps 3 and 4 above, then the RS <span class="bcp14">MUST</span> store, maintain, and rely on both token hashes as associated with the access token, consistent with what is specified in <a href="#sec-handling-token-hashes" class="auto internal xref">Section 11.1</a>.<a href="#section-4.3.2-5" class="pilcrow">¶</a></p>
<p id="section-4.3.2-6"><a href="#sec-seccons-two-hashes-jwt" class="auto internal xref">Section 14.7</a> discusses how computing and storing both token hashes neutralizes an attack against the RS, where a dishonest client can induce the RS to compute a token hash different from the correct one.<a href="#section-4.3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-token-hash-output">
<section id="section-4.4">
        <h3 id="name-computing-the-token-hash">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-computing-the-token-hash" class="section-name selfRef">Computing the Token Hash</a>
        </h3>
<p id="section-4.4-1">Once HASH_INPUT is determined as defined in Sections <a href="#sec-token-hash-input-c-as" class="auto internal xref">4.2</a> and <a href="#sec-token-hash-input-rs" class="auto internal xref">4.3</a>, a hash value of HASH_INPUT is generated as per <span><a href="https://rfc-editor.org/rfc/rfc6920#section-6" class="relref">Section 6</a> of [<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>. The resulting output in binary format is used as the token hash. Note that the used binary format embeds the identifier of the used hash function in the first byte of the computed token hash.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The specific hash function used <span class="bcp14">MUST</span> be collision resistant on byte strings and <span class="bcp14">MUST</span> be selected from the "Named Information Hash Algorithm Registry" <span>[<a href="#IANA.Hash.Algorithms" class="cite xref">IANA.Hash.Algorithms</a>]</span>. Consistent with the compliance requirements in <span><a href="https://rfc-editor.org/rfc/rfc6920#section-2" class="relref">Section 2</a> of [<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>, the hash function sha-256 as specified in <span>[<a href="#SHA-256" class="cite xref">SHA-256</a>]</span> is mandatory to implement.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">The AS specifies the used hash function to registered devices during their registration procedure (see <a href="#sec-registration" class="auto internal xref">Section 10</a>).<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-trl-resource">
<section id="section-5">
      <h2 id="name-token-revocation-list-trl">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-token-revocation-list-trl" class="section-name selfRef">Token Revocation List (TRL)</a>
      </h2>
<p id="section-5-1">Upon startup, the AS creates a single Token Revocation List (TRL) encoded as a CBOR array.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Each element of the array is a CBOR byte string, whose value is the token hash of an access token. The CBOR array <span class="bcp14">MUST</span> be treated as a set, i.e., the order of its elements has no meaning.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The TRL is initialized as empty, i.e., its initial content <span class="bcp14">MUST</span> be the empty CBOR array. The TRL is accessible through the TRL endpoint at the AS.<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="ssec-trl-update">
<section id="section-5.1">
        <h3 id="name-update-of-the-trl">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-update-of-the-trl" class="section-name selfRef">Update of the TRL</a>
        </h3>
<p id="section-5.1-1">The AS updates the TRL in the following two cases:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">When a non-expired access token is revoked, the token hash of the access token is added to the TRL. That is, a CBOR byte string with the token hash as its value is added to the CBOR array encoding the TRL.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">When a revoked access token expires, the token hash of the access token is removed from the TRL. That is, the CBOR byte string with the token hash as its value is removed from the CBOR array encoding the TRL.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-3">The AS <span class="bcp14">MAY</span> perform a single update to the TRL such that one or more token hashes are added or removed at once. For example, this can be the case if multiple access tokens are revoked or expire at the same time or within an acceptably narrow time frame.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-trl-endpoint">
<section id="section-6">
      <h2 id="name-the-trl-endpoint">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-the-trl-endpoint" class="section-name selfRef">The TRL Endpoint</a>
      </h2>
<p id="section-6-1">Consistent with <span><a href="https://rfc-editor.org/rfc/rfc9200#section-6.5" class="relref">Section 6.5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, all communications between the AS and a requester interacting with the TRL endpoint at the AS <span class="bcp14">MUST</span> be encrypted, as well as integrity and replay protected. Furthermore, responses from the AS to the requester <span class="bcp14">MUST</span> be bound to the corresponding requests.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Following a request to the TRL endpoint, the corresponding success response messages sent by the AS use Content-Format "application/ace-trl+cbor". Their payload is formatted as a CBOR map, and the CBOR values used to abbreviate the parameters included therein are defined in <a href="#trl-registry-parameters" class="auto internal xref">Section 12</a>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The AS <span class="bcp14">MUST</span> implement measures to prevent access to the TRL endpoint by entities other than registered devices and authorized administrators (see <a href="#sec-registration" class="auto internal xref">Section 10</a>).<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">The TRL endpoint supports only the GET method, and allows two types of queries of the TRL:<a href="#section-6-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-5">
        <li id="section-6-5.1">
          <p id="section-6-5.1.1">Full query: the AS returns the token hashes of the revoked access tokens currently in the TRL and pertaining to the requester.<a href="#section-6-5.1.1" class="pilcrow">¶</a></p>
<p id="section-6-5.1.2">
The AS <span class="bcp14">MUST</span> support this type of query. The processing of a full query and the related response format are defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>.<a href="#section-6-5.1.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-6-5.2">
          <p id="section-6-5.2.1">Diff query: the AS returns a list of diff entries. Each diff entry is related to one update that occurred to the TRL, and it contains a set of token hashes pertaining to the requester. In particular, all such token hashes were added to the TRL or removed from the TRL at the update related to the diff entry in question.<a href="#section-6-5.2.1" class="pilcrow">¶</a></p>
<p id="section-6-5.2.2">
The AS <span class="bcp14">MAY</span> support this type of query. In such a case, the AS maintains the history of updates to the TRL as defined in <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>. The processing of a diff query and the related response format are defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>.<a href="#section-6-5.2.2" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-6-6">If it supports diff queries, the AS <span class="bcp14">MAY</span> additionally support the related "Cursor" extension, which has two benefits:<a href="#section-6-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-7">
 <li id="section-6-7.1">The AS can avoid excessively long messages when several diff entries have to be transferred by delivering several diff query responses, each containing one adjacent subset of diff entries at a time.<a href="#section-6-7.1" class="pilcrow">¶</a>
</li>
        <li id="section-6-7.2">A requester can retrieve diff entries associated with TRL updates that, even if not the most recent ones, occurred after a TRL update associated with a diff entry indicated as a reference point.<a href="#section-6-7.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-6-8">If it supports the "Cursor" extension, the AS stores additional information when maintaining the history of updates to the TRL as defined in <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>. Also, the processing of full query requests and diff query requests, as well as the related response format, are further extended as defined in <a href="#sec-using-cursor" class="auto internal xref">Section 9</a>.<a href="#section-6-8" class="pilcrow">¶</a></p>
<p id="section-6-9"><a href="#sec-trl-parameteters" class="auto internal xref">Appendix B</a> provides an aggregated overview of the local supportive parameters that the AS internally uses at its TRL endpoint when supporting diff queries and the "Cursor" extension.<a href="#section-6-9" class="pilcrow">¶</a></p>
<div id="sec-error-responses">
<section id="section-6.1">
        <h3 id="name-error-responses-with-proble">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-error-responses-with-proble" class="section-name selfRef">Error Responses with Problem Details</a>
        </h3>
<p id="section-6.1-1">Some error responses from the TRL endpoint at the AS can convey error-specific information according to the problem-details format defined in <span>[<a href="#RFC9290" class="cite xref">RFC9290</a>]</span>. Such error responses <span class="bcp14">MUST</span> have Content-Format set to "application/concise-problem-details+cbor". The payload of these error responses <span class="bcp14">MUST</span> be a CBOR map specifying a Concise Problem Details data item (see <span><a href="https://rfc-editor.org/rfc/rfc9290#section-2" class="relref">Section 2</a> of [<a href="#RFC9290" class="cite xref">RFC9290</a>]</span>). The CBOR map is formatted as follows:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">It <span class="bcp14">MUST</span> include the Custom Problem Detail entry 'ace-trl-error' registered in <a href="#iana-custom-problem-details" class="auto internal xref">Section 15.3</a> of this document. This entry is formatted as a CBOR map, which includes the following fields:<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1.2.1">
                <p id="section-6.1-2.1.2.1.1">The 'error-id' field <span class="bcp14">MUST</span> be present. The map key used for this field is the CBOR unsigned integer with a value of 0. The value of this field is a CBOR integer specifying the error that occurred at the AS. This value is taken from the 'Value' column of the "ACE Token Revocation List Errors" registry defined in <a href="#iana-token-revocation-list-errors" class="auto internal xref">Section 15.5</a> of this document.<a href="#section-6.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1-2.1.2.2">
                <p id="section-6.1-2.1.2.2.1">The 'cursor' field <span class="bcp14">MAY</span> be present. The map key used for this field is the CBOR unsigned integer with a value of 1. The value of this field is a CBOR unsigned integer or the CBOR simple value <code>null</code> (0xf6). The use of this field is defined in <a href="#sec-trl-endpoint-query-parameters" class="auto internal xref">Section 6.3</a>.<a href="#section-6.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1-2.1.3">
The CDDL notation <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> of the 'ace-trl-error' entry is given below:<a href="#section-6.1-2.1.3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-6.1-2.1.4">
<pre>
   ace-trl-error = {
       0: int,        ; error-id
     ? 1: uint / null ; cursor
   }
</pre><a href="#section-6.1-2.1.4" class="pilcrow">¶</a>
</div>
</li>
          <li class="normal" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">It <span class="bcp14">MAY</span> include further Standard Problem Detail entries or Custom Problem Detail entries (see <span>[<a href="#RFC9290" class="cite xref">RFC9290</a>]</span>).<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-6.1-2.2.2">
In particular, it can include the Standard Problem Detail entry 'detail' (map key -2), whose value is a CBOR text string that specifies a human-readable diagnostic description of the error that occurred at the AS. The diagnostic text is intended for software engineers as well as for device and network operators in order to aid in debugging and provide context for possible intervention. The diagnostic message <span class="bcp14">SHOULD</span> be logged by the AS. The 'detail' entry is unlikely to be relevant in an unattended setup where human intervention is not expected.<a href="#section-6.1-2.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-3">An example of an error response using the problem-details format is shown in <a href="#fig-example-error-response" class="auto internal xref">Figure 5</a>.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<span id="name-example-of-error-response-w"></span><div id="fig-example-error-response">
<figure id="figure-5">
          <div class="sourcecode" id="section-6.1-4.1">
<pre>
Header: Bad Request (Code=4.00)
Content-Format: 257 (application/concise-problem-details+cbor)
Payload:
{
  / title /         -1: "Invalid parameter value",
  / detail /        -2: "Invalid value for 'cursor': -53",
  / ace-trl-error /  1: {
    / error-id / 0: 0 / "Invalid parameter value" /,
    / cursor /   1: 42
  }
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-error-response-w" class="selfRef">Example of Error Response with Problem Details</a>
          </figcaption></figure>
</div>
<p id="section-6.1-5">The problem-details format in general and the Custom Problem Detail entry 'ace-trl-error' in particular are <span class="bcp14">OPTIONAL</span> to support for registered devices. A registered device supporting the entry 'ace-trl-error' and that is able to understand the specified error may use that information to determine what actions to take next.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-trl-endpoint-supporting-diff-queries">
<section id="section-6.2">
        <h3 id="name-supporting-diff-queries">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-supporting-diff-queries" class="section-name selfRef">Supporting Diff Queries</a>
        </h3>
<p id="section-6.2-1">If the AS supports diff queries, it is able to transfer a list of diff entries, each of which is related to one update that occurred to the TRL (see <a href="#sec-trl-endpoint" class="auto internal xref">Section 6</a>). That is, when replying to a diff query performed for a requester, the AS provides the diff entries related to the most recent TRL updates pertaining to the requester.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The following defines how the AS builds and maintains an ordered list of diff entries, for each registered device and administrator, hereafter referred to as "requesters". In particular, a requester's diff entry associated with a TRL update contains a set of token hashes pertaining to that requester, each of which was added to the TRL or removed from the TRL at that update.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">The AS defines the single constant positive integer MAX_N &gt;= 1. For each requester, the AS maintains an update collection of maximum MAX_N series items, each of which is a diff entry. For each requester, the AS <span class="bcp14">MUST</span> keep track of the MAX_N most recent TRL updates pertaining to the requester. If the AS supports diff queries, the AS <span class="bcp14">MUST</span> provide requesters with the value of MAX_N upon their registration (see <a href="#sec-registration" class="auto internal xref">Section 10</a>).<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">The series of items in the update collection <span class="bcp14">MUST</span> be strictly chronologically ordered. That is, at any point in time, the first series item is the one least recently added to the update collection and still retained by the AS; the last series item is the one most recently added to the update collection. The particular method used to achieve this is implementation specific.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">Each time the TRL changes, the AS performs the following operations for each requester:<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-6">
<li id="section-6.2-6.1">
            <p id="section-6.2-6.1.1">The AS considers the subset of the TRL pertaining to that requester. If the TRL subset is not affected by this TRL update, the AS stops the processing for that requester. Otherwise, the AS moves to Step 2.<a href="#section-6.2-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.2">
            <p id="section-6.2-6.2.1">The AS creates two trl_patch sets of token hashes, i.e., one  'removed' set and one 'added' set, as related to this TRL update.<a href="#section-6.2-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.3">
            <p id="section-6.2-6.3.1">The AS fills the two sets with the token hashes of the removed and added access tokens, respectively, from/to the TRL subset considered at Step 1.<a href="#section-6.2-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.4">
            <p id="section-6.2-6.4.1">The AS creates a new series item that includes the two sets from Step 3.<a href="#section-6.2-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.5">
            <p id="section-6.2-6.5.1">If the update collection associated with the requester currently includes MAX_N series items, the AS <span class="bcp14">MUST</span> delete the oldest series item in the update collection.<a href="#section-6.2-6.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.6">
            <p id="section-6.2-6.6.1">The AS adds the series item to the update collection associated with the requester as the last (most recent) series item.<a href="#section-6.2-6.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="sec-trl-endpoint-supporting-cursor">
<section id="section-6.2.1">
          <h4 id="name-supporting-the-cursor-exten">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-supporting-the-cursor-exten" class="section-name selfRef">Supporting the "Cursor" Extension</a>
          </h4>
<p id="section-6.2.1-1">If it supports the "Cursor" extension for diff queries, the AS also performs the following actions:<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">The AS defines the single constant unsigned integer MAX_INDEX &lt;= ((2<sup>64</sup>) - 1).  The value of MAX_INDEX is <span class="bcp14">REQUIRED</span> to be at least (MAX_N - 1) and is <span class="bcp14">RECOMMENDED</span> to be at least ((2<sup>32</sup>) - 1). MAX_INDEX <span class="bcp14">SHOULD</span> be orders of magnitude greater than MAX_N.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-3">The following applies separately for each requester's update collection:<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.1-4.1">
              <p id="section-6.2.1-4.1.1">Each series item X in the update collection is also associated with an unsigned integer 'index', whose minimum value is 0 and whose maximum value is MAX_INDEX. The first series item ever added to the update collection <span class="bcp14">MUST</span> have an 'index' with a value of 0.<a href="#section-6.2.1-4.1.1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4.1.2">
If i_X is the value of 'index' associated with a series item X, then the following series item Y will take 'index' with a value of i_Y = (i_X + 1) % (MAX_INDEX + 1). That is, after having added a series item whose associated 'index' has a value of MAX_INDEX, the next added series item will result in a wraparound of the 'index' value; thus, it will take an 'index' with a value of 0.<a href="#section-6.2.1-4.1.2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4.1.3">
For example, assuming MAX_N = 3, the values of 'index' in the update collection chronologically evolve as follows, as new series items are added and old series items are deleted:<a href="#section-6.2.1-4.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.1-4.1.4.1">
                  <p id="section-6.2.1-4.1.4.1.1">...<a href="#section-6.2.1-4.1.4.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-4.1.4.2">
                  <p id="section-6.2.1-4.1.4.2.1">(i_A = MAX_INDEX - 2, i_B = MAX_INDEX - 1, i_C = MAX_INDEX)<a href="#section-6.2.1-4.1.4.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-4.1.4.3">
                  <p id="section-6.2.1-4.1.4.3.1">(i_B = MAX_INDEX - 1, i_C = MAX_INDEX, i_D = 0)<a href="#section-6.2.1-4.1.4.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-4.1.4.4">
                  <p id="section-6.2.1-4.1.4.4.1">(i_C = MAX_INDEX, i_D = 0, i_E = 1)<a href="#section-6.2.1-4.1.4.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-4.1.4.5">
                  <p id="section-6.2.1-4.1.4.5.1">(i_D = 0, i_E = 1, i_F = 2)<a href="#section-6.2.1-4.1.4.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-6.2.1-4.1.4.6">
                  <p id="section-6.2.1-4.1.4.6.1">...<a href="#section-6.2.1-4.1.4.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-6.2.1-4.2">
              <p id="section-6.2.1-4.2.1">The unsigned integer 'last_index' is also defined, with minimum value 0 and maximum value MAX_INDEX.<a href="#section-6.2.1-4.2.1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4.2.2">
If the update collection is empty (i.e., no series items have been added yet), the value of 'last_index' is not defined. If the update collection is not empty, 'last_index' has the value of 'index' currently associated with the last series item in the update collection.<a href="#section-6.2.1-4.2.2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4.2.3">
That is, after having added V series items to the update collection, the last and most recently added series item has an 'index' with a value of 'last_index' = (V - 1) % (MAX_INDEX + 1).<a href="#section-6.2.1-4.2.3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4.2.4">
As long as a wraparound of the 'index' value has not occurred, the value of 'last_index' is the absolute counter of series items added to that update collection, minus 1.<a href="#section-6.2.1-4.2.4" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.2.1-5">When processing a diff query using the "Cursor" extension, the values of 'index' are used as cursor information, as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a>.<a href="#section-6.2.1-5" class="pilcrow">¶</a></p>
<p id="section-6.2.1-6">For each requester's update collection, the AS also defines a constant positive integer MAX_DIFF_BATCH &lt;= MAX_N, whose value specifies the maximum number of diff entries to be included in a single diff query response. The specific value <span class="bcp14">MAY</span> depend on the specific registered device or administrator associated with the update collection in question. If supporting the "Cursor" extension, the AS <span class="bcp14">MUST</span> provide registered devices and administrators with the corresponding value of MAX_DIFF_BATCH upon their registration (see <a href="#sec-registration" class="auto internal xref">Section 10</a>).<a href="#section-6.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-trl-endpoint-query-parameters">
<section id="section-6.3">
        <h3 id="name-query-parameters">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-query-parameters" class="section-name selfRef">Query Parameters</a>
        </h3>
<p id="section-6.3-1">A GET request to the TRL endpoint can include the following query parameters. The AS <span class="bcp14">MUST</span> silently ignore unknown query parameters.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-2.1">
            <p id="section-6.3-2.1.1">'diff': if included, it asks the AS to perform a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>). Its value <span class="bcp14">MUST</span> be either:<a href="#section-6.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-2.1.2.1">
                <p id="section-6.3-2.1.2.1.1">the integer 0, indicating that a (notification) response should include as many diff entries as the AS can provide in the response; or<a href="#section-6.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3-2.1.2.2">
                <p id="section-6.3-2.1.2.2.1">a positive integer strictly greater than 0, indicating the maximum number of diff entries that a (notification) response should include.<a href="#section-6.3-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.3-2.1.3">
If the AS does not support diff queries, it ignores the 'diff' query parameter when present in the GET request and proceeds like when performing a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>).<a href="#section-6.3-2.1.3" class="pilcrow">¶</a></p>
<p id="section-6.3-2.1.4">
Otherwise, the AS <span class="bcp14">MUST</span> return a 4.00 (Bad Request) response in case the 'diff' query parameter of the GET request has a value that is neither 0 nor a positive integer, irrespective of the presence of the 'cursor' query parameter and its value (see below). The response <span class="bcp14">MUST</span> have Content-Format set to "application/concise-problem-details+cbor", and its payload is formatted as defined in <a href="#sec-error-responses" class="auto internal xref">Section 6.1</a>. Within the Custom Problem Detail entry 'ace-trl-error', the value of the 'error-id' field <span class="bcp14">MUST</span> be set to 0 ("Invalid parameter value"), and the 'cursor' field <span class="bcp14">MUST NOT</span> be present.<a href="#section-6.3-2.1.4" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.3-2.2">
            <p id="section-6.3-2.2.1">'cursor': if included, it asks the AS to perform a diff query of the TRL together with the "Cursor" extension, as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a>. Its value <span class="bcp14">MUST</span> be either 0 or a positive integer. If the 'cursor' query parameter is included, then the 'diff' query parameter <span class="bcp14">MUST</span> also be included.<a href="#section-6.3-2.2.1" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.2">
If included, the 'cursor' query parameter has an unsigned integer value that was provided by the AS in a previous response from the TRL endpoint (see Sections <a href="#sec-using-cursor-full-query-response" class="auto internal xref">9.1</a>, <a href="#sec-using-cursor-diff-query-response-no-cursor" class="auto internal xref">9.2.2</a>, and <a href="#sec-using-cursor-diff-query-response-cursor" class="auto internal xref">9.2.3</a>).<a href="#section-6.3-2.2.2" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.3">
     If the AS does not support the "Cursor" extension, it ignores the 'cursor' query parameter when present in the GET request. In such a case, the AS proceeds as specified elsewhere in this document, that is:<a href="#section-6.3-2.2.3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.3-2.2.4">
       <li id="section-6.3-2.2.4.1">it performs a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>), if it supports diff queries and the 'diff' query parameter is present in the GET request; otherwise,<a href="#section-6.3-2.2.4.1" class="pilcrow">¶</a>
</li>
              <li id="section-6.3-2.2.4.2">it performs a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>).<a href="#section-6.3-2.2.4.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-6.3-2.2.5">
If the AS supports both diff queries and the "Cursor" extension, and the GET request includes the 'cursor' query parameter, then the AS <span class="bcp14">MUST</span> return a 4.00 (Bad Request) response in case any of the conditions below holds.<a href="#section-6.3-2.2.5" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.6">
The 4.00 (Bad Request) response <span class="bcp14">MUST</span> have Content-Format set to "application/concise-problem-details+cbor", and its payload is formatted as defined in <a href="#sec-error-responses" class="auto internal xref">Section 6.1</a>.<a href="#section-6.3-2.2.6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-2.2.7.1">
                <p id="section-6.3-2.2.7.1.1">The GET request does not include the 'diff' query parameter, irrespective of the value of the 'cursor' query parameter.<a href="#section-6.3-2.2.7.1.1" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.7.1.2">
Within the Custom Problem Detail entry 'ace-trl-error', the value of the 'error-id' field <span class="bcp14">MUST</span> be set to 1 ("Invalid set of parameters"), and the 'cursor' field <span class="bcp14">MUST NOT</span> be present.<a href="#section-6.3-2.2.7.1.2" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3-2.2.7.2">
                <p id="section-6.3-2.2.7.2.1">The 'cursor' query parameter has a value that is neither 0 nor a positive integer; or it has a value strictly greater than MAX_INDEX (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>).<a href="#section-6.3-2.2.7.2.1" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.7.2.2">
 Within the Custom Problem Detail entry 'ace-trl-error', the value of the 'error-id' field <span class="bcp14">MUST</span> be set to 0 ("Invalid parameter value"). The entry 'ace-trl-error' <span class="bcp14">MUST</span> include the 'cursor' field, whose value is either:<a href="#section-6.3-2.2.7.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-2.2.7.2.3.1">the CBOR simple value <code>null</code> (0xf6), if the update collection associated with the requester is empty; or, otherwise<a href="#section-6.3-2.2.7.2.3.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-6.3-2.2.7.2.3.2">the corresponding current value of 'last_index'.<a href="#section-6.3-2.2.7.2.3.2" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li class="normal" id="section-6.3-2.2.7.3">
                <p id="section-6.3-2.2.7.3.1">All of the following hold: the update collection associated with the requester is not empty; no wraparound of the 'index' value has occurred; and the 'cursor' query parameter has a value strictly greater than the current 'last_index' on the update collection (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>).<a href="#section-6.3-2.2.7.3.1" class="pilcrow">¶</a></p>
<p id="section-6.3-2.2.7.3.2">
Within the Custom Problem Detail entry 'ace-trl-error', the value of the 'error-id' field <span class="bcp14">MUST</span> be set to 2 ("Out of bound cursor value"), and the 'cursor' field <span class="bcp14">MUST NOT</span> be present.<a href="#section-6.3-2.2.7.3.2" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="ssec-trl-full-query">
<section id="section-7">
      <h2 id="name-full-query-of-the-trl">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-full-query-of-the-trl" class="section-name selfRef">Full Query of the TRL</a>
      </h2>
<p id="section-7-1">In order to produce a (notification) response to a GET request asking for a full query of the TRL, the AS performs the following actions:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-2">
<li id="section-7-2.1">
          <p id="section-7-2.1.1">From the TRL, the AS builds a HASHES set such that:<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1.2.1">
              <p id="section-7-2.1.2.1.1">If the requester is a registered device, HASHES specifies the token hashes currently in the TRL and associated with the access tokens pertaining to that registered device. The AS can always use the authenticated identity of the registered device to perform the necessary filtering on the TRL content.<a href="#section-7-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7-2.1.2.2">
              <p id="section-7-2.1.2.2.1">If the requester is an administrator, HASHES specifies all the token hashes currently in the TRL.<a href="#section-7-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li id="section-7-2.2">
          <p id="section-7-2.2.1">The AS sends a 2.05 (Content) response to the requester. The response <span class="bcp14">MUST</span> have Content-Format set to "application/ace-trl+cbor". The payload of the response is a CBOR map, which <span class="bcp14">MUST</span> be formatted as follows.<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.2.2.1">
              <p id="section-7-2.2.2.1.1">The 'full_set' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode a CBOR array 'full_set_value'. Each element of 'full_set_value' is a CBOR byte string, whose value is one of the token hashes from the HASHES set. If the HASHES set is empty, the 'full_set' parameter specifies the empty CBOR array.<a href="#section-7-2.2.2.1.1" class="pilcrow">¶</a></p>
<p id="section-7-2.2.2.1.2">
The CBOR array <span class="bcp14">MUST</span> be treated as a set, i.e., the order of its elements has no meaning.<a href="#section-7-2.2.2.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7-2.2.2.2">
              <p id="section-7-2.2.2.2.1">The 'cursor' parameter <span class="bcp14">MUST</span> be included if the AS supports both diff queries and the related "Cursor" extension (see Sections <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">6.2</a> and <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">6.2.1</a>). Its value is set as specified in <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 9.1</a> and provides the requester with information for sending a new request that asks the AS to perform a follow-up diff query using the "Cursor" extension (see <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a>).<a href="#section-7-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-7-2.2.2.2.2">
If the AS does not support both diff queries and the "Cursor" extension, this parameter <span class="bcp14">MUST NOT</span> be included. In case the requester does not support both diff queries and the "Cursor" extension, it <span class="bcp14">MUST</span> silently ignore the 'cursor' parameter if present.<a href="#section-7-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-7-3"><a href="#cddl-full" class="auto internal xref">Figure 6</a> provides the CDDL definition <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> of the CBOR array 'full_set_value' specified in the response from the AS as the value of the 'full_set' parameter.<a href="#section-7-3" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-full_set"></span><div id="cddl-full">
<figure id="figure-6">
        <div class="lang-cddl sourcecode" id="section-7-4.1">
<pre>
token_hash = bytes
full_set_value = [* token_hash]
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-cddl-definition-of-full_set" class="selfRef">CDDL Definition of 'full_set_value'</a>
        </figcaption></figure>
</div>
<p id="section-7-5"><a href="#response-full" class="auto internal xref">Figure 7</a> shows an example of a response from the AS following a full query request to the TRL endpoint. In this example, the AS does not support diff queries nor the "Cursor" extension; hence the 'cursor' parameter is not included in the payload of the response. Also, full token hashes are omitted for brevity.<a href="#section-7-5" class="pilcrow">¶</a></p>
<span id="name-example-of-a-response-follo"></span><div id="response-full">
<figure id="figure-7">
        <div class="sourcecode" id="section-7-6.1">
<pre>
Header: Content (Code=2.05)
Content-Format: 262 (application/ace-trl+cbor)
Payload:
{
   / full_set / 0: [
     h'01fa51cc...4819', / elided for brevity /
     h'01748190...223d'  / elided for brevity /
   ]
}
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-of-a-response-follo" class="selfRef">Example of a Response Following a Full Query Request to the TRL Endpoint</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-trl-diff-query">
<section id="section-8">
      <h2 id="name-diff-query-of-the-trl">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-diff-query-of-the-trl" class="section-name selfRef">Diff Query of the TRL</a>
      </h2>
<p id="section-8-1">In order to produce a (notification) response to a GET request asking for a diff query of the TRL, the AS performs the following actions:<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Note that, if the AS supports both diff queries and the related "Cursor" extension, Steps 3 and 4 defined below are extended as defined in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a>.<a href="#section-8-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-3">
<li id="section-8-3.1">
          <p id="section-8-3.1.1">The AS defines the positive integer NUM as follows: if the value N specified in the 'diff' query parameter in the GET request is equal to 0 or greater than the predefined positive integer MAX_N (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>), then NUM takes the value of MAX_N. Otherwise, NUM takes N.<a href="#section-8-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-3.2">
          <p id="section-8-3.2.1">The AS determines U = min(NUM, SIZE), where SIZE &lt;= MAX_N. In particular, SIZE is the number of diff entries currently stored in the requester's update collection.<a href="#section-8-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-3.3">
          <p id="section-8-3.3.1">The AS prepares U diff entries. If U is equal to 0 (e.g., because SIZE is equal to 0 at Step 2), then no diff entries are prepared.<a href="#section-8-3.3.1" class="pilcrow">¶</a></p>
<p id="section-8-3.3.2">
The prepared diff entries are related to the U most recent TRL updates pertaining to the requester, as maintained in the update collection for that requester (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>). In particular, the first diff entry refers to the most recent of such updates, the second diff entry refers to the second-to-last of such updates, and so on.<a href="#section-8-3.3.2" class="pilcrow">¶</a></p>
<p id="section-8-3.3.3">
   Each diff entry is a CBOR array 'diff_entry', which includes the following two elements:<a href="#section-8-3.3.3" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-8-3.3.4">
            <li id="section-8-3.3.4.1">
              <p id="section-8-3.3.4.1.1">A trl_patch set of token hashes encoded as a CBOR array 'removed'. Each element of the array is a CBOR byte string, whose value is the token hash of an access token such that it pertains to the requester and was removed from the TRL during the update associated with the diff entry.<a href="#section-8-3.3.4.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-8-3.3.4.2">
              <p id="section-8-3.3.4.2.1">A trl_patch set of token hashes encoded as a CBOR array 'added'. Each element of the array is a CBOR byte string, whose value is the token hash of an access token such that it pertains to the requester and was added to the TRL during the update associated with the diff entry.<a href="#section-8-3.3.4.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-8-3.3.5">
The CBOR arrays 'removed' and 'added' <span class="bcp14">MUST</span> be treated as sets, i.e., the order of their elements has no meaning.<a href="#section-8-3.3.5" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-3.4">
          <p id="section-8-3.4.1">The AS prepares a 2.05 (Content) response for the requester. The response <span class="bcp14">MUST</span> have Content-Format set to "application/ace-trl+cbor". The payload of the response is a CBOR map, which <span class="bcp14">MUST</span> be formatted as follows:<a href="#section-8-3.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.4.2.1">
              <p id="section-8-3.4.2.1.1">The 'diff_set' parameter <span class="bcp14">MUST</span> be present and <span class="bcp14">MUST</span> encode a CBOR array 'diff_set_value' of U elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared above as a diff entry. Note that U might have a value of 0; in this case, 'diff_set_value' is the empty CBOR array.<a href="#section-8-3.4.2.1.1" class="pilcrow">¶</a></p>
<p id="section-8-3.4.2.1.2">
Within 'diff_set_value', the 'diff_entry' CBOR arrays <span class="bcp14">MUST</span> be sorted to reflect the corresponding updates to the TRL in reverse chronological order. That is, the first 'diff_entry' element of 'diff_set_value' relates to the most recent TRL update pertaining to the requester. The second 'diff_entry' element relates to the second-to-last most recent TRL update pertaining to the requester, and so on.<a href="#section-8-3.4.2.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8-3.4.2.2">
              <p id="section-8-3.4.2.2.1">The 'cursor' parameter and the 'more' parameter <span class="bcp14">MUST</span> be included if the AS supports both diff queries and the related "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>). Their values are set as specified in <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a> and provide the requester with information for sending a new request that asks the AS to perform a follow-up query of the TRL (see <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">Section 9.2</a>).<a href="#section-8-3.4.2.2.1" class="pilcrow">¶</a></p>
<p id="section-8-3.4.2.2.2">
In case the AS supports diff queries but not the "Cursor" extension, these parameters <span class="bcp14">MUST NOT</span> be included.  In case the requester supports diff queries but not the "Cursor" extension, the requester <span class="bcp14">MUST</span> silently ignore the 'cursor' parameter and the 'more' parameter, if present.<a href="#section-8-3.4.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
      </ol>
<p id="section-8-4"><a href="#cddl-diff" class="auto internal xref">Figure 8</a> provides the CDDL definition <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> of the CBOR array 'diff_set_value' specified in the response from the AS, as the value of the 'diff_set' parameter.<a href="#section-8-4" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-diff_set"></span><div id="cddl-diff">
<figure id="figure-8">
        <div class="lang-cddl sourcecode" id="section-8-5.1">
<pre>
   token_hash = bytes
   trl_patch = [* token_hash]
   diff_entry = [removed: trl_patch, added: trl_patch]
   diff_set_value = [* diff_entry]
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-cddl-definition-of-diff_set" class="selfRef">CDDL Definition of 'diff_set_value'</a>
        </figcaption></figure>
</div>
<p id="section-8-6"><a href="#response-diff" class="auto internal xref">Figure 9</a> shows an example of a response from the AS following a diff query request to the TRL endpoint, where U = 3 diff entries are included. In this example, the AS does not support the "Cursor" extension; hence, the 'cursor' parameter and the 'more' parameter are not included in the payload of the response. Also, full token hashes are omitted for brevity.<a href="#section-8-6" class="pilcrow">¶</a></p>
<span id="name-example-of-response-followi"></span><div id="response-diff">
<figure id="figure-9">
        <div class="sourcecode" id="section-8-7.1">
<pre>
Header: Content (Code=2.05)
Content-Format: 262 (application/ace-trl+cbor)
Payload:
{
   / diff_set / 1: [
     [
       [ h'01fa51cc...0f6a', / elided for brevity /
         h'01748190...8bce'  / elided for brevity /
       ],
       [ h'01cdf1ca...563d', / elided for brevity /
         h'01be41a6...a057'  / elided for brevity /
       ]
     ],
     [
       [ h'0144dd12...77bc', / elided for brevity /
         h'01231fff...a2ce'  / elided for brevity /
       ],
       []
     ],
     [
       [],
       [ h'01ca986f...ffc1', / elided for brevity /
         h'01fe1a2b...def0'  / elided for brevity /
       ]
     ]
   ]
}
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-of-response-followi" class="selfRef">Example of Response Following a Diff Query Request to the TRL Endpoint</a>
        </figcaption></figure>
</div>
<p id="section-8-8"><a href="#sec-series-pattern" class="auto internal xref">Appendix A</a> discusses how performing a diff query of the TRL is, in fact, a usage example of the Series Transfer Pattern defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="cite xref">STP</a>]</span>.<a href="#section-8-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor">
<section id="section-9">
      <h2 id="name-response-messages-when-usin">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-response-messages-when-usin" class="section-name selfRef">Response Messages when Using the "Cursor" Extension</a>
      </h2>
<p id="section-9-1">If the AS supports both diff queries and the "Cursor" extension, it composes a response to a full query request or diff query request as defined in Sections <a href="#sec-using-cursor-full-query-response" class="auto internal xref">9.1</a> and <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">9.2</a>, respectively.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The exact format of the response depends on:<a href="#section-9-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-3.1">the request being a full query or diff query request,<a href="#section-9-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.2">the presence of the 'diff' and 'cursor' query parameters and their values in the diff query request, and<a href="#section-9-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.3">the current status of the update collection associated with the requester.<a href="#section-9-3.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-9-4">Error handling and the possible resulting error responses are as defined in <a href="#sec-trl-endpoint-query-parameters" class="auto internal xref">Section 6.3</a>.<a href="#section-9-4" class="pilcrow">¶</a></p>
<div id="sec-using-cursor-full-query-response">
<section id="section-9.1">
        <h3 id="name-response-to-full-query">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-response-to-full-query" class="section-name selfRef">Response to Full Query</a>
        </h3>
<p id="section-9.1-1">When processing a full query request to the TRL endpoint, the AS composes a response as defined in <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">In particular, the 'cursor' parameter included in the CBOR map carried in the response payload specifies either the CBOR simple value <code>null</code> (0xf6) or a CBOR unsigned integer.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">The 'cursor' parameter <span class="bcp14">MUST</span> encode the CBOR simple value <code>null</code> (0xf6) in case there are currently no TRL updates pertaining to the requester, i.e., the update collection for that requester is empty. This is the case from when the requester registers at the AS until the first update pertaining to that requester occurs to the TRL.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">Otherwise, the 'cursor' parameter <span class="bcp14">MUST</span> encode a CBOR unsigned integer. The unsigned integer <span class="bcp14">MUST</span> take the 'index' value of the last series item in the update collection associated with the requester (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>) as corresponding to the most recent TRL update pertaining to the requester. In fact, such a value is the current value of 'last_index' for the update collection associated with the requester.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor-diff-query-response">
<section id="section-9.2">
        <h3 id="name-response-to-diff-query">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-response-to-diff-query" class="section-name selfRef">Response to Diff Query</a>
        </h3>
<p id="section-9.2-1">When processing a diff query request to the TRL endpoint, the AS composes a response as defined in the following subsections.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<div id="sec-using-cursor-diff-query-response-empty">
<section id="section-9.2.1">
          <h4 id="name-empty-update-collection">
<a href="#section-9.2.1" class="section-number selfRef">9.2.1. </a><a href="#name-empty-update-collection" class="section-name selfRef">Empty Update Collection</a>
          </h4>
<p id="section-9.2.1-1">If the update collection associated with the requester has no elements, the AS returns a 2.05 (Content) response. The response <span class="bcp14">MUST</span> have Content-Format set to "application/ace-trl+cbor", and its payload <span class="bcp14">MUST</span> be a CBOR map formatted as follows:<a href="#section-9.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.1-2.1">
              <p id="section-9.2.1-2.1.1">The 'diff_set' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the empty CBOR array.<a href="#section-9.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.2.1-2.2">
              <p id="section-9.2.1-2.2.1">The 'cursor' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the CBOR simple value <code>null</code> (0xf6).<a href="#section-9.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.2.1-2.3">
              <p id="section-9.2.1-2.3.1">The 'more' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the CBOR simple value <code>false</code> (0xf4).<a href="#section-9.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-9.2.1-3">Note that the above applies when the update collection associated with the requester has no elements, regardless of whether or not the 'cursor' query parameter is included in the diff query request and irrespective of the specified unsigned integer value if present.<a href="#section-9.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor-diff-query-response-no-cursor">
<section id="section-9.2.2">
          <h4 id="name-cursor-not-included-in-the-">
<a href="#section-9.2.2" class="section-number selfRef">9.2.2. </a><a href="#name-cursor-not-included-in-the-" class="section-name selfRef">Cursor Not Included in the Diff Query Request</a>
          </h4>
<p id="section-9.2.2-1">If the update collection associated with the requester is not empty and the diff query request does not include the 'cursor' query parameter, the AS performs the actions defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>, with the following differences:<a href="#section-9.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.2-2.1">
              <p id="section-9.2.2-2.1.1">At Step 3, the AS considers the value MAX_DIFF_BATCH (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>) and prepares L = min(U, MAX_DIFF_BATCH) diff entries.<a href="#section-9.2.2-2.1.1" class="pilcrow">¶</a></p>
<p id="section-9.2.2-2.1.2">
If U &lt;= MAX_DIFF_BATCH, the prepared diff entries are the last series items in the update collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#section-9.2.2-2.1.2" class="pilcrow">¶</a></p>
<p id="section-9.2.2-2.1.3">
If U &gt; MAX_DIFF_BATCH, the prepared diff entries are the eldest of the last U series items in the update collection associated with the requester, as corresponding to the first L of the U most recent TRL updates pertaining to the requester.<a href="#section-9.2.2-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.2.2-2.2">
              <p id="section-9.2.2-2.2.1">At Step 4, the CBOR map to carry in the payload of the 2.05 (Content) response <span class="bcp14">MUST</span> be formatted as follows:<a href="#section-9.2.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.2-2.2.2.1">
                  <p id="section-9.2.2-2.2.2.1.1">The 'diff_set' parameter <span class="bcp14">MUST</span> be present and <span class="bcp14">MUST</span> encode a CBOR array 'diff_set_value' of L elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared as a diff entry.<a href="#section-9.2.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.2.2-2.2.2.2">
                  <p id="section-9.2.2-2.2.2.2.1">The 'cursor' parameter <span class="bcp14">MUST</span> be present and <span class="bcp14">MUST</span> encode a CBOR unsigned integer. The unsigned integer <span class="bcp14">MUST</span> take the 'index' value of the series item of the update collection included as first diff entry in the 'diff_set_value' CBOR array, which is specified by the 'diff_set' parameter. That is, the 'cursor' parameter takes the 'index' value of the series item in the update collection corresponding to the most recent TRL update pertaining to the requester and returned in this diff query response.<a href="#section-9.2.2-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-9.2.2-2.2.2.2.2">
Note that the 'cursor' parameter takes the same 'index' value of the last series item in the update collection when U &lt;= MAX_DIFF_BATCH.<a href="#section-9.2.2-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.2.2-2.2.2.3">
                  <p id="section-9.2.2-2.2.2.3.1">The 'more' parameter <span class="bcp14">MUST</span> be present.  The parameter <span class="bcp14">MUST</span> encode the CBOR simple value <code>false</code> (0xf4) if U &lt;= MAX_DIFF_BATCH; otherwise, it <span class="bcp14">MUST</span> encode the CBOR simple value <code>true</code> (0xf5).<a href="#section-9.2.2-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
<p id="section-9.2.2-3">If the 'more' parameter in the payload of the received 2.05 (Content) response has a value of <code>true</code>, the requester can send a follow-up diff query request including the 'cursor' query parameter with the same value of the 'cursor' parameter specified in this diff query response. As defined in <a href="#sec-using-cursor-diff-query-response-cursor" class="auto internal xref">Section 9.2.3</a>, this would result in the AS transferring the following subset of series items as diff entries, thus resuming from where interrupted in the previous transfer.<a href="#section-9.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-using-cursor-diff-query-response-cursor">
<section id="section-9.2.3">
          <h4 id="name-cursor-included-in-the-diff">
<a href="#section-9.2.3" class="section-number selfRef">9.2.3. </a><a href="#name-cursor-included-in-the-diff" class="section-name selfRef">Cursor Included in the Diff Query Request</a>
          </h4>
<p id="section-9.2.3-1">If the update collection associated with the requester is not empty and the diff query request includes the 'cursor' query parameter with value P, the AS proceeds as follows, depending on which of the following two cases hold:<a href="#section-9.2.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-9.2.3-2">
            <dt>Case A:</dt>
<dd id="section-9.2.3-2.1">
              <p id="section-9.2.3-2.1.1">The series item X with 'index' having value P and the series item Y with 'index' having value (P + 1) % (MAX_INDEX + 1) are both not found in the update collection associated with the requester. This occurs when the item Y (and possibly further ones after it) has been previously removed from the update collection for that requester (see Step 5 at <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>).<a href="#section-9.2.3-2.1.1" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2.1.2">
In this case, the AS returns a 2.05 (Content) response. The response <span class="bcp14">MUST</span> have Content-Format set to "application/ace-trl+cbor", and its payload <span class="bcp14">MUST</span> be a CBOR map formatted as follows:<a href="#section-9.2.3-2.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.3-2.1.3.1">
                  <p id="section-9.2.3-2.1.3.1.1">The 'diff_set' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the empty CBOR array.<a href="#section-9.2.3-2.1.3.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.2.3-2.1.3.2">
                  <p id="section-9.2.3-2.1.3.2.1">The 'cursor' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the CBOR simple value <code>null</code> (0xf6).<a href="#section-9.2.3-2.1.3.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.2.3-2.1.3.3">
                  <p id="section-9.2.3-2.1.3.3.1">The 'more' parameter <span class="bcp14">MUST</span> be included and <span class="bcp14">MUST</span> encode the CBOR simple value <code>true</code> (0xf5).<a href="#section-9.2.3-2.1.3.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="section-9.2.3-2.1.4">
With the combination ('cursor', 'more') = (<code>null</code>, <code>true</code>), the AS is indicating that the update collection is, in fact, not empty, but that one or more series items have been lost due to their removal. These include the item with 'index' value (P + 1) % (MAX_INDEX + 1) that the requester wished to obtain as the first one following the specified reference point with 'index' value P.<a href="#section-9.2.3-2.1.4" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2.1.5">
When receiving this diff query response, the requester <span class="bcp14">SHOULD</span> send a new full query request to the AS. A successful response provides the requester with the full current pertaining subset of the TRL as well as a valid value of the 'cursor' parameter (see <a href="#sec-using-cursor-full-query-response" class="auto internal xref">Section 9.1</a>) to be, possibly, used as query parameter in a following diff query request.<a href="#section-9.2.3-2.1.5" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt>Case B:</dt>
<dd id="section-9.2.3-2.2">
              <p id="section-9.2.3-2.2.1">The series item X with 'index' having value P is found in the update collection associated with the requester, or instead the series item X is not found and the series item Y with 'index' having value (P + 1) % (MAX_INDEX + 1) is found in the update collection associated with the requester.<a href="#section-9.2.3-2.2.1" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2.2.2">
In this case, the AS performs the actions defined in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a> with the following differences:<a href="#section-9.2.3-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.3-2.2.3.1">
                  <p id="section-9.2.3-2.2.3.1.1">At Step 3, the AS considers the value MAX_DIFF_BATCH (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>) and prepares L = min(SUB_U, MAX_DIFF_BATCH) diff entries, where SUB_U = min(NUM, SUB_SIZE) and SUB_SIZE is the number of series items in the update collection starting from and including the series item added immediately after X. If L is equal to 0 (e.g., because SUB_U is equal to 0), then no diff entries are prepared.<a href="#section-9.2.3-2.2.3.1.1" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2.2.3.1.2">
If SUB_U &lt;= MAX_DIFF_BATCH, the prepared diff entries are the last series items in the update collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#section-9.2.3-2.2.3.1.2" class="pilcrow">¶</a></p>
<p id="section-9.2.3-2.2.3.1.3">
If SUB_U &gt; MAX_DIFF_BATCH, the prepared diff entries are the eldest of the last SUB_U series items in the update collection associated with the requester, corresponding to the first L of the SUB_U most recent TRL updates pertaining to the requester.<a href="#section-9.2.3-2.2.3.1.3" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-9.2.3-2.2.3.2">
                  <p id="section-9.2.3-2.2.3.2.1">At Step 4, the CBOR map to carry in the payload of the 2.05 (Content) response <span class="bcp14">MUST</span> be formatted as follows:<a href="#section-9.2.3-2.2.3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.3-2.2.3.2.2.1">
                      <p id="section-9.2.3-2.2.3.2.2.1.1">The 'diff_set' parameter <span class="bcp14">MUST</span> be present and <span class="bcp14">MUST</span> encode a CBOR array 'diff_set_value' of L elements. Each element of 'diff_set_value' specifies one of the CBOR arrays 'diff_entry' prepared as a diff entry. Note that L might have value 0, in which case 'diff_set_value' is the empty CBOR array.<a href="#section-9.2.3-2.2.3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.2.3-2.2.3.2.2.2">
                      <p id="section-9.2.3-2.2.3.2.2.2.1">The 'cursor' parameter <span class="bcp14">MUST</span> be present and <span class="bcp14">MUST</span> encode a CBOR unsigned integer. In particular:<a href="#section-9.2.3-2.2.3.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.3-2.2.3.2.2.2.2.1">
                          <p id="section-9.2.3-2.2.3.2.2.2.2.1.1">If L is equal to 0, i.e., the series item X is the last one in the update collection, then the 'cursor' parameter <span class="bcp14">MUST</span> take the same 'index' value of the last series item in the update collection. In fact, such a value is the current value of 'last_index' for the update collection.<a href="#section-9.2.3-2.2.3.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                        <li class="normal" id="section-9.2.3-2.2.3.2.2.2.2.2">
                          <p id="section-9.2.3-2.2.3.2.2.2.2.2.1">If L is different than 0, then the 'cursor' parameter <span class="bcp14">MUST</span> take the 'index' value of the series element of the update collection included as first diff entry in the 'diff_set' CBOR array. That is, the 'cursor' parameter takes the 'index' value of the series item in the update collection corresponding to the most recent TRL update pertaining to the requester and returned in this diff query response.<a href="#section-9.2.3-2.2.3.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                      </ul>
<p id="section-9.2.3-2.2.3.2.2.2.3">
Note that the 'cursor' parameter takes the same 'index' value of the last series item in the update collection when SUB_U &lt;= MAX_DIFF_BATCH.<a href="#section-9.2.3-2.2.3.2.2.2.3" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="section-9.2.3-2.2.3.2.2.3">
                      <p id="section-9.2.3-2.2.3.2.2.3.1">The 'more' parameter <span class="bcp14">MUST</span> be present.  The parameter <span class="bcp14">MUST</span> encode the CBOR simple value <code>false</code> (0xf4) if SUB_U &lt;= MAX_DIFF_BATCH; otherwise, it <span class="bcp14">MUST</span> encode the CBOR simple value <code>true</code> (0xf5).<a href="#section-9.2.3-2.2.3.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
<p id="section-9.2.3-2.2.4">
If the 'more' parameter in the payload of the received 2.05 (Content) response has value <code>true</code>, the requester can send a follow-up diff query request including the 'cursor' query parameter with the same value of the 'cursor' parameter specified in this diff query response. This would result in the AS transferring the following subset of series items as diff entries, thus resuming from where interrupted in the previous transfer.<a href="#section-9.2.3-2.2.4" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-registration">
<section id="section-10">
      <h2 id="name-registration-at-the-authori">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-registration-at-the-authori" class="section-name selfRef">Registration at the Authorization Server</a>
      </h2>
<p id="section-10-1">During the registration process at the AS, an administrator or a registered device receives the following information as part of the registration response:<a href="#section-10-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-2.1">
          <p id="section-10-2.1.1">The url-path to the TRL endpoint at the AS.<a href="#section-10-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-2.2">
          <p id="section-10-2.2.1">The hash function used to compute token hashes. This is specified by identifying an entry in the "Named Information Hash Algorithm Registry" <span>[<a href="#IANA.Hash.Algorithms" class="cite xref">IANA.Hash.Algorithms</a>]</span>. The specific means for this is outside the scope of this document.<a href="#section-10-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-2.3">
          <p id="section-10-2.3.1">A positive integer MAX_N, if the AS supports diff queries of the TRL (see Sections <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">6.2</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">8</a>).<a href="#section-10-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-10-2.4">
          <p id="section-10-2.4.1">A positive integer MAX_DIFF_BATCH, if the AS supports diff queries of the TRL as well as the related "Cursor" extension (see Sections <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">6.2.1</a> and <a href="#sec-using-cursor" class="auto internal xref">9</a>).<a href="#section-10-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-10-3">Once the registration process is completed, the AS maintains the registration and related information until a possible deregistration occurs, hence keeping track of active administrators and registered devices. The particular way to achieve this is implementation specific. In any case, such a mechanism to maintain registrations is enforced at the AS in order to ensure that requests sent by clients to the /token endpoint (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) and by RSs to the /introspect endpoint (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) are processed as intended.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">When communicating with one another, the registered devices and the AS have to use a secure communication association and be mutually authenticated (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">In the same spirit, communications between the AS and an administrator <span class="bcp14">MUST</span> be ensured to be mutually authenticated, encrypted, and integrity protected as well as protected against message replay.<a href="#section-10-5" class="pilcrow">¶</a></p>
<p id="section-10-6">Before starting its registration process at the AS, an administrator has to establish such a secure communication association with the AS, if they do not share one already. In particular, mutual authentication is <span class="bcp14">REQUIRED</span> during the establishment of the secure association. To this end, the administrator and the AS can rely, e.g., on establishing a TLS or DTLS secure session with mutual authentication (see <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> and <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span>) or an Object Security for Constrained RESTful Environments (OSCORE) Security Context <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> by running the authenticated key exchange protocol EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-10-6" class="pilcrow">¶</a></p>
<p id="section-10-7">When receiving authenticated requests from the administrator for accessing the TRL endpoint, the AS can always check whether the requester is authorized to take such a role, i.e., to access the content of the whole TRL.<a href="#section-10-7" class="pilcrow">¶</a></p>
<p id="section-10-8">To this end, the AS may rely on a local access control list or similar, which specifies the authentication credentials of trusted, authorized administrators. In particular, the AS verifies the requester to the TRL endpoint as an authorized administrator only if the access control list includes the same authentication credential used by the requester when establishing the mutually authenticated secure communication association with the AS.<a href="#section-10-8" class="pilcrow">¶</a></p>
<p id="section-10-9">Further details about the registration process at the AS are out of scope for this specification. Note that the registration process is also out of the scope of the ACE framework (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.5" class="relref">Section 5.5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-10-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-notification">
<section id="section-11">
      <h2 id="name-notification-of-revoked-acc">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-notification-of-revoked-acc" class="section-name selfRef">Notification of Revoked Access Tokens</a>
      </h2>
<p id="section-11-1">Once registered at the AS, the administrator or a registered device can send a GET request to the TRL endpoint at the AS. The request can express the wish for a full query (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>) of the TRL. Also, the request can include the CoAP Observe Option set to 0 (register) in order to start an observation of the TRL endpoint as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">In case the request is successfully processed, the AS replies with a  2.05 (Content) response. In particular, if the AS supports diff queries but not the "Cursor" extension (see Sections <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">6.2</a> and <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">6.2.1</a>), then the payload of the response is formatted as defined in Sections <a href="#ssec-trl-full-query" class="auto internal xref">7</a> or <a href="#ssec-trl-diff-query" class="auto internal xref">8</a>, in case the GET request has yielded the execution of a full query or of a diff query of the TRL, respectively. Instead, if the AS supports both diff queries and the related "Cursor" extension, then the payload of the response is formatted as defined in <a href="#sec-using-cursor" class="auto internal xref">Section 9</a>.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">In case a requester does not receive a response from the TRL endpoint or it receives an error response from the TRL endpoint, the requester does not make any assumptions or draw any conclusions regarding the revocation or expiration of its pertaining access tokens. The requester <span class="bcp14">MAY</span> try again by sending a new request to the TRL endpoint.<a href="#section-11-3" class="pilcrow">¶</a></p>
<p id="section-11-4">When the TRL is updated (see <a href="#ssec-trl-update" class="auto internal xref">Section 5.1</a>), the AS sends Observe notifications to the observers whose pertaining subset of the TRL has changed. Observe notifications are sent as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>. If supported by the AS, an observer may configure the behavior according to which the AS sends those Observe notifications. To this end, a possible way relies on the conditional control parameter "c.pmax" defined in <span>[<a href="#I-D.ietf-core-conditional-attributes" class="cite xref">COND-PARAMETERS</a>]</span>, which can be included as a "name=value" query parameter in an Observation Request. This ensures that no more than c.pmax seconds elapse between two consecutive notifications sent to that observer, regardless of whether or not the TRL has changed.<a href="#section-11-4" class="pilcrow">¶</a></p>
<p id="section-11-5">Following a first exchange with the AS, an administrator or a registered device can send additional GET requests to the TRL endpoint at any time, analogously to what is defined above. When doing so, the requester towards the TRL endpoint can ask the AS to perform a full query (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>) of the TRL. In the latter case, the requester can additionally rely on the "Cursor" extension (see Sections <a href="#sec-trl-endpoint-query-parameters" class="auto internal xref">6.3</a> and <a href="#sec-using-cursor-diff-query-response" class="auto internal xref">9.2</a>).<a href="#section-11-5" class="pilcrow">¶</a></p>
<p id="section-11-6">As specified in <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>, an AS supporting diff queries maintains an update collection of maximum MAX_N series items for each administrator or registered device, hereafter referred to as a "requester". In particular, if an update collection includes MAX_N series items, adding a further series item to that update collection results in deleting the oldest series item from that update collection.<a href="#section-11-6" class="pilcrow">¶</a></p>
<p id="section-11-7">From then on, the requester associated with the update collection will not be able to retrieve the deleted series item when sending a new diff query request to the TRL endpoint. If that series item reflected the revocation of an access token pertaining to the requester, then the requester will not learn about that when receiving the corresponding diff query response from the AS.<a href="#section-11-7" class="pilcrow">¶</a></p>
<p id="section-11-8">Sending a diff query request specifically as an Observation Request, and, thus, relying on Observe notifications, largely reduces the chances for a requester to miss updates that have occurred to its associated update collection. In turn, this relies on the requester successfully receiving the Observe notification responses from the TRL (see also <a href="#sec-security-considerations-comm-patterns" class="auto internal xref">Section 14.3</a>).<a href="#section-11-8" class="pilcrow">¶</a></p>
<p id="section-11-9">In order to limit the amount of time during which the requester is unaware of pertaining access tokens that have been revoked but are not expired yet, a requester <span class="bcp14">SHOULD NOT</span> rely solely on diff query requests. In particular, a requester <span class="bcp14">SHOULD</span> also regularly send a full query request to the TRL endpoint according to a related application policy.<a href="#section-11-9" class="pilcrow">¶</a></p>
<div id="sec-handling-token-hashes">
<section id="section-11.1">
        <h3 id="name-handling-of-revoked-access-">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-handling-of-revoked-access-" class="section-name selfRef">Handling of Revoked Access Tokens and Token Hashes</a>
        </h3>
<p id="section-11.1-1">When receiving a response from the TRL endpoint, a registered device <span class="bcp14">MUST</span> expunge every stored access token associated with a token hash specified in the response. In case the registered device is an RS, it <span class="bcp14">MUST NOT</span> delete the stored token hash after having expunged the associated access token.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">If an RS uses the method defined in this document with the AS that has issued an access token, then the RS <span class="bcp14">MUST NOT</span> accept and store that access token if any of the following holds.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-3.1">
            <p id="section-11.1-3.1.1">The token hash corresponding to the access token is among the currently stored ones.<a href="#section-11.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-3.2">
            <p id="section-11.1-3.2.1">The access token is a CWT and any of the following holds:<a href="#section-11.1-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-3.2.2.1">
                <p id="section-11.1-3.2.2.1.1">The access token includes a non-empty "unprotected" field, i.e., the value of the field is not encoded as the empty CBOR map (0xa0). This applies to the top-level "unprotected" field of the COSE object used for the CWT, the "unprotected" field of each element of the "signatures" array, and the "unprotected" field of each element of any "recipients" array.<a href="#section-11.1-3.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.1-3.2.2.2">
                <p id="section-11.1-3.2.2.2.1">The received CBOR data item that embodies the access token does not comply with what is defined in <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>. This concerns:<a href="#section-11.1-3.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-3.2.2.2.2.1">the use of exactly two nested CBOR tags, where the outer tag is the CWT CBOR tag and the inner tag is one of the COSE CBOR tags;<a href="#section-11.1-3.2.2.2.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-11.1-3.2.2.2.2.2">the tag numbers encoded with the minimum possible length; and<a href="#section-11.1-3.2.2.2.2.2" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-11.1-3.2.2.2.2.3">the access token being the innermost tag content of the received CBOR data item.<a href="#section-11.1-3.2.2.2.2.3" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li class="normal" id="section-11.1-3.2.2.3">
                <p id="section-11.1-3.2.2.3.1">In the received CBOR data item that embodies the access token, the inner tag has a tag number that is not consistent with the actual COSE data item to process. For instance, the inner tag number is 16 (COSE_Encrypt0) but the CWT is actually a COSE_Sign data item.<a href="#section-11.1-3.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-11.1-3.3">
            <p id="section-11.1-3.3.1">The access token relies on a JSON object for encoding its claims, but it is not a JWT <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span> and any of the following holds:<a href="#section-11.1-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-3.3.2.1">
                <p id="section-11.1-3.3.2.1.1">The access token uses the JWS JSON Serialization from <span>[<a href="#RFC7515" class="cite xref">RFC7515</a>]</span> and includes the JWS Unprotected Header.<a href="#section-11.1-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.1-3.3.2.2">
                <p id="section-11.1-3.3.2.2.1">The access token uses the JWE JSON Serialization from <span>[<a href="#RFC7516" class="cite xref">RFC7516</a>]</span> and includes the JWE Shared Unprotected Header and/or includes the "header" member in any of the elements of the "recipients" array.<a href="#section-11.1-3.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-11.1-4">An RS <span class="bcp14">MUST</span> store the token hash th1 corresponding to an access token t1 until both the following conditions hold:<a href="#section-11.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-5.1">
            <p id="section-11.1-5.1.1">The RS has received and seen t1, irrespective of having accepted and stored it.<a href="#section-11.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-11.1-5.2">
            <p id="section-11.1-5.2.1">The RS has gained knowledge that t1 has expired. This can be achieved, e.g., through the following means:<a href="#section-11.1-5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-5.2.2.1">
                <p id="section-11.1-5.2.2.1.1">A response from the TRL endpoint indicating that t1 has expired after its earlier revocation, i.e., the token hash th1 has been removed from the TRL. This can be indicated, for instance, in a response from the TRL endpoint following a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>).<a href="#section-11.1-5.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.1-5.2.2.2">
                <p id="section-11.1-5.2.2.2.1">The value of the 'exp' claim specified in t1 indicates that t1 has expired.<a href="#section-11.1-5.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.1-5.2.2.3">
                <p id="section-11.1-5.2.2.3.1">The locally determined expiration time for t1 has passed, based on the time at the RS when t1 was first accepted and on the value of its 'exi' claim.<a href="#section-11.1-5.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-11.1-5.2.2.4">
                <p id="section-11.1-5.2.2.4.1">The result of token introspection performed on t1 (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), if supported by both the RS and the AS.<a href="#section-11.1-5.2.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-11.1-6">The RS <span class="bcp14">MUST NOT</span> delete the stored token hashes whose corresponding access tokens do not fulfill both the two conditions above, unless it becomes necessary due to memory limitations. In such a case, the RS <span class="bcp14">MUST</span> delete the earliest stored token hashes first.<a href="#section-11.1-6" class="pilcrow">¶</a></p>
<p id="section-11.1-7">Retaining the stored token hashes as specified above limits the impact from a (dishonest) client whose pertaining access token:<a href="#section-11.1-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-11.1-8">
   <li id="section-11.1-8.1">includes the 'exi' claim,<a href="#section-11.1-8.1" class="pilcrow">¶</a>
</li>
          <li id="section-11.1-8.2">is uploaded at the RS for the first time after it has been revoked and later expired, and<a href="#section-11.1-8.2" class="pilcrow">¶</a>
</li>
          <li id="section-11.1-8.3">has the sequence number encoded in the 'cti' claim (for CWTs) or in the 'jti' claim (for JWTs) greater than the highest sequence number among the expired access tokens including the 'exi' claim for the RS (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>).<a href="#section-11.1-8.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-11.1-9">That is, the RS would not accept such a revoked and expired access token as long as it stores the corresponding token hash.<a href="#section-11.1-9" class="pilcrow">¶</a></p>
<p id="section-11.1-10">This risk can be further limited.  Specifically, if token
introspection is implemented by both the RS and the AS, the RS can
introspect the access token (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) when
receiving an access token that includes the 'exi' claim and for which
a corresponding token hash is not stored.<a href="#section-11.1-10" class="pilcrow">¶</a></p>
<p id="section-11.1-11">When, due to the stored and corresponding token hash th2, an access token t2 that includes the 'exi' claim is expunged or is not accepted upon its upload, the RS retrieves the sequence number sn2 encoded in the 'cti' claim (for CWTs) or in the 'jti' claim (for JWTs) (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). Then, the RS stores sn2 as associated with th2. If expunging or not accepting t2 yields the deletion of th2, then the RS <span class="bcp14">MUST</span> associate sn2 with th2 before continuing with the deletion of th2.<a href="#section-11.1-11" class="pilcrow">¶</a></p>
<p id="section-11.1-12">When deleting any token hash, the RS checks whether the token hash is associated with a sequence number sn_th. In such a case, the RS checks whether sn_th is greater than the highest sequence number sn* among the expired access tokens including the 'exi' claim for the RS. If that is the case, sn* <span class="bcp14">MUST</span> take the value of sn_th.<a href="#section-11.1-12" class="pilcrow">¶</a></p>
<p id="section-11.1-13">By virtue of what is defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.10.3" class="relref">Section 5.10.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, this ensures that, following the deletion of the token hash associated with an access token including the 'exi' claim and uploaded for the first time after it has been revoked and later expired, the RS will not accept the access token at that point in time or in the future.<a href="#section-11.1-13" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="trl-registry-parameters">
<section id="section-12">
      <h2 id="name-ace-token-revocation-list-p">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-ace-token-revocation-list-p" class="section-name selfRef">ACE Token Revocation List Parameters</a>
      </h2>
<p id="section-12-1">This specification defines a number of parameters that can be transported in the response from the TRL endpoint, when the response payload is a CBOR map. Note that such a response <span class="bcp14">MUST</span> use the Content-Format "application/ace-trl+cbor" defined in <a href="#iana-content-type" class="auto internal xref">Section 15.2</a> of this specification.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">The table below summarizes the parameters. For each of them, it specifies the value to use as CBOR key, i.e., as abbreviation in the key of the map pair for the parameter, instead of the parameter's name as a text string.<a href="#section-12-2" class="pilcrow">¶</a></p>
<span id="name-cbor-abbreviations-for-the-"></span><div id="_table-cbor-trl-params">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-cbor-abbreviations-for-the-" class="selfRef">CBOR Abbreviations for the ACE Token Revocation List Parameters</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">CBOR Key</th>
            <th class="text-left" rowspan="1" colspan="1">CBOR Type</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">full_set</td>
            <td class="text-left" rowspan="1" colspan="1">0</td>
            <td class="text-left" rowspan="1" colspan="1">array</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">diff_set</td>
            <td class="text-left" rowspan="1" colspan="1">1</td>
            <td class="text-left" rowspan="1" colspan="1">array</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">cursor</td>
            <td class="text-left" rowspan="1" colspan="1">2</td>
            <td class="text-left" rowspan="1" colspan="1">Null or unsigned integer</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">more</td>
            <td class="text-left" rowspan="1" colspan="1">3</td>
            <td class="text-left" rowspan="1" colspan="1">True or False</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="error-types">
<section id="section-13">
      <h2 id="name-ace-token-revocation-list-e">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-ace-token-revocation-list-e" class="section-name selfRef">ACE Token Revocation List Error Identifiers</a>
      </h2>
<p id="section-13-1">This specification defines a number of values that the AS can use as error identifiers. These are used in error responses with Content-Format "application/concise-problem-details+cbor", as values of the 'error-id' field within the Custom Problem Detail entry 'ace-trl-error' (see <a href="#sec-error-responses" class="auto internal xref">Section 6.1</a>).<a href="#section-13-1" class="pilcrow">¶</a></p>
<span id="name-ace-token-revocation-list-er"></span><div id="_table-ACE-TRL-Error">
<table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-ace-token-revocation-list-er" class="selfRef">ACE Token Revocation List Error Identifiers</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0</td>
            <td class="text-left" rowspan="1" colspan="1">Invalid parameter value</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">1</td>
            <td class="text-left" rowspan="1" colspan="1">Invalid set of parameters</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">2</td>
            <td class="text-left" rowspan="1" colspan="1">Out of bound cursor value</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-14">
      <h2 id="name-security-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-14-1">The protocol defined in this document inherits the security considerations from the ACE framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and those about the usage of CWTs from <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>, the usage of JWTs from <span>[<a href="#RFC7519" class="cite xref">RFC7519</a>]</span> and <span>[<a href="#RFC8725" class="cite xref">RFC8725</a>]</span>, the usage of CoAP Observe from <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, and the computation of the token hashes from <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>. The following considerations also apply.<a href="#section-14-1" class="pilcrow">¶</a></p>
<div id="content-retrieval-from-the-trl">
<section id="section-14.1">
        <h3 id="name-content-retrieval-from-the-">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-content-retrieval-from-the-" class="section-name selfRef">Content Retrieval from the TRL</a>
        </h3>
<p id="section-14.1-1">The AS <span class="bcp14">MUST</span> ensure that each registered device can access and retrieve only its pertaining subset of the TRL. To this end, the AS can always perform the required filtering based on the authenticated identity of the registered device, i.e., a (non-public) identifier that the AS can securely relate to the registered device and the secure association that they use to communicate.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<p id="section-14.1-2">The AS <span class="bcp14">MUST</span> ensure that, other than registered devices accessing their own pertaining subset of the TRL, only authorized and authenticated administrators can access the content of the whole TRL (see <a href="#sec-registration" class="auto internal xref">Section 10</a>).<a href="#section-14.1-2" class="pilcrow">¶</a></p>
<p id="section-14.1-3">Note that the TRL endpoint supports only the GET method (see <a href="#sec-trl-endpoint" class="auto internal xref">Section 6</a>). Therefore, as detailed in Sections <a href="#ssec-trl-full-query" class="auto internal xref">7</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">8</a>, access to the TRL endpoint is performed only by means of protected and authenticated GET requests, which, by definition, are safe in the REST sense and do not alter the content of the TRL. That is, registered devices and administrators can perform exclusively read-only operations when accessing the TRL endpoint.<a href="#section-14.1-3" class="pilcrow">¶</a></p>
<p id="section-14.1-4">In fact, the content of the TRL can be updated only internally by the AS, in the two circumstances described in <a href="#ssec-trl-update" class="auto internal xref">Section 5.1</a>.  Therefore, an adversary that is not in control of the AS cannot manipulate the content of the TRL, e.g., by removing a token hash and thereby fraudulently allowing a client to access protected resources in spite of a revoked access token or by adding a token hash and thereby fraudulently stopping a client from accessing protected resources in spite of an access token being still valid.<a href="#section-14.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="size-of-the-trl">
<section id="section-14.2">
        <h3 id="name-size-of-the-trl">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-size-of-the-trl" class="section-name selfRef">Size of the TRL</a>
        </h3>
<p id="section-14.2-1">If many non-expired access tokens associated with a registered device are revoked, the pertaining subset of the TRL could grow to a size bigger than what the registered device is prepared to handle upon reception of a response from the TRL endpoint, especially if relying on a full query of the TRL (see <a href="#ssec-trl-full-query" class="auto internal xref">Section 7</a>).<a href="#section-14.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2-2">This could be exploited by attackers to negatively affect the behavior of a registered device. Therefore, in order to help reduce the size of the TRL, the AS <span class="bcp14">SHOULD</span> refrain from issuing access tokens with an excessively long expiration time.<a href="#section-14.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-security-considerations-comm-patterns">
<section id="section-14.3">
        <h3 id="name-communication-patterns">
<a href="#section-14.3" class="section-number selfRef">14.3. </a><a href="#name-communication-patterns" class="section-name selfRef">Communication Patterns</a>
        </h3>
<p id="section-14.3-1">The communication about revoked access tokens presented in this specification is expected to especially rely on CoAP Observe notifications sent from the AS to a requester (i.e., an administrator or a registered device). The suppression of those notifications by an external attacker that has access to the network would prevent requesters from ever knowing that their pertaining access tokens have been revoked.<a href="#section-14.3-1" class="pilcrow">¶</a></p>
<p id="section-14.3-2">In order to avoid this, a requester <span class="bcp14">SHOULD NOT</span> rely solely on the CoAP Observe notifications. In particular, a requester <span class="bcp14">SHOULD</span> also regularly poll the AS for the most current information about revoked access tokens by sending GET requests to the TRL endpoint. Specific strategies and schedules for polling the AS are to be defined by a related application policy and by taking into account the expected operational and availability patterns adopted by the requester (e.g., in the interest of energy saving and other optimizations).<a href="#section-14.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-of-new-access-tokens">
<section id="section-14.4">
        <h3 id="name-request-of-new-access-token">
<a href="#section-14.4" class="section-number selfRef">14.4. </a><a href="#name-request-of-new-access-token" class="section-name selfRef">Request of New Access Tokens</a>
        </h3>
<p id="section-14.4-1">If a client stores an access token that it still believes to be valid, and it accordingly attempts to access a protected resource at the RS, the client may receive an unprotected 4.01 (Unauthorized) response from the RS.<a href="#section-14.4-1" class="pilcrow">¶</a></p>
<p id="section-14.4-2">This can be due to a number of causes, for example:<a href="#section-14.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.4-3.1">the access token has been revoked, the RS has become aware of it, and the RS has expunged the access token, but the client is not aware of this (yet).<a href="#section-14.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-14.4-3.2">the access token is still valid, but an on-path active adversary might have injected a forged 4.01 (Unauthorized) response or the RS might have deleted the access token from its local storage due to its dedicated storage space being all consumed.<a href="#section-14.4-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-14.4-4">In either case, if the client believes that the access token is still valid, it <span class="bcp14">SHOULD NOT</span> immediately ask for a new access token to the AS upon receiving a 4.01 (Unauthorized) response from the RS. Instead, the client <span class="bcp14">SHOULD</span> send a request to the TRL endpoint at the AS. If the client gains knowledge that the access token is not valid anymore, the client expunges the access token and can ask for a new one. Otherwise, the client can try again to upload the same access token to the RS or request a new one.<a href="#section-14.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="vulnerable-time-window-at-the-rs">
<section id="section-14.5">
        <h3 id="name-vulnerable-time-window-at-t">
<a href="#section-14.5" class="section-number selfRef">14.5. </a><a href="#name-vulnerable-time-window-at-t" class="section-name selfRef">Vulnerable Time Window at the RS</a>
        </h3>
<p id="section-14.5-1">A client may attempt to access a protected resource at an RS after the access token allowing such an access has been revoked but before the RS is aware of the revocation.<a href="#section-14.5-1" class="pilcrow">¶</a></p>
<p id="section-14.5-2">In such a case, if the RS is still storing the access token, the client will be able to access the protected resource even though it should not. Such access is a security violation, even if the client is not attempting to be malicious.<a href="#section-14.5-2" class="pilcrow">¶</a></p>
<p id="section-14.5-3">In order to minimize such a risk, if an RS relies solely on polling through individual requests to the TRL endpoint to learn of revoked access tokens, the RS <span class="bcp14">SHOULD</span> implement an adequate trade-off between the polling frequency and the maximum length of the vulnerable time window.<a href="#section-14.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-seccons-token-manipulation">
<section id="section-14.6">
        <h3 id="name-preventing-unnoticed-manipu">
<a href="#section-14.6" class="section-number selfRef">14.6. </a><a href="#name-preventing-unnoticed-manipu" class="section-name selfRef">Preventing Unnoticed Manipulation of Access Tokens</a>
        </h3>
<p id="section-14.6-1">As defined in <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a>, issued access tokens <span class="bcp14">MUST NOT</span> rely on unprotected headers to specify information as header parameters. Also, when issued access tokens are CWTs, they <span class="bcp14">MUST</span> be tagged by using the COSE CBOR tag corresponding to the used COSE object.  Further, the result <span class="bcp14">MUST</span> be tagged using the CWT CBOR tag; no further tagging is performed.<a href="#section-14.6-1" class="pilcrow">¶</a></p>
<p id="section-14.6-2">This ensures that the RS always computes the correct token hash corresponding to an access token, i.e., the same token hash computed by the AS and C for that access token.<a href="#section-14.6-2" class="pilcrow">¶</a></p>
<p id="section-14.6-3">By construction, the rules defined in <a href="#sec-issuing-access-tokens-as" class="auto internal xref">Section 3</a> prevent an active adversary from successfully performing an attack against the RS, which would otherwise be possible in case the access token is uploaded to the RS over an unprotected communication channel.<a href="#section-14.6-3" class="pilcrow">¶</a></p>
<p id="section-14.6-4">In such an attack, the adversary intercepts the access token en route to the RS. Then, the adversary manipulates the access token in a way that is going to be unnoticed by the RS but without preventing the successful cryptographic validation of the access token at the RS. To this end, the adversary has two possible options:<a href="#section-14.6-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.6-5.1">
            <p id="section-14.6-5.1.1">Adding and/or removing fields within the unprotected header(s) of the access token, as long as those fields do not play a role in the cryptographic validation of the access token.<a href="#section-14.6-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.6-5.2">
            <p id="section-14.6-5.2.1">Specifically when the access token is a CWT, adding, removing, or manipulating possible CBOR tags enclosing the access token.<a href="#section-14.6-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-14.6-6">After that, the adversary sends the manipulated access token to the RS.<a href="#section-14.6-6" class="pilcrow">¶</a></p>
<p id="section-14.6-7">After having successfully validated the manipulated access token, the RS computes a corresponding token hash different from the one computed and stored by C and the AS. Finally, the RS stores the manipulated access token and the corresponding wrong token hash.<a href="#section-14.6-7" class="pilcrow">¶</a></p>
<p id="section-14.6-8">Later on, if the access token is revoked and the AS provides the RS with the corresponding correct token hash, the RS does not recognize the received token hash among the stored ones; therefore, the RS does not delete the revoked access token.<a href="#section-14.6-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-seccons-two-hashes-jwt">
<section id="section-14.7">
        <h3 id="name-two-token-hashes-at-the-rs-">
<a href="#section-14.7" class="section-number selfRef">14.7. </a><a href="#name-two-token-hashes-at-the-rs-" class="section-name selfRef">Two Token Hashes at the RS Using JWTs</a>
        </h3>
<p id="section-14.7-1"><a href="#sec-token-hash-input-rs-jwt" class="auto internal xref">Section 4.3.2</a> specifies that an RS using JWTs as access tokens has to compute and store two token hashes associated with the same access token. This is because the RS does not know for sure if the AS provided the access token to the client by means of an AS-to-Client response encoded in CBOR or in JSON.<a href="#section-14.7-1" class="pilcrow">¶</a></p>
<p id="section-14.7-2">Taking advantage of that, a dishonest client can attempt to perform an attack against the RS. That is, the client can first receive the JWT in an AS-to-Client response encoded in CBOR (JSON). Then, the client can upload the JWT to the RS in a way that makes the RS believe that the client instead received the JWT in an AS-to-Client response encoded in JSON (CBOR).<a href="#section-14.7-2" class="pilcrow">¶</a></p>
<p id="section-14.7-3">Consequently, the RS considers a HASH_INPUT different from the one considered by the AS and the client (see <a href="#sec-token-hash-input-c-as" class="auto internal xref">Section 4.2</a>). Hence, the RS computes a token hash h' different from the token hash h computed by the AS and the client. It follows that, if the AS revokes the access token and advertises the right token hash h, then the RS will not learn about the access token revocation; therefore, the RS will not delete the access token.<a href="#section-14.7-3" class="pilcrow">¶</a></p>
<p id="section-14.7-4">Fundamentally, this would happen because the HASH_INPUT used to compute the token hash of a JWT depends on whether the AS-to-Client response is encoded in CBOR or in JSON. This makes the RS vulnerable to the attack described above when JWTs are used as access tokens. However, this is not a problem if the access token is a CWT, since the HASH_INPUT used to compute the token hash of a CWT does not depend on whether the AS-to-Client response is encoded in CBOR or in JSON.<a href="#section-14.7-4" class="pilcrow">¶</a></p>
<p id="section-14.7-5">While this asymmetry cannot be avoided altogether, the method defined for the AS and the client in <a href="#sec-token-hash-input-c-as" class="auto internal xref">Section 4.2</a> deliberately penalizes the case where the RS uses JWTs as access tokens. In such a case, the RS effectively neutralizes the attack described above by computing and storing two token hashes associated with the same access token (see <a href="#sec-token-hash-input-rs-jwt" class="auto internal xref">Section 4.3.2</a>).<a href="#section-14.7-5" class="pilcrow">¶</a></p>
<p id="section-14.7-6">Conversely, this design deliberately favors the case where the RS uses CWTs as access tokens, which is a preferable option for resource-constrained RSs as well as the default case in the ACE framework (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-3" class="relref">Section 3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). That is, if an RS uses CWTs as access tokens, then the RS is not exposed to the attack described above; therefore, the RS safely computes and stores only one token hash per access token (see <a href="#sec-token-hash-input-rs-cwt" class="auto internal xref">Section 4.3.1</a>).<a href="#section-14.7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="additional-security-measures">
<section id="section-14.8">
        <h3 id="name-additional-security-measure">
<a href="#section-14.8" class="section-number selfRef">14.8. </a><a href="#name-additional-security-measure" class="section-name selfRef">Additional Security Measures</a>
        </h3>
<p id="section-14.8-1">By accessing the TRL at the AS, registered devices and administrators are able to learn that their pertaining access tokens have been revoked. However, they cannot learn the reason why, including when that reason is the compromise, misbehavior, or decommissioning of a registered device.<a href="#section-14.8-1" class="pilcrow">¶</a></p>
<p id="section-14.8-2">In fact, even the AS might not know that a registered device to which a revoked access token pertains has been specifically compromised, misbehaving, or decommissioned. At the same time, it might not be acceptable to only revoke the access tokens pertaining to such a registered device.<a href="#section-14.8-2" class="pilcrow">¶</a></p>
<p id="section-14.8-3">Therefore, in order to preserve the security of the system and application, the entity that authoritatively declares a registered device to be compromised, misbehaving, or decommissioned should also promptly trigger the execution of additional revocation processes as deemed appropriate. These include, for instance:<a href="#section-14.8-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.8-4.1">
            <p id="section-14.8-4.1.1">The deregistration of the registered device from the AS so that the AS does not issue further access tokens pertaining to that device.<a href="#section-14.8-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-14.8-4.2">
            <p id="section-14.8-4.2.1">If applicable, the revocation of the public authentication credential associated with the registered device (e.g., its public key certificate).<a href="#section-14.8-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-14.8-5">The methods by which these processes are triggered and carried out are out of the scope of this document.<a href="#section-14.8-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-15">
      <h2 id="name-iana-considerations">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-15-1">The IANA actions for this document are described in the following subsections.<a href="#section-15-1" class="pilcrow">¶</a></p>
<div id="iana-media-type">
<section id="section-15.1">
        <h3 id="name-media-type-registrations">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-media-type-registrations" class="section-name selfRef">Media Type Registrations</a>
        </h3>
<p id="section-15.1-1">IANA has registered the media type "application/ace-trl+cbor" for messages of the protocol defined in this document encoded in CBOR. This registration follows the procedures specified in <span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>.<a href="#section-15.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-15.1-2">
          <dt id="section-15.1-2.1">Type name:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.2">application<a href="#section-15.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.3">Subtype name:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.4">ace-trl+cbor<a href="#section-15.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.5">Required parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.6">N/A<a href="#section-15.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.7">Optional parameters:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.8">N/A<a href="#section-15.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.9">Encoding considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.10">Must be encoded as a CBOR map
          containing the protocol parameters defined in RFC 9770.<a href="#section-15.1-2.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.11">Security considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.12">See <a href="#sec-security-considerations" class="auto internal xref">Section 14</a> of RFC 9770.<a href="#section-15.1-2.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.13">Interoperability considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.14">N/A<a href="#section-15.1-2.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.15">Published specification:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.16">RFC 9770<a href="#section-15.1-2.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.17">Applications that use this media type:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.18">The type is used
          by authorization servers, clients, and RSs that support
          the notification of revoked access tokens according to a Token
          Revocation List maintained by the authorization server as specified
          in RFC 9770.<a href="#section-15.1-2.18" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.19">Fragment identifier considerations:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.20">N/A<a href="#section-15.1-2.20" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.21">Additional information:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.22">N/A<a href="#section-15.1-2.22" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.23">Person &amp; email address to contact for further
          information:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.24">ACE WG mailing list (ace@ietf.org) or IETF
          Applications and Real-Time Area (art@ietf.org)<a href="#section-15.1-2.24" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.25">Intended usage:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.26">COMMON<a href="#section-15.1-2.26" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.27">Restrictions on usage:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.28">None<a href="#section-15.1-2.28" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.1-2.29">Author/Change controller:</dt>
          <dd style="margin-left: 1.5em" id="section-15.1-2.30">IETF<a href="#section-15.1-2.30" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-content-type">
<section id="section-15.2">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-15.2-1">IANA has registered the following entry to the "CoAP Content-Formats" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-15.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-15.2-2">
          <dt id="section-15.2-2.1">Content Type:</dt>
          <dd style="margin-left: 1.5em" id="section-15.2-2.2">application/ace-trl+cbor<a href="#section-15.2-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.2-2.3">Content Coding:</dt>
          <dd style="margin-left: 1.5em" id="section-15.2-2.4">-<a href="#section-15.2-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.2-2.5">ID:</dt>
          <dd style="margin-left: 1.5em" id="section-15.2-2.6">262<a href="#section-15.2-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.2-2.7">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-15.2-2.8">RFC 9770<a href="#section-15.2-2.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-custom-problem-details">
<section id="section-15.3">
        <h3 id="name-custom-problem-detail-keys-">
<a href="#section-15.3" class="section-number selfRef">15.3. </a><a href="#name-custom-problem-detail-keys-" class="section-name selfRef">Custom Problem Detail Keys Registry</a>
        </h3>
<p id="section-15.3-1">IANA has registered the following entry in the "Custom Problem Detail Keys" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-15.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-15.3-2">
          <dt id="section-15.3-2.1">Key Value:</dt>
          <dd style="margin-left: 1.5em" id="section-15.3-2.2">1<a href="#section-15.3-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-2.3">Name:</dt>
          <dd style="margin-left: 1.5em" id="section-15.3-2.4">ace-trl-error<a href="#section-15.3-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-2.5">Brief Description:</dt>
          <dd style="margin-left: 1.5em" id="section-15.3-2.6">Carry RFC 9770 problem details in a Concise Problem Details data item.<a href="#section-15.3-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-2.7">Change Controller:</dt>
          <dd style="margin-left: 1.5em" id="section-15.3-2.8">IETF<a href="#section-15.3-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-15.3-2.9">Reference:</dt>
          <dd style="margin-left: 1.5em" id="section-15.3-2.10">
            <a href="#sec-error-responses" class="auto internal xref">Section 6.1</a> of RFC 9770<a href="#section-15.3-2.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-token-revocation-list">
<section id="section-15.4">
        <h3 id="name-ace-token-revocation-list-pa">
<a href="#section-15.4" class="section-number selfRef">15.4. </a><a href="#name-ace-token-revocation-list-pa" class="section-name selfRef">ACE Token Revocation List Parameters Registry</a>
        </h3>
<p id="section-15.4-1">IANA has established the "ACE Token Revocation List Parameters"  registry within the "Authentication and Authorization for Constrained Environments (ACE)" registry group.<a href="#section-15.4-1" class="pilcrow">¶</a></p>
<p id="section-15.4-2">One of the following registration policies is used: "Standards Action With Expert Review", "Specification Required" per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.6" class="relref">Section 4.6</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>, or "Expert Review" per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Expert Review guidelines are provided in <a href="#review" class="auto internal xref">Section 15.6</a>.<a href="#section-15.4-2" class="pilcrow">¶</a></p>
<p id="section-15.4-3">All assignments according to "Standards Action With Expert Review" are made on a "Standards Action" basis per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.9" class="relref">Section 4.9</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> with Expert Review additionally required per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. The procedure for early IANA allocation of Standards Track code points defined in <span>[<a href="#RFC7120" class="cite xref">RFC7120</a>]</span> also applies. When such a procedure is used, IANA will ask the designated expert(s) to approve the early allocation before registration. In addition, WG chairs are encouraged to consult the expert(s) early during the process outlined in <span><a href="https://rfc-editor.org/rfc/rfc7120#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7120" class="cite xref">RFC7120</a>]</span>.<a href="#section-15.4-3" class="pilcrow">¶</a></p>
<p id="section-15.4-4">The columns of this registry are as follows:<a href="#section-15.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-15.4-5.1">Name: This field contains a descriptive name that
          enables easier reference to the item. The name <span class="bcp14">MUST</span>
          be unique, and it is not used in the encoding.<a href="#section-15.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-15.4-5.2">CBOR Key: This field contains the value used as CBOR map
          key of the item. The value <span class="bcp14">MUST</span> be unique. The value
          is an unsigned integer or a negative integer. Different ranges of
          values use different registration policies <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Integer values from -256 to 255 are designated
          as "Standards Action With Expert Review". Integer values from -65536
          to -257 and from 256 to 65535 are designated as "Specification
          Required". Integer values greater than 65535 are designated as
          "Expert Review". Integer values less than -65536 are marked as
          "Private Use".<a href="#section-15.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-15.4-5.3">CBOR Type: This field contains the allowable CBOR data
          types for values of this item or a pointer to the registry that
          defines its type, when that depends on another item.<a href="#section-15.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-15.4-5.4">Reference: This field contains a pointer to the public
          specification for the item.<a href="#section-15.4-5.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-15.4-6">This registry has been initially populated by the values in <a href="#trl-registry-parameters" class="auto internal xref">Section 12</a>. The "Reference" column for all of these entries refers to this document.<a href="#section-15.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-token-revocation-list-errors">
<section id="section-15.5">
        <h3 id="name-ace-token-revocation-list-err">
<a href="#section-15.5" class="section-number selfRef">15.5. </a><a href="#name-ace-token-revocation-list-err" class="section-name selfRef">ACE Token Revocation List Errors</a>
        </h3>
<p id="section-15.5-1">IANA has established the "ACE Token Revocation List Errors"  registry within the "Authentication and Authorization for Constrained Environments (ACE)" registry group.<a href="#section-15.5-1" class="pilcrow">¶</a></p>
<p id="section-15.5-2">One of the following registration policies is used: "Standards Action With Expert Review", "Specification Required" per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.6" class="relref">Section 4.6</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>, or "Expert Review" per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Expert Review guidelines are provided in <a href="#review" class="auto internal xref">Section 15.6</a>.<a href="#section-15.5-2" class="pilcrow">¶</a></p>
<p id="section-15.5-3">All assignments according to "Standards Action With Expert Review" are made on a "Standards Action" basis per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.9" class="relref">Section 4.9</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> with Expert Review additionally required per <span><a href="https://rfc-editor.org/rfc/rfc8126#section-4.5" class="relref">Section 4.5</a> of [<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. The procedure for early IANA allocation of Standards Track code points defined in <span>[<a href="#RFC7120" class="cite xref">RFC7120</a>]</span> also applies. When such a procedure is used, IANA will ask the designated expert(s) to approve the early allocation before registration. In addition, WG chairs are encouraged to consult the expert(s) early during the process outlined in <span><a href="https://rfc-editor.org/rfc/rfc7120#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7120" class="cite xref">RFC7120</a>]</span>.<a href="#section-15.5-3" class="pilcrow">¶</a></p>
<p id="section-15.5-4">The columns of this registry are as follows:<a href="#section-15.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-15.5-5.1">
            <p id="section-15.5-5.1.1">Value: The field contains the value to be used to identify the error. The value <span class="bcp14">MUST</span> be unique. The value is an unsigned integer or a negative integer. Different ranges of values use different registration policies <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Integer values from -256 to 255 are designated as "Standards Action With Expert Review". Integer values from -65536 to -257 and from 256 to 65535 are designated as "Specification Required". Integer values greater than 65535 are designated as "Expert Review". Integer values less than -65536 are marked as "Private Use".<a href="#section-15.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-15.5-5.2">
            <p id="section-15.5-5.2.1">Description: This field contains a brief description of the error.<a href="#section-15.5-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-15.5-5.3">
            <p id="section-15.5-5.3.1">Reference: This field contains a pointer to the public specification defining the error, if one exists.<a href="#section-15.5-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-15.5-6">This registry has been initially populated by the values in <a href="#error-types" class="auto internal xref">Section 13</a>. The "Reference" column for all of these entries refers to this document.<a href="#section-15.5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="review">
<section id="section-15.6">
        <h3 id="name-expert-review-instructions">
<a href="#section-15.6" class="section-number selfRef">15.6. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-15.6-1">The IANA registries established by this document use "Standards Action With Expert Review", "Specification Required", or "Expert Review" registration procedures depending on the range of values for which an assignment is requested. This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason, so they should be given substantial latitude.<a href="#section-15.6-1" class="pilcrow">¶</a></p>
<p id="section-15.6-2">Expert reviewers should take into consideration the following points:<a href="#section-15.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-15.6-3.1">
            <p id="section-15.6-3.1.1">Point squatting should be discouraged. Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments. The zones tagged as Private Use are intended for testing purposes and closed environments. Code points in other ranges should not be assigned for testing.<a href="#section-15.6-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-15.6-3.2">
            <p id="section-15.6-3.2.1">Specifications are required for the "Standards Action With Expert Review" range of point assignment. Specifications should exist for "Specification Required" ranges, but early assignment before a specification is available is considered to be permissible. For the "Expert Review" range of point assignment, specifications are recommended and are needed if they are expected to be used outside of closed environments in an interoperable way. When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.<a href="#section-15.6-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-15.6-3.3">
            <p id="section-15.6-3.3.1">Experts should take into account the expected usage of fields when approving point assignment. The fact that there is a range for Standards Track documents does not mean that a Standards Track document cannot have points assigned outside of that range. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-15.6-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-16">
      <h2 id="name-references">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-16.1">
        <h3 id="name-normative-references">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="IANA.Hash.Algorithms">[IANA.Hash.Algorithms]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Named Information Hash Algorithm Registry"</span>, <span>&lt;<a href="https://www.iana.org/assignments/named-information">https://www.iana.org/assignments/named-information</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3629">[RFC3629]</dt>
        <dd>
<span class="refAuthor">Yergeau, F.</span>, <span class="refTitle">"UTF-8, a transformation format of ISO 10646"</span>, <span class="seriesInfo">STD 63</span>, <span class="seriesInfo">RFC 3629</span>, <span class="seriesInfo">DOI 10.17487/RFC3629</span>, <time datetime="2003-11" class="refDate">November 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3629">https://www.rfc-editor.org/info/rfc3629</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6347">[RFC6347]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span> and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"Datagram Transport Layer Security Version 1.2"</span>, <span class="seriesInfo">RFC 6347</span>, <span class="seriesInfo">DOI 10.17487/RFC6347</span>, <time datetime="2012-01" class="refDate">January 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6347">https://www.rfc-editor.org/info/rfc6347</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6838">https://www.rfc-editor.org/info/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6920">[RFC6920]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Kutscher, D.</span>, <span class="refAuthor">Dannewitz, C.</span>, <span class="refAuthor">Ohlman, B.</span>, <span class="refAuthor">Keranen, A.</span>, and <span class="refAuthor">P. Hallam-Baker</span>, <span class="refTitle">"Naming Things with Hashes"</span>, <span class="seriesInfo">RFC 6920</span>, <span class="seriesInfo">DOI 10.17487/RFC6920</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6920">https://www.rfc-editor.org/info/rfc6920</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7120">[RFC7120]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refTitle">"Early IANA Allocation of Standards Track Code Points"</span>, <span class="seriesInfo">BCP 100</span>, <span class="seriesInfo">RFC 7120</span>, <span class="seriesInfo">DOI 10.17487/RFC7120</span>, <time datetime="2014-01" class="refDate">January 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7120">https://www.rfc-editor.org/info/rfc7120</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7515">[RFC7515]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Signature (JWS)"</span>, <span class="seriesInfo">RFC 7515</span>, <span class="seriesInfo">DOI 10.17487/RFC7515</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7516">[RFC7516]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">J. Hildebrand</span>, <span class="refTitle">"JSON Web Encryption (JWE)"</span>, <span class="seriesInfo">RFC 7516</span>, <span class="seriesInfo">DOI 10.17487/RFC7516</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7641">https://www.rfc-editor.org/info/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8259">[RFC8259]</dt>
        <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8259">https://www.rfc-editor.org/info/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8725">[RFC8725]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span>, <span class="refAuthor">Hardt, D.</span>, and <span class="refAuthor">M. Jones</span>, <span class="refTitle">"JSON Web Token Best Current Practices"</span>, <span class="seriesInfo">BCP 225</span>, <span class="seriesInfo">RFC 8725</span>, <span class="seriesInfo">DOI 10.17487/RFC8725</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8725">https://www.rfc-editor.org/info/rfc8725</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9052">[RFC9052]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9052</span>, <span class="seriesInfo">DOI 10.17487/RFC9052</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9052">https://www.rfc-editor.org/info/rfc9052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9147">[RFC9147]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9147">https://www.rfc-editor.org/info/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9200">https://www.rfc-editor.org/info/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9202">[RFC9202]</dt>
        <dd>
<span class="refAuthor">Gerdes, S.</span>, <span class="refAuthor">Bergmann, O.</span>, <span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Datagram Transport Layer Security (DTLS) Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="seriesInfo">RFC 9202</span>, <span class="seriesInfo">DOI 10.17487/RFC9202</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9202">https://www.rfc-editor.org/info/rfc9202</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9203">[RFC9203]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">M. Gunnarsson</span>, <span class="refTitle">"The Object Security for Constrained RESTful Environments (OSCORE) Profile of the Authentication and Authorization for Constrained Environments (ACE) Framework"</span>, <span class="seriesInfo">RFC 9203</span>, <span class="seriesInfo">DOI 10.17487/RFC9203</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9203">https://www.rfc-editor.org/info/rfc9203</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9290">[RFC9290]</dt>
        <dd>
<span class="refAuthor">Fossati, T.</span> and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Problem Details for Constrained Application Protocol (CoAP) APIs"</span>, <span class="seriesInfo">RFC 9290</span>, <span class="seriesInfo">DOI 10.17487/RFC9290</span>, <time datetime="2022-10" class="refDate">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9290">https://www.rfc-editor.org/info/rfc9290</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9431">[RFC9431]</dt>
        <dd>
<span class="refAuthor">Sengul, C.</span> and <span class="refAuthor">A. Kirby</span>, <span class="refTitle">"Message Queuing Telemetry Transport (MQTT) and Transport Layer Security (TLS) Profile of Authentication and Authorization for Constrained Environments (ACE) Framework"</span>, <span class="seriesInfo">RFC 9431</span>, <span class="seriesInfo">DOI 10.17487/RFC9431</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9431">https://www.rfc-editor.org/info/rfc9431</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9528">https://www.rfc-editor.org/info/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHA-256">[SHA-256]</dt>
      <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Secure Hash Standard"</span>, <span class="seriesInfo">NIST FIPS PUB 180-4</span>, <span class="seriesInfo">DOI 10.6028/NIST.FIPS.180-4</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-16.2">
        <h3 id="name-informative-references">
<a href="#section-16.2" class="section-number selfRef">16.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-conditional-attributes">[COND-PARAMETERS]</dt>
        <dd>
<span class="refAuthor">Silverajan, B.</span>, <span class="refAuthor">Koster, M.</span>, and <span class="refAuthor">A. Soloway</span>, <span class="refTitle">"Conditional Query Parameters for CoAP Observe"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-conditional-attributes-11</span>, <time datetime="2025-03-16" class="refDate">16 March 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-conditional-attributes-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-conditional-attributes-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7009">[RFC7009]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">Dronia, S.</span>, and <span class="refAuthor">M. Scurtescu</span>, <span class="refTitle">"OAuth 2.0 Token Revocation"</span>, <span class="seriesInfo">RFC 7009</span>, <span class="seriesInfo">DOI 10.17487/RFC7009</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7009">https://www.rfc-editor.org/info/rfc7009</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.bormann-t2trg-stp">[STP]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">K. Hartke</span>, <span class="refTitle">"The Series Transfer Pattern (STP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-t2trg-stp-03</span>, <time datetime="2020-04-07" class="refDate">7 April 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03">https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sec-series-pattern">
<section id="appendix-A">
      <h2 id="name-on-using-the-series-transfe">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-on-using-the-series-transfe" class="section-name selfRef">On Using the Series Transfer Pattern</a>
      </h2>
<p id="appendix-A-1">Performing a diff query of the TRL as specified in <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a> is, in fact, a usage example of the Series Transfer Pattern (STP) defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="cite xref">STP</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">That is, a diff query enables the transfer of a series of diff entries with the AS providing U &lt;= MAX_N diff entries as related to the U most recent TRL updates pertaining to a requester, i.e., a registered device or an administrator.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">When responding to a diff query request from a requester (see <a href="#ssec-trl-diff-query" class="auto internal xref">Section 8</a>), 'diff_set' is a subset of the update collection associated with the requester where each 'diff_entry' record is a series item from that update collection. Note that 'diff_set' specifies the whole current update collection when the value of U is equal to SIZE, i.e., the current number of series items in the update collection.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">The value N of the 'diff' query parameter in the GET request allows the requester and the AS to trade the amount of provided information with the latency of the information transfer.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">Since the update collection associated with each requester includes up to MAX_N series items, the AS deletes the oldest series item when a new one is generated and added to the end of the update collection, due to a new TRL update pertaining to that requester (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>). This addresses the question "When can the server decide to no longer retain older items?" raised in <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.bormann-t2trg-stp" class="cite xref">STP</a>]</span>.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">Furthermore, performing a diff query of the TRL together with the "Cursor" extension as specified in <a href="#sec-using-cursor" class="auto internal xref">Section 9</a> relies, in fact, on the "cursor" pattern of the STP (see <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.bormann-t2trg-stp" class="cite xref">STP</a>]</span>).<a href="#appendix-A-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-trl-parameteters">
<section id="appendix-B">
      <h2 id="name-local-supportive-parameters">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-local-supportive-parameters" class="section-name selfRef">Local Supportive Parameters of the TRL Endpoint</a>
      </h2>
<p id="appendix-B-1"><a href="#_table-TRL-endpoint-parameters" class="auto internal xref">Table 3</a> provides an aggregated overview of the local supportive parameters that the AS internally uses at its TRL endpoint when supporting diff queries (see <a href="#sec-trl-endpoint" class="auto internal xref">Section 6</a>) and the "Cursor" extension (see <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a>).<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Except for MAX_N defined in <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>, all the other parameters are defined in <a href="#sec-trl-endpoint-supporting-cursor" class="auto internal xref">Section 6.2.1</a> and are used only if the AS supports the "Cursor" extension.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">For each parameter, the columns of the table provide the following information. Both a registered device and an administrator are referred to as "requester".<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="appendix-B-4">
        <dt id="appendix-B-4.1">Name:</dt>
        <dd style="margin-left: 1.5em" id="appendix-B-4.2">The parameter name. A name with letters in uppercase denotes a parameter whose value does not change after its initialization.<a href="#appendix-B-4.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="appendix-B-4.3">Single instance:</dt>
        <dd style="margin-left: 1.5em" id="appendix-B-4.4">"Y" if there is a single parameter instance associated with the TRL or "N" if there is one parameter instance per update collection (i.e., per requester).<a href="#appendix-B-4.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="appendix-B-4.5">Description:</dt>
        <dd style="margin-left: 1.5em" id="appendix-B-4.6">A short description of the parameter.<a href="#appendix-B-4.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="appendix-B-4.7">Values:</dt>
        <dd style="margin-left: 1.5em" id="appendix-B-4.8">The unsigned integer values that the parameter can assume, where LB and UB denote the inclusive lower bound and upper bound, respectively.<a href="#appendix-B-4.8" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<span id="name-local-supportive-parameters-"></span><div id="_table-TRL-endpoint-parameters">
<table class="center" id="table-3">
        <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-local-supportive-parameters-" class="selfRef">Local Supportive Parameters of the TRL Endpoint</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Single  instance</th>
            <th class="text-left" rowspan="1" colspan="1">Description</th>
            <th class="text-left" rowspan="1" colspan="1">Values</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">MAX_N</td>
            <td class="text-left" rowspan="1" colspan="1">Y</td>
            <td class="text-left" rowspan="1" colspan="1">Max number of series items in the update collection of each requester</td>
            <td class="text-left" rowspan="1" colspan="1">LB = 1 <br><br> If supporting <br> the "Cursor" extension, then <br> UB = MAX_INDEX+1</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">MAX_DIFF_BATCH</td>
            <td class="text-left" rowspan="1" colspan="1">N</td>
            <td class="text-left" rowspan="1" colspan="1">Max number of diff entries included in a diff query response when using the "Cursor" extension</td>
            <td class="text-left" rowspan="1" colspan="1">LB = 1 <br><br> UB = MAX_N</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">MAX_INDEX</td>
            <td class="text-left" rowspan="1" colspan="1">Y</td>
            <td class="text-left" rowspan="1" colspan="1">Max value of each instance of 'index'</td>
            <td class="text-left" rowspan="1" colspan="1">LB = MAX_N-1 <br><br> UB = (2<sup>64</sup>)-1</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">index</td>
            <td class="text-left" rowspan="1" colspan="1">N</td>
            <td class="text-left" rowspan="1" colspan="1">Value associated with a series item of an update collection</td>
            <td class="text-left" rowspan="1" colspan="1">LB = 0 <br><br> UB = MAX_INDEX</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">last_index</td>
            <td class="text-left" rowspan="1" colspan="1">N</td>
            <td class="text-left" rowspan="1" colspan="1">The 'index' value of the most recently added series item in an update collection</td>
            <td class="text-left" rowspan="1" colspan="1">LB = 0 <br><br> UB = MAX_INDEX</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="sec-RS-examples">
<section id="appendix-C">
      <h2 id="name-interaction-examples">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-interaction-examples" class="section-name selfRef">Interaction Examples</a>
      </h2>
<p id="appendix-C-1">This section provides examples of interactions between an RS as a registered device and an AS. In the examples, all the access tokens issued by the AS are intended to be consumed by the considered RS.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The AS supports both full queries and diff queries of the TRL, as defined in Sections <a href="#ssec-trl-full-query" class="auto internal xref">7</a> and <a href="#ssec-trl-diff-query" class="auto internal xref">8</a>, respectively.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
<p id="appendix-C-3">The RS registration is assumed to be done by the RS sending a POST request with an unspecified payload to the AS, which replies with a 2.01 (Created) response. The payload of the registration response is assumed to be a CBOR map, which, in turn, is assumed to include the following entries:<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-4.1">
          <p id="appendix-C-4.1.1">a 'trl_path' parameter specifying the path of the TRL endpoint;<a href="#appendix-C-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.2">
          <p id="appendix-C-4.2.1">a 'trl_hash' parameter specifying the "Hash Name String" of the hash function used to compute token hashes as defined in <a href="#sec-token-name" class="auto internal xref">Section 4</a>;<a href="#appendix-C-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.3">
          <p id="appendix-C-4.3.1">a 'max_n' parameter specifying the value of MAX_N, i.e., the maximum number of series items that the AS retains in the update collection associated with a registered device (see <a href="#sec-trl-endpoint-supporting-diff-queries" class="auto internal xref">Section 6.2</a>);<a href="#appendix-C-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-C-4.4">
          <p id="appendix-C-4.4.1">possible further parameters related to the registration process.<a href="#appendix-C-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-C-5">Furthermore, 'h(x)' refers to the hash function used to compute the token hashes, as defined in <a href="#sec-token-name" class="auto internal xref">Section 4</a> of this specification and according to <span>[<a href="#RFC6920" class="cite xref">RFC6920</a>]</span>. Assuming the usage of CWTs transported in AS-to-Client responses encoded in CBOR (see <a href="#sec-token-hash-input-c-as-cbor" class="auto internal xref">Section 4.2.1</a>), 'bstr.h(t1)' and 'bstr.h(t2)' denote CBOR byte strings, whose values are the token hashes of the access tokens t1 and t2, respectively.<a href="#appendix-C-5" class="pilcrow">¶</a></p>
<div id="sec-RS-example-1">
<section id="appendix-C.1">
        <h3 id="name-full-query-with-observe">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-full-query-with-observe" class="section-name selfRef">Full Query with Observe</a>
        </h3>
<p id="appendix-C.1-1"><a href="#fig-RS-AS" class="auto internal xref">Figure 10</a> shows an interaction example of a CoAP observation and a full query of the TRL.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
<p id="appendix-C.1-2">In this example, the AS does not support the "Cursor" extension. Hence, the 'cursor' parameter is not included in the payload of the responses to a full query request.<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-"></span><div id="fig-RS-AS">
<figure id="figure-10">
          <div class="alignCenter art-ascii-art art-text artwork" id="appendix-C.1-3.1">
<pre>
RS                                                     AS
|                                                       |
|  Registration: POST                                   |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|                        2.01 Created                   |
|                          Payload: {                   |
|                            / ... /                    |
|                            "trl_path": "/revoke/trl", |
|                            "trl_hash": "sha-256",     |
|                               "max_n": 10             |
|                          }                            |
|                                                       |
|  GET coap://as.example.com/revoke/trl/                |
|    Observe: 0                                         |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 42                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: []                           |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|             (Access tokens t1 and t2 issued           |
|             and successfully submitted to RS)         |
|                                                       |
|                          ...                          |
|                                                       |
|              (Access token t1 is revoked)             |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 53                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t1)]                 |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|              (Access token t2 is revoked)             |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 64                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t1), bstr.h(t2)]     |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t1 expires)               |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 75                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t2)]                 |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t2 expires)               |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 86                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: []                           |
|        }                                              |
|                                                       |
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-interaction-for-full-query-" class="selfRef">Interaction for Full Query with Observe</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-2">
<section id="appendix-C.2">
        <h3 id="name-diff-query-with-observe">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-diff-query-with-observe" class="section-name selfRef">Diff Query with Observe</a>
        </h3>
<p id="appendix-C.2-1"><a href="#fig-RS-AS-2" class="auto internal xref">Figure 11</a> shows an interaction example of a CoAP observation and a diff query of the TRL.<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<p id="appendix-C.2-2">The RS indicates N = 3 as the value of the 'diff' query parameter, i.e., as the maximum number of diff entries to be included in a response from the AS.<a href="#appendix-C.2-2" class="pilcrow">¶</a></p>
<p id="appendix-C.2-3">In this example, the AS does not support the "Cursor" extension. Hence, the 'cursor' parameter and the 'more' parameter are not included in the payload of the responses to a diff query request.<a href="#appendix-C.2-3" class="pilcrow">¶</a></p>
<span id="name-interaction-for-diff-query-"></span><div id="fig-RS-AS-2">
<figure id="figure-11">
          <div class="alignCenter art-ascii-art art-text artwork" id="appendix-C.2-4.1">
<pre>
RS                                                     AS
|                                                       |
|  Registration: POST                                   |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|                        2.01 Created                   |
|                          Payload: {                   |
|                            / ... /                    |
|                            "trl_path": "/revoke/trl", |
|                            "trl_hash": "sha-256",     |
|                               "max_n": 10             |
|                          }                            |
|                                                       |
|  GET coap://as.example.com/revoke/trl?diff=3          |
|    Observe: 0                                         |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 42                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: []                           |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|             (Access tokens t1 and t2 issued           |
|             and successfully submitted to RS)         |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t1 is revoked)            |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 53                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: [                            |
|                           [ [], [bstr.h(t1)] ]        |
|                          ]                            |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t2 is revoked)            |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 64                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: [                            |
|                           [ [], [bstr.h(t2)] ],       |
|                           [ [], [bstr.h(t1)] ]        |
|                          ]                            |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t1 expires)               |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 75                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: [                            |
|                           [ [bstr.h(t1)], [] ],       |
|                           [ [], [bstr.h(t2)] ],       |
|                           [ [], [bstr.h(t1)] ]        |
|                          ]                            |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t2 expires)               |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 86                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: [                            |
|                           [ [bstr.h(t2)], [] ],       |
|                           [ [bstr.h(t1)], [] ],       |
|                           [ [], [bstr.h(t2)] ]        |
|                          ]                            |
|        }                                              |
|                                                       |
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-interaction-for-diff-query-" class="selfRef">Interaction for Diff Query with Observe</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-3">
<section id="appendix-C.3">
        <h3 id="name-full-query-with-observe-and">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-full-query-with-observe-and" class="section-name selfRef">Full Query with Observe and Diff Query</a>
        </h3>
<p id="appendix-C.3-1"><a href="#fig-RS-AS-3" class="auto internal xref">Figure 12</a> shows an interaction example of a CoAP observation and a full query of the TRL.<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
<p id="appendix-C.3-2">The example also shows one of the notifications from the AS getting lost in transmission; thus, that notification does not reach the RS.<a href="#appendix-C.3-2" class="pilcrow">¶</a></p>
<p id="appendix-C.3-3">When this happens, and after a waiting time defined by the application has elapsed, the RS sends a GET request with no Observe Option to the AS, asking the AS to perform a diff query of the TRL. The RS indicates N = 8 as the value of the 'diff' query parameter, i.e., as the maximum number of diff entries to be included in a response from the AS.<a href="#appendix-C.3-3" class="pilcrow">¶</a></p>
<p id="appendix-C.3-4">In this example, the AS does not support the "Cursor" extension. Hence, the 'cursor' parameter is not included in the payload of the responses to a full query request. Also, the 'cursor' parameter and the 'more' parameter are not included in the payload of the responses to a diff query request.<a href="#appendix-C.3-4" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-w"></span><div id="fig-RS-AS-3">
<figure id="figure-12">
          <div class="alignCenter art-ascii-art art-text artwork" id="appendix-C.3-5.1">
<pre>
RS                                                     AS
|                                                       |
|  Registration: POST                                   |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|                        2.01 Created                   |
|                          Payload: {                   |
|                            / ... /                    |
|                            "trl_path": "/revoke/trl", |
|                            "trl_hash": "sha-256",     |
|                               "max_n": 10             |
|                          }                            |
|                                                       |
|  GET coap://as.example.com/revoke/trl/                |
|    Observe: 0                                         |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 42                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: []                           |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|           (Access tokens t1 and t2 issued             |
|           and successfully submitted to RS)           |
|                                                       |
|                          ...                          |
|                                                       |
|              (Access token t1 is revoked)             |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 53                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t1)]                 |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|              (Access token t2 is revoked)             |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 64                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t1), bstr.h(t2)]     |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t1 expires)               |
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Observe: 75                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: [bstr.h(t2)]                 |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|               (Access token t2 expires)               |
|                                                       |
|  Lost X &lt;---------------------------------------------+
|      2.05 Content                                     |
|        Observe: 86                                    |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / full_set / 0: []                           |
|        }                                              |
|                                                       |
|                          ...                          |
|                                                       |
|           (Enough time has passed since               |
|           the latest received notification)           |
|                                                       |
|                                                       |
|  GET coap://as.example.com/revoke/trl?diff=8          |
+------------------------------------------------------&gt;|
|                                                       |
|&lt;------------------------------------------------------+
|      2.05 Content                                     |
|        Content-Format: 262 (application/ace-trl+cbor) |
|        Payload: {                                     |
|          / diff_set / 1: [                            |
|                           [ [bstr.h(t2)], [] ],       |
|                           [ [bstr.h(t1)], [] ],       |
|                           [ [], [bstr.h(t2)] ],       |
|                           [ [], [bstr.h(t1)] ]        |
|                          ]                            |
|        }                                              |
|                                                       |
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-interaction-for-full-query-w" class="selfRef">Interaction for Full Query with Observe and Diff Query</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-2-3">
<section id="appendix-C.4">
        <h3 id="name-diff-query-with-observe-and">
<a href="#appendix-C.4" class="section-number selfRef">C.4. </a><a href="#name-diff-query-with-observe-and" class="section-name selfRef">Diff Query with Observe and "Cursor" Extension</a>
        </h3>
<p id="appendix-C.4-1">In this example, the AS supports the "Cursor" extension. Hence, the CBOR map conveyed as payload of the registration response additionally includes a "max_diff_batch" parameter. This specifies the value of MAX_DIFF_BATCH, i.e., the maximum number of diff entries that can be included in a response to a diff query request from this RS.<a href="#appendix-C.4-1" class="pilcrow">¶</a></p>
<p id="appendix-C.4-2"><a href="#fig-RS-AS-4" class="auto internal xref">Figure 13</a> shows an interaction example of a CoAP observation and a diff query of the TRL.<a href="#appendix-C.4-2" class="pilcrow">¶</a></p>
<p id="appendix-C.4-3">The RS specifies the 'diff' query parameter with a value of 3, i.e., the maximum number of diff entries to be included in a response from the AS.<a href="#appendix-C.4-3" class="pilcrow">¶</a></p>
<p id="appendix-C.4-4">If the RS has not received a notification from the AS for a waiting time defined by the application, the RS sends a GET request with no Observe Option to the AS, asking the AS to perform a diff query of the TRL.<a href="#appendix-C.4-4" class="pilcrow">¶</a></p>
<p id="appendix-C.4-5">This is followed up by a further diff query request that includes the 'cursor' query parameter. Note that the payload of the corresponding response differs from the payload of the response to the previous diff query request.<a href="#appendix-C.4-5" class="pilcrow">¶</a></p>
<span id="name-interaction-for-diff-query-w"></span><div id="fig-RS-AS-4">
<figure id="figure-13">
          <div class="alignCenter art-ascii-art art-text artwork" id="appendix-C.4-6.1">
<pre>
RS                                                         AS
|                                                           |
|  Registration: POST                                       |
+----------------------------------------------------------&gt;|
|                                                           |
|&lt;----------------------------------------------------------+
|                      2.01 Created                         |
|                        Payload: {                         |
|                          / ... /                          |
|                                "trl_path": "/revoke/trl", |
|                                "trl_hash": "sha-256",     |
|                                   "max_n": 10,            |
|                          "max_diff_batch": 5              |
|                        }                                  |
|                                                           |
|  GET coap://as.example.com/revoke/trl?diff=3              |
|    Observe: 0                                             |
+----------------------------------------------------------&gt;|
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Observe: 42                                    |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [],                          |
|                / cursor / 2: null,                        |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|                             ...                           |
|                                                           |
|             (Access tokens t1 and t2 issued               |
|             and successfully submitted to RS)             |
|                                                           |
|                             ...                           |
|                                                           |
|               (Access token t1 is revoked)                |
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Observe: 53                                    |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [                            |
|                               [ [], [bstr.h(t1)] ]        |
|                              ],                           |
|                / cursor / 2: 0,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|                             ...                           |
|                                                           |
|               (Access token t2 is revoked)                |
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Observe: 64                                    |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [                            |
|                               [ [], [bstr.h(t2)] ],       |
|                               [ [], [bstr.h(t1)] ]        |
|                              ],                           |
|                / cursor / 2: 1,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|                             ...                           |
|                                                           |
|                 (Access token t1 expires)                 |
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Observe: 75                                    |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [                            |
|                               [ [bstr.h(t1)], [] ],       |
|                               [ [], [bstr.h(t2)] ],       |
|                               [ [], [bstr.h(t1)] ]        |
|                              ],                           |
|                / cursor / 2: 2,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|                             ...                           |
|                                                           |
|                 (Access token t2 expires)                 |
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Observe: 86                                    |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [                            |
|                               [ [bstr.h(t2)], [] ],       |
|                               [ [bstr.h(t1)], [] ],       |
|                               [ [], [bstr.h(t2)] ]        |
|                              ],                           |
|                / cursor / 2: 3,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|                             ...                           |
|                                                           |
|             (Enough time has passed since                 |
|             the latest received notification)             |
|                                                           |
|                                                           |
|  GET coap://as.example.com/revoke/trl?diff=3              |
+----------------------------------------------------------&gt;|
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [                            |
|                               [ [bstr.h(t2)], [] ],       |
|                               [ [bstr.h(t1)], [] ],       |
|                               [ [], [bstr.h(t2)] ]        |
|                              ],                           |
|                / cursor / 2: 3,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
|  GET coap://as.example.com/revoke/trl?diff=3&amp;cursor=3     |
+----------------------------------------------------------&gt;|
|                                                           |
|&lt;----------------------------------------------------------+
|          2.05 Content                                     |
|            Content-Format: 262 (application/ace-trl+cbor) |
|            Payload: {                                     |
|              / diff_set / 1: [],                          |
|                / cursor / 2: 3,                           |
|                  / more / 3: false                        |
|            }                                              |
|                                                           |
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-interaction-for-diff-query-w" class="selfRef">Interaction for Diff Query with Observe and "Cursor" Extension</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-5">
<section id="appendix-C.5">
        <h3 id="name-full-query-with-observe-and-">
<a href="#appendix-C.5" class="section-number selfRef">C.5. </a><a href="#name-full-query-with-observe-and-" class="section-name selfRef">Full Query with Observe and Diff Query with "Cursor" Extension</a>
        </h3>
<p id="appendix-C.5-1">In this example, the AS supports the "Cursor" extension. Hence, the CBOR map conveyed as payload of the registration response additionally includes a "max_diff_batch" parameter. This specifies the value of MAX_DIFF_BATCH, i.e., the maximum number of diff entries that can be included in a response to a diff query request from this RS.<a href="#appendix-C.5-1" class="pilcrow">¶</a></p>
<p id="appendix-C.5-2"><a href="#fig-RS-AS-5" class="auto internal xref">Figure 14</a> shows an interaction example of a CoAP observation and a full query of the TRL.<a href="#appendix-C.5-2" class="pilcrow">¶</a></p>
<p id="appendix-C.5-3">The example also shows some of the notifications from the AS getting lost in transmission; thus, those notifications do not reach the RS.<a href="#appendix-C.5-3" class="pilcrow">¶</a></p>
<p id="appendix-C.5-4">When this happens, and after a waiting time defined by the application has elapsed, the RS sends a GET request with no Observe Option to the AS, asking the AS to perform a diff query of the TRL. In particular, the RS specifies:<a href="#appendix-C.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.5-5.1">
            <p id="appendix-C.5-5.1.1">The 'diff' query parameter with a value of 8, i.e., the maximum number of diff entries to be included in a response from the AS.<a href="#appendix-C.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-C.5-5.2">
            <p id="appendix-C.5-5.2.1">The 'cursor' query parameter with a value of 2, thus requesting from the update collection the series items following the one with the 'index' value equal to 2 (i.e., following the last series item that the RS successfully received in an earlier notification response).<a href="#appendix-C.5-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-C.5-6">The response from the AS conveys a first batch of MAX_DIFF_BATCH = 5 series items from the update collection corresponding to the RS. The AS indicates that further series items are actually available in the update collection by setting the 'more' parameter of the response to <code>true</code>. Also, the 'cursor' parameter of the response is set to 7, i.e., to the 'index' value of the most recent series item included in the response.<a href="#appendix-C.5-6" class="pilcrow">¶</a></p>
<p id="appendix-C.5-7">After that, the RS follows up with a further diff query request including the 'cursor' query parameter with a value of 7 in order to retrieve the next and last batch of series items from the update collection.<a href="#appendix-C.5-7" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-wi"></span><div id="fig-RS-AS-5">
<figure id="figure-14">
          <div class="alignCenter art-ascii-art art-text artwork" id="appendix-C.5-8.1">
<pre>
RS                                                                AS
|                                                                  |
|  Registration: POST                                              |
+-----------------------------------------------------------------&gt;|
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                             2.01 Created                         |
|                               Payload: {                         |
|                                 / ... /                          |
|                                       "trl_path": "/revoke/trl", |
|                                       "trl_hash": "sha-256",     |
|                                          "max_n": 10,            |
|                                 "max_diff_batch": 5              |
|                               }                                  |
|                                                                  |
|  GET coap://as.example.com/revoke/trl/                           |
|    Observe: 0                                                    |
+-----------------------------------------------------------------&gt;|
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 42                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [],                          |
|                       / cursor / 2: null                         |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                 (Access tokens t1, t2, t3 issued                 |
|                 and successfully submitted to RS)                |
|                                                                  |
|                                ...                               |
|                                                                  |
|                 (Access tokens t4, t5, t6 issued                 |
|                 and successfully submitted to RS)                |
|                                                                  |
|                                ...                               |
|                                                                  |
|                   (Access token t1 is revoked)                   |
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 53                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t1)],                |
|                       / cursor / 2: 0                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                    (Access token t2 is revoked)                  |
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 64                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t1), bstr.h(t2)],    |
|                       / cursor / 2: 1                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t1 expires)                    |
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 75                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t2)],                |
|                       / cursor / 2: 2                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t2 expires)                    |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 86                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [],                          |
|                       / cursor / 2: 3                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t3 is revoked)                 |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 88                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t3)],                |
|                       / cursor / 2: 4                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t4 is revoked)                 |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 89                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t3), bstr.h(t4)],    |
|                       / cursor / 2: 5                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t3 expires)                    |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 90                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t4)],                |
|                       / cursor / 2: 6                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t4 expires)                    |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 91                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [],                          |
|                       / cursor / 2: 7                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|               (Access tokens t5 and t6 are revoked)              |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 92                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t5), bstr.h(t6)],    |
|                       / cursor / 2: 8                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t5 expires)                    |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 93                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [bstr.h(t6)],                |
|                       / cursor / 2: 9                            |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                     (Access token t6 expires)                    |
|                                                                  |
|  Lost X &lt;--------------------------------------------------------+
|                 2.05 Content                                     |
|                   Observe: 94                                    |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / full_set / 0: [],                          |
|                       / cursor / 2: 10                           |
|                   }                                              |
|                                                                  |
|                                ...                               |
|                                                                  |
|                 (Enough time has passed since                    |
|                 the latest received notification)                |
|                                                                  |
|                                                                  |
|  GET coap://as.example.com/revoke/trl?diff=8&amp;cursor=2            |
+-----------------------------------------------------------------&gt;|
|                                                                  |
|&lt;-----------------------------------------------------------------+
|                 2.05 Content                                     |
|                   Content-Format: 262 (application/ace-trl+cbor) |
|                   Payload: {                                     |
|                     / diff_set / 1: [                            |
|                                      [ [bstr.h(t4)], [] ],       |
|                                      [ [bstr.h(t3)], [] ],       |
|                                      [ [], [bstr.h(t4)] ],       |
|                                      [ [], [bstr.h(t3)] ],       |
|                                      [ [bstr.h(t2)], [] ]        |
|                                     ],                           |
|                       / cursor / 2: 7,                           |
|                         / more / 3: true                         |
|                   }                                              |
|                                                                  |
|  GET coap://as.example.com/revoke/trl?diff=8&amp;cursor=7            |
+-----------------------------------------------------------------&gt;|
|                                                                  |
|&lt;-----------------------------------------------------------------+
|            2.05 Content                                          |
|              Content-Format: 262 (application/ace-trl+cbor)      |
|              Payload: {                                          |
|                / diff_set / 1: [                                 |
|                                 [ [bstr.h(t6)], [] ],            |
|                                 [ [bstr.h(t5)], [] ],            |
|                                 [ [], [bstr.h(t5), bstr.h(t6)] ] |
|                                ],                                |
|                  / cursor / 2: 10,                               |
|                    / more / 3: false                             |
|              }                                                   |
|                                                                  |
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-interaction-for-full-query-wi" class="selfRef">Interaction for Full Query with Observe and Diff Query with "Cursor" Extension</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="acknowldegment">
<section id="appendix-D">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-D-1"><span class="contact-name">Ludwig Seitz</span> contributed as a coauthor of
      initial versions of this document.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2">The authors sincerely thank <span class="contact-name">Christian Amsüss</span>,
      <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">Deb Cooley</span>,
      <span class="contact-name">Roman Danyliw</span>, <span class="contact-name">Dhruv Dhody</span>,
      <span class="contact-name">Rikard Höglund</span>, <span class="contact-name">Benjamin       Kaduk</span>, <span class="contact-name">David Navarro</span>, <span class="contact-name">Joerg       Ott</span>, <span class="contact-name">Marco Rasori</span>, <span class="contact-name">Michael       Richardson</span>, <span class="contact-name">Kyle Rose</span>, <span class="contact-name">Zaheduzzaman Sarker</span>, <span class="contact-name">Jim Schaad</span>,
      <span class="contact-name">Göran Selander</span>, <span class="contact-name">Travis       Spencer</span>, <span class="contact-name">Orie Steele</span>, <span class="contact-name">Éric       Vyncke</span>, <span class="contact-name">Niklas Widell</span>, <span class="contact-name">Dale       Worley</span>, and <span class="contact-name">Paul Wouters</span> for their comments and
      feedback.<a href="#appendix-D-2" class="pilcrow">¶</a></p>
<p id="appendix-D-3">The work on this document has been partly supported by the Sweden's
      Innovation Agency VINNOVA and the Celtic-Next projects CRITISEC and
      CYPRESS; and by the H2020 project SIFIS-Home (Grant agreement
      952652).<a href="#appendix-D-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">164 40</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">164 40</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sebastian Echeverria</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh</span>, <span class="region">PA</span> <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:secheverria@sei.cmu.edu" class="email">secheverria@sei.cmu.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Grace Lewis</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh</span>, <span class="region">PA</span> <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:glewis@sei.cmu.edu" class="email">glewis@sei.cmu.edu</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
